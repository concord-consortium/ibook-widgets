!function(){function FastClick(e){"use strict";var t,n=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e,!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(n,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(n,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(n,arguments)},FastClick.notNeeded(e)||(this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;"click"===t?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;"click"===t?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),"function"==typeof e.onclick&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null))}function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],i=0;i<r.length;i++){var o=r[i].re,a=r[i].process,s=o.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.getHelpXML=function(){for(var e=new Array,n=0;n<r.length;n++)for(var i=r[n].example,o=0;o<i.length;o++)e[e.length]=i[o];for(var a in t)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(var n=0;n<e.length;n++)try{var l=document.createElement("li"),u=new RGBColor(e[n]),c=document.createElement("div");c.style.cssText="margin: 3px; border: 1px solid black; background:"+u.toHex()+"; color:"+u.toHex(),c.appendChild(document.createTextNode("test"));var d=document.createTextNode(" "+e[n]+" -> "+u.toRGB()+" -> "+u.toHex());l.appendChild(c),l.appendChild(d),s.appendChild(l)}catch(p){}return s}}var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,r,i,o,a,s,l,u,c,d,p=t&&t.split("/"),h=m.map,f=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=p.concat(e.split("/")),u=0;u<e.length;u+=1)if(d=e[u],"."===d)e.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||f)&&h){for(n=e.split("/"),u=n.length;u>0;u-=1){if(r=n.slice(0,u).join("/"),p)for(c=p.length;c>0;c-=1)if(i=h[p.slice(0,c).join("/")],i&&(i=i[r])){o=i,a=u;break}if(o)break;!s&&f&&f[r]&&(s=f[r],l=u)}!o&&s&&(o=s,a=l),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function r(t,n){return function(){return c.apply(e,y.call(arguments,0).concat([t,n]))}}function i(e){return function(t){return n(t,e)}}function o(e){return function(t){h[e]=t}}function a(n){if(t(f,n)){var r=f[n];delete f[n],g[n]=!0,u.apply(e,r)}if(!t(h,n)&&!t(g,n))throw new Error("No "+n);return h[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return m&&m.config&&m.config[e]||{}}}var u,c,d,p,h={},f={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;d=function(e,t){var r,o=s(e),l=o[0];return e=o[1],l&&(l=n(l,t),r=a(l)),l?e=r&&r.normalize?r.normalize(e,i(t)):n(e,t):(e=n(e,t),o=s(e),l=o[0],e=o[1],l&&(r=a(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:r}},p={require:function(e){return r(e)},exports:function(e){var t=h[e];return"undefined"!=typeof t?t:h[e]={}},module:function(e){return{id:e,uri:"",exports:h[e],config:l(e)}}},u=function(n,i,s,l){var u,c,m,v,y,b,x=[];if(l=l||n,"function"==typeof s){for(i=!i.length&&s.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=d(i[y],l),c=v.f,"require"===c)x[y]=p.require(n);else if("exports"===c)x[y]=p.exports(n),b=!0;else if("module"===c)u=x[y]=p.module(n);else if(t(h,c)||t(f,c)||t(g,c))x[y]=a(c);else{if(!v.p)throw new Error(n+" missing "+c);v.p.load(v.n,r(l,!0),o(c),{}),x[y]=h[c]}m=s.apply(h[n],x),n&&(u&&u.exports!==e&&u.exports!==h[n]?h[n]=u.exports:m===e&&b||(h[n]=m))}else n&&(h[n]=s)},requirejs=require=c=function(t,n,r,i,o){return"string"==typeof t?p[t]?p[t](n):a(d(t,n).f):(t.splice||(m=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},"function"==typeof r&&(r=i,i=o),i?u(e,t,n,r):setTimeout(function(){u(e,t,n,r)},4),c)},c.config=function(e){return m=e,m.deps&&c(m.deps,m.callback),c},define=function(e,n,r){n.splice||(r=n,n=[]),t(h,e)||t(f,e)||(f[e]=[e,n,r])},define.amd={jQuery:!0}}(),define("../../vendor/almond/almond",function(){}),define("lab.version",["require"],function(){return{repo:{branch:"master",commit:{sha:"6746bd35aaa1f4208875b79130a4dab94eabf145",short_sha:"6746bd35",url:"https://github.com/concord-consortium/lab/commit/6746bd35",author:"Richard Klancer",email:"rpk@pobox.com",date:"2014-03-27 20:49:36 +0000",short_message:"Avoid WebGL complaints about tiny atom textures",message:"Avoid WebGL complaints about tiny atom textures"},last_tag:"1.0.0-pre.2",dirty:!1}}}),define("common/actual-root",[],function(){var e,t=/^(\/.+?\/)(interactives|embeddable)\.html$/,n=/(\/.+?\/)(doc|examples|experiments)(\/\w+)*?\/\w+\.html/;return e=document.location.pathname.match(t),e&&e[1]?e[1]:(e=document.location.pathname.match(n),e&&e[1]||"/")}),define("lab.config",["require","common/actual-root"],function(e){var t=e("common/actual-root");return{sharing:!0,logging:!1,tracing:!1,homeForSharing:"",homeEmbeddablePath:"/embeddable.html",rootUrl:"lab",dataGamesProxyPrefix:"",fontface:"Lato",utmCampaign:null,versionedHome:null,actualRoot:t}}),function(e,t,n,r,i,o){function a(e){var t,n=e.length,i=this,o=0,a=i.i=i.j=0,s=i.S=[];for(n||(e=[n++]);r>o;)s[o]=o++;for(o=0;r>o;o++)s[o]=s[a=f&a+e[o%n]+(t=s[o])],s[a]=t;(i.g=function(e){for(var t,n=0,o=i.i,a=i.j,s=i.S;e--;)t=s[o=f&o+1],n=n*r+s[f&(s[o]=s[a=f&a+t])+(s[a]=t)];return i.i=o,i.j=a,n})(r)}function s(e,t){var n,r=[],i=(typeof e)[0];if(t&&"o"==i)for(n in e)try{r.push(s(e[n],t-1))}catch(o){}return r.length?r:"s"==i?e:e+"\x00"}function l(e,t){for(var n,r=e+"",i=0;i<r.length;)t[f&i]=f&(n^=19*t[f&i])+r.charCodeAt(i++);return c(t)}function u(n){try{return e.crypto.getRandomValues(n=new Uint8Array(r)),c(n)}catch(i){return[+new Date,e,e.navigator.plugins,e.screen,c(t)]}}function c(e){return String.fromCharCode.apply(0,e)}var d=n.pow(r,i),p=n.pow(2,o),h=2*p,f=r-1;n.seedrandom=function(e,o){var f=[],m=l(s(o?[e,c(t)]:0 in arguments?e:u(),3),f),g=new a(f);return l(c(g.S),t),n.random=function(){for(var e=g.g(i),t=d,n=0;p>e;)e=(e+n)*r,t*=r,n=g.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t},m},l(n.random(),t)}(this,[],Math,256,6,52),define("seedrandom",function(){}),define("arrays/index",["require","exports","module"],function(e,t){var n={};n.version="0.0.1",n.webgl="undefined"!=typeof window&&!!window.WebGLRenderingContext,n.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),n.create=function(e,t,r){r||(r=n.webgl||n.typed?"Float32Array":"regular"),void 0===t&&(t=0);var i;if("regular"===r)i=new Array(e);else switch(r){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+r+'".')}return n.fill(i,t),i},n.fill=function(e,t){for(var n=-1,r=e.length;++n<r;)e[n]=t},n.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor&&"[object Array]"===Object.prototype.toString.call(e))return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},n.copy=function(e,t,r){for(var i=void 0!==r?r:e.length,o=-1;++o<i;)t[o]=e[o];return n.constructor_function(t)===Array&&(t.length=i),t},n.clone=function(e){var t,r,i,o=e.length;if(i=n.constructor_function(e),i===Array){for(r=new i(o),t=0;o>t;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0));for(r=new i(o),t=0;o>t;t++)r[t]=e[t];return r},n.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},n.max=function(e){return Math.max.apply(Math,e)},n.min=function(e){return Math.min.apply(Math,e)},n.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;i>n;n++)t=e[n],r=t>r?t:r;return r},n.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;i>n;n++)t=e[n],r=r>t?t:r;return r},n.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,o=e.length;for(r=0;o>r;r++)n=e[r],i=n>i?n:i;return i}}},n.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,o=e.length;for(r=0;o>r;r++)n=e[r],i=i>n?n:i;return i}}},n.average=function(e){var t,n=0,r=e.length;for(t=0;r>t;t++)n+=e[t];return n/r},n.extend=function(e,t){var r,i,o;if(i=n.constructor_function(e),i===Array){for(o=e.length,e.length=t;t>o;o++)e[o]=0;return e}return r=new i(t),r.set(e.subarray(0,t)),r},n.remove=function(e,t){var r,i=n.constructor_function(e);if(i!==Array)throw new Error("arrays.remove for typed arrays not implemented yet.");return r=e.slice(t+1),e.length=t,Array.prototype.push.apply(e,r),e},n.isArray=function(e){if(void 0===e||null===e)return!1;switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object Uint8ClampedArray]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":return!0;default:return!1}};for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}),define("arrays",["arrays/index"],function(e){return e}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.determineEventType=function(e){"use strict;";return this.deviceIsAndroid&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(e){"use strict";var t;this.deviceIsIOS&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,n,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],this.deviceIsIOS){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},FastClick.prototype.onTouchMove=function(e){"use strict";return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},FastClick.prototype.findControl=function(e){"use strict";return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,n,r,i,o,a=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(o=e.changedTouches[0],a=document.elementFromPoint(o.pageX-window.pageXOffset,o.pageY-window.pageYOffset)||a,a.fastClickScrollParent=this.targetElement.fastClickScrollParent),r=a.tagName.toLowerCase(),"label"===r){if(t=this.findControl(a)){if(this.focus(a),this.deviceIsAndroid)return!1;a=t}}else if(this.needsFocus(a))return e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&"input"===r?(this.targetElement=null,!1):(this.focus(a),this.deviceIsIOS4&&"select"===r||(this.targetElement=null,e.preventDefault()),!1);return this.deviceIsIOS&&!this.deviceIsIOS4&&(i=a.fastClickScrollParent,i&&i.fastClickLastScrollTop!==i.scrollTop)?!0:(this.needsClick(a)||(e.preventDefault(),this.sendClick(a,e)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){"use strict";return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},FastClick.prototype.onClick=function(e){"use strict";var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){"use strict";var t;if("undefined"==typeof window.ontouchstart)return!0;if(/Chrome\/[0-9]+/.test(navigator.userAgent)){if(!FastClick.prototype.deviceIsAndroid)return!0;if(t=document.querySelector("meta[name=viewport]"),t&&-1!==t.content.indexOf("user-scalable=no"))return!0}return"none"===e.style.msTouchAction?!0:!1},FastClick.attach=function(e){"use strict";return new FastClick(e)},"undefined"!=typeof define&&define.amd?define("fastclick",[],function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,define("common/console",["require","lab.config"],function(e){var t,n,r=e("lab.config"),i=function(){};return"undefined"==typeof console&&(console={},window&&(window.console=console)),n=console,void 0===n.log&&(n.log=i),void 0===n.info&&(n.info=i),void 0===n.warn&&(n.warn=i),void 0===n.error&&(n.error=i),void 0===n.time&&(n.time=i),void 0===n.timeEnd&&(n.timeEnd=i),void 0===n.log.apply&&(n.log=Function.prototype.bind.call(console.log,console)),void 0===n.info.apply&&(n.info=Function.prototype.bind.call(console.info,console)),void 0===n.warn.apply&&(n.warn=Function.prototype.bind.call(console.warn,console)),void 0===n.error.apply&&(n.error=Function.prototype.bind.call(console.error,console)),void 0===n.time.apply&&(n.time=Function.prototype.bind.call(console.time,console)),void 0===n.timeEnd.apply&&(n.timeEnd=Function.prototype.bind.call(console.timeEnd,console)),t={log:function(){r.logging&&n.log.apply(n,arguments)},info:function(){r.logging&&n.info.apply(n,arguments)},warn:function(){r.logging&&n.warn.apply(n,arguments)},error:function(){r.logging&&n.error.apply(n,arguments)},time:function(){r.tracing&&n.time.apply(n,arguments)},timeEnd:function(){r.tracing&&n.timeEnd.apply(n,arguments)}}}),define("common/alert",["require","common/console"],function(e){var t=e("common/console"),n="undefined"!=typeof alert?alert:t.error;return function(e){n(e)}}),define("common/controllers/interactive-metadata",[],function(){return{interactive:{title:{required:!0},publicationStatus:{defaultValue:"public"},labEnvironment:{defaultValue:"production"},subtitle:{defaultValue:""},about:{defaultValue:""},category:{defaultValue:""},subCategory:{defaultValue:""},screenshot:{defaultValue:""},importedFrom:{},aspectRatio:{defaultValue:1.3},fontScale:{defaultValue:1},randomSeed:{required:!1},helpOnLoad:{defaultValue:!1},models:{required:!0},parameters:{defaultValue:[]},dataSets:{defaultValue:[]},propertiesToRetain:{defaultValue:[]},outputs:{defaultValue:[]},filteredOutputs:{defaultValue:[]},experiment:{required:!1},exports:{required:!1},hideExportDataControl:{required:!1,defaultValue:!1},components:{defaultValue:[]},layout:{defaultValue:{}},template:{defaultValue:"simple"},helpTips:{defaultValue:[]}},model:{type:{required:!0},id:{required:!0},url:{conflictsWith:["model"]},importedFrom:{},model:{conflictsWith:["url"]},onLoad:{},viewOptions:{},modelOptions:{},parameters:{},outputs:{},filteredOutputs:{}},parameter:{name:{required:!0},initialValue:{required:!0},onChange:{},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},output:{name:{required:!0},value:{required:!0},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},dataSet:{name:{required:!0},properties:{defaultValue:[]},serializableProperties:{defaultValue:"all"},streamDataFromModel:{defaultValue:!0},clearOnModelReset:{defaultValue:!0},initialData:{}},filteredOutput:{name:{required:!0},property:{required:!0},type:{defaultValue:"RunningAverage"},period:{defaultValue:2500},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},exports:{selectionComponents:{required:!1,defaultValue:[]},perRun:{required:!1,defaultValue:[]},perTick:{required:!0}},experiment:{timeSeries:{required:!0},parameters:{required:!0,defaultValue:[]},destinations:{required:!0,defaultValue:[]},stateButtons:{required:!0,startRun:{required:!0,defaultValue:"start-run"},stopRun:{required:!0,defaultValue:"stop-run"},saveRun:{required:!0,defaultValue:"save-run"},nextRun:{required:!0,defaultValue:"next-run"},clearAll:{required:!0,defaultValue:"clear-all"}},onReset:{},savedRuns:{defaultValue:[]}},experimentTimeSeries:{time:{defaultValue:"displayTime"},properties:{required:!0,defaultValue:[]}},experimentParameter:{inputs:{required:!0,defaultValue:[]},outputs:{required:!0,defaultValue:[]}},experimentDestination:{type:{required:!0},componentIds:{required:!0,defaultValue:[]},properties:{required:!0,defaultValue:[]}},experimentSavedRun:{timeStamp:{required:!0},timeSeries:{required:!0,defaultValue:[]},parameters:{required:!0,defaultValue:[]}},playback:{id:{required:!0},type:{required:!0},stepping:{defaultValue:!0}},text:{id:{required:!0},type:{required:!0},onClick:{},text:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},tooltip:{defaultValue:""}},image:{id:{required:!0},type:{required:!0},src:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},tooltip:{defaultValue:""}},div:{id:{required:!0},type:{required:!0},content:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},classes:{defaultValue:[]},tooltip:{defaultValue:""}},button:{id:{required:!0},type:{required:!0},action:{required:!0},text:{defaultValue:""},width:{defaultValue:""},height:{defaultValue:""},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},checkbox:{id:{required:!0},type:{required:!0},text:{defaultValue:""},textOn:{defaultValue:"right"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{conflictsWith:["initialValue","action"]},retainProperty:{defaultValue:!0},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},slider:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},steps:{required:!0},title:{defaultValue:""},labels:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},property:{conflictsWith:["initialValue","action"]},retainProperty:{defaultValue:!0},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},pulldown:{id:{required:!0},type:{required:!0},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{},retainProperty:{defaultValue:!0},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},pulldownOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{}},radio:{id:{required:!0},type:{required:!0},orientation:{defaultValue:"vertical"},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{},retainProperty:{defaultValue:!0},disabled:{defaultValue:!1},tooltip:{defaultValue:""}},radioOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{}},numericOutput:{id:{required:!0},type:{required:!0},property:{required:!0},label:{defaultValue:""},units:{defaultValue:""},orientation:{defaultValue:"horizontal"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},tooltip:{defaultValue:""}},thermometer:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},width:{defaultValue:"2.5em"},height:{defaultValue:"100%"},labelIsReading:{defaultValue:!1},reading:{defaultValue:{units:"K",offset:0,scale:1,digits:0}},labels:{defaultValue:[]}},table:{id:{required:!0},type:{required:!0},title:{defaultValue:null},dataSet:{conflictsWith:["tableData","clearOnModelReset","streamDataFromModel"]},tableData:{conflictsWith:["dataSet"]},clearOnModelReset:{conflictsWith:["dataSet"]},streamDataFromModel:{conflictsWith:["dataSet"]},addNewRows:{defaultValue:!0},visibleRows:{defaultValue:4},showBlankRow:{defaultValue:!1},indexColumn:{defaultValue:!0},propertyColumns:{defaultValue:[]},headerData:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"100%"},tooltip:{defaultValue:""}},graph:{id:{required:!0},type:{required:!0},dataSet:{conflictsWith:["dataPoints","clearOnModelReset","streamDataFromModel"]},dataPoints:{conflictsWith:["dataSet"]},clearOnModelReset:{conflictsWith:["dataSet"]},streamDataFromModel:{conflictsWith:["dataSet"]},resetAxesOnReset:{defaultValue:!0},enableAutoScaleButton:{defaultValue:!0},enableAxisScaling:{defaultValue:!0},autoScaleX:{defaultValue:!0},autoScaleY:{defaultValue:!0},enableSelectionButton:{defaultValue:!1},clearSelectionOnLeavingSelectMode:{defaultValue:!1},markAllDataPoints:{defaultValue:!1},showRulersOnSelection:{defaultValue:!1},fontScaleRelativeToParent:{defaultValue:!0},properties:{defaultValue:[]},xProperty:{defaultValue:"displayTime"},title:{defaultValue:"Graph"},lineWidth:{defaultValue:2},width:{defaultValue:"100%"},height:{defaultValue:"100%"},xlabel:{defaultValue:"auto"},xmin:{defaultValue:0},xmax:{defaultValue:20},ylabel:{defaultValue:"auto"},ymin:{defaultValue:0},ymax:{defaultValue:10},xTickCount:{defaultValue:10},yTickCount:{defaultValue:10},xscaleExponent:{defaultValue:.5},yscaleExponent:{defaultValue:.5},xFormatter:{defaultValue:".2r"},yFormatter:{defaultValue:".2r"},lines:{defaultValue:!0},bars:{defaultValue:!1},tooltip:{defaultValue:""}},barGraph:{id:{required:!0},type:{required:!0},property:{required:!0},secondProperty:{conflictsWith:["averagePeriod"]},min:{defaultValue:0},max:{defaultValue:10},title:{defaultValue:""},titleOn:{defaultValue:"right"},labels:{defaultValue:5},units:{defaultValue:!1},gridLines:{defaultValue:10},labelFormat:{defaultValue:"0.1f"},averagePeriod:{conflictsWith:["secondProperty"]},barWidth:{defaultValue:"2em"},height:{defaultValue:"100%"},barColor:{defaultValue:"#e23c34"},fillColor:{defaultValue:"#fff"},tooltip:{defaultValue:""}},helpTip:{component:{defaultValue:""},text:{defaultValue:""}}}}),define("common/validator",["require","arrays"],function(e){function t(e,t){this.prop=e,this.message=t}function n(e){return null!==e&&"object"==typeof e}function r(e,n,r){var i,o;for(i=0,o=r.length;o>i;i++)if(e.hasOwnProperty(r[i]))throw new t(n,"Properties set contains conflicting properties: "+r[i]+" and "+n)}function i(e,n,r,i){if(e.readOnly)throw new t(n,"Properties set tries to overwrite read-only property "+n);if(!i&&e.immutable)throw new t(n,"Properties set tries to overwrite immutable property "+n);return e.validate?e.validate(r):r}var o=e("arrays");return t.prototype=new Error,t.prototype.constructor=t,{validate:function(e,t,n){var o,a,s={};if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(o in t)t.hasOwnProperty(o)&&(a=e[o],"undefined"!=typeof a&&(t[o]=i(a,o,t[o],n),a.conflictsWith&&r(t,o,a.conflictsWith),s[o]=t[o]));return s},validateSingleProperty:i,propertyIsWritable:function(e){return!e.readOnly},propertyChangeInvalidates:function(e){return"undefined"==typeof e.propertyChangeInvalidates?!0:!!e.propertyChangeInvalidates},validateCompleteness:function(e,r){var i,a,s,l={};if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(i in e)if(e.hasOwnProperty(i))if(a=e[i],s=a.defaultValue,"undefined"==typeof r[i]){if(a.required===!0)throw new t(i,"Properties set is missing required property "+i);o.isArray(s)?l[i]=o.copy(s,[]):n(s)?l[i]=$.extend(!0,{},s):"undefined"!=typeof s&&(l[i]=s)}else l[i]=!o.isArray(r[i])&&n(r[i])&&n(s)?$.extend(!0,{},s,r[i]):o.isArray(r[i])?$.extend(!0,[],r[i]):r[i];return this.validate(e,l,!0)},ValidationError:t}}),define("common/listening-pool",[],function(){function e(e){this._nameSpace=e,this.registeredListeners=[],this._nameSpaced=function(e){return e+"."+this._nameSpace
}}var t=function(e){return"function"!=typeof e.off?!0:!1};return e.prototype.listen=function(e,t,n){var r=this._nameSpaced(t),i={speaker:e,eventName:r};e.on(r,n),this.registeredListeners.push(i)},e.prototype.remove=function(e){t(e)?e.speaker.on(e.eventName,null):e.speaker.off(e.eventName)},e.prototype.removeAll=function(){for(;this.registeredListeners.length>0;)this.remove(this.registeredListeners.pop())},e}),define("common/dispatch-support",[],function(){function e(e){return[].slice.call(e)}return function(){function t(e){var t,r;for(a=e,o=d3.dispatch.apply(null,a),t=0,r=a.length;r>t;t++)i[a[t]]=n(a[t])}function n(e){return function(){s?l.add(e):o[e].apply(o,arguments)}}function r(e){return function(){o[e].apply(o,arguments)}}var i,o,a,s=!1,l=d3.set();return i={on:r("on"),mixInto:function(e){e.on=i.on,e.suppressEvents=i.suppressEvents},addEventTypes:function(){arguments.length&&t(a.concat(e(arguments)))},startBatch:function(){s=!0},endBatch:function(){s=!1,i.flush()},flush:function(){l.forEach(function(e){o[e]()}),l=d3.set()},suppressEvents:function(e){s=!0,e(),s=!1,l=d3.set()}},t(e(arguments)),i}}),define("common/controllers/data-set",["common/controllers/interactive-metadata","common/validator","common/listening-pool","common/dispatch-support"],function(){function e(a,s,l){this.interactivesController=s,this._model=s.getModel(),this.namespace="dataSet"+ ++o,this.component=n.validateCompleteness(t.dataSet,a),this.name=this.component.name,this.properties=this.component.properties||[],this.streamDataFromModel=this.component.streamDataFromModel,this.clearOnModelReset=this.component.clearOnModelReset,this.initialData=this.component.initialData?$.extend(!0,{},this.component.initialData):null,this._data={},this._modelProperties=[],this._listeningPool=new r(this.namespace),this._dispatch=new i;for(var u in e.Events)this._dispatch.addEventTypes(e.Events[u]);this._dispatch.mixInto(this),this.resetData(),this.interactivesController.addDataSet(this,l)}var t=require("common/controllers/interactive-metadata"),n=require("common/validator"),r=require("common/listening-pool"),i=require("common/dispatch-support"),o=0;return e.Events={SAMPLE_ADDED:"sampleAdded",SAMPLE_CHANGED:"sampleChanged",DATA_TRUNCATED:"dataTruncated",DATA_RESET:"dataReset",SELECTION_CHANGED:"selectionChanged",LABELS_CHANGED:"labelsChanged"},e.prototype._setupEmptyData=function(){var e=this;this.properties.forEach(function(t){e._data[t]=[]})},e.prototype._inNewModelTerritory=function(){return this._model.stepCounter()<this.maxLength(this._modelProperties)},e.prototype._addListeners=function(){var t=this._listeningPool,n=this.interactivesController.getModel(),r=this,i=function(){r._trigger(e.Events.SELECTION_CHANGED,n.stepCounter())};t.removeAll(),this.streamDataFromModel&&(t.listen(n,"tick",function(){r.appendDataPoint(),i()}),t.listen(n,"play",function(){r._inNewModelTerritory()&&r.removeModelDataAfterStepPointer()}),t.listen(n,"stepBack",i),t.listen(n,"stepForward",i),t.listen(n,"seek",i),t.listen(n,"invalidation",function(){r.removeModelDataAfterStepPointer()})),t.listen(n,"reset",function(){r.clearOnModelReset&&r.resetData(),r.streamDataFromModel&&r.appendDataPoint()}),this.properties.forEach(function(t){r._model.addPropertyDescriptionObserver(t,function(){r._trigger(e.Events.LABELS_CHANGED,r.getLabels())})})},e.prototype._getModelProperty=function(e){return this._model.get(e)},e.prototype._trigger=function(e,t){this._dispatch[e]({data:t})},e.prototype._getPropertyLabel=function(e){if(!this._model.hasProperty(e))return"";var t=this._model.getPropertyDescription(e);return t.getLabel()+" ("+t.getUnitAbbreviation()+")"},e.prototype.getData=function(){return this._data},e.prototype.maxLength=function(e){var t=-1/0,n=this;return e.forEach(function(e){t<n._data[e].length&&(t=n._data[e].length)}),t},e.prototype.resetData=function(){this._setupEmptyData(),this.initialData&&$.extend(!0,this._data,this.initialData),this._trigger(e.Events.DATA_RESET,this._data)},e.prototype.clearData=function(){this._setupEmptyData(),this._trigger(e.Events.DATA_RESET,this._data)},e.prototype.appendDataPoint=function(t,n){t||(t=this._modelProperties);var r={},i=this;t.forEach(function(e){var t=n&&void 0!==n[e]?n[e]:i._getModelProperty(e);void 0!==t&&(r[e]=t,i._data[e].push(t))}),this._trigger(e.Events.SAMPLE_ADDED,r)},e.prototype.removeModelDataAfterStepPointer=function(){var t=this._model.stepCounter(),n=this;this._modelProperties.forEach(function(e){n._data[e].length>t&&(n._data[e].length=t)}),this._trigger(e.Events.DATA_TRUNCATED,this._data),n.appendDataPoint()},e.prototype.editDataPoint=function(t,n,r){this._data[n][t]=r;var i=this,o={};this.properties.forEach(function(e){o[e]=i._data[e][t]}),this._trigger(e.Events.SAMPLE_CHANGED,{index:t,property:n,value:r,dataPoint:o})},e.prototype.getPropertyValue=function(e,t){return this._data[t][e]},e.prototype.getLabels=function(){var e={},t=this;return this.properties.forEach(function(n){e[n]=t._getPropertyLabel(n)}),e},e.prototype.modelLoadedCallback=function(){this._model=this.interactivesController.getModel(),this._addListeners(),this._modelProperties=[];var e=this;this.properties.forEach(function(t){e._model.hasProperty(t)&&e._modelProperties.push(t)}),this.clearOnModelReset&&this.resetData(),this.streamDataFromModel&&this.appendDataPoint()},e.prototype.serialize=function(){var e=$.extend(!0,{},this.component);return e.initialData=this.serializeData(),e},e.prototype.serializeData=function(){if("none"===this.component.serializableProperties)return{};var e="all"===this.component.serializableProperties?this.properties:this.component.serializableProperties,t={},n=this;return e.forEach(function(e){t[e]=$.extend(!0,[],n._data[e])}),t},e}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,o=Function.prototype,a=r.push,s=r.slice,l=r.concat,u=(r.unshift,i.toString),c=i.hasOwnProperty,d=r.forEach,p=r.map,h=r.reduce,f=r.reduceRight,m=r.filter,g=r.every,v=r.some,y=r.indexOf,b=r.lastIndexOf,x=Array.isArray,w=Object.keys,_=o.bind,T=function(e){return e instanceof T?e:this instanceof T?void(this._wrapped=e):new T(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.2";var C=T.each=T.forEach=function(e,t,r){if(null!=e)if(d&&e.forEach===d)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var a in e)if(T.has(e,a)&&t.call(r,e[a],a,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];return null==e?r:p&&e.map===p?e.map(t,n):(C(e,function(e,i,o){r[r.length]=t.call(n,e,i,o)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),h&&e.reduce===h)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(C(e,function(e,o,a){i?n=t.call(r,n,e,o,a):(n=e,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var a=T.keys(e);o=a.length}if(C(e,function(s,l,u){l=a?a[--o]:--o,i?n=t.call(r,n,e[l],l,u):(n=e[l],i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return A(e,function(e,i,o){return t.call(n,e,i,o)?(r=e,!0):void 0}),r},T.filter=T.select=function(e,t,n){var r=[];return null==e?r:m&&e.filter===m?e.filter(t,n):(C(e,function(e,i,o){t.call(n,e,i,o)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return null==e?i:g&&e.every===g?e.every(t,r):(C(e,function(e,o,a){return(i=i&&t.call(r,e,o,a))?void 0:n}),!!i)};var A=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,r):(C(e,function(e,o,a){return i||(i=t.call(r,e,o,a))?n:void 0}),!!i)};T.contains=T.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):A(e,function(e){return e===t})},T.invoke=function(e,t){var n=s.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-1/0;var r={computed:-1/0};return C(e,function(e,i,o){var a=t?t.call(n,e,i,o):e;a>=r.computed&&(r={value:e,computed:a})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return 1/0;var r={computed:1/0};return C(e,function(e,i,o){var a=t?t.call(n,e,i,o):e;a<r.computed&&(r={value:e,computed:a})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return C(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var S=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=S(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var P=function(e,t,n,r){var i={},o=S(t);return C(e,function(t,a){var s=o.call(n,t,a,e);r(i,s,t)}),i};T.groupBy=function(e,t,n){return P(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return P(e,t,n,function(e,t){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=null==n?T.identity:S(n);for(var i=n.call(r,t),o=0,a=e.length;a>o;){var s=o+a>>>1;n.call(r,e[s])<i?o=s+1:a=s}return o},T.toArray=function(e){return e?e.length===+e.length?s.call(e):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:s.call(e,0,t)},T.initial=function(e,t,n){return s.call(e,0,e.length-(null==t||n?1:t))},T.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},T.rest=T.tail=T.drop=function(e,t,n){return s.call(e,null==t||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var E=function(e,t,n){return C(e,function(e){T.isArray(e)?t?a.apply(n,e):E(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return E(e,t,[])},T.without=function(e){return T.difference(e,s.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){T.isFunction(t)&&(r=n,n=t,t=!1);var i=n?T.map(e,n,r):e,o=[],a=[];return C(i,function(n,r){(t?r&&a[a.length-1]===n:T.contains(a,n))||(a.push(n),o.push(e[r]))}),o},T.union=function(){return T.uniq(l.apply(r,arguments))},T.intersection=function(e){var t=s.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=l.apply(r,s.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){for(var e=s.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t),r=0;t>r;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,o=new Array(r);r>i;)o[i++]=e,e+=n;return o};var k=function(){};T.bind=function(e,t){var n,r;if(e.bind===_&&_)return _.apply(e,s.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return r=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,r.concat(s.call(arguments)));k.prototype=e.prototype;var i=new k,o=e.apply(i,r.concat(s.call(arguments)));return Object(o)===o?o:i}},T.bindAll=function(e){var t=s.call(arguments,1);return 0==t.length&&(t=T.functions(e)),C(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(s.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,o,a=0,s=function(){a=new Date,i=null,o=e.apply(n,r)};return function(){var l=new Date,u=t-(l-a);return n=this,r=arguments,0>=u?(clearTimeout(i),a=l,o=e.apply(n,r)):i||(i=setTimeout(s,u)),o}},T.debounce=function(e,t,n){var r,i;return function(){var o=this,a=arguments,s=function(){r=null,n||(i=e.apply(o,a))},l=n&&!r;return clearTimeout(r),r=setTimeout(s,t),l&&(i=e.apply(o,a)),i}},T.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},T.wrap=function(e,t){return function(){var n=[e];return a.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},T.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return C(s.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=l.apply(r,s.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=l.apply(r,s.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return C(s.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var R=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=u.call(e);if(i!=u.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return r[o]==t;n.push(e),r.push(t);var a=0,s=!0;if("[object Array]"==i){if(a=e.length,s=a==t.length)for(;a--&&(s=R(e[a],t[a],n,r)););}else{var l=e.constructor,c=t.constructor;if(l!==c&&!(T.isFunction(l)&&l instanceof l&&T.isFunction(c)&&c instanceof c))return!1;for(var d in e)if(T.has(e,d)&&(a++,!(s=T.has(t,d)&&R(e[d],t[d],n,r))))break;if(s){for(d in t)if(T.has(t,d)&&!a--)break;s=!a}}return n.pop(),r.pop(),s};T.isEqual=function(e,t){return R(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=x||function(e){return"[object Array]"==u.call(e)},T.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(e){return"function"==typeof e}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;e>r;r++)t.call(n,r)},T.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=T.invert(M.escape);var N={escape:new RegExp("["+T.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(M.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(N[e],function(t){return M[e][t]})}}),T.result=function(e,t){if(null==e)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){C(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),B.call(this,n.apply(T,e))}})};var O=0;T.uniqueId=function(e){var t=O++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||L).source,(n.interpolate||L).source,(n.evaluate||L).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,function(t,n,r,a,s){o+=e.slice(i,s).replace(D,function(e){return"\\"+I[e]}),o+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":a?"';\n"+a+"\n__p+='":"",i=s+t.length}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(n.variable||"obj","_",o)}catch(s){throw s.source=o,s}if(t)return a(t,T);var l=function(e){return a.call(this,e,T)};return l.source="function("+(n.variable||"obj")+"){\n"+o+"}",l},T.chain=function(e){return T(e).chain()};var B=function(e){return this._chain?T(e).chain():e};T.mixin(T),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],B.call(this,n)}}),C(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return B.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),function(){{var e,t=this,n=t.Backbone,r=[],i=(r.push,r.slice);r.splice}e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.1.0";var o=t._;o||"undefined"==typeof require||(o=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=e.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=o.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,a,s,u,c,d,p;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:o.keys(this._events),u=0,c=s.length;c>u;u++)if(e=s[u],a=this._events[e]){if(this._events[e]=r=[],t||n)for(d=0,p=a.length;p>d;d++)i=a[d],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&u(n,t),r&&u(r,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;n||"object"!=typeof t||(n=this),e&&((r={})[e._listenId]=e);for(var a in r)e=r[a],e.off(t,n,this),(i||o.isEmpty(e._events))&&delete this._listeningTo[a];return this}},s=/\s+/,l=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(s.test(n)){for(var o=n.split(s),a=0,l=o.length;l>a;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},u=function(e,t){var n,r=-1,i=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}},c={listenTo:"on",listenToOnce:"once"};o.each(c,function(e,t){a[t]=function(t,n,r){var i=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=o.uniqueId("l"));return i[a]=t,r||"object"!=typeof n||(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,o.extend(e,a);var d=e.Model=function(e,t){var n=e||{};t||(t={}),this.cid=o.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=o.defaults({},n,o.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};o.extend(d.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return o.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var r,i,a,s,l,u,c,d;if(null==e)return this;if("object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={}),!this._validate(i,n))return!1;a=n.unset,l=n.silent,s=[],u=this._changing,this._changing=!0,u||(this._previousAttributes=o.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],o.isEqual(d[r],t)||s.push(r),o.isEqual(c[r],t)?delete this.changed[r]:this.changed[r]=t,a?delete d[r]:d[r]=t;if(!l){s.length&&(this._pending=!0);for(var p=0,h=s.length;h>p;p++)this.trigger("change:"+s[p],this,d[s[p]],n)}if(u)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,o.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,o.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!o.isEmpty(this.changed):o.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?o.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e)o.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){return t.set(t.parse(r,e),e)?(n&&n(t,r,e),void t.trigger("sync",t,r,e)):!1},D(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,a,s=this.attributes;if(null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=o.extend({validate:!0},n),r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=o.extend({},s,r)),void 0===n.parse&&(n.parse=!0);var l=this,u=n.success;return n.success=function(e){l.attributes=s;var t=l.parse(e,n);return n.wait&&(t=o.extend(r||{},t)),o.isObject(t)&&!l.set(t,n)?!1:(u&&u(l,e,n),void l.trigger("sync",l,e,n))},D(this,n),i=this.isNew()?"create":n.patch?"patch":"update","patch"===i&&(n.attrs=r),a=this.sync(i,this,n),r&&n.wait&&(this.attributes=s),a},destroy:function(e){e=e?o.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;D(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=o.result(this,"urlRoot")||o.result(this.collection,"url")||I();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},o.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=o.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,o.extend(t,{validationError:n})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];o.each(p,function(e){d.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),o[e].apply(o,t)}});var h=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,o.extend({silent:!0},t))},f={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};o.extend(h.prototype,a,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,o.extend({merge:!1},t,m))},remove:function(e,t){var n=!o.isArray(e);e=n?[e]:o.clone(e),t||(t={});var r,i,a,s;for(r=0,i=e.length;i>r;r++)s=e[r]=this.get(e[r]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s));return n?e[0]:e},set:function(e,t){t=o.defaults({},t,f),t.parse&&(e=this.parse(e,t));var n=!o.isArray(e);e=n?e?[e]:[]:o.clone(e);var r,i,a,s,l,u,c,p=t.at,h=this.model,m=this.comparator&&null==p&&t.sort!==!1,g=o.isString(this.comparator)?this.comparator:null,v=[],y=[],b={},x=t.add,w=t.merge,_=t.remove,T=!m&&x&&_?[]:!1;for(r=0,i=e.length;i>r;r++){if(l=e[r],a=l instanceof d?s=l:l[h.prototype.idAttribute],u=this.get(a))_&&(b[u.cid]=!0),w&&(l=l===s?s.attributes:l,t.parse&&(l=u.parse(l,t)),u.set(l,t),m&&!c&&u.hasChanged(g)&&(c=!0)),e[r]=u;else if(x){if(s=e[r]=this._prepareModel(l,t),!s)continue;v.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)}T&&T.push(u||s)}if(_){for(r=0,i=this.length;i>r;++r)b[(s=this.models[r]).cid]||y.push(s);y.length&&this.remove(y,t)}if(v.length||T&&T.length)if(m&&(c=!0),this.length+=v.length,null!=p)for(r=0,i=v.length;i>r;r++)this.models.splice(p+r,0,v[r]);else{T&&(this.models.length=0);var C=T||v;for(r=0,i=C.length;i>r;r++)this.models.push(C[r])}if(c&&this.sort({silent:!0}),!t.silent){for(r=0,i=v.length;i>r;r++)(s=v[r]).trigger("add",s,this,t);(c||T&&T.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e=this.add(e,o.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,o.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,o.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return o.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),o.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(o.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return o.invoke(this.models,"get",e)},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?o.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t=t?o.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var g=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];o.each(g,function(e){h.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),o[e].apply(o,t)}});var v=["groupBy","countBy","sortBy"];o.each(v,function(e){h.prototype[e]=function(t,n){var r=o.isFunction(t)?t:function(e){return e.get(t)};return o[e](this.models,r,n)}});var y=e.View=function(e){this.cid=o.uniqueId("view"),e||(e={}),o.extend(this,o.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];o.extend(y.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=o.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(o.isFunction(n)||(n=this[e[t]]),n){var r=t.match(b),i=r[1],a=r[2];n=o.bind(n,this),i+=".delegateEvents"+this.cid,""===a?this.$el.on(i,n):this.$el.on(i,a,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(o.result(this,"el"),!1);else{var t=o.extend({},o.result(this,"attributes"));this.id&&(t.id=o.result(this,"id")),this.className&&(t["class"]=o.result(this,"className"));var n=e.$("<"+o.result(this,"tagName")+">").attr(t);
this.setElement(n,!1)}}}),e.sync=function(t,n,r){var i=_[t];o.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:i,dataType:"json"};if(r.url||(a.url=o.result(n,"url")||I()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){a.type="POST",r.emulateJSON&&(a.data._method=i);var s=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",i),s?s.apply(this,arguments):void 0}}"GET"===a.type||r.emulateJSON||(a.processData=!1),"PATCH"===a.type&&w&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=e.ajax(o.extend(a,r));return n.trigger("request",n,l,r),l};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),_={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var T=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,S=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(T.prototype,a,{initialize:function(){},route:function(t,n,r){o.isRegExp(t)||(t=this._routeToRegExp(t)),o.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var i=this;return e.history.route(t,function(o){var a=i._extractParameters(t,o);r&&r.apply(i,a),i.trigger.apply(i,["route:"+n].concat(a)),i.trigger("route",n,a),e.history.trigger("route",i,n,a)}),this},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=o.result(this,"routes");for(var e,t=o.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(P,"\\$&").replace(C,"(?:$1)?").replace(A,function(e,t){return t?e:"([^/]+)"}).replace(S,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return o.map(n,function(e){return e?decodeURIComponent(e):null})}});var E=e.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},k=/^[#\/]|\s+$/g,R=/^\/+|\/+$/g,M=/msie [\w.]+/,N=/\/$/,O=/[?#].*$/;E.started=!1,o.extend(E.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(N,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(k,"")},start:function(t){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=o.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),r=document.documentMode,i=M.exec(navigator.userAgent.toLowerCase())&&(!r||7>=r);this.root=("/"+this.root+"/").replace(R,"/"),i&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location,s=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&s&&a.hash&&(this.fragment=this.getHash().replace(k,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!E.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(O,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),e.history=new E;var L=function(e,t){var n,r=this;n=e&&o.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},o.extend(n,r,t);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,e&&o.extend(n.prototype,e),n.__super__=r.prototype,n};d.extend=h.extend=T.extend=y.extend=E.extend=L;var I=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore"],function(e){return function(){var t;return t||e.Backbone}}(this)),define("grapher/bar-graph/bar-graph-model",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({defaults:{value:0,secondValue:null,min:0,max:10,barWidth:"2em",height:"20em",title:"",titleOn:"right",barColor:"#e23c34",fillColor:"white",labels:10,units:"",gridLines:10,labelFormat:"0.1f"}});return n}),define("common/jquery-plugins",[],function(){$.fn.measure=function(e,t,n){var r,i,o;return r=$(this).clone(!1),r.css({visibility:"hidden",position:"absolute"}),r.appendTo(n),i=t?r.find(t):r,o=e.apply(i),r.remove(),o},$.fn.truncate=function(e){var t,n,r=$(this),i=$("<span>");if(i.text(r.text()),i.css({"font-size":r.css("font-size"),"font-weight":r.css("font-weight"),"white-space":"nowrap",visibility:"hidden"}),i.appendTo(r.parent()),t=i.width(),t>e){for(n=i.text()+"...",i.text(n);t>e&&n.length>3;)n=i.text().slice(0,-4)+"...",i.text(n),t=i.width();r.attr("title",r.text()),r.text(n)}i.remove()}}),define("grapher/bar-graph/bar-graph-view",["require","common/jquery-plugins","backbone"],function(e){e("common/jquery-plugins");var t=e("backbone"),n=0,r=function(){return n++},i=function(e){return e.node().getBBox().width},o=16,a=function(e){var t=e/o;return function(e){return e*t}},s=function(e,t){var n,r,i=[],o={};for(n=0,r=t.length;r>n;n++)i[n]=t[n].value,o[i[n]]=t[n].label;e.tickValues(i).tickFormat(function(e){return o[e]})},l=function(e,t){var n=d3.format(e);return function(e){return n(e)+" "+t}},u=t.View.extend({tagName:"div",className:"bar-graph",initialize:function(){this.uid=r(),this.$topArea=$('<div class="top-area">').appendTo(this.$el),this.vis=d3.select(this.el).append("svg"),this.defs=this.vis.append("defs"),this.axisContainer=this.vis.append("g"),this.fill=this.vis.append("rect"),this.bar=this.vis.append("rect"),this.gridContainer=this.vis.append("g"),this.trianglePos=this.vis.append("g"),this.traingle=this.trianglePos.append("polygon"),this.titleContainer=this.vis.append("g"),this.yScale=d3.scale.linear(),this.heightScale=d3.scale.linear(),this.yAxis=d3.svg.axis(),this.scale=null,this.barWidth=null,this.$bottomArea=$('<div class="bottom-area">').appendTo(this.$el),this.model.on("change",this.modelChanged,this)},render:function(){var e=this.model.toJSON(),t=parseFloat(this.$el.css("font-size")),n=this.scale=a(t),r=e.labels>0||e.labels.length>0,o=n(r?8:3),u=n(r?8:3),c=0;this.$el.outerHeight(e.height),this._setupHorizontalTitle(),this.svgHeight=this.$el.height()-this.$topArea.height()-this.$bottomArea.height(),this.vis.attr({width:600,height:this.svgHeight}),this.yScale.domain([e.min,e.max]).range([this.svgHeight-o,u]).clamp(!0),this.heightScale.domain([e.min,e.max]).range([0,this.svgHeight-o-u]).clamp(!0),this.axisContainer.selectAll("*").remove(),r&&(this.yAxis.scale(this.yScale).tickValues(null).tickPadding(0).tickSize(0,0,0).orient("left"),"number"==typeof e.labels?this.yAxis.ticks(e.labels).tickFormat(l(e.labelFormat,e.units)):s(this.yAxis,e.labels),this.axisContainer.call(this.yAxis),c+=i(this.axisContainer),this.axisContainer.attr("transform","translate("+c+")"),c+=n(5)),this.fill.attr({width:e.barWidth,height:this.heightScale(e.max),x:c,y:this.yScale(e.max),rx:"0.5em",ry:"0.5em",fill:this._getFillGradient(e.fillColor)}),this.bar.attr({width:e.barWidth,x:c,rx:"0.5em",ry:"0.5em",fill:this._getBarGradient(e.barColor)}),this.barWidth=i(this.fill),this.traingle.classed("triangle",!0).attr({points:"15,-7 15,7 1,0",transform:"translate("+c+") scale("+n(1)+")"}),this._setupGrid(c),c+=this.barWidth,c=this._setupTitle(c),this.vis.attr("width",c/t+"em"),this.$el.css("min-width",c/t+"em"),this.$el.css("min-width",c/t+.8+"em"),this.update()},update:function(){var e=this.model.get("value"),t=this.model.get("secondValue");this.bar.attr("height",this.heightScale(e)).attr("y",this.yScale(e)),"undefined"!=typeof t&&null!==t?(this.traingle.classed("hidden",!1),this.trianglePos.attr("transform","translate(0,"+this.yScale(t)+")")):this.traingle.classed("hidden",!0)},modelChanged:function(){var e,t,n,r=this.model.changedAttributes(),i=0;for(n in r)if(r.hasOwnProperty(n)&&(i++,i>2))return void this.render();e="undefined"!=typeof r.value,t="undefined"!=typeof r.secondValue,1===i&&(e||t)||2===i&&e&&t?this.update():this.render()},_getBarGradient:function(e){var t="bar-gradient-"+this.uid,n=this.defs.select("#"+t);return e=d3.rgb(e),n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e.brighter(2).toString()).attr("offset","0%"),n.append("stop").attr("stop-color",e.toString()).attr("offset","100%"),"url(#"+t+")"},_getFillGradient:function(e){var t="fill-gradient-"+this.uid,n=this.defs.select("#"+t);return n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e).attr("offset","0%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.5).attr("offset","15%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.4).attr("offset","100%"),"url(#"+t+")"},_setupGrid:function(e){var t=this.yScale.ticks(this.model.get("gridLines")),n=this.yScale,r=this.barWidth;return t.pop(),t.shift(),this.grid=this.gridContainer.selectAll(".grid-line").data(t,String),this.grid.enter().append("path").attr("class","grid-line"),this.grid.exit().remove(),this.grid.attr("d",function(t){return"M "+e+" "+Math.round(n(t))+" h "+r}),e},_setupTitle:function(e){var t,n,r,i,o=this.model.get("title"),a=this;return o&&"right"===this.model.get("titleOn")&&(e+=this.scale(10),t=$.isArray(o),n=t?o.length:1,r=this.titleContainer.selectAll(".title").data(t?o:[o]),r.exit().remove(),i=r.enter().append("g").attr("class","title"),i.append("title"),i.append("text"),r.each(function(e,t){var r=d3.select(this);r.select("title").text(e),r.select("text").text(a._processTitle(e)).attr("dy",-(n-t-1)+"em")}),this.titleContainer.attr("transform","translate("+e+", "+this.svgHeight/2+") rotate(90)"),e+=parseFloat($(r.node()).css("font-size"))*n),e},_setupHorizontalTitle:function(){var e,t=this.model.get("title"),n=this.model.get("titleOn");this.$topArea.empty(),this.$bottomArea.empty(),t&&0!==t.length&&"right"!==n&&(t=$.isArray(t)?t:[t],"top"===n?e=this.$topArea:"bottom"===n&&(e=this.$bottomArea),t.forEach(function(t){e.append('<p class="title">'+t+"</p>")}))},_processTitle:function(e){var t,n=$('<span class="title">'+e+"</span>").appendTo(this.$el);return n.truncate(this.svgHeight),t=n.text(),n.remove(),t}});return u}),define("common/controllers/bar-graph-controller",["require","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/bar-graph/bar-graph-model"),n=e("grapher/bar-graph/bar-graph-view"),r=e("common/controllers/interactive-metadata"),i=e("common/validator"),o={min:"min",max:"max",title:"title",titleOn:"titleOn",barColor:"barColor",fillColor:"fillColor",labels:"labels",gridLines:"gridLines",labelFormat:"labelFormat",units:"units"},a=function(e){var t,n,r={};for(t in o)o.hasOwnProperty(t)&&(n=o[t],void 0!==e[t]&&(r[n]=e[t]));return r};return function(e,o){function s(){u=o.getModel(),e=i.validateCompleteness(r.barGraph,e),c=new t(a(e)),d=new n({model:c,id:e.id}),d.$el.addClass("component"),p=e.property,h=e.secondProperty,e.tooltip&&d.$el.attr("title",e.tooltip)}var l,u,c,d,p,h,f=function(){c.set({value:u.get(p)})},m=function(){c.set({secondValue:u.get(h)})};return l={modelLoadedCallback:function(){var t="";u&&(u.removeObserver(p,f),h&&u.removeObserver(h,m)),u=o.getModel(),u.addPropertiesListener([p],f),"undefined"!=typeof e.averagePeriod&&null!==e.averagePeriod&&(h=p+"-bargraph-"+e.id+"-average",u.defineFilteredOutput(h,{},p,"RunningAverage",e.averagePeriod)),h&&u.addPropertiesListener([h],m),e.units===!0?t=u.getPropertyDescription(p).getUnitAbbreviation():e.units&&(t=e.units),c.set({barWidth:e.barWidth,height:e.height,units:t}),d.render(),f()},getViewContainer:function(){return d.$el},resize:function(){d.render()},serialize:function(){var t=$.extend(!0,{},e);return t}},s(),l}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("lab-grapher",e):"undefined"!=typeof window?window.LabGrapher=e():"undefined"!=typeof global?global.LabGrapher=e():"undefined"!=typeof self&&(self.LabGrapher=e())}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){t.exports.numberWidthUsingFormatter=function(e,t,n,r,i){var o,a,s,l,u,c;return o=e.append("svg").attr("width",t).attr("height",n).attr("class","graph"),a=o.append("g").append("text").attr("class","axis").attr("x",-r/4+"px").attr("dy",".35em").attr("text-anchor","end").text(i),c=a.node(),c.getBBox?(s=a.node().getBBox(),l=s.width,u=s.height):(l=0,u=0),o.remove(),[l,u]},t.exports.axisProcessDrag=function(e,t,n){var r,i,o=n,a=0,s=n[0],l=n[1],u=l-s;return 0!==t&&(s>=0&&l>s?(a=s,r=e-a,i=.4*r+a,t>i&&(change=r/(t-a),u=l-a,o=[s,s+u*change])):0>s&&l>0?(a=0,r=e-a,i=.4*r+a,(e>=0&&t>i||0>e&&i>t)&&(change=r/(t-a),o=[s*change,l*change])):0>s&&0>l&&(a=l,r=e-a,i=.4*r+a,i>t&&(change=r/(t-a),u=s-a,o=[l+u*change,l]))),o[0]=+o[0].toPrecision(5),o[1]=+o[1].toPrecision(5),o}},{}],2:[function(e,t){var n=e("./axis"),r={autoscale:"Show all data (autoscale)",selection:"Select data for export"};t.exports=function(e,t,i){function o(e,n,r){switch((n||!t)&&(t=u(n)),a(e,r),t.xrange=t.xmax-t.xmin,t.yrange=t.ymax-t.ymin,Qn="[object Array]"===Object.prototype.toString.call(t.title)?t.title:[t.title],Qn.reverse(),Wn=t.sampleInterval,$n=t.dataSampleStart,Dn=t.lineWidth,It={width:120,height:120},h(),Qt=d3.format(t.xFormatter),en=d3.format(t.yFormatter),Kt=function(e){var t=qt.domain(),n=Math.abs(.01*(t[1]-t[0]));return Math.abs(0+e)<n&&(e=0),Qt(e)},Zt=function(e){var t=Ht.domain(),n=Math.abs(.01*(t[1]-t[0]));return Math.abs(0+e)<n&&(e=0),en(e)},Yt=t.xTickCount,Xt=t.yTickCount,Bn=[],t.dataType){case"fake":sr=v(),Bn=[sr];break;case"points":yt(t.dataPoints);break;case"samples":bt(t.dataSamples,Wn,$n)}ar=[],or=null,y(sr.length)}function a(e,n){e&&(kt=d3.select(e),Rt=kt.node(),Mt=$(Rt),Nt=kt.property("clientWidth"),Ot=kt.property("clientHeight")),n&&(i=n),void 0!==Dt&&(Dt.remove(),Dt=void 0),void 0!==rn&&(rn.remove(),rn=void 0),void 0!==an&&(an.remove(),an=void 0),un=t.dataChange?"ns-resize":"crosshair",s(),nr=0/0,rr=0/0,ir=null}function s(e,t){e||t?(Nt=e,Rt.style.width=Nt+"px",t?(Ot=t,Rt.style.height=Ot+"px"):(Rt.style.height="100%",t=kt.property("clientHeight"),Ot=t,Rt.style.height=Ot+"px")):(Nt=Math.max(kt.property("clientWidth"),60),Ot=Math.max(kt.property("clientHeight"),60)),d()}function l(){s(),cn=parseFloat(Mt.css("font-size")),t.fontScaleRelativeToParent||Mt.css("font-size",.5+tr.value/6+"em"),cn=parseFloat(Mt.css("font-size")),dn=cn/2,pn=cn/4,void 0===Dt?(hn=cn,fn=cn,mn=cn,gn=cn):(hn=parseFloat($("svg.graph text.title").css("font-size")),fn=parseFloat($("svg.graph text.axis").css("font-size")),mn=parseFloat($("svg.graph text.xlabel").css("font-size")),gn=parseFloat($("svg.graph text.ylabel").css("font-size"))),c(),f(),Jt=d3.svg.line().x(function(e,t){return qt(sr[t][0])}).y(function(e,t){return Ht(sr[t][1])})}function u(e){if(e)for(var t in lr)void 0===e[t]&&(e[t]=lr[t]);else e=lr;return e.axisShift<1&&(e.axisShift=1),e}function c(){switch(void 0===qt?(vn=[cn,cn],yn=[2*cn,cn]):(vn=n.numberWidthUsingFormatter(kt,Nt,Ot,fn,p(qt.ticks(Yt),Kt)),yn=n.numberWidthUsingFormatter(kt,Nt,Ot,fn,p(Ht.ticks(Xt),Zt))),bn=vn[0],wn=vn[1],An=.6*bn,En=1.1*wn,Tn=En+1.3*wn,Sn=Tn-wn/3,xn=yn[0],_n=yn[1],kn=xn+wn/4,Cn=kn+_n,Pn=-(kn+_n/4),tr.value){case 0:Lt={top:dn,right:dn,bottom:cn,left:cn};break;case 1:Lt={top:t.title?1.8*hn:cn,right:dn,bottom:cn,left:cn};break;case 2:Lt={top:t.title?1.8*hn:cn,right:An,bottom:1.25*fn,left:1.25*xn},Yt=Math.max(6,t.xTickCount/2),Xt=Math.max(6,t.yTickCount/2);break;case 3:Lt={top:t.title?1.8*hn:cn,right:An,bottom:t.xlabel?Tn:1.25*fn,left:t.ylabel?Cn:xn};break;default:Lt={top:t.title?1.8*hn:cn,right:An,bottom:t.xlabel?Tn:1.25*fn,left:t.ylabel?Cn:xn}}tr.value>2?Lt.top+=(Qn.length-1)*tr.value/3*tr.value/3*cn:Qn=[Qn[0]],It.width=Math.max(Nt-Lt.left-Lt.right,60),It.height=Math.max(Ot-Lt.top-Lt.bottom,60)}function d(){t.responsiveLayout?Nt<=tr.icon?(tr.category="icon",tr.value=0):Nt<=tr.tiny?(tr.category="tiny",tr.value=1):Nt<=tr.small?(tr.category="small",tr.value=2):Nt<=tr.medium?(tr.category="medium",tr.value=3):(tr.category="large",tr.value=4):(tr.category="large",tr.value=4)}function p(e,t,n){var r,i,o,a=0,s=0;for(n=n||5,o=0;o<e.length;o++)r=t(+e[o].toPrecision(n)),r=r.replace(/^\s\s*/,"").replace(/\s\s*$/,""),i=r.length,i>a&&(a=i,s=o);return t(e[s])}function h(){function e(e,t){var n=e.domain,r=e.nice;return e.domain=function(){var r=n.apply(e,arguments);return arguments.length&&t(),r},e.nice=function(){var n=r.apply(e,arguments);return t(),n},e}qt=e(d3.scale[t.xscale](),function(){t.xmin=qt.domain()[0],t.xmax=qt.domain()[1]}),Ht=e(d3.scale[t.yscale](),function(){t.ymin=Ht.domain()[0],t.ymax=Ht.domain()[1]}),f()}function f(){m(),g()}function m(){qt.domain([t.xmin,t.xmax]).range([0,It.width])}function g(){Ht.domain([t.ymin,t.ymax]).range([It.height,0])}function v(){var e,n=t.yrange/2,r=n/2;return t.datacount=It.width/30,t.xtic=t.xrange/t.datacount,t.ytic=t.yrange/t.datacount,e=d3.range(t.datacount).map(function(e){return[e*t.xtic+t.xmin,t.ymin+r+Math.random()*n]})}function y(e){return"number"==typeof e?zn=e:"last"===e&&(zn=0,Bn.forEach(function(e){e.length>zn&&(zn=e.length)})),"number"!=typeof zn&&(zn=sr.length-1),zn}function b(e,t,n){var r=0,i=[];for(t=t||1,n=n||0,r=0;r<e.length;r++)i.push([r*t+n,e[r]]);return i}function x(e){i=e,on.text(e?e:"")}function w(){tn=kt.append("div"),tn.attr("class","button-layer").style("z-index",3),t.enableAutoScaleButton&&tn.append("a").attr({"class":"autoscale-button",title:r.autoscale}).on("click",function(){z(!0),P()}).append("i").attr("class","icon-picture"),t.enableSelectionButton&&(nn=tn.append("a"),nn.attr({"class":"selection-button",title:r.selection}).on("click",function(){q()}).append("i").attr("class","icon-cut")),_()}function _(){tn.style({width:1.75*cn+"px",height:1.25*cn+"px",top:Lt.top+dn+"px",left:Lt.left+(It.width-2*cn)+"px"})}function T(){Dt=kt.append("svg").attr("width",Nt).attr("height",Ot).attr("class","graph").style("z-index",2),Bt=Dt.append("g").attr("transform","translate("+Lt.left+","+Lt.top+")"),Vt=Bt.append("rect").attr("class","plot").attr("width",It.width).attr("height",It.height).attr("pointer-events","all").attr("fill","rgba(255,255,255,0)").on("mousemove",L).on("mousedown",D).on("touchstart",D),Vt.call(d3.behavior.zoom().x(qt).y(Ht).on("zoom",P)),rn=kt.append("div").attr("class","background").style({width:It.width+"px",height:It.height+"px",top:Lt.top+"px",left:Lt.left+"px","z-index":0}),et(),Ft=Bt.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",It.width).attr("height",It.height).attr("viewBox","0 0 "+It.width+" "+It.height),zt=Ft.append("line").attr("stroke",Jn).attr("stroke-dasharray","2,2").attr("y1",0).attr("y2",It.height).attr("x1",function(){return null===or?0:or[0]}).attr("x2",function(){return null===or?0:or[0]}).attr("class","ruler hidden"),Wt=Ft.append("line").attr("stroke",Jn).attr("stroke-dasharray","2,2").attr("x1",0).attr("x2",It.width).attr("y1",function(){return null===or?0:or[1]}).attr("y2",function(){return null===or?0:or[1]}).attr("class","ruler hidden"),Mn=Dt.append("rect").attr("class","draggable-axis").attr("x",Lt.left-kn).attr("y",Lt.top).attr("rx",_n/6).attr("width",kn).attr("height",It.height).attr("pointer-events","all").style("cursor","row-resize").on("mousedown",F).on("touchstart",F),On=Mn.append("title"),Rn=Dt.append("rect").attr("class","draggable-axis").attr("x",Lt.left).attr("y",It.height+Lt.top).attr("rx",_n/6).attr("width",It.width).attr("height",En).attr("pointer-events","all").style("cursor","col-resize").on("mousedown",V).on("touchstart",V),Nn=Rn.append("title"),tr.value<=2&&t.ylabel&&Nn.text(t.xlabel),tr.catefory&&t.ylabel&&On.text(t.ylabel),S(),Hn=Ft.append("g").attr("class","brush"),t.title&&tr.value>0?(jt=Bt.selectAll("text").data(Qn,function(e){return e}),jt.enter().append("text").attr("class","title").text(function(e){return e}).attr("x",function(){return It.width/2-Math.min(It.width,A(this))/2}).attr("dy",function(e,t){return-t*hn-dn+"px"}),$t=jt.append("title").text("")):t.title&&($t=Vt.append("title").text(t.title)),tr.value>2&&(Gt=Bt.append("text").attr("class","axis").attr("class","xlabel").text(t.xlabel).attr("x",It.width/2).attr("y",It.height).attr("dy",Sn+"px").style("text-anchor","middle")),tr.value>2&&(Ut=Bt.append("g").append("text").attr("class","axis").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate("+Pn+" "+It.height/2+") rotate(-90)"),"small"===tr.category&&Mn.append("title").text(t.ylabel)),d3.select(Rt).on("mousemove.drag",G).on("touchmove.drag",G).on("mouseup.drag",U).on("touchend.drag",U),on=Bt.append("text").attr("class","graph-notification").text(i).attr("x",It.width/2).attr("y",It.height/2).style("text-anchor","middle"),N(),O()}function C(){Bt.attr("width",Nt).attr("height",Ot).attr("transform","translate("+Lt.left+","+Lt.top+")"),Vt.attr("width",It.width).attr("height",It.height),rn.style({width:It.width+"px",height:It.height+"px",top:Lt.top+"px",left:Lt.left+"px","z-index":0}),Ft.attr("top",0).attr("left",0).attr("width",It.width).attr("height",It.height).attr("viewBox","0 0 "+It.width+" "+It.height),Mn.attr("x",Lt.left-kn).attr("y",Lt.top-_n/2).attr("width",kn).attr("height",It.height+_n),Rn.attr("x",Lt.left).attr("y",It.height+Lt.top).attr("width",It.width).attr("height",En),S(),t.title&&tr.value>0?(jt.attr("x",function(){return It.width/2-Math.min(It.width,A(this))/2}).attr("dy",function(e,t){return-t*hn-dn+"px"}),$t.text("")):t.title&&$t.text(t.title),t.xlabel&&tr.value>2?(Gt.attr("x",It.width/2).attr("y",It.height).attr("dy",Sn+"px"),Nn.text("")):Nn.text(t.xlabel),t.ylabel&&tr.value>2?(Ut.attr("transform","translate("+Pn+" "+It.height/2+") rotate(-90)"),On.text("")):On.text(t.ylabel),on.attr("x",It.width/2).attr("y",It.height/2),Bt.selectAll("g.x").remove(),Bt.selectAll("g.y").remove(),cr&&dr&&Q(),N(),O(),tt()}function A(e){return e.getComputedTextLength?e.getComputedTextLength():100}function S(){tr.value<=1?(Rn.style({fill:"rgba(196, 196, 196, 0.2)"}),Mn.style({fill:"rgba(196, 196, 196, 0.2)"})):(Rn.style({fill:null}),Mn.style({fill:null}))}function P(){c(),C();var e=Bt.selectAll("g.x").data(qt.ticks(Yt),String).attr("transform",Kn),n=e.enter().insert("g","a").attr("class","x").attr("transform",Kn);n.append("line").attr("stroke",Jn).attr("y1",0).attr("y2",It.height),tr.value>1&&n.append("text").attr("class","axis").attr("y",It.height).attr("dy",fn+"px").attr("text-anchor","middle").text(Kt).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")}),e.exit().remove();var r=Bt.selectAll("g.y").data(Ht.ticks(Xt),String).attr("transform",Zn),i=r.enter().insert("g","a").attr("class","y").attr("transform",Zn).attr("background-fill","#FFEEB6");if(i.append("line").attr("stroke",Jn).attr("x1",0).attr("x2",It.width),tr.value>1){if("log"===t.yscale){var o=i[0].length;i=i.filter(o>100?function(e){return!!e.toString().match(/(\.[0]*|^)[1]/)}:o>50?function(e){return!!e.toString().match(/(\.[0]*|^)[12]/)}:function(e){return!!e.toString().match(/(\.[0]*|^)[125]/)})}i.append("text").attr("class","axis").attr("x",-fn/4+"px").attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(Zt).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")})}r.exit().remove(),Vt.call(d3.behavior.zoom().x(qt).y(Ht).on("zoom",P)),E()}function E(e){y(e),it(zn),N(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function k(e){y(e),z()?P():E(zn)}function R(e){var t=[];return e===or&&t.push("selected"),0===t.length?null:t.join(" ")}function M(){var e=qt.domain(),t=qt.range();Ln=(t[1]-t[0])/(e[1]-e[0]),Ln=Math.min(Math.max(Ln,4),8),In=Ln/3}function N(){var e,n=null;t.markAllDataPoints&&tr.value>1?(n=[],n=n.concat.apply(n,Bn)):t.markNearbyDataPoints&&tr.value>1&&(n=ar.slice(0),null!==or&&-1===n.indexOf(or)&&n.push(or)),null!==n&&(M(),e=Bt.select("svg").selectAll("circle").data(n),e.enter().append("circle").attr("class",R).attr("cx",function(e){return qt(e[0])}).attr("cy",function(e){return Ht(e[1])}).attr("r",Ln).style("stroke-width",In).style("cursor",un).on("mousedown.drag",j).on("touchstart.drag",j).append("title").text(function(e){return"( "+Kt(e[0])+", "+Zt(e[1])+" )"}),e.attr("class",R).attr("cx",function(e){return qt(e[0])}).attr("cy",function(e){return Ht(e[1])}).select("title").text(function(e){return"( "+Kt(e[0])+", "+Zt(e[1])+" )"}),e.exit().remove()),O()}function O(){t.showRulersOnSelection&&null!==or?(zt.attr("y1",0).attr("y2",It.height).attr("x1",function(){return null===or?0:qt(or[0])}).attr("x2",function(){return null===or?0:qt(or[0])}).attr("class",function(){return"ruler"+(null===or?" hidden":"")}),Wt.attr("x1",0).attr("x2",It.width).attr("y1",function(){return null===or?0:Ht(or[1])}).attr("y2",function(){return null===or?0:Ht(or[1])}).attr("class",function(){return"ruler"+(null===or?" hidden":"")})):(zt.attr("class","ruler hidden"),Wt.attr("class","ruler hidden"))}function L(){if(t.markNearbyDataPoints){var e,n,r,i,o,a=d3.mouse(Bt.node()),s=qt.invert(Math.max(0,Math.min(It.width,a[0])));for(ar=[],o=0;o<Bn.length;o++)sr=Bn[o],e=I(s,o),null!==e&&(n=sr.indexOf(e),r=n-t.extraCirclesVisibleOnHover,i=n+(t.extraCirclesVisibleOnHover+1),0>r&&(r=0),i>sr.length-1&&(i=sr.length),ar=ar.concat(sr.slice(r,i)));E()}}function I(e,t){if(("undefined"==typeof t||null===t)&&(t=0),sr=Bn[t],0===sr.length)return null;for(var n,r,i,o,a=0,s=sr.length-1;s>a;)n=Math.floor((a+s)/2),sr[n][0]<e?a=n+1:s=n;return r=sr[n-1],i=sr[n],o=sr[n+1],"undefined"!=typeof r&&Math.abs(r[0]-e)<=Math.abs(i[0]-e)?r:"undefined"==typeof o||Math.abs(i[0]-e)<=Math.abs(o[0]-e)?i:o}function D(){if(t.enableAxisScaling){var e;if(d3.event.preventDefault(),d3.select("body").style("cursor","move"),d3.event.altKey)if(Vt.style("cursor","nesw-resize"),d3.event.shiftKey&&t.addData){e=d3.mouse(Bt.node());var n=[];n[0]=qt.invert(Math.max(0,Math.min(It.width,e[0]))),n[1]=Ht.invert(Math.max(0,Math.min(It.height,e[1]))),sr.push(n),sr.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),or=n,E()}else e=d3.mouse(Bt.node()),nr=qt.invert(e[0]),rr=Ht.invert(e[1]),ir=!1,d3.event.stopPropagation()}}function B(){return!1}function V(){if(t.enableAxisScaling){Rt.focus(),document.onselectstart=B,d3.event.preventDefault();var e=d3.mouse(Bt.node());nr=qt.invert(e[0])}}function F(){if(t.enableAxisScaling){Rt.focus(),d3.event.preventDefault(),document.onselectstart=B;var e=d3.mouse(Bt.node());rr=Ht.invert(e[1])}}function j(e){Rt.focus(),d3.event.preventDefault(),document.onselectstart=B,or=ir=or===e?null:e,E()}function G(){var e,r,i,o,a,s,l,u,c=d3.mouse(Bt.node());document.onselectstart=function(){return!0},d3.event.preventDefault(),ir&&(t.dataChange?ir[1]=Ht.invert(Math.max(0,Math.min(It.height,c[1]))):(Bn.forEach(function(t){var n=t.indexOf(ir);-1!==n&&(e=t,r=n)}),r&&r<e.length-1&&(i=qt.invert(c[0]),o=ir[0],a=e[r+1],s=e[r-1],l=o-(o-s[0])/2,u=o+(a[0]-o)/2,l>i?(ir=s,or=ir):i>u&&(ir=a,or=ir))),E()),isNaN(nr)||(d3.select("body").style("cursor","col-resize"),Vt.style("cursor","col-resize"),qt.domain(n.axisProcessDrag(nr,qt.invert(c[0]),qt.domain())),M(),P(),d3.event.stopPropagation()),isNaN(rr)||(d3.select("body").style("cursor","row-resize"),Vt.style("cursor","row-resize"),Ht.domain(n.axisProcessDrag(rr,Ht.invert(c[1]),Ht.domain())),P(),d3.event.stopPropagation())}function U(){d3.select("body").style("cursor","auto"),Vt.style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(nr)||(P(),nr=0/0),isNaN(rr)||(P(),rr=0/0),ir=null}function z(e){var n=-1/0;if(Bn.forEach(function(e){e.length>n&&(n=e.length)}),!(1>n)){var r,i;if(t.autoScaleX||e){var o=e?.05:t.autoScalePadding;r=W("x",Fn,jn,o,e)}if(t.autoScaleY||e){var a=e?.05:t.autoScalePadding;i=W("y",Gn,Un,a,e)}return r||i}}function W(e,n,r,i,o){var a,s="x"===e?qt:Ht,l=s.domain()[0],u=s.domain()[1],c=!1,d=function(e,t){return 0>e?-Math.pow(-e,t):Math.pow(e,t)};switch(t[e+"scale"]){case"linear":a=function(e){return e};break;case"log":n=Math.log(n)/Math.log(10),r=Math.log(r)/Math.log(10),a=function(e){return Math.pow(10,e)};break;case"pow":var p=t[e+"scaleExponent"];n=d(n,p),r=d(r,p),a=function(e){return d(e,1/p)}}var h=r-n!==0?(r-n)*i:(u-l)*i;return(r>u||o)&&(u=r+h,c=!0),(l>n||o)&&(l=n-h,c=!0),c&&s.domain([a(l),a(u)]).nice(),c}function q(){X()||(J(!1),X(!0)),J()?((t.clearSelectionOnLeavingSelectMode||H()===[])&&H(null),J(!1)):(null==H()&&H([]),J(!0))}function H(e){return arguments.length?(null===e?cr=!1:0===e.length?(cr=!0,ur.xmin=1/0,ur.xmax=1/0):(cr=!0,ur.xmin=e[0],ur.xmax=e[1]),Q(),qn&&qn(H()),Xn):cr?1/0===ur.xmax&&1/0===ur.xmin?[]:[ur.xmin,ur.xmax]:null}function Y(){return cr}function X(e){return arguments.length?(e=!!e,dr!==e&&(dr=e,Q()),Xn):dr}function J(e){return arguments.length?(e=!!e,pr!==e&&(pr=e,nn&&(e?nn.attr("style","color: #aa0000;"):nn.attr("style","")),Q()),Xn):pr}function K(e){return arguments.length?(qn=e,Xn):qn}function Z(){var e;pr&&(e=Yn.extent(),H(e[0]!==e[1]?e:[]))}function Q(){cr&&dr?(Yn=Yn||d3.svg.brush().x(qt).extent([ur.xmin||0,ur.xmax||0]).on("brush",Z),Hn.call(Yn.extent([ur.xmin||0,ur.xmax||0])).style("display","inline").style("pointer-events",pr?"all":"none").selectAll("rect").attr("height",It.height)):Hn.style("display","none")
}function et(){an=kt.append("canvas"),sn=an.node(),tt()}function tt(){an.attr("class","overlay").style({position:"absolute",width:It.width+"px",height:It.height+"px",top:Lt.top+"px",left:Lt.left+"px","z-index":1}),sn=an.node(),sn.width=It.width,sn.height=It.height,sn.top=Lt.top,sn.left=Lt.left,rt(),it(zn)}function nt(){sn.getContext&&(sn.width=sn.width,ln.lineWidth=Dn,ln.fillStyle=er,ln.fillRect(0,0,sn.width,sn.height),ln.strokeStyle="rgba(255,65,0, 1.0)")}function rt(){sn.getContext&&(ln=sn.getContext("2d"),ln.globalCompositeOperation="source-over",ln.lineWidth=Dn,ln.fillStyle=er,ln.fillRect(0,0,sn.width,sn.height),ln.strokeStyle="rgba(255,65,0, 1.0)")}function it(e){var n,r,i,o,a,s,l,u,c,d,p,h,f=Ht(1e-5),m=t.lines,g=t.bars,v=Bn.length;if("undefined"!=typeof sn.getContext)if(y(e),nt(),ln.fillRect(0,0,sn.width,sn.height),ln.lineWidth=Dn,c=qt.domain()[0],d=qt.domain()[1],h=Math.max(0,c),m){for(n=0;v>n;n++)if(sr=Bn[n],u=sr.length,0!==u)if(1!==u){for(l=0,r=0;u>r&&!(sr[r][0]>=c);r++)l++;if(!(l>=u)){for(l>0&&l--,a=qt(sr[l][0]),s=Ht(sr[l][1]),ot(n),ln.beginPath(),ln.moveTo(a,s),o=sr[l][0],l++,i=Math.min(e,u);i>l&&(o=sr[l][0],a=qt(o),s=Ht(sr[l][1]),ln.lineTo(a,s),!(o>=d));l++);if(ln.stroke(),u>l&&d>o){for(ot(n,!0),ln.lineWidth=Dn/2;u>l&&(o=sr[l][0],a=qt(o),s=Ht(sr[l][1]),ln.lineTo(a,s),!(o>=d));l++);ln.stroke(),ln.lineWidth=Dn}}}else at(n),ln.fillRect(qt(sr[0][0]),Ht(sr[0][1]),Dn,Dn)}else if(g)for(n=0;v>n;n++){for(sr=Bn[n],u=sr.length,ot(n),p=e-1,l=h;p>l;l++)a=qt(sr[l][0]),s=Ht(sr[l][1]),0!==s&&(ln.beginPath(),ln.moveTo(a,f),ln.lineTo(a,s),ln.stroke());if(p=sr.length-1,p>l)for(ot(n,!0);p>l;l++)a=qt(sr[l][0]),s=Ht(sr[l][1]),ln.beginPath(),ln.moveTo(a,f),ln.lineTo(a,s),ln.stroke()}else for(n=0;v>n;n++){for(sr=Bn[n],u=sr.length,l=0,r=0;u>r&&!(sr[r][0]>=c);r++)l++;if(l>0&&--l,!(l>=u)){for(at(n),i=Math.min(e,u);i>l&&(o=sr[l][0],a=qt(o),s=Ht(sr[l][1]),ln.fillRect(a,s,Dn,Dn),!(o>=d));l++);if(u>l&&d>o)for(at(n,!0);u>l&&(o=sr[l][0],a=qt(o),s=Ht(sr[l][1]),ln.fillRect(a,s,Dn,Dn),!(o>=d));l++);}}}function ot(e,t){var n=t?.5:1;switch(e){case 0:ln.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:ln.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:ln.strokeStyle="rgba(44,0,160,"+n+")";break;default:ln.strokeStyle="rgba(44,0,160,"+n+")"}}function at(e,t){var n=t?.4:1;switch(e){case 0:ln.fillStyle="rgba(160,00,0,"+n+")";break;case 1:ln.fillStyle="rgba(44,160,0,"+n+")";break;case 2:ln.fillStyle="rgba(44,0,160,"+n+")";break;default:ln.fillStyle="rgba(44,0,160,"+n+")"}}function st(e){mt(e),y("last"),k()}function lt(e,t){gt(e,t),y("last"),k()}function ut(e){vt(e),y("last"),k()}function ct(e){var t=sr.length,n=(t+$n)*Wn,r=[n,e];sr.push(r),y("last"),k()}function dt(e){sr.push(e),y("last"),k()}function pt(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function ht(e,n){if(t.sortPoints&&!(e.length<2)){if(null==n)return void e.sort(pt);var r=e[n],i=e[n-1],o=e[n+1];(i&&i[0]>r[0]||o&&r[0]>o[0])&&e.sort(pt)}}function ft(e){e[0]<Fn&&(Fn=e[0]),e[1]<Gn&&(Gn=e[1]),e[0]>jn&&(jn=e[0]),e[1]>Un&&(Un=e[1])}function mt(e){for(var t,n,r,i=0,o=e.length;o>i;i++)null!=e[i]&&(n=Bn[i],r=Vn[i],(null==n||null==r)&&(n=Bn[i]=[],r=Vn[i]=[]),t=e[i],n.push(t),r.push(t),ft(t),ht(n,n.length-1))}function gt(e,t){for(var n,r,i,o,a=!1,s=0,l=e.length;l>s;s++)null!=e[s]&&(i=Bn[s],o=Vn[s],(null==i||null==o)&&(i=Bn[s]=[],o=Vn[s]=[]),n=o[t],r=e[s],null==n?(i.push(r),o[t]=r,ht(i,i.length-1),ft(r)):(n[0]=r[0],n[1]=r[1],ht(i),a=!0));a&&(Fn=Gn=1/0,jn=Un=-1/0,Bn.forEach(function(e){e.forEach(ft)}))}function vt(e){var t,n;if("[object Array]"===Object.prototype.toString.call(e[0])){for(n=0;n<e.length;n++)Bn[n]||Bn.push([]),sr=Bn[n],t=sr.length*Wn+$n,sr.push.apply(sr,b(e[n],Wn,t)),Bn[n]=sr;sr=Bn[0]}else for(n=0;n<e.length;n++)Bn[n]||Bn.push([]),t=Bn[n].length*Wn+$n,Bn[n].push([t,e[n]])}function yt(e){function n(e){var t=[];return e.forEach(function(e){null!=e&&null!=e[0]&&null!=e[1]&&t.push(e)}),t}function r(e){var t=[];return e.forEach(function(e,n){null!=e&&null!=e[0]&&null!=e[1]&&(t[n]=e)}),t}function i(e){function n(e,t,n){ft(e),r&&t>0&&e[0]<n[t-1][0]&&(r=!1)}var r=t.sortPoints;e.forEach(n),!r&&t.sortPoints&&e.sort(pt)}if(Fn=Gn=1/0,jn=Un=-1/0,Bn=[],Vn=[],e&&0!==e.length)if("[object Array]"===Object.prototype.toString.call(e[0]))for(var o=0;o<e.length;o++)Bn.push(n(e[o])),Vn.push(r(e[o])),i(Bn[o]);else Bn=[n(sr)],Vn=[r(sr)],i(Bn[0]);else Bn=[[]],Vn=[[]];sr=Bn[0],z(),y("last")}function bt(e,t,n){if(Bn=[],"[object Array]"===Object.prototype.toString.call(e[0])){for(var r=0;r<e.length;r++)Bn.push(b(e[r],t,n));sr=Bn[0]}else sr=b(e,t,n),Bn=[sr];Wn=t,$n=n}function xt(e){bt(e,Wn,$n)}function wt(e){sr.length&&(sr.splice(e,1),zn>=sr.length&&(zn=sr.length-1))}function _t(){Dt.node().addEventListener("keydown",function(e){if(!or)return!1;if("keydown"===e.type){switch(e.keyCode){case 8:case 46:if(t.dataChange){var n=sr.indexOf(or);wt(n),or=sr.length?sr[n>0?n-1:0]:null,E()}e.preventDefault(),e.stopPropagation()}e.preventDefault()}})}function Tt(){t.title&&jt&&jt.text(t.title),St()}function Ct(){t.xlabel&&Gt&&Gt.text(t.xlabel),St()}function At(){t.ylabel&&Ut?Ut.text(t.ylabel):Ut.style("display","none"),St()}function St(){l(),void 0===Dt?T():C(),t.showButtons&&(tn||w(),_()),P()}function Pt(e,t,n){return arguments.length?o(e,t,n):o(),St(),St(),P(),_t(),Xn}function Et(e,t){return s(e,t),a(),St(),P(),Xn}var kt,Rt,Mt,Nt,Ot,Lt,It,Dt,Bt,Vt,Ft,jt,Gt,Ut,zt,Wt,$t,qt,Ht,Yt,Xt,Jt,Kt,Zt,Qt,en,tn,nn,rn,on,an,sn,ln,un,cn,dn,pn,hn,fn,mn,gn,vn,yn,bn,xn,wn,_n,Tn,Cn,An,Sn,Pn,En,kn,Rn,Mn,Nn,On,Ln,In,Dn,Bn,Vn,Fn,jn,Gn,Un,zn,Wn,$n,qn,Hn,Yn,Xn={},Jn=function(e){return e?"#ccc":"#666"},Kn=function(e){return"translate("+qt(e)+",0)"},Zn=function(e){return"translate(0,"+Ht(e)+")"},Qn=[],er="rgba(255,255,255, 0.0)",tr={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},nr=0/0,rr=0/0,ir=null,or=null,ar=[],sr=[],lr={showButtons:!0,responsiveLayout:!1,fontScaleRelativeToParent:!0,enableAutoScaleButton:!0,enableAxisScaling:!0,enableSelectionButton:!1,clearSelectionOnLeavingSelectMode:!1,dataType:"points",dataPoints:[],dataSamples:[],sampleInterval:1,dataSampleStart:0,sortPoints:!0,title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,autoScaleX:!0,autoScaleY:!0,autoScalePadding:.3,xTickCount:10,yTickCount:10,xFormatter:".3s",yFormatter:".3s",xscale:"linear",yscale:"linear",xscaleExponent:.5,yscaleExponent:.5,axisShift:10,markAllDataPoints:!1,markNearbyDataPoints:!1,extraCirclesVisibleOnHover:2,showRulersOnSelection:!1,lineWidth:2,dataChange:!1,addData:!1,notification:!1,lines:!0,bars:!1},ur={xmin:null,xmax:null,ymin:null,ymax:null},cr=!1,dr=!1,pr=!0;return Xn={update:E,repaint:St,reset:Pt,redraw:P,resize:Et,notify:x,selectionDomain:H,selectionVisible:X,selectionListener:K,selectionEnabled:J,hasSelection:Y,brushElement:function(){return Hn},brushControl:function(){return Yn},brushListener:function(){return Z},scale:s,updateOrRescale:k,xDomain:function(e){return arguments.length?(t.xmin=e[0],t.xmax=e[1],m&&(m(),P()),Xn):[t.xmin,t.xmax]},yDomain:function(e){return arguments.length?(t.ymin=e[0],t.ymax=e[1],g&&(g(),P()),Xn):[t.ymin,t.ymax]},xmin:function(e){return arguments.length?(t.xmin=e,t.xrange=t.xmax-t.xmin,m&&(m(),P()),Xn):t.xmin},xmax:function(e){return arguments.length?(t.xmax=e,t.xrange=t.xmax-t.xmin,m&&(m(),P()),Xn):t.xmax},ymin:function(e){return arguments.length?(t.ymin=e,t.yrange=t.ymax-t.ymin,g&&(g(),P()),Xn):t.ymin},ymax:function(e){return arguments.length?(t.ymax=e,t.yrange=t.ymax-t.ymin,g&&(g(),P()),Xn):t.ymax},xLabel:function(e){return arguments.length?(t.xlabel=e,Ct(),Xn):t.xlabel},yLabel:function(e){return arguments.length?(t.ylabel=e,At(),Xn):t.ylabel},title:function(e){return arguments.length?(t.title=e,Tt(),Xn):t.title},width:function(e){return arguments.length?(It.width=e,Xn):It.width},height:function(e){return arguments.length?(It.height=e,Xn):It.height},elem:function(e){return arguments.length?(kt=d3.select(e),o(kt),Xn):kt},numberOfPoints:function(){return sr?sr.length:!1},addPoints:st,replacePoints:lt,addPoint:dt,resetPoints:yt,addSamples:ut,addSample:ct,resetSamples:xt},o(e,t,i),Rt&&(St(),St()),Xn}},{"./axis":1}],3:[function(e,t){t.exports=e("./lib/graph")},{"./lib/graph":2}]},{},[3])(3)}),define("common/controllers/graph-controller",["require","lab-grapher","common/controllers/interactive-metadata","common/validator","common/listening-pool","common/controllers/data-set"],function(e){var t=e("lab-grapher"),n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i=e("common/listening-pool"),o=e("common/controllers/data-set"),a={title:"title",enableAutoScaleButton:"enableAutoScaleButton",enableAxisScaling:"enableAxisScaling",autoScaleX:"autoScaleX",autoScaleY:"autoScaleY",enableSelectionButton:"enableSelectionButton",clearSelectionOnLeavingSelectMode:"clearSelectionOnLeavingSelectMode",dataPoints:"dataPoints",markAllDataPoints:"markAllDataPoints",showRulersOnSelection:"showRulersOnSelection",fontScaleRelativeToParent:"fontScaleRelativeToParent",xlabel:"xlabel",xmin:"xmin",xmax:"xmax",ylabel:"ylabel",ymin:"ymin",ymax:"ymax",lineWidth:"lineWidth",xTickCount:"xTickCount",yTickCount:"yTickCount",xscaleExponent:"xscaleExponent",yscaleExponent:"yscaleExponent",xFormatter:"xFormatter",yFormatter:"yFormatter",lines:"lines",bars:"bars"},s=0,l=0,u=0;return function(e,c){function d(){return c.getModel()}function p(e){return null!=e&&"auto"!==e}function h(){if(e.dataSet)I=c.getDataSet(e.dataSet);else{var t=e.properties.slice();B.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),I=new o({properties:t,name:e.id+"-autoDataSet",streamDataFromModel:e.streamDataFromModel,clearOnModelReset:e.clearOnModelReset},c,!0)}j.listen(I,o.Events.DATA_RESET,w),j.listen(I,o.Events.SAMPLE_ADDED,P),j.listen(I,o.Events.SAMPLE_CHANGED,E),j.listen(I,o.Events.SELECTION_CHANGED,v),j.listen(I,o.Events.DATA_TRUNCATED,_),j.listen(I,o.Events.LABELS_CHANGED,T)}function f(){D=c.getScriptingAPI(),j=new i(U),e=r.validateCompleteness(n.graph,e),V=e.properties.slice(),B=e.xProperty,$.isArray(B)||(B=[B]),h(),N=$("<div>").attr("id",e.id).addClass("graph"),N.addClass("component"),N.css({width:e.width,height:e.height}),e.tooltip&&N.attr("title",e.tooltip),F=[],I.resetData()}function m(){var t,n,r={};for(t in a)a.hasOwnProperty(t)&&(n=a[t],r[n]=e[t]);return r}function g(e){O.updateOrRescale(e)}function v(e){g(e.data)}function y(){O?e.resetAxesOnReset&&C():M(),x(I.getData()),R()}function b(){y()}function x(e){if(O){var t=[];V.forEach(function(n,r){for(var i=[],o=e[S(r)],a=e[n],s=0,l=Math.min(o.length,a.length);l>s;s++)i.push([o[s],a[s]]);t.push(i)}),t=t.concat(F),O.resetPoints(t),O.repaint()}}function w(e){x(e.data)}function _(e){x(e.data)}function T(t){var n=V[u],r=B[l],i=t[n]||t.data[n],o=t[r]||t.data[r];p(e.ylabel)||O.yLabel(i),p(e.xlabel)||O.xLabel(o)}function C(){O.reset("#"+e.id,m())}function A(e){var t=e[0],n=e[1];return null!=t&&""!==t&&!isNaN(Number(t))&&null!=n&&""!==n&&!isNaN(Number(n))}function S(e){return B[e]||B[0]}function P(e){if(O){var t,n=!0,r=e.data,i=[];V.forEach(function(e,n){t=[r[S(n)],r[e]],i.push(A(t)?t:null)}),n&&O.addPoints(i)}}function E(e){if(O){var t,n=e.data.dataPoint,r=e.data.index,i=[];V.forEach(function(e,r){t=[n[S(r)],n[e]],i.push(A(t)?t:null)}),O.replacePoints(i,r)}}function k(){var e=d();e.on("reset",b)}function R(){T(I.getLabels())}function M(){O=new t(N[0],m(),void 0,c.getNextTabIndex())}var N,O,L,I,D,B,V,F,j,G=[],U="graphController"+ ++s;return L={type:"graph",modelLoadedCallback:function(){k(),D=c.getScriptingAPI(),y(),O.repaint()},getDataSet:function(){return I},appendDataPropertiesToComponent:function(){I.appendDataPoint()},addDataSet:function(e){F.push(e)},clearDataSets:function(){F=[]},setAttributes:function(t){O&&($.extend(e,t),I.resetData(),t.dataPoints&&(G=t.dataPoints),C(),R())},syncAxisRangesToPropertyRanges:function(){var e,t,n=d(),r=n.getPropertyDescription(B[l]),i=V.map(function(e){return n.getPropertyDescription(e)});r&&null!=r.getMin()&&null!=r.getMax()&&O.xDomain([r.getMin(),r.getMax()]),e=1/0,t=-1/0,i.forEach(function(n){n&&(n.getMin()<e&&(e=n.getMin()),n.getMax()>t&&(t=n.getMax()))}),isFinite(e)&&isFinite(t)&&O.yDomain([e,t])},scrollXAxisToZero:function(){var e=O.xmin(),t=O.xmax();0!==e&&O.xDomain([0,t-e])},getView:function(){return O},getViewContainer:function(){return N},resize:function(){O&&O.resize()},reset:function(){O&&C()},update:function(){O&&O.update()},selectionDomain:function(){return O?O.selectionDomain.apply(O,arguments):null},selectionEnabled:function(){return O?O.selectionEnabled.apply(O,arguments):null},serialize:function(){var t=$.extend(!0,{},e),n=O.xDomain(),r=O.yDomain(),i=e.xmin;return t.ymin=r[0],t.ymax=r[1],t.xmin=i,t.xmax=i+n[1]-n[0],t}},f(),L}}),define("import-export/dg-exporter",["require","common/console","lab.config"],function(e){var t=e("common/console"),n=e("lab.config");return{gameName:"Next Gen MW",parentCollectionName:"Summary of Run",childCollectionName:"Time Series of Run",perRunColumnLabelCount:0,perRunColumnLabelPositions:{},mockDGController:{doCommand:function(e){return t.log("action: ",e.action),t.log("args: ",e.args),{caseID:0}}},isDgGameControllerDefined:function(){return n.dataGamesProxyPrefix?!!(window.parent&&window.parent.DG&&window.parent.DG.currGameController):!1},canExportData:function(){return this.isDgGameControllerDefined()},getDGGameController:function(){return this.isDgGameControllerDefined()?window.parent.DG.currGameController:this.mockDGController},doCommand:function(e,t){var n=this.getDGGameController();return n.doCommand({action:e,args:t})},exportData:function(e,t,n,r){var i,o,a,s,l,u,c=[],d=[],p=[];for(u=0;u<t.length;u++)i=e[u],o=t[u],null==this.perRunColumnLabelPositions[i]&&(this.perRunColumnLabelPositions[i]=this.perRunColumnLabelCount++),a=this.perRunColumnLabelPositions[i],0===u?(c[a]={name:i,formula:"caseIndex"},d[a]=null):(c[a]={name:i},d[a]=o);for(u=0;u<n.length;u++)p.push({name:n[u]});this.doCommand("initGame",{name:this.gameName}),this.doCommand("createCollection",{name:this.parentCollectionName,attrs:c,childAttrName:"contents",collapseChildren:!0}),this.doCommand("createCollection",{name:this.childCollectionName,attrs:p}),s=this.doCommand("openCase",{collection:this.parentCollectionName,values:d}),this.doCommand("createCases",{collection:this.childCollectionName,values:r,parent:s.caseID}),this.doCommand("closeCase",{collection:this.parentCollectionName,values:l,caseID:s.caseID})},openTable:function(){this.doCommand("createComponent",{type:"DG.TableView",log:!1})},logAction:function(e){this.doCommand("logAction",{formatStr:e})}}}),define("common/controllers/basic-dialog",[],function(){function e(e){this.$element=$("<div>"),this.$element.dialog($.extend({},t,e))}var t={autoOpen:!1,dialogClass:"interactive-dialog",width:"80%"};return e.prototype.open=function(){this.$element.dialog("open")},e.prototype.set=function(e,t){this.$element.dialog("option",e,t)},e.prototype.setContent=function(e){this.$element.empty(),this.$element.append('<input type="hidden" autofocus="autofocus" />'),this.$element.append(e)},e}),define("common/controllers/export-controller",["require","import-export/dg-exporter","common/controllers/basic-dialog","underscore"],function(e){function t(e,t){var n=new r({width:"60%",modal:!0,buttons:t});n.setContent(e),n.open()}var n=e("import-export/dg-exporter"),r=e("common/controllers/basic-dialog"),i=e("underscore"),o=function(e,r){function a(){var e,t,n=[];for(e=0,t=S.length;t>e;e++)n.push(_.get(S[e]));return n}function s(){x=[a()]}function l(){x.push(a()),E=!0}function u(){x.length=_.stepCounter()+1}function c(e,t,n){var r,a="User "+e+".";t&&(r={fields:t.perRunPropertyLabels,values:t.perRunPropertyValues}),n&&(r=i.extend(r||{},n)),r&&(a+=" Per-run Settings and Data: ",a+=JSON.stringify(r)),o.logAction(a)}function d(){return o.canExportData()&&E}function p(e){t("<p>You're setting up a new run without saving your data. Please indicate why:</p><form id='export-alert-form'>  <p><input type='radio' name='reason' value='trying-things-out'>Just trying things out.</input></p>  <p><input type='radio' name='reason' value='experiment-worked-not-satisfied'>Experiment worked, but not satisfied with the data.</input></p>  <p><input type='radio' name='reason' value='something-went-wrong'>Something went wrong during the experiment.</input></p>  <p><input type='radio' name='reason' value='other'>Other.</input></p></form>",{OK:function(){c("discarded data",y(),{reasonCode:$(this).find("input[name=reason]:checked").val()}),$(this).remove(),e.proceed()},Cancel:function(){$(this).remove(),e.cancel()}})}function h(){if(!C)return[];var e=y(),t=[];return e.perRunPropertyValues.forEach(function(e,n){var r=C.perRunPropertyValues[n];e!==r&&t.push({field:C.perRunPropertyLabels[n],valueAtStart:r,valueExported:e})}),t}function f(){_.on("tick.exportController",l),_.on("reset.exportController",s),_.on("play.exportController",function(){u(),c("started the model",y()),C||(C=y())}),_.on("invalidation.exportController",u),_.on("willReset.exportController",function(){T=y()})}function m(e,t){return e===_&&d()?(p(t),!0):!1}function g(){r.on("modelLoaded.exportController",function(e){v("modelLoaded",e)}),r.on("modelReset.exportController",function(e){v("modelReset",e)}),r.on("willResetModel",m)}function v(e,t){_=r.getModel(),s(),f(),"modelLoaded"===e?"reload"===t?c("reloaded the model",T):"new-run"===t?c("set up a new run",T):c("loaded a model"):"modelReset"===e&&("new-run"===t?c("set up a new run",T):c("reset the model",T)),C=null,T=null,E=!1}function y(){var e={};e.perRunPropertyLabels=[],e.perRunPropertyValues=[];for(var t=0;t<A.length;t++)e.perRunPropertyLabels[t]=b(A[t]),e.perRunPropertyValues[t]=_.get(A[t]);return e}function b(e){var t=_.getPropertyDescription(e),n=t.getLabel(),r=t.getUnitAbbreviation(),i="";return i+=n.length>0?n:e,r&&r.length>0&&(i+=" (",i+=r,i+=")"),i}var x,w,_,T,C,A=(e.perRun||[]).slice(),S=["displayTime"].concat(e.perTick.slice()),P=(e.selectionComponents||[]).slice(),E=!1;return g(),w={canExportData:function(){return o.canExportData()},isUnexportedDataPresent:function(){return E},selectedData:function(){var e,t,n,i=1/0,o=-1/0,a=[];for(e=0;e<P.length;e++)t=r.getComponent(P[e]),t&&t.selectionDomain&&(n=t.selectionDomain(),null!==n&&2==n.length&&(i>n[0]&&(i=n[0]),o<n[1]&&(o=n[1])));return a=1/0>i||o>-1/0?x.filter(function(e){return e[0]>i&&e[0]<o}):x},exportData:function(){var e,t,r=[],i=[],o=[];for(e=h(),c("exported the model",y(),{changedParameters:e}),e.length>0&&c("changed parameters between start and export",null,{changedParameters:e}),r[0]="Row",i[0]=null,t=0;t<A.length;t++)r[t+1]=b(A[t]),i[t+1]=_.get(A[t]);for(t=0;t<S.length;t++)o[t]=b(S[t]);n.exportData(r,i,o,this.selectedData()),n.openTable(),E=!1}}};return o.canExportData=function(){return n.canExportData()},o.logAction=function(){n.logAction.apply(n,arguments)},o}),define("common/controllers/scripting-api",["require","common/alert"],function(e){function t(e){return function(){throw new ReferenceError(e+" is not defined")}}function n(){var e,n,r,i,a=Object.getOwnPropertyNames(window);for(n=0,r=a.length;r>n;n++)e=a[n],o.hasOwnProperty(e)||(i=t(e),Object.defineProperty(o,e,{set:i,get:i}))}var r=e("common/alert"),i=0,o={};return function(e,t){function a(e){t.on("reset.common-scripting-api-"+i++,e)}var s={api:function(){function n(e){return"number"==typeof e&&parseFloat(e)===parseInt(e,10)}function o(e){return"object"==typeof e&&e.slice===Array.prototype.slice}function s(e){return e?Math.random()*e:Math.random()}function l(e){return Math.floor(Math.random()*e)}function u(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function c(e,t){var n,r=[];for(n=0;t>n;n++)r[n]=n;for(n=0;e>n;n++)u(r,n,n+l(t-n));return r.length=e,r}function d(e,t,n){var r;"undefined"!=typeof _gaq&&(r=_gaq,e||(e="Interactive"),r.push(["_trackEvent",e,t,n]))}return{isInteger:n,isArray:o,randomInteger:l,randomFloat:s,swapElementsOfArray:u,choose:c,deg2rad:Math.PI/180,rad2deg:180/Math.PI,trackEvent:d,format:d3.format,get:function(){return t.get.apply(t,arguments)},set:function(){return t.set.apply(t,arguments)},freeze:function(){return t.freeze.apply(t,arguments)},unfreeze:function(){return t.unfreeze.apply(t,arguments)},loadModel:function(n,r){t.stop(),e.loadModel(n,null,r)},getLoadedModelId:function(){return e.getLoadedModelId()},onPropertyChange:function(e,n){t.addPropertiesListener([e],function(){n(t.get(e))})},callAt:function(e,n){function r(){t.properties.time>=e&&(n(),o())}function i(){t.addObserver("time",r)}function o(){t.removeObserver("time",r)}function s(){t.properties.time<e&&i()}a(i),this.onStart(s),i()},callEvery:function(e,n){function r(){for(;t.properties.time-s>=e;)n(),s+=e}function i(){s=0}function o(){for(;s>t.properties.time;)s-=e}var s=0;t.addObserver("time",r),a(i),this.onStart(o)},onClick:function(t,n){e.modelController.modelContainer.setClickHandler("."+t,n)},onDrag:function(t,n){e.modelController.modelContainer.setDragHandler(t,n)},onSelect:function(t){e.modelController.modelContainer.setSelectHandler(t)},setComponentDisabled:function(t,n){e.getComponent(t).setDisabled(n)},clearDataSet:function(t){e.getDataSet(t).clearData()},resetDataSet:function(t){e.getDataSet(t).resetData()},appendDataPropertiesToComponent:function(t){var n=e.getComponent(t);void 0!==n&&n.appendDataPropertiesToComponent()},setComponentAttributes:function(t,n){var r=e.getComponent(t);void 0!==r&&r.setAttributes(n)},syncAxisRangesToPropertyRanges:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.syncAxisRangesToPropertyRanges)throw new Error("Component "+t+" does not support syncAxisRangesToPropertyRanges.");n.syncAxisRangesToPropertyRanges()},scrollXAxisToZero:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.scrollXAxisToZero)throw new Error("Component "+t+" does not support scrollXAxisToZero.");n.scrollXAxisToZero()},resetGraphSelection:function(t){var n=e.getComponent(t);if(!n)throw new Error("Component "+t+" not found.");if(!n.selectionDomain)throw new Error("Component "+t+" does not support selectionDomain.");if(!n.selectionEnabled)throw new Error("Component "+t+" does not support selectionEnabled.");n.selectionDomain(null),n.selectionEnabled(!1)},start:function(){t.start(),d("Interactive","Start","Starting interactive: "+e.get("title"))},onStart:function(e){t.on("play.custom-script"+i++,e)},stop:function(){t.stop()},onStop:function(e){t.on("stop.custom-script",e)},reloadModel:function(t){e.reloadModel(t)},reloadInteractive:function(){e.reloadInteractive()},stepForward:function(){t.stepForward(),t.isNewStep()||e.updateModelView()},stepBack:function(){t.stepBack(),e.updateModelView()},tick:function(){t.tick()},isStopped:function(){return t.isStopped()},getTime:function(){return t.get("time")},getFPS:function(){return t.getFPS()},getSimulationProgressRate:function(){return t.getSimulationProgressRate()},startPerformanceTuning:function(){t.performanceOptimizer.enable()},repaint:function(){e.repaintModelView()},canExportData:function(){var t=e.getDGExportController();return t&&t.canExportData()||!1},isUnexportedDataPresent:function(){var t=e.getDGExportController();return t&&t.isUnexportedDataPresent()||!1},exportData:function(){var t=e.getDGExportController();if(!t||!t.canExportData())throw new Error("No exports have been specified.");t.exportData()},Math:Math,Infinity:1/0,isFinite:isFinite,NaN:0/0,isNaN:isNaN,undefined:void 0,alert:r,console:null!==window.console?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}(),get model(){return t},get intController(){return e},bindModel:function(e){t=e},freeze:function(){Object.freeze(this.api)},extend:function(e){$.extend(this.api,new e(this))},exposeScriptingAPI:function(){window.script=this.api,window.script.run=function(e,t){var n,r=[],i=[];for(n in t)t.hasOwnProperty(n)&&(r.push(n),i.push(t[n]));return s.makeFunctionInScriptContext.apply(null,r.concat(e)).apply(null,i)}},makeFunctionInScriptContext:function(){var e,t,i,a=Array.prototype.slice.call(arguments,0,arguments.length-1),l=arguments[arguments.length-1];"string"!=typeof l&&(l=l.join("      \n")),e="with (shadowedGlobals) {\n  with (scriptingAPI) {\n    return function("+a.join(",")+") {\n      'use strict';\n      "+l+"\n    };\n  }\n}";try{t=new Function("shadowedGlobals","scriptingAPI",e),i=t(o,s.api)}catch(u){return r('Error compiling script: "'+u.toString()+'"\nScript:\n\n'+l),function(){throw new Error("Cannot run a script that could not be compiled")}}return function(){n();try{return i.apply(null,Array.prototype.slice.call(arguments))}catch(e){r('Error running script: "'+e.toString()+'"\nScript:\n\n'+l)}}}};return s}}),define("common/inherit",[],function(){return function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.superClass=t.prototype,e.prototype.constructor=e}}),define("common/views/view-state",[],function(){return{disableView:function(e){e.hasClass("lab-disabled")||(e.addClass("lab-disabled"),e.append('<div class="lab-disabled-overlay"/>'))},enableView:function(e){e.removeClass("lab-disabled"),e.find(".lab-disabled-overlay").remove()}}}),define("common/controllers/disablable",["common/views/view-state"],function(){var e=require("common/views/view-state"),t=e.enableView,n=e.disableView;return function(e,r){e.setDisabled=function(e){var r=this.getViewContainer();e?(n(r),this.isDisabled=!0):(t(r),this.isDisabled=!1)},e.isDisabled=!1,r&&e.setDisabled(r.disabled)}}),define("common/controllers/interactive-component",["require","common/controllers/interactive-metadata","common/validator","common/controllers/disablable"],function(e){function t(e,t,i){this._interactivesController=i,this._scriptingAPI=this._interactivesController.getScriptingAPI(),this._model=this._interactivesController.getModel(),this.component=r.validateCompleteness(n[e],t),this.$element=$("<div>").attr("id",t.id).addClass("component"),this.component.width&&this.$element.css("width",this.component.width),this.component.height&&this.$element.css("height",this.component.height),this.component.disabled&&this.setDisabled(this.component.disabled),this._optionallyAddOnClickHandlers(),this.component.classes&&this.component.classes.length&&this.$element.addClass(this.component.classes.join(" ")),this.component.tooltip&&this.$element.attr("title",this.component.tooltip)}var n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i=e("common/controllers/disablable");return t.prototype._modelLoadedCallback=function(){this._scriptingAPI=this._interactivesController.getScriptingAPI(),this._model=this._interactivesController.getModel(),this._optionallyAddOnClickHandlers()},t.prototype._updateClickHandler=function(e){this.$element.off("click."+this._nameSpace),this._actionClickFunction="function"!=typeof e?this._scriptingAPI.makeFunctionInScriptContext(e):e;var t=this;this.$element.on("click."+this._nameSpace,this._clickTargetSelector||null,function(){t._actionClickFunction()}),this.$element.addClass("clickable")},t.prototype._optionallyAddOnClickHandlers=function(){void 0!==this.component.onClick&&this._updateClickHandler(this.component.onClick),void 0!==this.component.action&&this._updateClickHandler(this.component.action)},t.prototype.setAction=function(e){"function"!=typeof script&&(this.component.action=e),this._updateClickHandler(e)},t.prototype.setOnClick=function(e){void 0!==this.component.onClick&&(this.component.onClick=e,this._updateClickHandler(this.component.onClick))},t.prototype.getViewContainer=function(){return this.$element},t.prototype.serialize=function(){return this.component},i(t.prototype),t}),define("common/controllers/button-controller",["common/inherit","common/controllers/interactive-component"],function(){function e(e,t){this._actionClickFunction=function(){},this._nameSpace="button"+ ++r,n.call(this,"button",e,t),this.$element.addClass("interactive-button"),this.button=$("<button>").html(e.text).appendTo(this.$element),this._clickTargetSelector="button",this.setAttributes=function(e){e.text&&"undefined"!=typeof e.text&&this.button.html(e.text)}}var t=require("common/inherit"),n=require("common/controllers/interactive-component"),r=0;return t(e,n),e.prototype.modelLoadedCallback=function(){e.superClass._modelLoadedCallback.call(this)},e}),define("common/controllers/checkbox-controller",["common/controllers/interactive-metadata","common/controllers/disablable","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/controllers/disablable"),n=require("common/validator");return function(r,i){function o(){s(v.get(u))}function a(){var e=v.getPropertyDescription(u);g.setDisabled(e.getFrozen())}function s(e){e?(p.prop("checked",!0),h.addClass("checked")):(p.prop("checked",!1),h.removeClass("checked"))}function l(e){e.preventDefault(),s(p.prop("checked")?!1:!0),p.trigger("change")}var u,c,d,p,h,f,m,g,v,y;return v=i.getModel(),y=i.getScriptingAPI(),r=n.validateCompleteness(e.checkbox,r),u=r.property,c=r.action,d=r.initialValue,f=$("<label>").append("<span>"+r.text+"</span>"),f.attr("for",r.id),p=$('<input type="checkbox">').attr("id",r.id),i&&p.attr("tabindex",i.getNextTabIndex()),h=$('<div class="fakeCheckable">'),p.css("display","none"),m="left"===r.textOn?$("<div>").append(f).append(p).append(h.addClass("right")):$("<div>").append(p).append(h).append(f),m.addClass("interactive-checkbox"),m.addClass("component"),h.on("click",l),f.on("click",l),m.css({width:r.width,height:r.height}),c&&(c=y.makeFunctionInScriptContext("value",c)),p.on("change",function(){var e,t=!1;$(this).is(":checked")&&(t=!0),void 0!==u&&(e={},e[u]=t,v.set(e)),void 0!==c&&c(t)}),r.tooltip&&m.attr("title",r.tooltip),void 0!==d&&s(d),g={modelLoadedCallback:function(){v&&void 0!==u&&(v.removeObserver(u,o),v.removePropertyDescriptionObserver(u,a)),v=i.getModel(),y=i.getScriptingAPI(),void 0!==u&&(v.addPropertiesListener([u],o),v.addPropertyDescriptionObserver(u,a),o())},getViewContainer:function(){return m},serialize:function(){var e=$.extend(!0,{},r);return void 0===u&&(e.initialValue=p.is(":checked")?!0:!1),e}},t(g,r),g}}),function(e){function t(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function n(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function r(e){for(var t=0,n=-1;-1!==(n=e.indexOf("\n",n+1));)t++;return t}function i(e,t){function n(e){this.len_after=e,this.name="close_"+t}var r=e+"_state",i="strong"==e?"em_state":"strong_state";return function(o){if(this[r][0]==t)return this[r].shift(),[o.length,new n(o.length-t.length)];var a=this[i].slice(),s=this[r].slice();this[r].unshift(t);{var l=this.processInline(o.substr(t.length)),u=l[l.length-1];this[r].shift()}if(u instanceof n){l.pop();var c=o.length-u.len_after;return[c,[e].concat(l)]}return this[i]=a,this[r]=s,[t.length,t]}}function o(e){for(var t=e.split(""),n=[""],r=!1;t.length;){var i=t.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=t.shift();default:n[n.length-1]+=i}}return n}function s(e){return g(e)&&e.length>1&&"object"==typeof e[1]&&!g(e[1])?e[1]:void 0}function l(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function u(e){if("string"==typeof e)return l(e);var t=e.shift(),n={},r=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(n=e.shift());e.length;)r.push(u(e.shift()));var i="";for(var o in n)i+=" "+o+'="'+l(n[o])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+i+"/>":"<"+t+i+">"+r.join("")+"</"+t+">"}function c(e,t,n){var r;n=n||{};var i=e.slice(0);"function"==typeof n.preprocessTreeNode&&(i=n.preprocessTreeNode(i,t));var o=s(i);if(o){i[1]={};for(r in o)i[1][r]=o[r];o=i[1]}if("string"==typeof i)return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";
break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",o&&delete o.references;break;case"code_block":i[0]="pre",r=o?2:1;var a=["code"];a.push.apply(a,i.splice(r,i.length-r)),i[r]=a;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var l=t[o.ref];if(!l)return o.original;delete o.ref,o.href=l.href,l.title&&(o.title=l.title),delete o.original;break;case"img_ref":i[0]="img";var l=t[o.ref];if(!l)return o.original;delete o.ref,o.src=l.href,l.title&&(o.title=l.title),delete o.original}if(r=1,o){for(var u in i[1]){r=2;break}1===r&&i.splice(r,1)}for(;r<i.length;++r)i[r]=c(i[r],t,n);return i}function d(e){for(var t=s(e)?2:1;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(d(e[t]),++t)}var h=e.Markdown=function(e){switch(typeof e){case"undefined":this.dialect=h.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in h.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=h.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};e.parse=function(e,t){var n=new h(t);return n.toTree(e)},e.toHTML=function(t,n,r){var i=e.toHTMLTree(t,n,r);return e.renderJsonML(i)},e.toHTMLTree=function(e,t,n){"string"==typeof e&&(e=this.parse(e,t));var r=s(e),i={};r&&r.references&&(i=r.references);var o=c(e,i,n);return d(o),o};var f=h.mk_block=function(e,r,i){1==arguments.length&&(r="\n\n");var o=new String(e);return o.trailing=r,o.inspect=n,o.toSource=t,void 0!=i&&(o.lineNumber=i),o};h.prototype.split_blocks=function(e){e=e.replace(/(\r\n|\n|\r)/g,"\n");var t,n=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,i=[],o=1;for(null!=(t=/^(\s*\n)/.exec(e))&&(o+=r(t[0]),n.lastIndex=t[0].length);null!==(t=n.exec(e));)"\n#"==t[2]&&(t[2]="\n",n.lastIndex--),i.push(f(t[1],t[2],o)),o+=r(t[0]);return i},h.prototype.processBlock=function(e,t){var n=this.dialect.block,r=n.__order__;if("__call__"in n)return n.__call__.call(this,e,t);for(var i=0;i<r.length;i++){var o=n[r[i]].call(this,e,t);if(o)return(!g(o)||o.length>0&&!g(o[0]))&&this.debug(r[i],"didn't return a proper array"),o}return[]},h.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},h.prototype.toTree=function(e,t){var n=e instanceof Array?e:this.split_blocks(e),r=this.tree;try{for(this.tree=t||this.tree||["markdown"];n.length;){var i=this.processBlock(n.shift(),n);i.length&&this.tree.push.apply(this.tree,i)}return this.tree}finally{t&&(this.tree=r)}},h.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,e)},h.prototype.loop_re_over_block=function(e,t,n){for(var r,i=t.valueOf();i.length&&null!=(r=e.exec(i));)i=i.substr(r[0].length),n.call(this,r);return i},h.dialects={},h.dialects.Gruber={block:{atxHeader:function(e,t){var n=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!n)return void 0;var r=["header",{level:n[1].length}];return Array.prototype.push.apply(r,this.processInline(n[2])),n[0].length<e.length&&t.unshift(f(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[r]},setextHeader:function(e,t){var n=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!n)return void 0;var r="="===n[2]?1:2,i=["header",{level:r},n[1]];return n[0].length<e.length&&t.unshift(f(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[i]},code:function(e,t){var n=[],r=/^(?: {0,3}\t| {4})(.*)\n?/;if(!e.match(r))return void 0;e:for(;;){var i=this.loop_re_over_block(r,e.valueOf(),function(e){n.push(e[1])});if(i.length){t.unshift(f(i,e.trailing));break e}if(!t.length)break e;if(!t[0].match(r))break e;n.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",n.join("\n")]]},horizRule:function(e,t){var n=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!n)return void 0;var r=[["hr"]];return n[1]&&r.unshift.apply(r,this.processBlock(n[1],[])),n[3]&&t.unshift(f(n[3])),r},lists:function(){function e(e){return new RegExp("(?:^("+l+"{0,"+e+"} {0,3})("+o+")\\s+)|(^"+l+"{0,"+(e-1)+"}[ ]{0,4})")}function t(e){return e.replace(/ {0,3}\t/g,"    ")}function n(e,t,n,r){if(t)return void e.push(["para"].concat(n));var i=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;r&&e.length>1&&n.unshift(r);for(var o=0;o<n.length;o++){var a=n[o],s="string"==typeof a;s&&i.length>1&&"string"==typeof i[i.length-1]?i[i.length-1]+=a:i.push(a)}}function r(e,t){for(var n=new RegExp("^("+l+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+l+"{"+e+"}","gm"),i=[];t.length>0&&n.exec(t[0]);){var o=t.shift(),a=o.replace(r,"");i.push(f(a,o.trailing,o.lineNumber))}return i}function i(e,t,n){var r=e.list,i=r[r.length-1];if(!(i[1]instanceof Array&&"para"==i[1][0]))if(t+1==n.length)i.push(["para"].concat(i.splice(1,i.length-1)));else{var o=i.pop();i.push(["para"].concat(i.splice(1,i.length-1)),o)}}var o="[*+-]|\\d+\\.",a=/[*+-]/,s=new RegExp("^( {0,3})("+o+")[ 	]+"),l="(?: {0,3}\\t| {4})";return function(o,l){function u(e){var t=a.exec(e[2])?["bulletlist"]:["numberlist"];return h.push({list:t,indent:e[1]}),t}var c=o.match(s);if(!c)return void 0;for(var d,p,h=[],f=u(c),g=!1,v=[h[0].list];;){for(var y=o.split(/(?=\n)/),b="",x=0;x<y.length;x++){var w="",_=y[x].replace(/^\n/,function(e){return w=e,""}),T=e(h.length);if(c=_.match(T),void 0!==c[1]){b.length&&(n(d,g,this.processInline(b),w),g=!1,b=""),c[1]=t(c[1]);var C=Math.floor(c[1].length/4)+1;if(C>h.length)f=u(c),d.push(f),d=f[1]=["listitem"];else{var A=!1;for(p=0;p<h.length;p++)if(h[p].indent==c[1]){f=h[p].list,h.splice(p+1,h.length-(p+1)),A=!0;break}A||(C++,C<=h.length?(h.splice(C,h.length-C),f=h[C-1].list):(f=u(c),d.push(f))),d=["listitem"],f.push(d)}w=""}_.length>c[0].length&&(b+=w+_.substr(c[0].length))}b.length&&(n(d,g,this.processInline(b),w),g=!1,b="");var S=r(h.length,l);S.length>0&&(m(h,i,this),d.push.apply(d,this.toTree(S,[])));var P=l[0]&&l[0].valueOf()||"";if(!P.match(s)&&!P.match(/^ /))break;o=l.shift();var E=this.dialect.block.horizRule(o,l);if(E){v.push.apply(v,E);break}m(h,i,this),g=!0}return v}}(),blockquote:function(e,t){if(!e.match(/^>/m))return void 0;var n=[];if(">"!=e[0]){for(var r=e.split(/\n/),i=[],o=e.lineNumber;r.length&&">"!=r[0][0];)i.push(r.shift()),o++;var a=f(i.join("\n"),"\n",e.lineNumber);n.push.apply(n,this.processBlock(a,[])),e=f(r.join("\n"),e.trailing,o)}for(;t.length&&">"==t[0][0];){var l=t.shift();e=f(e+e.trailing+l,l.trailing,e.lineNumber)}var u=e.replace(/^> ?/gm,""),c=(this.tree,this.toTree(u,["blockquote"])),d=s(c);return d&&d.references&&(delete d.references,v(d)&&c.splice(1,1)),n.push(c),n},referenceDefn:function(e,t){var n=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!e.match(n))return void 0;s(this.tree)||this.tree.splice(1,0,{});var r=s(this.tree);void 0===r.references&&(r.references={});var i=this.loop_re_over_block(n,e,function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=r.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return i.length&&t.unshift(f(i,e.trailing)),[]},para:function(e){return[["para"].concat(this.processInline(e))]}}},h.dialects.Gruber.inline={__oneElement__:function(e,t,n){var r,i;t=t||this.dialect.inline.__patterns__;var o=new RegExp("([\\s\\S]*?)("+(t.source||t)+")");if(r=o.exec(e),!r)return[e.length,e];if(r[1])return[r[1].length,r[1]];var i;return r[2]in this.dialect.inline&&(i=this.dialect.inline[r[2]].call(this,e.substr(r.index),r,n||[])),i=i||[r[2].length,r[2]]},__call__:function(e,t){function n(e){"string"==typeof e&&"string"==typeof i[i.length-1]?i[i.length-1]+=e:i.push(e)}for(var r,i=[];e.length>0;)r=this.dialect.inline.__oneElement__.call(this,e,t,i),e=e.substr(r.shift()),m(r,n);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var n={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(n.title=t[4]),[t[0].length,["img",n]]}return t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),t?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function y(e){var t=String(e),n=h.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!n)return[1,"["];var y,r,i=1+n[0],o=n[1];e=e.substr(i);var a=e.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(a){var s=a[1];if(i+=a[0].length,s&&"<"==s[0]&&">"==s[s.length-1]&&(s=s.substring(1,s.length-1)),!a[3])for(var l=1,u=0;u<s.length;u++)switch(s[u]){case"(":l++;break;case")":0==--l&&(i-=s.length-u,s=s.substring(0,u))}return s=this.dialect.inline.__call__.call(this,s,/\\/)[0],r={href:s||""},void 0!==a[3]&&(r.title=a[3]),y=["link",r].concat(o),[i,y]}return a=e.match(/^\s*\[(.*?)\]/),a?(i+=a[0].length,r={ref:(a[1]||String(o)).toLowerCase(),original:t.substr(0,i)},y=["link_ref",r].concat(o),[i,y]):1==o.length&&"string"==typeof o[0]?(r={ref:o[0].toLowerCase(),original:t.substr(0,i)},y=["link_ref",r,o[0]],[i,y]):[1,"["]},"<":function(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}},h.dialects.Gruber.inline["**"]=i("strong","**"),h.dialects.Gruber.inline.__=i("strong","__"),h.dialects.Gruber.inline["*"]=i("em","*"),h.dialects.Gruber.inline._=i("em","_"),h.buildBlockOrder=function(e){var t=[];for(var n in e)"__order__"!=n&&"__call__"!=n&&t.push(n);e.__order__=t},h.buildInlinePatterns=function(e){var t=[];for(var n in e)if(!n.match(/^__.*__$/)){var r=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==n.length?r:"(?:"+r+")")}t=t.join("|"),e.__patterns__=t;var i=e.__call__;e.__call__=function(e,n){return void 0!=n?i.call(this,e,n):i.call(this,e,t)}},h.DialectHelpers={},h.DialectHelpers.inline_until_char=function(e,t){for(var n=0,r=[];;){if(e.charAt(n)==t)return n++,[n,r];if(n>=e.length)return null;var i=this.dialect.inline.__oneElement__.call(this,e.substr(n));n+=i[0],r.push.apply(r,i.slice(1))}},h.subclassDialect=function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}},h.buildBlockOrder(h.dialects.Gruber.block),h.buildInlinePatterns(h.dialects.Gruber.inline),h.dialects.Maruku=h.subclassDialect(h.dialects.Gruber),h.dialects.Maruku.processMetaHash=function(e){for(var t=o(e),n={},r=0;r<t.length;++r)if(/^#/.test(t[r]))n.id=t[r].substring(1);else if(/^\./.test(t[r]))n["class"]=n["class"]?n["class"]+t[r].replace(/./," "):t[r].substring(1);else if(/\=/.test(t[r])){var i=t[r].split(/\=/);n[i[0]]=i[1]}return n},h.dialects.Maruku.block.document_meta=function(e){if(e.lineNumber>1)return void 0;if(!e.match(/^(?:\w+:.*\n)*\w+:.*$/))return void 0;s(this.tree)||this.tree.splice(1,0,{});var t=e.split(/\n/);for(p in t){var n=t[p].match(/(\w+):\s*(.*)$/),r=n[1].toLowerCase(),i=n[2];this.tree[1][r]=i}return[]},h.dialects.Maruku.block.block_meta=function(e){var t=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!t)return void 0;var n,r=this.dialect.processMetaHash(t[2]);if(""===t[1]){var i=this.tree[this.tree.length-1];if(n=s(i),"string"==typeof i)return void 0;n||(n={},i.splice(1,0,n));for(a in r)n[a]=r[a];return[]}var o=e.replace(/\n.*$/,""),l=this.processBlock(o,[]);n=s(l[0]),n||(n={},l[0].splice(1,0,n));for(a in r)n[a]=r[a];return l},h.dialects.Maruku.block.definition_list=function(e,t){var n,r,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,o=["dl"];if(!(r=e.match(i)))return void 0;for(var a=[e];t.length&&i.exec(t[0]);)a.push(t.shift());for(var s=0;s<a.length;++s){var r=a[s].match(i),l=r[1].replace(/\n$/,"").split(/\n/),u=r[2].split(/\n:\s+/);for(n=0;n<l.length;++n)o.push(["dt",l[n]]);for(n=0;n<u.length;++n)o.push(["dd"].concat(this.processInline(u[n].replace(/(\n)\s+/,"$1"))))}return[o]},h.dialects.Maruku.block.table=function b(e){var t,n,r=function(e,t){t=t||"\\s",t.match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var n,r=[],i=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");n=e.match(i);)r.push(n[1]),e=n[2];return r.push(e),r},i=/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,o=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;if(n=e.match(i))n[3]=n[3].replace(/^\s*\|/gm,"");else if(!(n=e.match(o)))return void 0;var b=["table",["thead",["tr"]],["tbody"]];n[2]=n[2].replace(/\|\s*$/,"").split("|");var a=[];for(m(n[2],function(e){a.push(e.match(/^\s*-+:\s*$/)?{align:"right"}:e.match(/^\s*:-+\s*$/)?{align:"left"}:e.match(/^\s*:-+:\s*$/)?{align:"center"}:{})}),n[1]=r(n[1].replace(/\|\s*$/,""),"|"),t=0;t<n[1].length;t++)b[1][1].push(["th",a[t]||{}].concat(this.processInline(n[1][t].trim())));return m(n[3].replace(/\|\s*$/gm,"").split("\n"),function(e){var n=["tr"];for(e=r(e,"|"),t=0;t<e.length;t++)n.push(["td",a[t]||{}].concat(this.processInline(e[t].trim())));b[2].push(n)},this),[b]},h.dialects.Maruku.inline["{:"]=function(e,t,n){if(!n.length)return[2,"{:"];var r=n[n.length-1];if("string"==typeof r)return[2,"{:"];var i=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!i)return[2,"{:"];var o=this.dialect.processMetaHash(i[1]),a=s(r);a||(a={},r.splice(1,0,a));for(var l in o)a[l]=o[l];return[i[0].length,""]},h.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,h.buildBlockOrder(h.dialects.Maruku.block),h.buildInlinePatterns(h.dialects.Maruku.inline);var m,g=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};m=Array.prototype.forEach?function(e,t,n){return e.forEach(t,n)}:function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||e,e[r],r,e)};var v=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0};e.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var n=[];if(t.root)n.push(u(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)n.push(u(e.shift()));return n.join("\n\n")}}(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}()),define("markdown",function(e){return function(){var t;return t||e.markdown}}(this)),define("common/markdown-to-html",["require","markdown"],function(e){var t=e("markdown"),n='class="opens-in-new-window" target="blank"';return function(e){var r,i="";return $.isArray(e)||(e=[e]),e.forEach(function(e){i+=e+"\n"}),r='<div class="markdown-typography">'+t.toHTML(i)+"</div>",r.replace(/<a(.*?)>/g,"<a$1 "+n+">")}}),define("common/controllers/text-controller",["require","common/markdown-to-html","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t){i.call(this,"text",e,t),this.$element.addClass("interactive-text"),this.$element.append(n(this.component.text))}var n=e("common/markdown-to-html"),r=e("common/inherit"),i=e("common/controllers/interactive-component");return r(t,i),t.prototype.modelLoadedCallback=function(){t.superClass._modelLoadedCallback.call(this)},t}),define("common/controllers/image-controller",["require","lab.config","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t){var n="undefined"!=typeof Lab?Lab.config.actualRoot:"";i.call(this,"image",e,t),this._controller=t,this._$img=$("<img>"),this._externalUrl=o.test(this.component.src),this._resourcesUrl=a.test(this.component.src),this._externalUrl?this._$img.attr("src",this.component.src):this._resourcesUrl&&this._$img.attr("src",this.component.src.replace(a,n+"/lab/resources/")),"auto"!==this.component.width&&this._$img.css("width","100%"),"auto"!==this.component.height&&this._$img.css("height","100%"),this._$img.appendTo(this.$element)}var n=e("lab.config"),r=e("common/inherit"),i=e("common/controllers/interactive-component"),o=/^https?:\/\//i,a=/^{resources}\//i;return r(t,i),t.prototype.modelLoadedCallback=function(){var e,t;this._externalUrl||(e=this.component.src,t=this._controller.modelController.modelUrl,t=t.slice(0,t.lastIndexOf("/")+1),e=n.actualRoot+t+e,this._$img.attr("src",e))},t}),define("common/controllers/radio-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable");return function(r,i){function o(){if(void 0!==r.property)for(var e=h.get(r.property),t=0,n=p.length;n>t;t++)p[t].value===e?(m[t].attr("checked",!0),g[t].addClass("checked")):(m[t].removeAttr("checked"),g[t].removeClass("checked"))}function a(){var e=h.getPropertyDescription(r.property);u.setDisabled(e.getFrozen())}function s(e){var t,n,r=$(this).closest("span"),i=r.find("input"),o=r.find(".fakeCheckable");if(e.preventDefault(),void 0===i.attr("disabled")){for(t=0,n=m.length;n>t;t++)m[t].removeAttr("checked"),g[t].removeClass("checked");void 0!==i.attr("checked")?(i.removeAttr("checked"),o.removeClass("checked")):(i.attr("checked","checked"),o.addClass("checked")),i.trigger("change")}}function l(){var o,a,l,v,y,b;for(h=i.getModel(),f=i.getScriptingAPI(),r=t.validateCompleteness(e.radio,r),p=r.options,y=0,b=p.length;b>y;y++)p[y]=t.validateCompleteness(e.radioOption,p[y]);for(c=$("<div>").attr("id",r.id),c.addClass("interactive-radio"),c.addClass("component"),c.addClass(r.orientation),r.label&&(l=$("<span>").text(r.label),l.addClass("label"),l.addClass("top"===r.labelOn?"on-top":"on-left"),c.append(l)),y=0,b=p.length;b>y;y++)v=p[y],o=$("<input>").attr("type","radio").attr("name",r.id).attr("tabindex",i.getNextTabIndex()).attr("id",r.id+"-"+y),m.push(o),l=$("<label>").attr("for",r.id+"-"+y).text(v.text),a=$('<div class="fakeCheckable">'),g.push(a),v.disabled&&(o.attr("disabled",v.disabled),a.addClass("disabled")),v.selected&&(o.attr("checked",v.selected),a.addClass("checked")),d=$("<span>").addClass("option").append(o).append(a).append(l),c.append(d),a.on("touchstart click",s),l.on("touchstart click",s),o.change(function(e){return function(){e.action?f.makeFunctionInScriptContext(e.action)():void 0!==e.value&&h.set(r.property,e.value)}}(v));r.tooltip&&c.attr("title",r.tooltip),n(u,r)}var u,c,d,p,h,f,m=[],g=[];return u={modelLoadedCallback:function(){h&&void 0!==r.property&&(h.removeObserver(r.property,o),h.removePropertyDescriptionObserver(r.property,a)),h=i.getModel(),f=i.getScriptingAPI(),void 0!==r.property&&(h.addPropertiesListener([r.property],o),h.addPropertyDescriptionObserver(r.property,a)),o()},getViewContainer:function(){return c},serialize:function(){var e,t;if(void 0===r.property)for(e=0,t=p.length;t>e;e++)m[e].attr("checked")?p[e].selected=!0:delete p[e].selected;return $.extend(!0,{},r)}},l(),u}}),define("common/controllers/slider-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable");return function(r,i){function o(){r.action&&(d=S.makeFunctionInScriptContext("value",r.action),_.bind("slide",function(e,t){d(t.value),m&&T.text(g(t.value))})),c&&_.bind("slide",function(e,t){var n={};n[c]=t.value,A&&A.set(n),m&&T.text(g(t.value))}),m&&(g=S.makeFunctionInScriptContext("value",m))}function a(){for(S=i.getScriptingAPI(),A=i.getModel(),r=t.validateCompleteness(e.slider,r),s=r.min,l=r.max,u=r.steps,c=r.property,p=r.initialValue,h=r.title,f=r.labels,m=r.displayValue,A=i.getModel(),void 0===s&&(s=0),void 0===l&&(l=10),void 0===u&&(u=10),x=$('<p class="title">'+h+"</p>"),C=$('<div class="container">'),_=$('<div class="html-slider">').attr("id",r.id),_.appendTo(C),_.slider({min:s,max:l,step:(l-s)/u}),T=_.find(".ui-slider-handle"),T.attr("tabindex",i.getNextTabIndex()),b=$('<div class="interactive-slider">').append(x).append(C),b.addClass("component"),v=0;v<f.length;v++)y=f[v],w=$('<p class="label">'+y.label+"</p>"),w.css("left",(y.value-s)/(l-s)*100+"%"),C.append(w);o(),r.tooltip&&b.attr("title",r.tooltip),n(P,r),T.on("keydown.slider-handle",function(e){e.stopPropagation()}),b.css({width:r.width,height:r.height}),"auto"===r.width&&b.css("min-width","12em"),P.resize(),void 0!==p&&null!==p&&(_.slider("value",p),m&&T.text(g(p)))}var s,l,u,c,d,p,h,f,m,g,v,y,b,x,w,_,T,C,A,S,P,E=function(){var e=i.getModel().get(c);_.slider("value",e),m&&T.text(g(e))},k=function(){var e=A.getPropertyDescription(c);P.setDisabled(e.getFrozen())};return P={modelLoadedCallback:function(){A&&c&&(A.removeObserver(c,E),A.removePropertyDescriptionObserver(c,k)),S=i.getScriptingAPI(),A=i.getModel(),c&&(A.addPropertiesListener([c],E),A.addPropertyDescriptionObserver(c,k)),o(),c&&E()},getViewContainer:function(){return b},resize:function(){var e,t;"auto"!==r.height&&(e=b.height()-x.outerHeight(!0),void 0!==w&&(e-=w.outerHeight(!0)),C.css("height",e),_.css("top",.5*e),t=parseFloat(T.css("font-size")),T.css("height",e+.4*t),T.css("top",-.5*e-.4*t))},serialize:function(){var e=$.extend(!0,{},r);return c||(e.initialValue=_.slider("value")),e}},a(),P}}),define("common/views/select-box-view",[],function(){return function(e){function t(){var e;return n?void(n=!1):(e=$(this).prop("selectedIndex"),void u(a[e],e))}var n,r,i,o=e.id,a=e.options,s=e.label,l=e.labelOn,u=e.onChange;return{update:function(e){n=!0,r.data("selectBox-selectBoxIt").selectOption(e.toString().trim())},render:function(e){function n(t){var n=parseFloat(e.css("font-size"));return t/n}function u(){return this.width()}var c,d,p,h,f,m,g=[];return r=$("<select>"),a.forEach(function(e){c=$("<option>").html(e.text),g.push(c),e.disabled&&c.prop("disabled",e.disabled),e.selected&&c.prop("selected",e.selected),void 0!==e.value&&c.prop("value",e.value),r.append(c)}),r.change(t),i=$("<div>").attr("id",o),s&&(d=$("<span>").text(s),d.addClass("label"),d.addClass("top"===l?"on-top":"on-left"),i.append(d)),i.append(r),r.selectBoxIt(),i.find(".selectboxit").css("width","auto"),p=n(i.measure(u,"ul",e)),h=n(i.measure(u,".selectboxit-arrow-container",e)),f=p+"em",m=p+h+.3+"em",i.find(".selectboxit").css("width",m),i.find(".selectboxit-text").css("max-width",f),i.find(".selectboxit-container select").css({width:m,height:"100%"}),i}}}}),define("common/controllers/pulldown-controller",["common/controllers/interactive-metadata","common/validator","common/controllers/disablable","common/views/select-box-view","common/jquery-plugins"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/controllers/disablable"),r=require("common/views/select-box-view");return require("common/jquery-plugins"),function(i,o){function a(){void 0!==i.property&&h.update(c.get(i.property))}function s(){var e=c.getPropertyDescription(i.property);u.setDisabled(e.getFrozen())}function l(){var a,s,l=o.interactiveContainer;for(c=o.getModel(),d=o.getScriptingAPI(),i=t.validateCompleteness(e.pulldown,i),p=i.options,a=0,s=p.length;s>a;a++)p[a]=t.validateCompleteness(e.pulldownOption,p[a]);h=new r({id:i.id,options:p,label:i.label,labelOn:i.labelOn,onChange:function(e){e.action?d.makeFunctionInScriptContext(e.action)():void 0!==e.value&&d.api.set(i.property,e.value)}}),f=h.render(l),f.addClass("interactive-pulldown").addClass("component"),i.tooltip&&f.attr("title",i.tooltip),n(u,i)}var u,c,d,p,h,f;return u={modelLoadedCallback:function(){d=o.getScriptingAPI(),void 0!==i.property?(c&&(c.removeObserver(i.property,a),c.removePropertyDescriptionObserver(i.property,s)),c=o.getModel(),c.addObserver(i.property,a),c.addPropertyDescriptionObserver(i.property,s)):c=o.getModel(),a()},getViewContainer:function(){return f},serialize:function(){var e,t,n;if(void 0===i.property)for(n=f.find("option"),e=0,t=p.length;t>e;e++)$(n[e]).prop("selected")?p[e].selected=!0:delete p[e].selected;return $.extend(!0,{},i)}},l(),u}}),define("common/layout/detect-font-change",[],function(){function e(e){var t=Math.ceil(1.5*parseFloat(e.match(/[\d\.]+px/),10)),n=document.createElement("canvas"),r=n.getContext("2d");return isNaN(t)&&(t=20),n.width=t,n.height=t,r.font=e,r.fillText("A",0,t),n.toDataURL()}function t(e){window.clearInterval(o[e].pollingInterval),delete o[e]}function n(n,r,a){return o[n].bitmap=e(n),function(){return e(n)!==o[n].bitmap?(o[n].changeCallbacks.forEach(function(e){e()}),i[n]=!0,void t(n)):void(Date.now()-r>a&&t(n))}}var r={timeout:3e3,interval:250,onchange:null},i={},o={};return function(e){var t,a={};return Object.keys(e).concat(Object.keys(r)).forEach(function(t){a[t]=null!=e[t]?e[t]:r[t]}),t=a.font,i[t]?!1:(o[t]||(o[t]={bitmap:null,pollingInterval:null,changeCallbacks:[]}),a.onchange&&o[t].changeCallbacks.push(a.onchange),o[t].pollingInterval||(o[t].pollingInterval=window.setInterval(n(t,Date.now(),a.timeout),a.interval)),!0)}}),define("common/views/numeric-output-view",["common/layout/detect-font-change"],function(){var e=require("common/layout/detect-font-change"),t=2;return function(n){function r(e){var n;m=e,g=l.height(),p.width(m),p.height(g),v=t*m,y=t*g,p.attr("width",v),p.attr("height",y),n=t*parseInt(l.css("font-size"),10),f.font=[l.css("font-style"),l.css("font-variant"),l.css("font-weight"),n+"px/"+l.css("line-height"),l.css("font-family")].join(" "),f.fillStyle=l.css("color"),f.textAlign="right",f.textBaseline="middle",h=y/2}function i(){var e=s.position();p.css({left:e.left+parseInt(l.css("padding-left"),10)+l.width()-m,top:e.top+parseInt(s.css("padding-top"),10)})}var o,a,s,l,u,c,d,p,h,f,m,g,v,y,b,x=n.id,w=n.label,_=n.unit,T=0;return b={update:function(e){e=null==e?"":""+e,c=e;var n=!1;T=Math.round(f.measureText(e).width/t),T>m&&(r(2*T),n=!0),Math.abs(l.width()-T)>5&&T>d&&(l.width(T),n=!0),n&&i(),f.clearRect(0,0,v,y),f.fillText(e,v,h)},updateLabel:function(e){a.html(e)},updateUnits:function(e){u.html(e)},hideUnits:function(){u.css("opacity",0)},showUnits:function(){u.css("opacity",1)},render:function(){return p=$("<canvas>").css("position","absolute"),f=p[0].getContext("2d"),o=$('<div class="numeric-output">'),a=$('<span class="label"></span>'),s=$('<span class="output"></span>'),l=$('<span class="value"> - </span>').css("opacity",0),u=$('<span class="units"></span>'),w&&a.html(w),_&&u.html(_),o.attr("id",x).append(a).append(s.append(p).append(l).append(u)),o},resize:function(){d=parseInt(l.css("min-width"),10)-parseInt(l.css("padding-left"),10)-parseInt(l.css("padding-right"),10),r(2*T),b.update(c),i(),e({font:f.font,onchange:function(){b.resize()}})}}}}),define("common/controllers/numeric-output-controller",["common/controllers/interactive-metadata","common/validator","common/views/numeric-output-view"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator"),n=require("common/views/numeric-output-view");return function(r,i){function o(){var e=f.properties[a];u&&(e=u(e)),c.update(e)}var a,s,l,u,c,d,p,h,f,m;return f=i.getModel(),m=i.getScriptingAPI(),r=t.validateCompleteness(e.numericOutput,r),a=r.property,l=r.units,s=r.label,u=r.displayValue,c=new n({id:r.id,units:l,label:s}),d=c.render(),d.addClass("component"),d.addClass(r.orientation),d.css({width:r.width,height:r.height}),u&&(u=m.makeFunctionInScriptContext("value",u)),r.tooltip&&d.attr("title",r.tooltip),h={modelLoadedCallback:function(){f&&f.removeObserver(a,o),f=i.getModel(),m=i.getScriptingAPI(),a&&(p=f.getPropertyDescription(a),p&&(s||c.updateLabel(p.getLabel()),l||c.updateUnits(p.getUnitAbbreviation())),o(),f.addObserver(a,o))},getViewContainer:function(){return d},resize:function(){c.resize(),o()},serialize:function(){return $.extend(!0,{},r)}}}}),define("common/views/table-view",[],function(){return function(e,t){function n(){var e,t;for(E.find("th").remove("th"),e=0;e<L.length;e++)t=$("<th>"),t.text(L[e].name),t.click(o),E.append(t)}function r(e,t,n){"undefined"!=typeof t&&null!==t?"string"==typeof t?e.text(t):"number"==typeof t&&e.text(I[n](t)):e.html("&nbsp;")}function i(){k.find("td").html(function(){var e=$(this),t=e.data("datum"),n=e.data("index");r(e,t,n)})}function o(e){var t,n=$(this),r="asc",i="desc";m(),t=r,n.hasClass(r)?(n.removeClass(r),n.addClass(i),t=i):n.hasClass(i)?(n.removeClass(i),n.addClass(r),t=r):(n.addClass(i),t=i),n.siblings().removeClass("sorted"),R=k.find("tr"),R.tsort("td:eq("+n.index()+")",{sortFunction:function(e,n){var i=Math.abs(parseFloat(e.s)),o=Math.abs(parseFloat(n.s));return t===r?i===o?0:i>o?1:-1:i===o?0:o>i?1:-1}}),n.addClass("sorted"),g(),e.preventDefault()}function a(){T=P.find("tr:first th").map(function(){return $(this).outerWidth()}),k.find("tr:first td").each(function(e){$(this).outerWidth(T[e])})}function s(e){return $(k.find("tr")).filter(function(){return $(this).data("index")===e})}function l(e){return e.data("index")}function u(e){var t=U.indexOf(e);return-1!==t?(U.splice(t,1),s(e).removeClass("selected")):void 0}function c(e){var t;return-1===U.indexOf(e)?(U.push(e),t=s(e),t.addClass("selected"),t):void 0}function d(){var e,t,n=[];for(e=0;e<U.length;e++)t=U[e],n.push([t,s(t).index()]);return n.sort(function(e,t){return e[1]-t[1]})}function p(){var e,t,n,r;for(t=d(),n=t[0],r=t[t.length-1],R=k.find("tr"),e=n[1];e<=r[1];e++)c($(R[e]).data("index"))}function h(){var e;for(e=0;e<U.length;e++)s(U[e]).removeClass("selected");U=[]}function f(e,t){var n,i,o,s;for(o=$('<tr class="data">'),$(o).data("index",t),n=0;n<L.length;n++)s=$("<td>"),$(s).data("index",n),i=e[n],s.data("datum",i),r(s,i,n),o.append(s);k.append(o),k.find("tr").length<2&&a()}function m(){k.find(".blank").remove()}function g(){if(m(),D){var e,t,n,r=k.find("tr").length;for(t=$('<tr class="data blank">'),$(t).data("index",r),e=0;e<L.length;e++)n=$("<td>"),$(n).data("index",e),n.html("&nbsp;"),t.append(n);k.append(t),k.find("tr").length<2&&a()}}function v(){k.scrollTop(99999999)}function y(e,t){var n;if(0===k.find("tr").length)return void _.appendDataRow(e,t);var i,o,a=$(k.find("tr")).filter(function(){return $(this).data("index")===t}),s=$(a).find("td"),l=s.length;for(o=0;o<e.length;o++)l>o&&(i=$(s[o]),n=e[o],i.data("datum",n),r(i,n,o))}function b(){M=k.position(),N=k.height()}function x(){var e=k.find("input");e.each(function(){var e=$(this).parent(),n=e.parent().data("index"),r=e.data("index"),i=$(this).val();!isNaN(parseFloat(i))&&isFinite(i)&&(i=parseFloat(i)),t.addDataToCell(n,r,i),e.empty().html(i)}),a(),b()}function w(e,n){var r,i,o,l=$(s(e).find("td")[n]),u=k.find("input");l&&L[n].editable&&!l.find("input").length&&(u.length&&x(),r=t.getDataInCell(e,n),i=$('<input class="editor-text">').val(r),l.empty().append(i),a(),i.bind("keydown",function(t){var r=t.keyCode?t.keyCode:t.which;if(13===r)x();else if(9===r)for(x(),o=n;++o<L.length;)if(L[o].editable){w(e,o);break}t.stopPropagation()}),i.on("blur",x),setTimeout(function(){i.focus()},0))}var _,T,C,A,S,P,E,k,R,M,N,O=e.id,L=e.columns,I=e.formatters,D=(e.visibleRows,e.showBlankRow),B=e.title,V=e.width,F=e.height,j=e.tooltip,G=e.klasses||[],U=[];return _={render:function(){var e,t;for(C=$("<div>"),S=$("<table>"),k=$("<tbody>"),E=$('<tr class="header">'),P=$("<thead>").append(E),S.append(P).append(k),n(),A=$("<div>").addClass("table-wrapper").append(S),C.attr("id",O),B&&(t=$("<div>").addClass("title").text(B),C.append(t)),C.append(A),e=0;e<G.length;e++)C.addClass(G[e]);return j&&C.attr("title",j),V&&C.css("width",V),F&&C.css("height",F),k.delegate("tr","click",function(e){var t=l($(e.currentTarget));e.shiftKey||e.metaKey||h(),c(t),e.shiftKey&&p()}),k.delegate("td","click",function(e){var t=$(e.currentTarget),n=t.parent().data("index"),r=t.data("index");
w(n,r)}),b(),C},resize:function(){var e;S.height(A.height()),e=S.height()-P.outerHeight(!0),k.height(e-6),a(),b()},clear:function(){k.find(".data").remove()},appendDataRow:function(e,t){f(e,t),g(),v()},appendDataRows:function(e,t){var n=t;e.forEach(function(e){f(e,n++)}),g(),v()},removeDataRows:function(e){var t=k.find("tr").filter(function(){var t=$(this).data("index");return t>=e});t.remove(),g()},replaceDataRow:y,removeSelection:u,addSelection:c,clearSelection:h,updateTable:function(e){L=e.columns||L,I=e.formatters||I,n(),i(),a(),b()}}}}),define("common/controllers/table-controller",["require","common/controllers/interactive-metadata","common/validator","common/views/table-view","common/listening-pool","common/controllers/data-set"],function(e){var t=e("common/controllers/interactive-metadata"),n=e("common/validator"),r=e("common/views/table-view"),i=e("common/listening-pool"),o=e("common/controllers/data-set"),a=0;return function(e,s){function l(){var o,a=s.interactiveContainer;for(C=s.getModel(),e=n.validateCompleteness(t.table,e),O=e.propertyColumns.slice(),o=0;o<O.length;o++)O[o].name&&(O[o]=O[o].name);S=new i(L),u(),c(),k=0,N=$.extend(!0,[],e.headerData),P=new r({id:e.id,title:e.title,columns:R,formatters:M,visibleRows:e.visibleRows,showBlankRow:e.showBlankRow,width:e.width,height:e.height,tooltip:e.tooltip,klasses:["interactive-table","component"]},T),E=P.render(a),A.resetData()}function u(){A=e.dataSet?s.getDataSet(e.dataSet):new o({name:e.id+"-autoDataSet",properties:O.slice(),xProperty:e.xProperty,initialData:e.tableData,streamDataFromModel:e.streamDataFromModel,clearOnModelReset:e.clearOnModelReset},s,!0),S.listen(A,o.Events.SAMPLE_ADDED,y),S.listen(A,o.Events.SAMPLE_CHANGED,b),S.listen(A,o.Events.DATA_RESET,x),S.listen(A,o.Events.DATA_TRUNCATED,w),S.listen(A,o.Events.SELECTION_CHANGED,h)}function c(){var t,n,r,i,o,a,s,l;for(R=[],M=[],e.indexColumn&&(R.push({name:"#",editable:!1}),M.push(d3.format("f"))),t=0;t<e.propertyColumns.length;t++)o=null,s=!1,l=".3r",r="string"==typeof e.propertyColumns[t]?{name:e.propertyColumns[t]}:e.propertyColumns[t],"undefined"!=typeof C&&(n=r.name,C.properties.hasOwnProperty(n)&&(i=C.getPropertyDescription(n),i&&(o=i.getLabel(),a=i.getUnitAbbreviation(),a&&(o+=" ("+a+")")))),o||(o=r.name,r.units&&(o+=" ("+r.units+")"),s=r.hasOwnProperty("editable")?r.editable:!0,l=r.hasOwnProperty("format")?r.format:l),R.push({name:o,editable:s}),M.push(d3.format(l))}function d(){c(),P.updateTable({columns:R,formatters:M})}function p(){A.appendDataPoint()}function h(t){var n=t.data;if(e.addNewRows)P.clearSelection(),P.addSelection(n);else{var r=A.getData();P.replaceDataRow(m(r,n),0)}}function f(t,n){var r=[];return e.indexColumn&&(null==n&&(n=k),r.push(n)),O.forEach(function(e){r.push(t[e])}),r}function m(t,n){var r=[];return e.indexColumn&&r.push(n),O.forEach(function(e){r.push(t[e][n])}),r}function g(t){for(var n=e.indexColumn?1:0,r=t.length;r>n;n++)if(null!=t[n])return!1;return!0}function v(t){var n=f(t);g(n)||(e.addNewRows?(P.appendDataRow(n,k),k++):(P.replaceDataRow(n,0),k++))}function y(e){v(e.data)}function b(t){var n=t.data.index,r=f(t.data.dataPoint,n);e.addNewRows?P.replaceDataRow(r,n):P.replaceDataRow(r,0)}function x(t){var n,r=t.data,i=A.maxLength(O);if(e.addNewRows){var o=[];for(k=0;i>k;k++)o.push(m(r,k));P.clear(),P.appendDataRows(o,0)}else n=m(r,i-1),P.replaceDataRow(n,0),k=i}function w(t){var n=A.maxLength(O);k=n,e.addNewRows?P.removeDataRows(n):P.replaceDataRow(m(t.data,n-1),0)}function _(){}var T,C,A,S,P,E,k,R,M,N,O,L="tableController"+ ++a;return T={modelLoadedCallback:function(){C=s.getModel(),_(),d()},resize:function(){P&&P.resize()},getData:function(e){var t=A.getData(),n={};return e.forEach(function(e){n[e]=t[e]}),n},appendDataPropertiesToComponent:p,addDataToCell:function(t,n,r){e.indexColumn&&n--;var i=O[n];if(t===k){if(""===r)return;var o={};return o[i]=r,void A.appendDataPoint(O,o)}A.editDataPoint(t,i,r)},getDataInCell:function(t,n){e.indexColumn&&n--;var r=O[n];return A.getPropertyValue(t,r)},getViewContainer:function(){return E},getView:function(){return P},serialize:function(){var t=$.extend(!0,{},e);return t.headerData=R,e.dataSet||(t.tableData=A.serializeData()),t}},l(),T}}),define("common/benchmark/browser-detect",[],function(){function e(){var e=navigator.userAgent.match(/\(([^)]+)\).*/);if(!e)return"na";var n=e[1],r=n.split("; ");if("Macintosh"===r[0])return r[1];if(r[0].match(/^Windows/)){var i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/),o="";return n.match(/WOW64/)?o="64/32":n.match(/Win64; IA64/)?o="64":n.match(/Win64; x64/)&&(o="64"),t[i[1]]+"/"+o}return r[0].match(/^X11/)?r.join("/"):"na"}var t={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"};return{isMobile:function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),what_browser:function(){var n,r=/ (Chrome)\/(.*?) /,i=/ (Firefox)\/([0123456789ab.]+)/,o=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,a=/ (MSIE) ([0123456789.]+);/,s=/^(Opera)\/.+? Version\/([0123456789.]+)$/,l=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,u=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,c=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,d=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,p=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,h=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/;if(n=navigator.userAgent.match(d),n&&n[1])return{browser:"Chrome for Android",version:n[4],oscpu:n[1]+"/"+n[2]+"/"+n[3]};if(n=navigator.userAgent.match(r),n&&n[1])return{browser:n[1],version:n[2],oscpu:e()};if(n=navigator.userAgent.match(i),n&&n[1]){var f=navigator.buildID,m="";return f&&f.length>=8&&(m="("+f.slice(0,4)+"-"+f.slice(4,6)+"-"+f.slice(6,8)+")"),{browser:n[1],version:n[2]+" "+m,oscpu:e()}}if(n=navigator.userAgent.match(p),n&&n[1])return{browser:"Firefox",version:n[2],oscpu:n[1]};if(n=navigator.userAgent.match(h),n&&n[1])return{browser:"Android",version:n[2],oscpu:n[1]+"/"+n[2]+"/"+n[3]};if(n=navigator.userAgent.match(o),n&&n[3])return{browser:n[3],version:n[2]+"/"+n[1],oscpu:e()};if(n=navigator.userAgent.match(a),n&&n[1]){var g=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:n[1],version:n[2],oscpu:t[g[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return n=navigator.userAgent.match(s),n&&n[1]?{browser:n[1],version:n[2],oscpu:e()}:(n=navigator.userAgent.match(l),n&&n[1]?{browser:"Mobile Safari",version:n[2],oscpu:n[1]+"/iOS/"+n[2]}:(n=navigator.userAgent.match(u),n&&n[1]?{browser:"Mobile Safari",version:n[2],oscpu:n[1]+"/iOS/"+n[2]}:(n=navigator.userAgent.match(c),n&&n[1]?{browser:"Mobile Safari",version:n[3],oscpu:n[1]+"/iOS/"+n[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}}}),define("common/benchmark/benchmark",["require","./browser-detect"],function(e){function t(e,t,n){function r(t){var n=e.getElementsByTagName("tr")[0],r=n.appendChild(document.createElement("th"));r.innerHTML=t,m[t]=f++}function o(t){t=t||0;var n,r=e.appendChild(document.createElement("tr"));for(n=0;t>n;n++)r.appendChild(document.createElement("td"));return r}function a(e,t,n){var r;n=n||l,r=n.getElementsByTagName("td")[m[e]],"string"==typeof t&&"<"===t.slice(0,1)?r.innerHTML=t:r.textContent=t}function s(){function e(e){return Math.floor(e)===e}var n,r,o,a,s,l,u,c,d=g.length,p=i.getElementsByTagName("td"),h=d3.format("5.1f"),f=d3.format("f");for(n=0;n<t.length;n++)if(o=t[n],l=m[o.name],o.numeric===!1)a=g[2],s=a.getElementsByTagName("td")[l],p[l].innerHTML=s.innerHTML;else{for(u=0,r=2;d>r;r++)a=g[r],s=a.getElementsByTagName("td")[l],u+=+s.textContent;c=u/(d-2),c=o.formatter?o.formatter(c):e(c)?f(u/(d-2)):h(u/(d-2)),p[l].textContent=c}}var l,u,c,d,p,h=0,f=0,m={},g=e.getElementsByTagName("tr");if(e.style.display="",0===g.length){for(o(),r("browser"),r("version"),r("cpu/os"),r("date"),r("commit"),r("branch"),h=0;h<t.length;h++)r(t[h].name);i=o(f),i.className="average"}else for(c=g[0],d=c.getElementsByTagName("th"),h=0,p=d.length;p>h;h++)m[d[h].innerHTML]=f++;for(l=o(f),l.className="sample",h=0;6>h;h++)u=n[h],a(u[0],u[1]),a(u[0],u[1],i);for(h=6;h<n.length;h++)u=n[h],a(u[0],u[1]);s()}function n(e,t,n,r){function i(e){function n(n){l.push(e.formatter?[e.name,e.formatter(n)]:[e.name,n]),s.length>0?i(s.shift()):(r&&r(),t&&t(l))}e.run(n)}var o,s=e.slice(),l=[],u=a(),c=d3.time.format("%Y-%m-%d %H:%M");return l.push(["browser",u.browser]),l.push(["version",u.version]),l.push(["cpu/os",u.oscpu]),l.push(["date",c(new Date)]),o="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>",Lab.version.repo.dirty&&(o+=" <i>dirty</i>"),l.push(["commit",o]),l.push(["branch",Lab.version.repo.branch]),n&&n(),i(s.shift()),l}function r(e,r,i,o,a){var s;return n(e,function(n){t(r,e,n),i(n)},o,a),s}var i,o=e("./browser-detect"),a=o.what_browser,s=o.isMobile,l=o.what_browser();return{get browser(){return l},what_browser:function(){return l=a()},get isMobile(){return s},run:function(e,t,n,i,o){r(e,t,n,i,o)},bench:function(e,t,r,i){return n(e,t,r,i)},renderToTable:function(e,n,r){t(e,n,r)}}}),define("common/url-helper",["require","lab.version","lab.config"],function(e){var t=e("lab.version"),n=e("lab.config"),r=function(e,t,n){return e.length>0?e+"&"+t+"="+n:"?"+t+"="+n};return{getVersionedUrl:function(){if(n.versionedHome&&t.repo.last_tag)return n.versionedHome(t.repo.last_tag);var e=window.location.host,i=window.location.pathname,o=window.location.search,a=window.location.protocol;return o=r(o,"show_data_warning","true"),a+"//"+e+i+o}}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("iframe-phone",e):"undefined"!=typeof window?window.iframePhone=e():"undefined"!=typeof global?global.iframePhone=e():"undefined"!=typeof self&&(self.iframePhone=e())}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){function n(){function e(e,t){r.supported()?window.parent.postMessage(e,t):window.parent.postMessage(JSON.stringify(e),t)}function t(t,n){var r;r=1===arguments.length&&"object"==typeof t&&"string"==typeof t.type?t:{type:t,content:n},p?e(r,u):h.push(r)}function n(){e({type:"hello",origin:document.location.href.match(/(.*?\/\/.*?)\//)[1]},"*")}function i(e,t){c[e]=t}function o(){c={}}function a(){return Object.keys(c)}function s(e){if(e.source===window.parent){var n=e.data;if("string"==typeof n&&(n=JSON.parse(n)),!p&&"hello"===n.type)for(u=n.origin,p=!0;h.length>0;)t(h.shift());e.origin===u&&c[n.type]&&c[n.type](n.content)}}function l(){d||(d=!0,window.parent!==window&&(n(),window.addEventListener("message",s,!1)))}var u,c={},d=!1,p=!1,h=[];return{initialize:l,getListenerNames:a,addListener:i,removeAllListeners:o,post:t}}var r=e("./structured-clone"),i=null;t.exports=function(){return i||(i=new n),i}},{"./structured-clone":3}],2:[function(e,t){var n=e("./structured-clone");t.exports=function(e,t){function r(){return e.src.match(/(.*?\/\/.*?)\//)[1]}function i(t,i){var o;o=1===arguments.length&&"object"==typeof t&&"string"==typeof t.type?t:{type:t,content:i},c?(o.origin=l,n.supported()?e.contentWindow.postMessage(o,r()):e.contentWindow.postMessage(JSON.stringify(o),r())):u.push(o)}function o(e,t){d[e]=t}function a(e){d[e]=null}function s(t){var n;t.source===e.contentWindow&&t.origin===r()&&(n=t.data,"string"==typeof n&&(n=JSON.parse(n)),d[n.type]?d[n.type](n.content):console.log("cant handle type: "+n.type))}var l=window.location.href.match(/(.*?\/\/.*?)\//)[1],u=[],c=!1,d={};return o("hello",function(){for(c=!0,i("hello"),t&&"function"==typeof t&&t();u.length>0;)i(u.shift())}),window.addEventListener("message",s,!1),{post:i,addListener:o,removeListener:a}}},{"./structured-clone":3}],3:[function(e,t,n){var r=!1;!function(){var e=0;if(window.postMessage)try{window.onmessage=function(t){var n=Object.prototype.toString.call(t.data);e=-1!=n.indexOf("Null")||-1!=n.indexOf("DOMWindow")?1:0,r={structuredClones:e}},window.postMessage(document.createElement("a"),"*")}catch(t){e=t.DATA_CLONE_ERR||"Cannot post cyclic structures."==t.message?1:0,r={structuredClones:e}}}(),n.supported=function(){return r&&r.structuredClones>0}},{}],4:[function(e,t){t.exports={ParentEndpoint:e("./lib/parent-endpoint"),getIFrameEndpoint:e("./lib/iframe-endpoint"),structuredClone:e("./lib/structured-clone")}},{"./lib/iframe-endpoint":1,"./lib/parent-endpoint":2,"./lib/structured-clone":3}]},{},[4])(4)}),define("common/controllers/parent-message-api",["require","common/benchmark/benchmark","common/url-helper","iframe-phone"],function(e){var t=e("common/benchmark/benchmark"),n=e("common/url-helper"),r=e("iframe-phone");return function(e){function i(e){a.post("propertyValue",{name:e,value:o.get(e)})}var o,a=r.getIFrameEndpoint();return a.removeAllListeners(),a.addListener("setFocus",function(){var t=e.modelController.modelContainer;t&&t.setFocus&&t.setFocus()}),a.addListener("getLearnerUrl",function(){a.post("setLearnerUrl",n.getVersionedUrl())}),a.addListener("loadInteractive",function(t){e&&e.loadInteractive&&e.loadInteractive(t)}),a.addListener("loadModel",function(t){e&&e.loadModel&&e.loadModel(t.modelId,t.modelObject)}),a.addListener("getModelState",function(){e&&e.modelController&&a.post("modelState",e.modelController.state())}),a.addListener("getInteractiveState",function(){e&&e.modelController&&a.post("interactiveState",e.serialize())}),a.addListener("runBenchmarks",function(){var n,r;e&&e.modelController&&(n=e.modelController,r=e.benchmarks.concat(n.benchmarks),t.bench(r,function(e){console.log(e),a.post("returnBenchmarks",{results:e,benchmarks:r})}))}),a.addListener("listenForDispatchEvent",function(e){var t=e.eventName,n=e.properties,r={},i=0,s=null;o.on(t,function(){if(n)for(i=0;i<n.length;i++)s=n[i],r[s]=o.get(s);a.post(t,r)})}),a.addListener("removeListenerForDispatchEvent",function(e){o.on(e,null)}),a.addListener("get",function(e){i(e)}),a.addListener("observe",function(e){o.addPropertiesListener(e,function(){i(e)}),i(e)}),a.addListener("set",function(e){o.set(e.name,e.value)}),a.addListener("tick",function(e){o.tick(Number(e))}),a.addListener("play",function(){o.start()}),a.addListener("stop",function(){o.stop()}),a.initialize(),e.on("modelLoaded.parentMessageAPI",function(){a.post("modelLoaded")}),{bindModel:function(e){o=e}}}}),function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define("mustache",n):e.Mustache=n}}(this,function(e){function t(e,t){return x.call(e,t)}function n(e){return!t(g,e)}function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e){return String(e).replace(/[&<>"'\/]/g,function(e){return T[e]})}function a(e){this.string=e,this.tail=e,this.pos=0}function s(e,t){this.view=null==e?{}:e,this.parent=t,this._cache={".":this.view}}function l(){this.clearCache()}function u(t,n,i,o){function a(e){return n.render(e,i)}for(var s,l,c,d="",p=0,h=t.length;h>p;++p)switch(s=t[p],l=s[1],s[0]){case"#":if(c=i.lookup(l),"object"==typeof c||"string"==typeof c)if(_(c))for(var f=0,m=c.length;m>f;++f)d+=u(s[4],n,i.push(c[f]),o);else c&&(d+=u(s[4],n,i.push(c),o));else if(r(c)){var g=null==o?null:o.slice(s[3],s[5]);c=c.call(i.view,g,a),null!=c&&(d+=c)}else c&&(d+=u(s[4],n,i,o));break;case"^":c=i.lookup(l),(!c||_(c)&&0===c.length)&&(d+=u(s[4],n,i,o));break;case">":c=n.getPartial(l),r(c)&&(d+=c(i));break;case"&":c=i.lookup(l),null!=c&&(d+=c);break;case"name":c=i.lookup(l),null!=c&&(d+=e.escape(c));break;case"text":d+=l}return d}function c(e){for(var t,n=[],r=n,i=[],o=0,a=e.length;a>o;++o)switch(t=e[o],t[0]){case"#":case"^":i.push(t),r.push(t),r=t[4]=[];break;case"/":var s=i.pop();s[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}function d(e){for(var t,n,r=[],i=0,o=e.length;o>i;++i)t=e[i],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(n=t,r.push(t)));return r}function p(e){return[new RegExp(i(e[0])+"\\s*"),new RegExp("\\s*"+i(e[1]))]}function h(t,r){function o(){if(S&&!P)for(;A.length;)delete C[A.pop()];else A=[];S=!1,P=!1}if(t=t||"",r=r||e.tags,"string"==typeof r&&(r=r.split(m)),2!==r.length)throw new Error("Invalid tags: "+r.join(", "));for(var s,l,u,h,g,x,w=p(r),_=new a(t),T=[],C=[],A=[],S=!1,P=!1;!_.eos();){if(s=_.pos,u=_.scanUntil(w[0]))for(var E=0,k=u.length;k>E;++E)h=u.charAt(E),n(h)?A.push(C.length):P=!0,C.push(["text",h,s,s+1]),s+=1,"\n"==h&&o();if(!_.scan(w[0]))break;if(S=!0,l=_.scan(b)||"name",_.scan(f),"="===l?(u=_.scanUntil(v),_.scan(v),_.scanUntil(w[1])):"{"===l?(u=_.scanUntil(new RegExp("\\s*"+i("}"+r[1]))),_.scan(y),_.scanUntil(w[1]),l="&"):u=_.scanUntil(w[1]),!_.scan(w[1]))throw new Error("Unclosed tag at "+_.pos);if(g=[l,u,s,_.pos],C.push(g),"#"===l||"^"===l)T.push(g);else if("/"===l){if(x=T.pop(),!x)throw new Error('Unopened section "'+u+'" at '+s);if(x[1]!==u)throw new Error('Unclosed section "'+x[1]+'" at '+s)}else if("name"===l||"{"===l||"&"===l)P=!0;else if("="===l){if(r=u.split(m),2!==r.length)throw new Error("Invalid tags at "+s+": "+r.join(", "));w=p(r)}}if(x=T.pop())throw new Error('Unclosed section "'+x[1]+'" at '+_.pos);return c(d(C))}var f=/\s*/,m=/\s+/,g=/\S/,v=/\s*=/,y=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/,x=RegExp.prototype.test,w=Object.prototype.toString,_=Array.isArray||function(e){return"[object Array]"===w.call(e)},T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.prototype.eos=function(){return""===this.tail},a.prototype.scan=function(e){var t=this.tail.match(e);if(t&&0===t.index){var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},a.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},s.make=function(e){return e instanceof s?e:new s(e)},s.prototype.push=function(e){return new s(e,this)},s.prototype.lookup=function(e){var t;if(e in this._cache)t=this._cache[e];else{for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var i=e.split("."),o=0;null!=t&&o<i.length;)t=t[i[o++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return r(t)&&(t=t.call(this.view)),t},l.prototype.clearCache=function(){this._cache={},this._partialCache={}},l.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},l.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},l.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},l.prototype.compileTokens=function(e,t){var n=this;return function(i,o){if(o)if(r(o))n._loadPartial=o;else for(var a in o)n.compilePartial(a,o[a]);return u(e,n,s.make(i),t)}},l.prototype.render=function(e,t,n){return this.compile(e)(t,n)},e.name="mustache.js",e.version="0.7.3",e.tags=["{{","}}"],e.Scanner=a,e.Context=s,e.Writer=l,e.parse=h,e.escape=o;var C=new l;e.clearCache=function(){return C.clearCache()},e.compile=function(e,t){return C.compile(e,t)},e.compilePartial=function(e,t,n){return C.compilePartial(e,t,n)},e.compileTokens=function(e,t){return C.compileTokens(e,t)},e.render=function(e,t,n){return C.render(e,t,n)},e.to_html=function(t,n,i,o){var a=e.render(t,n,i);return r(o)?void o(a):a}}),define("text",["module"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a="undefined"!=typeof location&&location.href,s=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,u=a&&(location.port||void 0),c=[],d=e.config&&e.config()||{};return t={version:"2.0.2",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),-1!==n&&(t=i.substring(n+1,i.length),t="strip"===t,i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var o,a,s,l=t.xdRegExp.exec(e);return l?(o=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(o&&o!==n||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(c[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText)return void r();d.isBuild=i.isBuild;var o=t.parseName(e),c=o.moduleName+"."+o.ext,p=n.toUrl(c),h=d.useXhr||t.useXhr;!a||h(p,s,l,u)?t.get(p,function(n){t.finishLoad(e,o.strip,n,r)},function(e){r.error&&r.error(e)}):n([c],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,r)})},write:function(e,n,r){if(c.hasOwnProperty(n)){var i=t.jsEscape(c[n]);r.asModule(e+"!"+n,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,n,r,i,o){var a=t.parseName(n),s=a.moduleName+"."+a.ext,l=r.toUrl(a.moduleName+"."+a.ext)+".js";t.load(s,r,function(){var n=function(e){return i(l,e)};n.asModule=function(e,t){return i.asModule(e,l,t)},t.write(e,s,n,o)},o)}},"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");0===r.indexOf("﻿")&&(r=r.substring(1)),t(r)}):"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=String(n.toString())}finally{s.close()}t(l)}:t.createXhr()&&(t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),d.onXhr&&d.onXhr(i,e),i.onreadystatechange=function(){var t,o;4===i.readyState&&(t=i.status,t>399&&600>t?(o=new Error(e+" HTTP status: "+t),o.xhr=i,r(o)):n(i.responseText))},i.send(null)}),t}),define("text!common/controllers/thermometer.tpl",[],function(){return'<div class="interactive-thermometer component" id="{{id}}">\n  <div class="thermometer-main-container">\n    <div class="thermometer">\n      <div class="thermometer-fill"></div>\n    </div>\n    <p class="label">{{labelText}}</p>\n  </div>\n  <div class="labels-container">\n    {{#labels}}\n      <span class="value-label" style="bottom: {{position}}">{{label}}</span>\n    {{/labels}}\n  </div>\n</div>'}),define("common/controllers/thermometer-controller",["require","mustache","text!common/controllers/thermometer.tpl","common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(e){var t=e("mustache"),n=e("text!common/controllers/thermometer.tpl"),r=e("common/controllers/interactive-metadata"),i=e("common/validator");return e("common/jquery-plugins"),function(e,o){function a(){var a,y,x,w,_,T,C,A,S,P,E,k;for(b=o.getModel(),e=i.validateCompleteness(r.thermometer,e),a=e.reading,s=a.units,y=a.offset,x=a.scale,l=a.digits,P=e.min,S=e.max,u=function(e){return x*e+y},c=function(e){return(e-P)/(S-P)*100+"%"},d=e.labelIsReading,_=d?"":"Thermometer",w={id:e.id,labelText:d?"":"Thermometer"},T=e.labels,A=-1/0,w.labels=[],E=0,k=T.length;k>E;E++)w.labels.push({label:T[E].label,position:c(u(T[E].value))}),T[E].label.length>A&&(A=T[E].label.length,C=E);h=$(t.render(n,w)),f=h.find(".thermometer"),m=h.find(".thermometer-fill"),g=h.find(".label"),v=h.find(".labels-container"),A=h.measure(function(){return this.width()/parseFloat(this.css("font-size"))+"em"},".value-label:eq("+C+")",o.interactiveContainer),v.css("width",A),h.css("height",e.height),p=!1,/%$/.test(e.width)?(h.css("width",e.width),p=!0):f.css("width",e.width)}var s,l,u,c,d,p,h,f,m,g,v,y,b,x=function(e){e=u(e),g.text(e.toFixed(l)+" "+s)},w=function(){var e=b.get("targetTemperature");m.css("height",c(u(e))),d&&x(e)};return y={modelLoadedCallback:function(){b&&b.removeObserver("targetTemperature",w),b=o.getModel(),b.addPropertiesListener("targetTemperature",w),w()},getViewContainer:function(){return h},resize:function(){var e=h.height()-g.height();f.height(e),v.height(e),p&&f.width(h.width()-v.width())},serialize:function(){return e}},a(),y}}),define("common/controllers/playback-controller",["require","common/inherit","common/layout/detect-font-change","common/controllers/interactive-component"],function(e){function t(e,t){i.call(this,"playback",e,t),this.$element.addClass("interactive-playback"),this._modelStopped=!0,this._modelPlayable=!0,this._showClock=!0,this._timeDesc=null,this._model=null,this._scriptingAPI=null,this._interactivesController=t,r({font:o,onchange:$.proxy(this._showClockChanged,this)})}var n=e("common/inherit"),r=e("common/layout/detect-font-change"),i=e("common/controllers/interactive-component"),o="bold 2em Lato";return n(t,i),t.prototype._createControlsFor={video:function(){var e=this._scriptingAPI;this.$element.removeClass("text").addClass("video"),this._$reset=$('<button class="reset"><i class="icon-step-backward"></i></button>').appendTo(this.$element),this._$playPause=$('<button class="play-pause"><i class="icon-play"></i><i class="icon-pause"></i></button>').appendTo(this.$element),this._$timeDisplay=$('<span class="time-display">').appendTo(this._$playPause),this._$timeCanvas=$("<canvas>").appendTo(this._$timeDisplay),this._timeCtx=this._$timeCanvas[0].getContext("2d"),this._$stepBackward=$('<button class="step"><i class="icon-backward"></i></button>').insertBefore(this._$playPause),this._$stepForward=$('<button class="step"><i class="icon-forward"></i></button>').insertAfter(this._$playPause),this._$reset.after('<div class="spacer reset">'),this._$stepBackward.after('<div class="spacer step">'),this._$stepForward.before('<div class="spacer step">'),this._$reset.on("click",e.reloadModel),this._$playPause.on("click",$.proxy(function(){this._modelStopped?this._modelPlayable&&e.start():e.stop()},this)),this._$stepBackward.on("click",e.stepBack),this._$stepForward.on("click",e.stepForward),this._$playPause.attr("title","Start / pause the simulation"),this._$reset.attr("title","Reset the simulation"),this._$stepBackward.attr("title","Step back"),this._$stepForward.attr("title","Step forward")},text:function(){var e=this._scriptingAPI;this.$element.removeClass("video").addClass("text"),this._$start=$('<button class="start">Start</button>').appendTo(this.$element),this._$stop=$('<button class="stop">Stop</button>').appendTo(this.$element),this._$reset=$('<button class="reset">Reset</button>').appendTo(this.$element),this._$reset.on("click",e.reloadModel),this._$start.on("click",e.start),this._$stop.on("click",e.stop),this._$start.attr("title","Start the simulation or data collection"),this._$stop.attr("title","Stop the simulation or data collection"),this._$reset.attr("title","Reset the simulation or data collection")}},t.prototype._updateButtonStatesFor={video:function(){var e=!this._modelStopped,t=this._modelPlayable;e?this._$playPause.addClass("playing"):this._$playPause.removeClass("playing"),t||e?this._$playPause.removeClass("disabled"):this._$playPause.addClass("disabled")},text:function(){this._modelStopped?this._$stop.addClass("disabled"):this._$stop.removeClass("disabled"),this._modelPlayable?this._$start.removeClass("disabled"):this._$start.addClass("disabled")}},t.prototype._simulationStateChanged=function(){var e=this._model.isStopped(),t=this._model.properties.isPlayable===!1?!1:!0;(e!==this._modelStopped||t!==this._modelPlayable)&&(this._modelStopped=e,this._modelPlayable=t,this._updateButtonStatesFor[this.controlButtonStyle].call(this))},t.prototype._showClockChanged=function(){"video"===this.controlButtonStyle&&(this._showClock=this._model.get("showClock"),this._showClock?(this._$playPause.addClass("with-clock"),this._timeDesc=this._model.getPropertyDescription("displayTime"),this._timeChanged()):this._$playPause.removeClass("with-clock"))},t.prototype._timeChanged=function(){this._showClock&&"video"===this.controlButtonStyle&&(this._timeCtx.clearRect(0,0,this._canvWidth,this._canvHeigth),this._timeCtx.fillText(this._timeDesc.format(this._model.get("displayTime")),this._canvWidth,.85*this._canvHeigth))},t.prototype._updateControlButtonChoicesFor={video:function(e){var t;e?"play"===e?(this.$element.find(".play-pause").removeClass("hidden"),this.$element.find(".spacer, .step, .reset").addClass("hidden")):"reset"===e?(this.$element.find(".reset").removeClass("hidden"),this.$element.find(".spacer, .play-pause, .step").addClass("hidden")):"play_reset"===e?(this.$element.find(".spacer, .play-pause, .reset").removeClass("hidden"),this.$element.find(".step").addClass("hidden")):"play_reset_step"===e&&this.$element.find(".spacer, .step, .reset, .play-pause").removeClass("hidden"):this.$element.find(".step, .reset, .play-pause").addClass("hidden"),t=this.$element.find("button"),t.removeClass("first"),t.removeClass("last"),t=t.not(".hidden"),t.first().addClass("first"),t.last().addClass("last")
},text:function(e){if(e)if("play"===e)this.$element.find(".start, .stop").removeClass("hidden"),this.$element.find(".reset").addClass("hidden");else if("reset"===e)this.$element.find(".reset").removeClass("hidden"),this.$element.find(".start, .stop").addClass("hidden");else{if("play_reset"!==e)throw new Error('controlButtons option "'+e+'" is not understood or is not compatible with controlButtonStyle "text"');this.$element.find(".start, .stop, .reset").removeClass("hidden")}else this.$element.find(".reset, .start, .stop").addClass("hidden")}},t.prototype._controlButtonChoicesChanged=function(){var e=this._model.properties.controlButtons;this._updateControlButtonChoicesFor[this.controlButtonStyle].call(this,e)},t.prototype._controlButtonStyleChanged=function(){var e=this._model.properties.controlButtonStyle||"video";if(this.controlButtonStyle!==e){if(this.controlButtonStyle=e,this.$element.empty(),!this._createControlsFor[e])throw new Error('Unknown controlButtonStyle "'+e+'"');this._createControlsFor[e].call(this)}},t.prototype.modelLoadedCallback=function(){this._model=this._interactivesController.getModel(),this._scriptingAPI=this._interactivesController.getScriptingAPI().api,this._model.on("play."+this.component.id,$.proxy(this._simulationStateChanged,this)),this._model.on("stop."+this.component.id,$.proxy(this._simulationStateChanged,this)),this._model.addObserver("isPlayable",$.proxy(this._simulationStateChanged,this)),this._model.addObserver("showClock",$.proxy(this._showClockChanged,this)),this._model.addObserver("displayTime",$.proxy(this._timeChanged,this)),this._model.addObserver("controlButtons",$.proxy(this._controlButtonChoicesChanged,this)),this._model.addObserver("controlButtonStyle",$.proxy(this._controlButtonStyleChanged,this)),this._controlButtonStyleChanged(),this._controlButtonChoicesChanged(),this._simulationStateChanged(),this._showClockChanged()},t.prototype.resize=function(){this._$timeCanvas&&(this._canvWidth=2*this._$timeCanvas.width(),this._canvHeigth=2*this._$timeCanvas.height(),this._$timeCanvas.attr("width",this._canvWidth),this._$timeCanvas.attr("height",this._canvHeigth),this._timeCtx.font=o,this._timeCtx.fillStyle="#939598",this._timeCtx.textAlign="right",this._showClockChanged())},t}),define("common/controllers/div-controller",["require","common/inherit","common/controllers/interactive-component"],function(e){function t(e,t,n){r.call(this,"div",e,t,n),this.$element.append(e.content)}var n=e("common/inherit"),r=e("common/controllers/interactive-component");return n(t,r),t}),define("common/controllers/help-system",["require","common/markdown-to-html","common/dispatch-support"],function(e){var t=e("common/markdown-to-html"),n=e("common/dispatch-support"),r=["center bottom","left center","center top","right center"],i=["center top-5","right+5 center","center bottom+5","left-5 center"];return function(e,o){function a(){var n,a,s,u=e[p];l.focus(),l.html(t(u.text)),u.component?(n="model"===u.component?$("#model-container"):$("#"+u.component).closest(".component"),a=n.outerHeight()+10,s=parseFloat(l.css("font-size")),l.position({of:n,collision:"flipfit flipfit",within:o,my:"left-"+4*s+" top+"+s,at:"right bottom",using:function(e,t){var n,r,i=t.element.left,o=t.element.width,a=t.target.left,s=t.target.width;$(this).css(e),n=$("<div>").addClass("lab-help-arrow").addClass(t.vertical).appendTo(this),a>i&&(r=a-i+s/2,r=Math.max(.1*o,Math.min(.9*o,r)),n.css("left",r))}}),h.forEach(function(e,t){(1===t||3===t)&&e.css("height",a),e.position({of:n,collision:"none none",my:r[t],at:i[t]})})):(l.position({of:o,collision:"flipfit flipfit",within:o,my:"center center",at:"center center"}),h.forEach(function(e,t){e.position({of:o,collision:"none none",my:t?"left top":"center center",at:t?"right bottom":"center center"})}))}var s,l,u,c=new n("start","stop"),d=!1,p=-1,h=[];return s={start:function(){for(var e=0;4>e;e++)h.push($('<div class="lab-help-overlay lab-help-next"></div>').appendTo(o));u=$('<div class="lab-help-instructions"><span class="lab-help-prev btn"><</span><span class="lab-help-next">Click overlay to see next help tip</span><span class="lab-help-next btn">></span></div>').appendTo(o),o.on("click.lab-help-next",".lab-help-next",s.next),o.on("click.lab-help-prev",".lab-help-prev",s.prev),l=$('<div class="lab-help-tip lab-help-next" tabindex="-1"></div>').appendTo(o),l.on("keydown.lab-help",function(e){switch(e.keycode||e.which){case 37:s.prev();break;case 39:s.next()}e.preventDefault(),e.stopPropagation()}),p=-1,d=!0,s.next(),c.start()},stop:function(){l.remove(),u.remove(),h.forEach(function(e){e.remove()}),h.length=0,o.off("click.lab-help-next",".lab-help-next"),o.off("click.lab-help-prev",".lab-help-prev"),d=!1,c.stop()},next:function(){return p++,p>=e.length?void s.stop():void a()},prev:function(){return p--,0>p?void s.stop():void a()},isActive:function(){return d}},c.mixInto(s),s}}),define("common/views/tooltip",["require","common/benchmark/benchmark"],function(e){function t(e){function t(t){var n=e.css("font-size"),r=.35*+parseFloat(n),i=$(t).closest("[title], [aria-describedby]");o.css("font-size",n),o.is(":visible")||o.show(),o.position({of:i,collision:"flipfit flipfit",within:e,my:"center top+"+r,at:"center bottom",using:function(e,t){$(this).css(e),$("<div>").addClass("ui-tooltip-arrow").addClass(t.vertical).addClass(t.horizontal).appendTo(this)}})}function n(){o&&o.hide(),clearInterval(a),clearInterval(s),l=!1,o=null}if(i){var o=null,a=null,s=null,l=!1;e.tooltip({show:!1,hide:!1,open:function(e,i){var u=3*Math.min(500,Date.now()-r);null!==o&&n(),o=i.tooltip,t(e.originalEvent.target),o.hide(),a=setTimeout(function(){o.fadeIn(),l=!0},u),s=setTimeout(function(){o.fadeOut()},u+5e3)},close:function(e,t){o&&t.tooltip[0]===o[0]&&(l&&(r=Date.now()),n())}})}}var n=e("common/benchmark/benchmark"),r=0,i=function(){if(n.isMobile)return!1;var e=n.browser.browser,t=parseInt(n.browser.version,10);return"Safari"===e&&7>t?!1:!0}();return t}),define("common/cookies",[],function(){return{getItem:function(e){return unescape(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,n,r,i,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";if(n)switch(n.constructor){case Number:a=1/0===n?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:a="; expires="+n;break;case Date:a="; expires="+n.toGMTString()}return document.cookie=escape(e)+"="+escape(t)+a+(i?"; domain="+i:"")+(r?"; path="+r:"")+(o?"; secure":""),!0},removeItem:function(e,t){return e&&this.hasItem(e)?(document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:""),!0):!1},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=unescape(e[t]);return e}}}),define("common/controllers/setup-banner",["lab.config","common/controllers/text-controller","common/controllers/image-controller","common/controllers/div-controller","common/controllers/playback-controller"],function(){var e=require("lab.config"),t=require("common/controllers/text-controller"),n=require("common/controllers/image-controller"),r=require("common/controllers/div-controller"),i=require("common/controllers/playback-controller"),o=1.5,a=.65*o,s=o/10;return function(l,u,c,d,p){function h(e,o){var a;"text"===e.type?a=t:"image"===e.type?a=n:"div"===e.type?a=r:"playback"===e.type&&(a=i),v[e.id]=new a(e,l),y.push(o),b[o.id]=[e.id]}function f(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?!0:~$(".fullscreen").css("background-image").indexOf("exit")}var m,g,v={},y=[],b={},x=u.about||u.subtitle;return y.push({id:"top-bar",top:"0",left:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",width:"container.width",aboveOthers:!0}),y.push({id:"bottom-bar",bottom:"container.height",left:"0",width:"container.width",height:"2.5em",belowOthers:!0}),d.update(u),h({type:"text",id:"about-link",text:"About",onClick:function(){x?d.open():c.open()},tooltip:"Instructions"},{id:"banner-right",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",right:"interactive.width","padding-left":"1em","padding-right":"0.75em",align:"right",aboveOthers:!0}),e.sharing&&(p.update(u),h({type:"text",id:"share-link",text:"Share",onClick:function(){p.open()},tooltip:"Share using e-mail, IM or embed in website"},{id:"banner-middle",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",right:"banner-right.left","padding-right":"1em",align:"right",aboveOthers:!0})),h({type:"div",id:"interactive-reload-icon",content:'<i class="icon-repeat"></i>',onClick:function(){l.reloadInteractive()},tooltip:"Reload interactive"},{id:"banner-reload",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",left:"0.7em","padding-right":"1em",align:"left",aboveOthers:!0}),u.helpTips.length>0&&(h({type:"div",id:"help-icon",content:'<i class="icon-question-sign"></i>',onClick:function(){l.helpSystem.isActive()?l.helpSystem.stop():l.helpSystem.start()},tooltip:"Show help tips"},{id:"banner-help",fontScale:a,top:"0",height:o+"em","padding-top":s+"em","padding-bottom":s+"em",left:"banner-reload.right","padding-right":"1em",align:"left",aboveOthers:!0}),l.helpSystem.on("start.icon",function(){var e=$("#help-icon > i");e.addClass("icon-remove-sign active"),e.removeClass("icon-question-sign")}),l.helpSystem.on("stop.icon",function(){var e=$("#help-icon > i");e.addClass("icon-question-sign"),e.removeClass("icon-remove-sign active")})),c.update(u),h({type:"div",id:"credits-link",height:"2.5em",width:"8.1em",classes:["credits"],tooltip:"Learn more about The Concord Consortium",onClick:function(){c.open()}},{id:"banner-bottom-left",bottom:"container.height",left:"0","padding-left":"0.3em",align:"left",belowOthers:!0}),m=document.body,g=m.requestFullScreen||m.webkitRequestFullScreen||m.mozRequestFullScreen||m.msRequestFullScreen,document.cancelFullscreenMethod=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msCancelFullScreen,g&&h({type:"div",id:"fullsize-link",height:"2.5em",width:"2.5em",classes:["fullscreen"],tooltip:"Toggle full-screen",onClick:function(){f()?document.cancelFullscreenMethod():g.call(m)}},{id:"banner-bottom-right",bottom:"container.height",right:"container.width",align:"left","padding-left":"1em",belowOthers:!0}),h({type:"playback",id:"playback"},{id:"interactive-playback-container",bottom:"container.height",left:"container.width/2 - interactive-playback-container.width/2",height:"banner-bottom-left.height",belowOthers:!0}),{components:v,template:y,layout:b}}}),define("common/controllers/about-dialog",["require","common/markdown-to-html","common/inherit","common/controllers/basic-dialog"],function(e){function t(e){i.call(this,{dialogClass:"about-dialog",appendTo:e})}var n=e("common/markdown-to-html"),r=e("common/inherit"),i=e("common/controllers/basic-dialog");return r(t,i),t.prototype.update=function(e){var t=$("<div>");this.set("title","About: "+e.title),e.subtitle&&t.append(n(e.subtitle)),t.append(n(e.about)),this.setContent(t)},t}),define("text!common/controllers/share-dialog.tpl",[],function(){return"<div>\n  <h2>\n    Paste this\n    <a class='opens-in-new-window' href='{{embeddableSharingUrl}}' target='_blank'>link</a>\n    in email or IM.\n  </h2>\n  <textarea>{{embeddableSharingUrl}}</textarea>\n  <h2>Paste HTML to embed in website or blog.</h2>\n  <p>Select Size:\n    <select id='iframe-size'>\n      <option value='smaller'>30% smaller</option>\n      <option selected value='actual'>actual</option>\n      <option value='larger'>50% larger</option>\n    </select>\n  </p>\n  <textarea id='share-iframe-content'></textarea>\n  {{> copyright}}\n</div>\n"}),define("text!common/controllers/copyright.tpl",[],function(){return'<div class="copyright-section"><strong>Copyright © 2013&nbsp;</strong><a class="opens-in-new-window" href="http://concord.org" id="share-license-link" target="_blank">The Concord Consortium</a>. All rights reserved. The software is licensed under&nbsp;<a class="opens-in-new-window" href="http://opensource.org/licenses/BSD-2-Clause" id="share-license-link" target="_blank">Simplified BSD</a>, <a class="opens-in-new-window" href="http://opensource.org/licenses/MIT" id="share-license-link" target="_blank">MIT</a> or <a class="opens-in-new-window" href="http://opensource.org/licenses/Apache-2.0" id="share-license-link" target="_blank">Apache 2.0</a> licenses. Please provide attribution to the Concord Consortium and the URL&nbsp;<a class="opens-in-new-window" href="http://concord.org/" id="share-license-link" target="_blank">http://concord.org</a>.</div>'}),define("common/controllers/share-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/share-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function t(e){var t=l.hash,i=l.href.match(/(.*?\/\/.*?)\//)[1],u=l.pathname;o.call(this,{dialogClass:"share-dialog",appendTo:e}),this._view={},this._view.embeddableSharingUrl=n.homeForSharing?n.homeForSharing+n.homeEmbeddablePath+t:i+u+t,this.setContent(r.render(a,this._view,{copyright:s})),this._$interactiveContainer=$(e),this._$iframeSize=this.$element.find("#iframe-size"),this._$iframeContent=this.$element.find("#share-iframe-content"),this._$iframeSize.on("change",$.proxy(this.updateIframeSize,this)),this.updateIframeSize()}var n=e("lab.config"),r=e("mustache"),i=e("common/inherit"),o=e("common/controllers/basic-dialog"),a=e("text!common/controllers/share-dialog.tpl"),s=e("text!common/controllers/copyright.tpl"),l=document.location,u=r.compile('<iframe width="{{width}}px" height="{{height}}px" frameborder="no" scrolling="no" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" src="{{{embeddableSharingUrl}}}"></iframe>');return i(t,o),t.prototype.updateIframeSize=function(){var e=this._$interactiveContainer.innerWidth(),t=this._$interactiveContainer.innerHeight(),n=this._$iframeSize.val();switch(n){case"smaller":this._view.width=Math.floor(.7*e),this._view.height=Math.floor(.7*t);break;case"larger":this._view.width=Math.floor(1.5*e),this._view.height=Math.floor(1.5*t);break;default:this._view.width=e,this._view.height=t}this._$iframeContent.val(u(this._view))},t.prototype.update=function(e){this.set("title","Share: "+e.title)},t}),define("text!common/controllers/credits-dialog.tpl",[],function(){return'<div>\n  <p>\n    This interactive was created by the <a href="{{concordUrl}}" target="_blank">Concord Consortium</a>\n    using our <a href="{{nextGenUrl}}" target="_blank">Next-Generation Molecular Workbench</a> software,\n    with funding by a grant from <a href="http://www.google.org/" target="_blank">Google.org</a>.\n   </p>\n   {{#showShareable}}\n   <p>\n      Find a <a href="{{interactiveCreditsUrl}}" class="opens-in-new-window" target="_blank">shareable version</a>\n      of this interactive along with dozens of other open-source interactives for science, math and engineering at\n      <a href="{{concordUrl}}" class="opens-in-new-window" target="_blank">concord.org</a>.\n    </p>\n    {{/showShareable}}\n  {{> copyright}}\n</div>\n'}),define("common/controllers/credits-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/credits-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function t(e){o.call(this,{dialogClass:"credits-dialog",appendTo:e})}var n=e("lab.config"),r=e("mustache"),i=e("common/inherit"),o=e("common/controllers/basic-dialog"),a=e("text!common/controllers/credits-dialog.tpl"),s=e("text!common/controllers/copyright.tpl");return i(t,o),t.prototype.update=function(e){var t,i={concordUrl:"http://concord.org",nextGenUrl:"http://mw.concord.org/nextgen/"},o=document.location.hash,l=document.location.href.match(/(.*?\/\/.*?)\//)[1],u=document.location.pathname;this.set("title","Credits: "+e.title),i.interactiveCreditsUrl=n.homeForSharing?n.homeForSharing+n.homeEmbeddablePath+o:l+u+o,n.utmCampaign&&(t="utm_source="+encodeURIComponent(e.title.replace(/ /gi,"+"))+"&utm_medium=embedded_interactive&utm_campaign="+n.utmCampaign,i.concordUrl+="?"+t,i.nextGenUrl+="?"+t,i.interactiveCreditsUrl+="?"+encodeURI("utm_source=embed_link&utm_medium=embedded_interactive&utm_campaign="+n.utmCampaign)),n.sharing||(i.showShareable=!0),this.setContent(r.render(a,i,{copyright:s}))},t}),define("common/layout/semantic-layout-config",[],function(){return{iterationsLimit:35,minModelWidth:150,minFontSize:.65,canonicalFontSize:.9,canonicalWidth:565,containerColors:["rgba(0,0,255,0.1)","rgba(255,0,0,0.1)","rgba(0,255,0,0.1)","rgba(255,255,0,0.1)","rgba(0,255,255,0.1)","rgba(255,255,128,0.1)","rgba(128,255,0,0.1)","rgba(255,128,0,0.1)"]}}),define("common/layout/semantic-layout",["require","common/layout/semantic-layout-config","arrays","common/console","common/alert"],function(require){var layoutConfig=require("common/layout/semantic-layout-config"),arrays=require("arrays"),console=require("common/console"),alert=require("common/alert");return function SemanticLayout(){function reset(){modelWidth=layoutConfig.minModelWidth,modelTop=0,modelLeft=0,topBoundary=0,leftBoundary=0,bottomBarWidth=0}function getDimensionOfContainer(e,t){var n=e.position();switch(t){case"top":return n.top;case"bottom":return n.top+e.outerHeight();case"left":return n.left;case"right":return n.left+e.outerWidth();case"height":return e.outerHeight();case"width":return e.outerWidth()}}function setFontSize(){var e,t,n=layoutConfig.canonicalWidth,r=n/aspectRatio;e=Math.min($mainContainer.width()/n,$mainContainer.height()/r),padding=10*e,t=layoutConfig.canonicalFontSize*fontScale*e,t<layoutConfig.minFontSize&&(t=layoutConfig.minFontSize),$mainContainer.css("font-size",t+"em"),fontSizeChanged=!0}function createContainers(){var e,t,n,r,i;for($containerByID={},containerSpecByID={},r=0,i=containerSpecList.length;i>r;r++){e=containerSpecList[r],t=e.id,containerSpecByID[t]=e,$containerByID[t]=$("<div id='"+t+"'>").appendTo($containersParent),$containerByID[t].css({display:"inline-block",position:"absolute"}),void 0===e.width&&$containerByID[t].css("white-space","nowrap");for(n in e)e.hasOwnProperty(n)&&(/^padding-/.test(n)?$containerByID[t].css(n,e[n]):"align"===n?$containerByID[t].css("text-align",e[n]):"min-width"===n?$containerByID[t].css("min-width",e[n]):"fontScale"===n&&$containerByID[t].css("font-size",e[n]+"em"))}}function placeComponentsInContainers(){var e,t,n,r,i,o,a,s,l,u,c,d,p,h,f,m;l=$.extend({},componentByID);for(t in containersContent)if(containersContent.hasOwnProperty(t))if($containerByID[t])if(n=containersContent[t],arrays.isArray(n))for(arrays.isArray(n[0])||(n=[n]),p=0,h=n.length;h>p;p++)for(r=n[p],i=$('<div class="interactive-row"/>'),i.css("width","100%"),1===h&&i.css("height","100%"),$containerByID[t].append(i),f=0,m=r.length;m>f;f++)e=r[f],void 0!==l[e]?(i.append(l[e].getViewContainer()),delete l[e]):alert("Incorrect layout definition. Component with ID '"+e+"'' is not defined.");else u="Incorrect layout definition for '"+t+"' container. It should specify an array of components or an array of arrays of components (multiple rows).",alert(u);else u="Incorrect layout definition - '"+t+"' container does not exist.",alert(u);s=containerSpecByID.bottom||containerSpecList[containerSpecList.length-1],o=$containerByID[s.id].children(),i=o.last(),i.length||(i=$('<div class="interactive-row"/>'),$containerByID[s.id].append(i));for(e in l)l.hasOwnProperty(e)&&i.append(l[e].getViewContainer());for(c=0,d=containerSpecList.length;d>c;c++)a=$containerByID[containerSpecList[c].id].children().children(),a.length>1&&a.addClass("component-spacing")}function positionContainers(){var e,t,n,r,i,o,a,s,l,u;for($modelContainer.css({width:modelWidth,height:modelController.getHeightForWidth(modelWidth,fontSizeChanged),left:modelLeft,top:modelTop}),fontSizeChanged=!1,s=0,l=containerSpecList.length;l>s;s++)e=containerSpecList[s],t=$containerByID[e.id],e.left||e.right||(e.left="0"),e.top||e.bottom||(e.top="0"),e.left&&(n=parseDimension(e.left),t.css("left",n)),e.top&&(r=parseDimension(e.top),t.css("top",r)),e.height&&t.css("height",parseDimension(e.height)),e.width&&t.css("width",parseDimension(e.width)),e.right&&(i=parseDimension(e.right),e.left?t.css("width",i-n):(n=i-t.outerWidth(),t.css("left",n))),e.bottom&&(o=parseDimension(e.bottom),e.top?t.css("height",o-r):(r=o-t.outerHeight(),t.css("top",r))),e.aboveOthers&&(o=getDimensionOfContainer(t,"bottom")+padding,o>topBoundary&&(topBoundary=o)),e.belowOthers&&(a=getDimensionOfContainer(t,"height")+padding,a>bottomBarWidth&&(bottomBarWidth=a));leftBoundary=padding;for(u in $containerByID)$containerByID.hasOwnProperty(u)&&(containerSpecByID[u]&&containerSpecByID[u].aboveOthers||containerSpecByID[u]&&containerSpecByID[u].belowOthers||(t=$containerByID[u],r=getDimensionOfContainer(t,"top"),t.css("top",r+topBoundary),n=getDimensionOfContainer(t,"left"),t.css("left",n+leftBoundary)))}function resizeModelContainer(){var e,t,n,r,i,o,a,s=-1/0,l=-1/0,u=1/0,c=1/0;for(e in $containerByID)$containerByID.hasOwnProperty(e)&&(containerSpecByID[e]&&containerSpecByID[e].aboveOthers||containerSpecByID[e]&&containerSpecByID[e].belowOthers||(t=$containerByID[e],n=getDimensionOfContainer(t,"right"),n>s&&(s=n),r=getDimensionOfContainer(t,"bottom"),r>l&&(l=r),o=getDimensionOfContainer(t,"left"),u>o&&(u=o),i=getDimensionOfContainer(t,"top"),c>i&&(c=i)));return availableWidth+2>=s&&availableHeight-bottomBarWidth+2>=l&&(Math.abs(availableWidth-s)<2||Math.abs(availableHeight-bottomBarWidth-l)<2)&&Math.abs(u-leftBoundary)<2&&Math.abs(c-topBoundary)<2?!0:(a=Math.min(availableWidth/s,(availableHeight-bottomBarWidth)/l),isNaN(a)||(modelWidth*=a),modelWidth<layoutConfig.minModelWidth&&(modelWidth=layoutConfig.minModelWidth),modelLeft-=u-leftBoundary,modelTop-=c-topBoundary,!1)}function parseDimension(dim){var vars,i,ii,value;if("number"==typeof dim||/^[0-9]+\.?[0-9]*(em)?$/.test(dim))return dim;for(vars=dim.match(/[a-zA-Z][a-zA-Z0-9\-]+\.[a-zA-Z]+/g),i=0,ii=vars.length;ii>i;i++)value=getDimension(vars[i]),dim=dim.replace(vars[i],value);return/^[^a-zA-Z]*$/.test(dim)?eval(dim):0}function getDimension(e){switch(e){case"container.width":return availableWidth;case"container.height":return availableHeight;case"interactive.left":return leftBoundary;case"interactive.top":return topBoundary;case"interactive.width":case"interactive.right":return availableWidth-leftBoundary;case"interactive.height":case"interactive.bottom":return availableHeight-topBoundary-bottomBarWidth;default:return e=e.split("."),getDimensionOfContainer($containerByID[e[0]],e[1])}}var layout,$mainContainer,$containersParent,containerSpecList,containersContent,componentByID,modelController,aspectRatio,fontScale,containerSpecByID,$containerByID,$modelContainer,availableWidth,availableHeight,padding=10,fontSizeChanged=!1,modelWidth,modelTop,modelLeft,topBoundary,leftBoundary,bottomBarWidth;return layout={initialize:function(e,t,n,r,i,o,a){$mainContainer=e,$containersParent=t,containerSpecList=n,containersContent=r,componentByID=i,aspectRatio=o,fontScale=a,createContainers(),placeComponentsInContainers(),modelController=null,$mainContainer.addClass("lab-responsive-content")},setupModel:function(e){if(modelController=e,$containerByID.model){if($containerByID.model===modelController.getViewContainer())return;$containerByID.model.remove()}$modelContainer=modelController.getViewContainer(),$modelContainer.css({display:"inline-block",position:"absolute","z-index":"0"}),$modelContainer.appendTo($containersParent),$containerByID.model=$modelContainer},isReady:function(){return modelController?!0:!1},layoutInteractive:function(){var e,t=layoutConfig.iterationsLimit;for(console.time("[layout] update"),reset(),availableWidth=$mainContainer.width(),availableHeight=$mainContainer.height(),modelWidth=availableWidth,setFontSize(),positionContainers();--t>0&&!resizeModelContainer();)positionContainers();modelController.resize();for(e in componentByID)componentByID.hasOwnProperty(e)&&void 0!==componentByID[e].resize&&componentByID[e].resize();return console.timeEnd("[layout] update"),layoutConfig.iterationsLimit-t}}}}),define("common/layout/templates",[],function(){return{simple:[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"narrow-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width / 4","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"wide-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"left-right-bottom":[{id:"left",top:"model.top",height:"model.height",right:"model.left","padding-right":"0.5em"},{id:"right",top:"model.top",height:"model.height",left:"model.right","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",left:"model.left",width:"model.width"}]}}),define("common/performance",[],function(){var e,t,n=!1;return e="undefined"!=typeof performance&&"undefined"!=typeof performance.now?$.proxy(performance.now,performance):$.proxy(Date.now,Date),{now:e,collectData:function(e){n=e,n&&(t={})},enterScope:function(r){if(n){var i=t[r];void 0===i&&(i=t[r]={lastTime:0,timeSum:0,count:0}),i.lastTime=e()}},leaveScope:function(r){if(n){var i=t[r];void 0!==i&&(i.timeSum+=e()-i.lastTime,i.count+=1)}},getAvgTime:function(e){var n=t[e];return void 0!==n?n.timeSum/n.count:0},getAvgFreq:function(e){var n=t[e];return void 0!==n?1e3*n.count/n.timeSum:0}}}),define("common/controllers/model-controller",["require","lab.config","common/performance"],function(e){function t(e,i,o,a,s,l,u){function c(){Math.seedrandom(o.randomSeed+g.get("time"))}function d(){n.enterScope("js-rendering"),m.modelContainer.update(),n.leaveScope("js-rendering")}function p(){g=new a(i,{waitForSetup:!0}),g.on("tickStart.modelController",c),g.on("tick.modelController",d),g.on("reset.modelController",h)}function h(){b=b||t.RESET_CAUSE.RESET,y.repaint(),x.modelReset(b)}function f(n,r,o){g&&g.willReset&&g.willReset(),e=n||e,i=r||i,p(),y?y.bindModel(g,e):y=new s(g,m.modelUrl),o||x.modelLoaded(t.LOAD_CAUSE.RELOAD)}var m,g,v,y,b,x=d3.dispatch("modelLoaded","modelReset","modelSetupComplete");return m={get type(){return a.type},get benchmarks(){return v},get modelUrl(){return e},get model(){return g},get modelContainer(){return y},on:function(e,t){x.on(e,t)},getViewContainer:function(){return m.modelContainer.$el},getHeightForWidth:function(e,t){return m.modelContainer.getHeightForWidth(e,t)},initializeView:function(){m.modelContainer.setup(),m.modelContainer.repaint()},resize:function(){m.modelContainer.resize()},repaint:function(){m.modelContainer.repaint()},updateView:function(){m.modelContainer.update()},reload:f,reset:function(e){g.stop(),b=e,g.reset(),b=void 0},state:function(){return g.serialize()},ScriptingAPI:l,enableKeyboardHandlers:function(){return g.get("enableKeyboardHandlers")}},null!=i&&p(),r.getModel=function(){return g},v="function"==typeof u?new u(m):[],m}var n=(e("lab.config"),e("common/performance")),r=function(){return this}();return t.LOAD_CAUSE={RELOAD:"reload",INITIAL_LOAD:"initialLoad"},t.RESET_CAUSE={RESET:"reset"},t}),define("common/serialize",["require","arrays"],function(e){var t=e("arrays"),n=function(e){var r,i;if(t.isArray(e))for(r=0,i=e.length;i>r;r++)(1/0===e[r]||e[r]===-1/0)&&(e[r]=e[r].toString());else for(r in e)e.hasOwnProperty(r)&&((1/0===e[r]||e[r]===-1/0)&&(e[r]=e[r].toString()),("object"==typeof e[r]||t.isArray(e[r]))&&n(e[r]))};return function(e,r,i){var o,a,s={};for(o in e)e.hasOwnProperty(o)&&void 0!==r[o]&&e[o].serialize!==!1&&(a=r[o],s[o]=t.isArray(a)?t.copy(a,[],i):"object"==typeof a?$.extend(!0,{},a):a);return n(s),s}}),define("common/property-support",[],function(){function e(e,t,n){if(typeof n!==e)throw new TypeError(t+" must be a "+e+".")}function t(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var n={get:{defaultValue:void 0,type:"function"},set:{defaultValue:void 0,type:"function"},validate:{defaultValue:void 0,type:"function"},beforeSetCallback:{defaultValue:void 0,type:"function"},afterSetCallback:{defaultValue:void 0,type:"function"},afterGetTransform:{defaultValue:void 0,type:"function"},beforeSetTransform:{defaultValue:void 0,type:"function"},writable:{defaultValue:!0,type:"boolean"},includeInHistoryState:{defaultValue:!1,type:"boolean"},invokeSetterAfterBulkRestore:{defaultValue:!0,type:"boolean"},type:{defaultValue:void 0,type:"propertyType"},description:{defaultValue:void 0}};return function(r){function i(){return E.filter(function(e){return x[e].observers.length>0})}function o(e){if(b.indexOf(e)<0)throw new TypeError(e+" is not a recognized property type.")}function a(t){var r={};return Object.keys(n).forEach(function(i){var a=n[i];if(void 0!==t[i])switch(r[i]=t[i],a.type){case"boolean":r[i]=!!r[i];break;case"function":e("function",i,t[i]);break;case"string":e("string",i,t[i]);break;case"propertyType":o(t[i])}else r[i]=a.defaultValue}),r}function s(e){var t=[];e.forEach(function(e){t.indexOf(e)<0&&(e(),t.push(e))})}function l(e){var t=[];T=!0,e(),T=!1,P.forEach(function(e){x[e].observers.forEach(function(e){t.push(e)})}),P=[],s(t)}function u(e){T?P.push(e):s(x[e].observers)}function c(e){s(x[e].propertyDescriptionObservers)}function d(e){var t=x[e];return t.descriptor.get?_?(t.hasCachedValue||(t.hasCachedValue=!0,t.cachedValue=t.descriptor.get()),t.cachedValue):t.descriptor.get():t.cachedValue}function p(e,t){var n=x[e];if(!n.descriptor.writable)throw new Error("Attempt to set read-only property "+e);n.descriptor.get&&!_?n.hasCachedValue=!1:(n.hasCachedValue=!0,n.cachedValue=t)}function h(e,t){var n=x[e];n.descriptor.description=t,c(e)}function f(e){w.all=void 0,e&&(w.byType[e]=void 0)}function m(e,t){var n=x[t];Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:function(){var e=d(t);return n.descriptor.afterGetTransform&&(e=n.descriptor.afterGetTransform(e)),e},set:function(e){n.descriptor.beforeSetCallback&&n.descriptor.beforeSetCallback(),n.descriptor.beforeSetTransform&&(e=n.descriptor.beforeSetTransform(e)),n.descriptor.validate&&(e=n.descriptor.validate(e)),p(t,e),n.descriptor.set&&n.descriptor.set(e),n.descriptor.afterSetCallback&&n.descriptor.afterSetCallback(),u(t)}})}function g(e){var t=e?w.byType[e]:w.all;return t||(t={},Object.keys(x).forEach(function(n){e&&e!==x[n].descriptor.type||m(t,n)}),Object.seal&&Object.seal(t),e?w.byType[e]=t:w.all=t),t}var v,y,b=r&&r.types&&t(r.types)||[],x={},w={all:void 0,byType:{}},_=!0,T=!1,C=d3.dispatch("beforeInvalidatingChange","afterInvalidatingChange","afterInvalidatingChangeSequence"),A=0,S=!1,P=[],E=[],k=[];return y={mixInto:function(e){Object.defineProperty(e,"properties",{configurable:!1,enumerable:!0,get:g}),e.propertiesOfType=function(e){return g(e)},e.set=function(t,n){var r;"string"==typeof t?e.properties[t]=n:(r=t,l(function(){Object.keys(r).forEach(function(t){e.properties[t]=r[t]})}))},e.get=function(t){return e.properties[t]},e.freeze=function(t){var n=e.getPropertyDescription(t);n.setFrozen(!0),h(t,n)},e.unfreeze=function(t){var n=e.getPropertyDescription(t);
n.setFrozen(!1),h(t,n)},e.addObserver=function(e,t){if(x[e]){var n=x[e].observers;n.indexOf(t)<0&&n.push(t)}},e.removeObserver=function(e,t){var n=x[e].observers,r=n.indexOf(t);r>=0&&n.splice(r,1)},e.addPropertyDescriptionObserver=function(e,t){if(x[e]){var n=x[e].propertyDescriptionObservers;n.indexOf(t)<0&&n.push(t)}},e.removePropertyDescriptionObserver=function(e,t){var n=x[e].propertyDescriptionObservers,r=n.indexOf(t);r>=0&&n.splice(r,1)},e.hasProperty=function(e){return null!=x[e]},e.isPropertyWritable=function(e){return x[e].descriptor.writable},e.getPropertyDescription=function(e){return x[e].descriptor.description},e.getPropertyType=function(e){return x[e].descriptor.type},e.getPropertyValidateFunc=function(e){return x[e].descriptor.validate},e.makeInvalidatingChange=function(e){y.invalidatingChangePreHook(),e(),y.invalidatingChangePostHook()},e.addPropertiesListener=function(t,n){"string"==typeof t?e.addObserver(t,n):t.forEach(function(t){e.addObserver(t,n)})}},defineProperty:function(e,t){t=a(t||{}),x[e]={descriptor:t,observers:[],propertyDescriptionObservers:[],hasCachedValue:!1,cachedValue:void 0,previousValue:void 0},t.get&&E.push(e),t.includeInHistoryState&&k.push(e),f(t.type)},setPropertyDescription:function(e,t){h(e,t)},deleteComputedPropertyCachedValues:function(){E.forEach(function(e){x[e].hasCachedValue=!1,x[e].cachedValue=void 0})},storeComputedProperties:function(){i().forEach(function(e){x[e].previousValue=d(e)})},notifyChangedComputedProperties:function(){l(function(){i().forEach(function(e){d(e)!==x[e].previousValue&&u(e),x[e].previousValue=void 0})})},notifyAllComputedProperties:function(){l(function(){i().forEach(function(e){u(e)})})},get properties(){return g()},propertiesOfType:function(e){return g(e)},get enableCaching(){return _},set enableCaching(e){_=!!e},get historyStateRawValues(){var e={};return k.forEach(function(t){e[t]=d(t)}),e},get rawValues(){var e={};return Object.keys(x).forEach(function(t){e[t]=d(t)}),e},setRawValues:function(e){l(function(){Object.keys(e).forEach(function(t){var n=x[t];n&&(d(t)!==e[t]&&u(t),p(t,e[t]),n.descriptor.invokeSetterAfterBulkRestore&&n.descriptor.set&&n.descriptor.set(d(t)))})})},invalidatingChangePreHook:function(){S&&v||(v=!0,0===A&&(y.storeComputedProperties(),y.deleteComputedPropertyCachedValues(),y.enableCaching=!1),A++,C.beforeInvalidatingChange())},invalidatingChangePostHook:function(){S||(A--,C.afterInvalidatingChange(),0===A&&(y.enableCaching=!0,y.notifyChangedComputedProperties(),C.afterInvalidatingChangeSequence()))},startBatch:function(){v=!1,S=!0},endBatch:function(){S=!1,v&&y.invalidatingChangePostHook()},on:function(e,t){C.on(e,t)}}}}),define("common/property-description",["require","underscore"],function(e){function t(e){return""===e}function n(e,t){var n;if(this._descriptionHash=t,this._label=t.label||"",this._unitName="",this._unitPluralName="",this._unitAbbreviation="",t.unitType){if(!(n=e.units[t.unitType]))throw new Error("PropertyDescription: couldn't find unitType "+t.unitType+" in the supplied units definition.");this._unitType=t.unitType,this._unitName=n.name,this._unitPluralName=n.pluralName,this._unitAbbreviation=n.symbol}t.unitName&&(this._unitName=t.unitName),t.unitPluralName&&(this._unitPluralName=t.unitPluralName),t.unitAbbreviation&&(this._unitAbbreviation=t.unitAbbreviation),this._min=t.min,this._max=t.max,this._frozen=t.frozen,this.setFormat(t.format)}var r=e("underscore");return n.prototype.getHash=function(){return r.extend(r.reject({unitName:this.getUnitName(),unitPluralName:this.getUnitPluralName(),unitAbbreviation:this.getUnitAbbreviation()},t),this._descriptionHash)},n.prototype.getLabel=function(){return this._label},n.prototype.getUnitType=function(){return this._unitType},n.prototype.getUnitName=function(){return this._unitName},n.prototype.getUnitPluralName=function(){return this._unitPluralName},n.prototype.getUnitAbbreviation=function(){return this._unitAbbreviation},n.prototype.getMin=function(){return this._min},n.prototype.getMax=function(){return this._max},n.prototype.getFrozen=function(){return this._frozen},n.prototype.setFrozen=function(e){this._frozen=e},n.prototype.setFormat=function(e){this._formatter=e?d3.format(e):function(e){return e}},n.prototype.format=function(e,t){t=t||{};var n,r,i,o=!0;return t.format?t.format===this._lastFormat?n=this._lastFormatter:(n=d3.format(t.format),this._lastFormat=t.format,this._lastFormatter=n):n=this._formatter,r=n(e),t&&null!=t.abbreviated&&(o=t.abbreviated),o?r+" "+this._unitAbbreviation:(i=1!==parseFloat(r),r+" "+(i?this._unitPluralName:this._unitName))},n}),define("common/parameter-support",["require","common/property-description"],function(e){var t=e("common/property-description");return function(e){var n=e.propertySupport,r=e.unitsDefinition||{};return{mixInto:function(e){e.defineParameter=function(i,o,a){var s={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new t(r,o),beforeSetCallback:n.invalidatingChangePreHook,afterSetCallback:n.invalidatingChangePostHook};a&&(s.set=function(t){a.call(e,t)}),n.defineProperty(i,s)}}}}}),define("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){define("cs!common/filters/running-average-filter",["require"],function(){var e;return e=function(){function e(e){this.periodLength=e,this._value=[],this._time=[],this._idx=-1,this._maxBufferLength=this.periodLength}return e.prototype.addSample=function(e,t){var n;if(this._time[this._idx]===e)return void(this._value[this._idx]=t);if(this._time[this._idx]>e)throw new Error("RunningAverageFilter: cannot add sample with @_time less than previous sample.");for(this._idx++,this._value.push(t),this._time.push(e),n=[];this._value.length>this._maxBufferLength;)this._time.shift(),this._value.shift(),n.push(this._idx--);return n},e.prototype.calculate=function(){var e,t,n,r,i,o;for(t=Math.max(this._time[this._idx]-this.periodLength,0),o=0,i=0,e=this._idx;e>0&&this._time[e-1]>=t;)r=this._time[e]-this._time[e-1],i+=r,o+=r*(this._value[e-1]+this._value[e])/2,e--;return e>0&&this._time[e]>t&&this._time[e-1]<t&&(r=this._time[e]-t,i+=r,n=this._value[e-1]+(this._value[e]-this._value[e-1])*(t-this._time[e-1])/(this._time[e]-this._time[e-1]),o+=r*(this._value[e]+n)/2),i?o/i:this._value[0]||0},e.prototype.getCurrentBufferLength=function(){return this._value.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(-1>e||e>=this._value.length)throw new Error("RunningAverageFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return this._value.length=e+1,this._time.length=e+1,this._idx=e},e.prototype.reset=function(){return this._values.length=0,this._time=0,this._idx=0},e}()})}.call(this),function(){define("cs!common/filters/simple-period-filter",["require"],function(){var e;return e=function(){function e(){this._values=[],this._time=[],this._idx=-1,this._zero_crossing_buffer=[],this._period_buffer=[],this._maxBufferLength=8192}return e.prototype.addSample=function(e,t){var n,r;if(this._time[this._idx]===e)return void(this._values[this._idx]=t);if(this._time[this._idx]>e)return void console.log("Error: RunningAverageFilter: cannot add sample with @_time less than previous sample.");for(this._idx++,this._values.push(t),this._time.push(e),this._values.length>1&&(n=this._values[this._values.length-2]);this._values.length>this._maxBufferLength;)this._time.shift(),this._values.shift(),this._idx--;if(0>n&&t>0||n>0&&0>t)for(this._zero_crossing_buffer.push(e),this._zero_crossing_buffer.length>1&&(r=this._zero_crossing_buffer[this._zero_crossing_buffer.length-2],this._period_buffer.push(e-r));this._zero_crossing_buffer.length>128;)this._zero_crossing_buffer.shift(),this._period_buffer.shift()},e.prototype.calculate=function(){var e,t;return this._period_buffer.length<1?0:1===this._period_buffer.length?2*this._period_buffer[0]:(t=this._period_buffer.reduce(function(e,t){return e+t}),e=t/this._period_buffer.length,2*e)},e.prototype.getCurrentBufferLength=function(){return this._values.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(-1>e||e>=this._values.length)throw new Error("SimplePeriodFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return e?(this._values.length=e+1,this._time.length=e+1,this._idx=e):this.reset()},e.prototype.reset=function(){this._values.length=0,this._time.length=0,this._idx=0,this._zero_crossing_buffer.length=0,this._period_buffer.length=0},e}()})}.call(this),define("common/output-support",["require","common/property-description","cs!common/filters/running-average-filter","cs!common/filters/simple-period-filter"],function(e){var t=e("common/property-description"),n=e("cs!common/filters/running-average-filter"),r=e("cs!common/filters/simple-period-filter");return function(e){function i(){u.forEach(function(e){e.addSample()})}function o(){u.forEach(function(e){e.reset()})}var a=e.propertySupport,s=e.unitsDefinition||{},l=e.tickHistory||null,u=[];return a.on("afterInvalidatingChange.output-support",i),{mixInto:function(e){e.defineOutput=function(e,n,r){a.defineProperty(e,{type:"output",writable:!1,get:r,includeInHistoryState:!1,description:new t(s,n)})},e.defineFilteredOutput=function(t,i,o,a,s){var c,d;if("RunningAverage"===a)c=new n(s);else{if("SimplePeriod"!==a)throw new Error("FilteredOutput: unknown filter type "+a+".");c=new r}if(d=e.properties[o],void 0===d||isNaN(Number(d)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");c.addSample(e.properties.time,d),l?l.registerExternalObject({push:function(){c.addSample(e.properties.time,e.properties[o])},extract:function(e){c.setCurrentStep(e)},invalidate:function(e){c.invalidate(e)},setHistoryLength:function(e){c.setMaxBufferLength(e)},reset:function(){c.reset()}}):u.push({addSample:function(){c.addSample(e.properties.time,e.properties[o])}}),i.property=o,i.type=a,i.period=s,e.defineOutput(t,i,function(){return c.calculate()})},e.updateAllOutputProperties=function(){a.deleteComputedPropertyCachedValues(),a.notifyAllComputedProperties(),i()},e.resetAllOutputProperties=function(){o()}}}}}),define("common/playback-support",["require","common/console","common/performance"],function(e){var t=e("common/console"),n=e("common/performance");return function(e){function r(e){var t,n=o&&o.properties.modelSampleRate||"default";"default"===n?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)}var i=e&&e.dispatch||null,o=e&&e.propertySupport||null,a=function(){if(i){if(i.on&&i.addEventTypes)return i.addEventTypes("play","stop","tickStart","tickEnd"),!0;throw new Error("[PlaybackSupport] Provided Dispatch object doesn't implement required interface!")}return!1}(),s=!0,l=!1,u=!1,c=!1;return{mixInto:function(e){"function"!=typeof e.tick&&(e.tick=function(){t.warn("[PlaybackSupport] .tick() method should be overwritten by target!")}),e.start=function(){return l=!1,u=!1,s?(s=!1,r(function(t){return a&&i.tickStart(),n.leaveScope("gap"),l?(s=!0,!0):u?(setTimeout(e.start,0),s=!0,!0):(n.enterScope("tick"),e.tick(t),n.leaveScope("tick"),n.enterScope("gap"),!1)}),a&&i.play(),n.enterScope("gap"),e):e},e.restart=function(){return u=!0,e},e.stop=function(){return l=!0,a&&i.stop(),e},e.isStopped=function(){return s||l},e.on("play.playback-support",function(){c=!0}),e.on("reset.playback-support",function(){c=!1}),Object.defineProperty(e,"hasPlayed",{enumerable:!0,get:function(){return c}})}}}}),define("common/define-builtin-properties",["require","common/validator","common/property-description"],function(e){var t=e("common/validator"),n=e("common/property-description");return function(e){function r(e,r,l){var u,c,d,p;if("mainProperty"===r)u=o.mainProperties;else{if("viewOption"!==r)throw new Error(r+" is not a supported built-in property type");u=o.viewOptions}d=t.propertyChangeInvalidates(u[e]),c={type:r,writable:t.propertyIsWritable(u[e]),set:l,includeInHistoryState:!!u[e].storeInTickHistory,validate:function(n){return t.validateSingleProperty(u[e],e,n,!1)},beforeSetCallback:d?i.invalidatingChangePreHook:void 0,afterSetCallback:d?i.invalidatingChangePostHook:void 0},p=u[e].unitType,c.description=new n(a,{unitType:p,label:u[e].label||e}),p&&s&&(c.beforeSetTransform=function(e){return s.translateToModelUnits(e,p)},c.afterGetTransform=function(e){return s.translateFromModelUnits(e,p)}),i.defineProperty(e,c)}var i=e.propertySupport,o=e.metadata,a=e.unitsDefinition||{},s=e.unitsTranslation||null,l=e.setters||{},u=e.initialProperties||null;!function(){var e,n;Object.keys(o.mainProperties).forEach(function(e){r(e,"mainProperty",l[e])}),Object.keys(o.viewOptions).forEach(function(e){r(e,"viewOption",l[e])}),u&&(e=t.validateCompleteness(o.mainProperties,u),i.setRawValues(e),n=t.validateCompleteness(o.viewOptions,u.viewOptions||{}),i.setRawValues(n))}()}}),define("common/lab-modeler-mixin",["require","common/property-support","common/parameter-support","common/output-support","common/dispatch-support","common/playback-support","common/define-builtin-properties"],function(e){var t=e("common/property-support"),n=e("common/parameter-support"),r=e("common/output-support"),i=e("common/dispatch-support"),o=e("common/playback-support"),a=e("common/define-builtin-properties");return function(e){var s,l,u=e.metadata,c=e.setters,d=e.unitsDefinition,p=e.unitsTranslation,h=e.initialProperties,f=e.tickHistory,m=void 0===e.usePlaybackSupport||!!e.usePlaybackSupport,g=new t({types:["output","parameter","mainProperty","viewOption"]}),v=new n({propertySupport:g,unitsDefinition:d}),y=new r({propertySupport:g,unitsDefinition:d,tickHistory:f}),b=new i;m&&(l=new o({dispatch:b,propertySupport:g}));var x=!1;return b.addEventTypes("reset","stepForward","stepBack","seek","invalidation","willReset","ready"),s={mixInto:function(e){g.mixInto(e),v.mixInto(e),y.mixInto(e),b.mixInto(e),l&&l.mixInto(e),e.willReset=function(){b.willReset()},e.ready=function(){if(x)throw new Error("ready() called on an already-ready model.");s.tickHistory&&(s.tickHistory.saveInitialState(),s.tickHistory.push()),g.invalidatingChangePreHook(),x=!0,g.invalidatingChangePostHook(),b.ready()},Object.defineProperty(e,"isReady",{enumerable:!0,get:function(){return x}}),u&&a({propertySupport:g,metadata:u,unitsDefinition:d,unitsTranslation:p,setters:c,initialProperties:h})},get propertySupport(){return g},get parameterSupport(){return v},get outputSupport(){return y},get dispatchSupport(){return b},get playbackSupport(){return l}}}}),define("common/models/tick-history",[],function(){return function(e,t,n){function r(){return{input:{},state:[],parameters:{}}}function i(){var e;for(d=[],p={length:0,maxSize:n,index:-1,counter:-1,startCounter:0},e=0;e<m.length;e++)m[e].reset&&m[e].reset()}function o(t){var n,r,i,o,a;if(g)t.input=e.getProperties();else{for(n=0;n<e.input.length;n++)r=e.input[n],t.input[r]=e.getRawPropertyValue(r);o=e.parameters;for(a in o)o.hasOwnProperty(a)&&o[a].isDefined&&(t.parameters[a]=e.getRawPropertyValue(a))}for(i=e.state,n=0;n<i.length;n++)t.state[n]=i[n].clone()}function a(){var e,t=r();for(o(t),d[p.index+1]=t,d.length>p.maxSize?(d.splice(0,1),p.startCounter++):p.index++,p.counter=p.index+p.startCounter,e=0;e<m.length;e++)m[e].push();s(),p.length=d.length}function s(){var e;for(d.length=p.index+1,p.length=d.length,e=0;e<m.length;e++)m[e].invalidate(p.index)}function l(t){var n,r;for(e.restoreProperties(t.input),g||e.restoreParameters(t.parameters),r=t.state,n=0;n<r.length;n++)e.state[n].restore(r[n]);for(n=0;n<m.length;n++)m[n].extract(p.index)}function u(e){if(0>e)throw new Error("TickHistory: extract index ["+e+"] less than 0");if(e>=d.length)throw new Error("TickHistory: extract index ["+e+"] greater than list.length: "+d.length);return e}var c,d,p,h={},f=1e3,m=[],g=!!e.getProperties;return h.isEmpty=function(){return 0===p.index},h.push=function(){a()},h.returnTick=function(e){var t;return t="number"==typeof e?e:p.index,u(t),d[t]},h.extract=function(e){var t;t="number"==typeof e?e:p.index,u(t),l(d[t])},h.saveInitialState=function(){c=r(),o(c)},h.restoreInitialState=function(){i(),l(c),a()},h.reset=i,h.decrementExtract=function(){p.counter>p.startCounter&&(p.index--,p.counter--,l(d[p.index]))},h.incrementExtract=function(){p.index++,p.counter++,l(d[p.index])},h.seekExtract=function(e){e<p.startCounter&&(e=p.startCounter),e>=p.startCounter+p.length&&(e=p.startCounter+p.length-1),p.counter=e,p.index=e-p.startCounter,l(d[p.index])},h.invalidateFollowingState=s,h.get=function(e){return p[e]},h.set=function(e,t){return p[e]=t},h.registerExternalObject=function(e){e.setHistoryLength(p.maxSize),m.push(e)},null==n&&(n=f),i(),h}}),define("common/array-types",["require","arrays"],function(e){var t=e("arrays"),n=function(){if("undefined"==typeof navigator)return!0;var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),r=t.typed&&n;return{floatType:r?"Float64Array":"regular",int32Type:r?"Int32Array":"regular",int16Type:r?"Int16Array":"regular",int8Type:r?"Int8Array":"regular",uint16Type:r?"Uint16Array":"regular",uint8Type:r?"Uint8Array":"regular"}}),define("models/md2d/models/engine/constants/units",["require","exports","module"],function(e,t){var n,r,i,o=1.66054e-27,a=1.602177e-19,s=a,l=1e-15,u=1e-9,c=10,d=1e3,p={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"};t.unit=n={FEMTOSECOND:{name:"femtosecond",value:1,type:p.TIME},SECOND:{name:"second",value:l,type:p.TIME},NANOMETER:{name:"nanometer",value:1,type:p.LENGTH},ANGSTROM:{name:"Angstrom",value:1*c,type:p.LENGTH},METER:{name:"meter",value:1*u,type:p.LENGTH},DALTON:{name:"Dalton",value:1,type:p.MASS},GRAM:{name:"gram",value:1*o*d,type:p.MASS},KILOGRAM:{name:"kilogram",value:1*o,type:p.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:p.ENERGY},JOULE:{name:"Joule",value:o*u*u*(1/l)*(1/l),type:p.ENERGY},EV:{name:"electron volt",value:o*u*u*(1/l)*(1/l)*(1/s),type:p.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:p.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*s,type:p.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:p.CHARGE},COULOMB:{name:"Coulomb",value:a,type:p.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:p.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:p.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:p.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:p.FORCE},NEWTON:{name:"Newton",value:1*o*u*(1/l)*(1/l),type:p.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*o*u*u*(1/l)*(1/l)*(1/s),type:p.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:p.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*u*(1/l),type:p.VELOCITY}},t.ratio=r=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=i=function(e,t){var n=t&&t.from,i=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!i)throw new Error('units.convert() did not receive a "to" argument');return e*r(i,{per:n})}}),define("models/md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t){var n,r,i=e("./units"),o=i.unit,a=i.ratio,s=i.convert,l={ELEMENTARY_CHARGE:{value:1,unit:o.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:o.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:o.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:a(o.DALTON,{per:o.GRAM}),unit:o.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:o.FARADS_PER_METER}};l.COULOMB_CONSTANT={value:1/(4*Math.PI*l.PERMITTIVITY_OF_FREE_SPACE.value),unit:o.METERS_PER_FARAD},t.unit=o,t.ratio=a,t.convert=s;for(n in l)l.hasOwnProperty(n)&&(r=l[n],t[n]=function(e){return{as:function(t){return i.convert(e.value,{from:e.unit,to:t})}}}(r))}),define("models/md2d/models/aminoacids-props",[],function(){return[{fullName:"Alanine",abbreviation:"Ala",symbol:"A",molWeight:89.09,charge:0,hydrophobicityRB:2.15,pK:0,surface:115,volume:88.6,solubility:16.65,hydrophobicity:1,property:"Total aliphatic; hydrophobic"},{fullName:"Arginine",abbreviation:"Arg",symbol:"R",molWeight:174.2,charge:1,hydrophobicityRB:2.23,pK:12,surface:225,volume:173.4,solubility:15,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Asparagine",abbreviation:"Asn",symbol:"N",molWeight:132.12,charge:0,hydrophobicityRB:1.05,pK:0,surface:160,volume:114.1,solubility:3.53,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Asparticacid",abbreviation:"Asp",symbol:"D",molWeight:133.1,charge:-1,hydrophobicityRB:1.13,pK:4.4,surface:150,volume:111.1,solubility:.778,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Cysteine",abbreviation:"Cys",symbol:"C",molWeight:121.15,charge:0,hydrophobicityRB:1.2,pK:8.5,surface:135,volume:108.5,solubility:1e3,hydrophobicity:1,property:"Polar side chains; semipolar"},{fullName:"Glutamine",abbreviation:"Gln",symbol:"Q",molWeight:146.15,charge:0,hydrophobicityRB:1.65,pK:0,surface:180,volume:143.8,solubility:2.5,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Glutamicacid",abbreviation:"Glu",symbol:"E",molWeight:147.13,charge:-1,hydrophobicityRB:1.73,pK:4.4,surface:190,volume:138.4,solubility:.864,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Glycine",abbreviation:"Gly",symbol:"G",molWeight:75.07,charge:0,hydrophobicityRB:1.18,pK:0,surface:75,volume:60.1,solubility:24.99,hydrophobicity:1,property:"Semipolar"},{fullName:"Histidine",abbreviation:"His",symbol:"H",molWeight:155.16,charge:1,hydrophobicityRB:2.45,pK:6.5,surface:195,volume:153.2,solubility:4.19,hydrophobicity:-2,property:"Basic side chains; strongly polar; cationic"},{fullName:"Isoleucine",abbreviation:"Ile",symbol:"I",molWeight:131.17,charge:0,hydrophobicityRB:3.88,pK:0,surface:175,volume:166.7,solubility:4.117,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Leucine",abbreviation:"Leu",symbol:"L",molWeight:131.17,charge:0,hydrophobicityRB:4.1,pK:10,surface:170,volume:166.7,solubility:2.426,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Lysine",abbreviation:"Lys",symbol:"K",molWeight:146.19,charge:1,hydrophobicityRB:3.05,pK:0,surface:200,volume:168.6,solubility:1e3,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Methionine",abbreviation:"Met",symbol:"M",molWeight:149.21,charge:0,hydrophobicityRB:3.43,pK:0,surface:185,volume:162.9,solubility:3.81,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Phenylalanine",abbreviation:"Phe",symbol:"F",molWeight:165.19,charge:0,hydrophobicityRB:3.46,pK:0,surface:210,volume:189.9,solubility:2.965,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Proline",abbreviation:"Pro",symbol:"P",molWeight:115.13,charge:0,hydrophobicityRB:3.1,pK:0,surface:145,volume:112.7,solubility:162.3,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Serine",abbreviation:"Ser",symbol:"S",molWeight:105.09,charge:0,hydrophobicityRB:1.4,pK:0,surface:115,volume:89,solubility:5.023,hydrophobicity:-1,property:"Semipolar"},{fullName:"Threonine",abbreviation:"Thr",symbol:"T",molWeight:119.12,charge:0,hydrophobicityRB:2.25,pK:0,surface:140,volume:116.1,solubility:1e3,hydrophobicity:-1,property:"Semipolar"},{fullName:"Tryptophan",abbreviation:"Trp",symbol:"W",molWeight:204.23,charge:0,hydrophobicityRB:4.11,pK:0,surface:255,volume:227.8,solubility:1.136,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Tyrosine",abbreviation:"Tyr",symbol:"Y",molWeight:181.19,charge:0,hydrophobicityRB:2.81,pK:10,surface:230,volume:193.6,solubility:.045,hydrophobicity:1,property:"Hydrophobic; total aromatic"},{fullName:"Valine",abbreviation:"Val",symbol:"V",molWeight:117.15,charge:0,hydrophobicityRB:3.38,pK:0,surface:155,volume:140,solubility:8.85,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"}]}),function(){define("cs!models/md2d/models/aminoacids-helper",["require","models/md2d/models/aminoacids-props"],function(e){var t,n,r;return r=e("models/md2d/models/aminoacids-props"),t=5,n={UUU:"Phe",UUC:"Phe",UUA:"Leu",UUG:"Leu",CUU:"Leu",CUC:"Leu",CUA:"Leu",CUG:"Leu",AUU:"Ile",AUC:"Ile",AUA:"Ile",AUG:"Met",GUU:"Val",GUC:"Val",GUA:"Val",GUG:"Val",UCU:"Ser",UCC:"Ser",UCA:"Ser",UCG:"Ser",AGU:"Ser",AGC:"Ser",CCU:"Pro",CCC:"Pro",CCA:"Pro",CCG:"Pro",ACU:"Thr",ACC:"Thr",ACA:"Thr",ACG:"Thr",GCU:"Ala",GCC:"Ala",GCA:"Ala",GCG:"Ala",UAU:"Tyr",UAC:"Tyr",CAU:"His",CAC:"His",CAA:"Gln",CAG:"Gln",AAU:"Asn",AAC:"Asn",AAA:"Lys",AAG:"Lys",GAU:"Asp",GAC:"Asp",GAA:"Glu",GAG:"Glu",UGU:"Cys",UGC:"Cys",UGG:"Trp",CGU:"Arg",CGC:"Arg",CGA:"Arg",CGG:"Arg",AGA:"Arg",AGG:"Arg",GGU:"Gly",GGC:"Gly",GGA:"Gly",GGG:"Gly",UAA:"STOP",UAG:"STOP",UGA:"STOP"},{firstElementID:t,lastElementID:t+r.length-1,cysteineElement:9,abbrToElement:function(e){var t,n,i,o;for(n=i=0,o=r.length;o>i;n=++i)if(t=r[n],t.abbreviation===e)return n+this.firstElementID},getAminoAcidByElement:function(e){return r[e-this.firstElementID]},isAminoAcid:function(e){return e>=this.firstElementID&&e<=this.lastElementID},getPolarAminoAcids:function(){var e,t,n,r,i;for(r=["Asn","Gln","Ser","Thr"],i=[],t=0,n=r.length;n>t;t++)e=r[t],i.push(this.abbrToElement(e));return i},codonToAbbr:function(e){return 3!==e.length?"STOP":n[e]}}})}.call(this),define("models/md2d/models/engine/math/distributions",["require","exports","module"],function(e,t){t.normal=function(){var e=null;return function(t,n){null==t&&(t=0),null==n&&(n=1);var r,i,o,a,s;return e?(i=e,e=null,i):(a=Math.random(),s=Math.random(),o=2*Math.PI*a,r=Math.sqrt(-2*Math.log(s)),e=t+n*r*Math.sin(o),t+n*r*Math.cos(o))}}()}),define("models/md2d/models/engine/math/utils",["require","exports","module"],function(e,t){t.getWindowedAverager=function(e){null==e&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:0/0}},t.getAngleBetweenVec=function(e,t,n,r,i,o){var a=e-i,s=n-i,l=t-o,u=r-o,c=a*a+l*l,d=s*s+u*u,p=Math.sqrt(c),h=Math.sqrt(d),f=(a*s+l*u)/(p*h);return f>1?f=1:-1>f&&(f=-1),Math.acos(f)}}),define("models/md2d/models/engine/math/minimizer",["require","exports","module","common/console"],function(e,t){var n=e("common/console");t.minimize=function(e,t,r){r=r||{},null==r.precision&&(r.precision=.01);var i,o,a,s,l,u,c,d,p,h,f=r.precision,m=r.bounds,g=r.maxiter||1e3,v=r.stopval||-1/0,y=r.maxstep||.01,b=r.eps||.01,x=t.length;for(u=y*y,i=[],p=0;x>p;p++)i[p]=t[p];o=e.apply(null,i),a=o[0],l=o[1],d=0;do{if(v>=a)break;if(d>g)return n.log("maxiter reached"),{error:"maxiter reached",f:a,iter:g,x:i};for(c=0,p=0;x>p;p++)c+=l[p]*l[p];if(b*b*c>u)for(h=Math.sqrt(u/c)/b,p=0;x>p;p++)l[p]=h*l[p];for(p=0;x>p;p++)i[p]-=b*l[p],m&&i[p]<m[p][0]&&(i[p]=m[p][0]),m&&i[p]>m[p][1]&&(i[p]=m[p][1]);s=a,o=e.apply(null,i),a=o[0],l=o[1],d++}while(Math.abs(a-s)>f);return[a,i]}}),define("models/md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./utils","./minimizer"],function(e,t){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.getAngleBetweenVec=e("./utils").getAngleBetweenVec,t.minimize=e("./minimizer").minimize}),define("models/md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t){{var n=e("../constants/index"),r=n.unit,i=.346,o=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),a=n.ratio(r.NANOMETER,{per:r.METER}),s=Math.pow(n.ratio(r.COULOMB,{per:r.ELEMENTARY_CHARGE}),2),l=n.ratio(r.EV,{per:r.JOULE}),u=n.ratio(r.MW_FORCE_UNIT,{per:r.NEWTON}),c=i*o*s*a*l,d=i*o*s*a*a*u,p=(t.potential=function(e,t,n,r,i){return i&&r>1&&1.2>e&&(r=1+(r-1)/(1+Math.exp(-12*e+7))),c*(t*n/e)/r},t.forceFromSquaredDistance=function(e,t,n,r,i){var o=Math.sqrt(e);return i&&r>1&&1.2>o&&(r=1+(r-1)/(1+Math.exp(-12*o+7))),-d*(t*n/e)/r});t.forceOverDistanceFromSquaredDistance=function(e,t,n,r,i){return p(e,t,n,r,i)/Math.sqrt(e)},t.force=function(e,t,n,r,i){return p(e*e,t,n,r,i)}}}),define("models/md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t){var n=e("../constants/index"),r=n.unit,i=n.ratio(r.NANOMETER,{per:r.METER}),o=n.ratio(r.MW_FORCE_UNIT,{per:r.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,a){var s,l,u,c,d,p,h,f,m=!1,g=function(e,f){s=e,l=f,u=t.rmin(l),null!=s&&null!=l&&(c=4*s*Math.pow(l,12),d=4*s*Math.pow(l,6),p=12*n.convert(c,{from:r.EV,to:r.JOULE})*i*o,h=6*n.convert(d,{from:r.EV,to:r.JOULE})*i*o),m&&"function"==typeof a&&a(v(),this)},v=function(){return{epsilon:s,sigma:l,rmin:u}},y=function(e){if(null==e||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},b=function(e){if(null==e||parseFloat(e)!==e||0>=e)throw new Error("lennardJones: sigma value "+e+" is invalid")};return y(e.epsilon),b(e.sigma),g(e.epsilon,e.sigma),m=!0,f={getCoefficients:v,setEpsilon:function(e){y(e),g(e,l)},setSigma:function(e){b(e),g(s,e)},potentialFromSquaredDistance:function(e){return e?c*Math.pow(e,-6)-d*Math.pow(e,-3):-1/0},potential:function(e){return f.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return p*i-h*r},force:function(e){return e*f.forceOverDistanceFromSquaredDistance(e*e)}}}}),define("models/md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t){t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),define("models/md2d/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"md2d",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{serialize:!1},maxX:{serialize:!1},minY:{serialize:!1},maxY:{serialize:!1},width:{defaultValue:10,unitType:"length",immutable:!0},height:{defaultValue:10,unitType:"length",immutable:!0},unitsScheme:{defaultValue:"md2d"},lennardJonesForces:{defaultValue:!0,storeInTickHistory:!0},coulombForces:{defaultValue:!0,storeInTickHistory:!0},temperatureControl:{defaultValue:!1,storeInTickHistory:!0},targetTemperature:{defaultValue:300,unitType:"temperature",storeInTickHistory:!0},modelSampleRate:{defaultValue:"default"},gravitationalField:{defaultValue:!1,unitType:"acceleration",storeInTickHistory:!0},timeStep:{defaultValue:1,unitType:"time",storeInTickHistory:!0},dielectricConstant:{defaultValue:1},realisticDielectricEffect:{defaultValue:!0},solventForceFactor:{defaultValue:1.25},solventForceType:{defaultValue:0},additionalSolventForceMult:{defaultValue:4},additionalSolventForceThreshold:{defaultValue:10,unitType:"length"},polarAAEpsilon:{defaultValue:-2},viscosity:{defaultValue:1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},DNAState:{defaultValue:"dna"},DNA:{defaultValue:"",validate:function(e){if(/[agtc]/.test(e)&&(e=e.toUpperCase()),/[^AGTC]/.test(e))throw new Error("DNA code on sense strand can be defined using only A, G, T or C characters.");
return e}},DNAMutations:{defaultValue:!0},useQuantumDynamics:{defaultValue:!1},useChemicalReactions:{defaultValue:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0,storeInTickHistory:!0},markColor:{defaultValue:"#f8b500"},keShading:{defaultValue:!1,storeInTickHistory:!0},chargeShading:{defaultValue:!1,storeInTickHistory:!0},useThreeLetterCode:{defaultValue:!0},aminoAcidColorScheme:{defaultValue:"hydrophobicity"},showChargeSymbols:{defaultValue:!0},showVDWLines:{defaultValue:!1,storeInTickHistory:!0},VDWLinesCutoff:{defaultValue:"medium"},showVelocityVectors:{defaultValue:!1,storeInTickHistory:!0},showForceVectors:{defaultValue:!1,storeInTickHistory:!0},showElectricField:{defaultValue:!1,storeInTickHistory:!0},electricFieldDensity:{defaultValue:18,storeInTickHistory:!0},electricFieldColor:{defaultValue:"auto"},showAtomTrace:{storeInTickHistory:!0,defaultValue:!1},atomTraceId:{storeInTickHistory:!0,defaultValue:0},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},controlButtonStyle:{defaultValue:"video",serialize:!1},gridLines:{defaultValue:!1},atomNumbers:{defaultValue:!1},enableAtomTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},atomTraceColor:{defaultValue:"#6913c5"},velocityVectors:{defaultValue:{color:"#000",width:.01,length:2}},forceVectors:{defaultValue:{color:"#169C30",width:.01,length:2}},forceVectorsDirectionOnly:{defaultValue:!1}},atom:{x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},element:{defaultValue:0},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},ax:{defaultValue:0,unitType:"acceleration",serialize:!1},ay:{defaultValue:0,unitType:"acceleration",serialize:!1},charge:{defaultValue:0,unitType:"charge"},friction:{defaultValue:0,unitType:"dampingCoefficient"},radical:{defaultValue:0},visible:{defaultValue:1},pinned:{defaultValue:0},marked:{defaultValue:0},draggable:{defaultValue:0},radius:{readOnly:!0,unitType:"length",serialize:!1},px:{readOnly:!0,unitType:"momentum",serialize:!1},py:{readOnly:!0,unitType:"momentum",serialize:!1},speed:{readOnly:!0,unitType:"velocity",serialize:!1},mass:{readOnly:!0,unitType:"mass",serialize:!1},excitation:{},sharedElectrons:{}},element:{mass:{defaultValue:120,unitType:"mass"},sigma:{defaultValue:.3,unitType:"length"},epsilon:{defaultValue:-.1,unitType:"energy"},radius:{unitType:"length",readOnly:!0,serialize:!1},color:{defaultValue:-855310}},pairwiseLJProperties:{element1:{defaultValue:0},element2:{defaultValue:0},sigma:{unitType:"length"},epsilon:{unitType:"energy"}},obstacle:{width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},mass:{defaultValue:1/0,unitType:"mass"},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},externalAx:{defaultValue:0,unitType:"acceleration"},externalAy:{defaultValue:0,unitType:"acceleration"},displayExternalAcceleration:{defaultValue:!0},friction:{defaultValue:0,unitType:"inverseTime"},westProbe:{defaultValue:!1},westProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},northProbe:{defaultValue:!1},northProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},eastProbe:{defaultValue:!1},eastProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},southProbe:{defaultValue:!1},southProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},color:{defaultValue:"rgb(128,128,128)"},visible:{defaultValue:!0}},shape:{type:{defaultValue:"rectangle",required:!0},width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},fence:{defaultValue:0},color:{defaultValue:"transparent"},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},layerPosition:{defaultValue:1},visible:{defaultValue:1}},line:{x1:{defaultValue:0,required:!0,unitType:"length"},y1:{defaultValue:0,required:!0,unitType:"length"},x2:{defaultValue:0,required:!0,unitType:"length"},y2:{defaultValue:0,required:!0,unitType:"length"},beginStyle:{defaultValue:"none"},endStyle:{defaultValue:"none"},fence:{defaultValue:0},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},layerPosition:{defaultValue:1},visible:{defaultValue:1}},radialBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},length:{unitType:"length",required:!0},strength:{unitType:"stiffness",required:!0},type:{defaultValue:101}},angularBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},atom3:{defaultValue:0},strength:{unitType:"rotationalStiffness",required:!0},angle:{unitType:"angle",required:!0}},restraint:{atomIndex:{required:!0},k:{defaultValue:2e3,unitType:"stiffness"},x0:{defaultValue:0,unitType:"length"},y0:{defaultValue:0,unitType:"length"}},electricField:{intensity:{defaultValue:.004},orientation:{defaultValue:"E"},shapeIdx:{defaultValue:null}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},calloutPoint:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},strokeColor:{defaultValue:"#000000"},rotate:{defaultValue:0},fontSize:{defaultValue:.12},hostType:{},hostIndex:{},textAlign:{}},chemicalReactions:{createAngularBonds:{defaultValue:!0},noLoops:{defaultValue:!1},valenceElectrons:{defaultValue:[1,1,7,7]},bondEnergy:{defaultValue:{"default":6,"0-0":4,"1-1":4,"2-2":4,"3-3":4}},activationEnergy:{defaultValue:{"default":.2}},bondProbability:{defaultValue:{"default":[.8,.15,.05]},validate:function(e){return Object.keys(e).forEach(function(t){var n=e[t];if(Math.abs(n[0]+n[1]+n[2]-1)>.001)throw new Error("Bond type probability values should sum to one.")}),e}}},image:{imageUri:{required:!0},imageX:{defaultValue:0,required:!0},imageY:{defaultValue:0,required:!0},imageHostType:{defaultValue:""},imageHostIndex:{defaultValue:0},imageLayer:{defaultValue:1},imageLayerPosition:{defaultValue:1},visible:{defaultValue:!0}},quantumDynamics:{elementEnergyLevels:{defaultValue:[]},photons:{defaultValue:{}},radiationlessEmissionProbability:{defaultValue:1},lightSource:{}},photon:{x:{serialize:!0},y:{serialize:!0},vx:{defaultValue:0,serialize:!0},vy:{defaultValue:0,serialize:!0},angularFrequency:{serialize:!0}}}}),function(){var e={}.hasOwnProperty;define("cs!models/md2d/models/engine/pairwise-lj-properties",["require","models/md2d/models/metadata","common/validator"],function(t){var n,r,i;return r=t("models/md2d/models/metadata"),i=t("common/validator"),n=function(){function t(e){this._engine=e,this._data={}}return t.prototype.registerChangeHooks=function(e,t){return this._changePreHook=e,this._changePostHook=t},t.prototype.set=function(t,n,o){var a;o=i.validate(r.pairwiseLJProperties,o),this._changePreHook(),null==this._data[t]&&(this._data[t]={}),null==this._data[n]&&(this._data[n]={}),null==this._data[t][n]&&(this._data[t][n]=this._data[n][t]={});for(a in o)e.call(o,a)&&(this._data[t][n][a]=o[a]);return this._engine.setPairwiseLJProperties(t,n),this._changePostHook()},t.prototype.remove=function(e,t){return this._changePreHook(),delete this._data[e][t],delete this._data[t][e],this._engine.setPairwiseLJProperties(e,t),this._changePostHook()},t.prototype.get=function(e,t){return this._data[e]&&this._data[e][t]?this._data[e][t]:void 0},t.prototype.deserialize=function(e){var t,n,o,a,s;for(a=0,s=e.length;s>a;a++)o=e[a],o=i.validateCompleteness(r.pairwiseLJProperties,o),t=o.element1,n=o.element2,delete o.element1,delete o.element2,this.set(t,n,o)},t.prototype.serialize=function(){var t,n,r,i,o,a;o=[],a=this._data;for(n in a)if(e.call(a,n)){t=a[n];for(r in t)e.call(t,r)&&r>n&&(i=this.get(n,r),i.element1=Number(n),i.element2=Number(r),o.push(i))}return o},t.prototype.clone=function(){return $.extend(!0,{},this._data)},t.prototype.restore=function(t){var n,r,i,o;this._data=t,o=this._data;for(r in o)if(e.call(o,r)){n=o[r];for(i in n)e.call(n,i)&&i>r&&this._engine.setPairwiseLJProperties(r,i)}},t}()})}.call(this),define("common/models/engines/clone-restore-wrapper",["require","arrays"],function(e){var t=e("arrays");return function(e,n){n=n||{};var r={clone:function(){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=t.clone(e[n]));return r}};return r.restore=n.padArraysWithZeroes?function(n){var r,i,o,a;for(r in e)if(e.hasOwnProperty(r))for(i=e[r],t.copy(n[r],i),o=n[r].length,a=i.length;a>o;o++)i[o]=0}:function(n){var r;for(r in e)e.hasOwnProperty(r)&&t.copy(n[r],e[r])},r}}),define("models/md2d/models/engine/cell-list",[],function(){return function(e,t,n){var r,i,o,a,s,l=function(){var r;for(i=Math.ceil(e/n),o=Math.ceil(t/n),a=i*o,s=new Array(a),r=0;a>r;r++)s[r]=[]};return l(),r={reinitialize:function(r,i,o){var a=!1;void 0!==r&&r!==e&&(e=r,a=!0),void 0!==i&&i!==t&&(t=i,a=!0),void 0!==o&&o!==n&&(n=o,a=!0),a&&l()},addToCell:function(e,t,r){var o=Math.floor(r/n)*i+Math.floor(t/n);s[o].push(e)},getCell:function(e){return s[e]},getRowsNum:function(){return o},getColsNum:function(){return i},getNeighboringCells:function(e,t){var n=e*i+t,r=[];return i>t+1&&o>e+1&&r.push(s[n+i+1]),i>t+1&&r.push(s[n+1]),i>t+1&&e-1>=0&&r.push(s[n-i+1]),e-1>=0&&r.push(s[n-i]),r},clear:function(){var e;for(e=0;a>e;e++)s[e].length=0}}}}),define("models/md2d/models/engine/neighbor-list",["require","arrays","common/array-types"],function(e){var t=e("arrays"),n=e("common/array-types");return function(e,r){var i,o,a,s,l,u,c,d,p,h,f=function(){o=e+10,a=0,s=o*(o-1)/2,h=!0,l=t.create(s,0,n.int16Type),u=t.create(o,-1,n.int16Type),c=t.create(o,-1,n.int16Type),d=t.create(o,1/0,n.floatType),p=t.create(o,1/0,n.floatType)};return f(),i={reinitialize:function(t,n){e=t,r=n,h=!0,e>o&&f()},clear:function(){var t;for(a=0,t=0;e>t;t++)u[t]=c[t]=-1},getList:function(){return l},markNeighbors:function(e,t){u[e]<0&&(u[e]=a),l[a]=t,a++,c[e]=a},getStartIdxFor:function(e){return u[e]},getEndIdxFor:function(e){return c[e]},saveAtomPosition:function(e,t,n){d[e]=t,p[e]=n},invalidate:function(){h=!0},shouldUpdate:function(t,n){var i,o=-1/0,a=-1/0;if(h)return h=!1,!0;for(i=0;e>i;i++)Math.abs(t[i]-d[i])>o&&(o=Math.abs(t[i]-d[i])),Math.abs(n[i]-p[i])>a&&(a=Math.abs(n[i]-p[i]));return Math.sqrt(o*o+a*a)>r}}}}),define("common/models/plugin-controller",[],function(){return function(){var e=[];return{registerPlugin:function(t){e.push(t)},callPluginFunction:function(t,n,r){var i,o,a,s;for(i=0,o=e.length;o>i;i++)a=e[i][t],a&&(s=a.apply(e[i],n)),r&&r(s,i,e[i])}}}}),define("models/md2d/models/engine/utils",["require","arrays"],function(e){var t=e("arrays");return{extendArrays:function(e,n){var r,i;if(Array.isArray(e))for(r=0,i=e.length;i>r;r++)t.isArray(e[r])&&(e[r]=t.extend(e[r],n));else for(r in e)e.hasOwnProperty(r)&&t.isArray(e[r])&&(e[r]=t.extend(e[r],n))}}}),define("models/md2d/models/engine/md2d",["require","exports","module","arrays","common/array-types","common/console","./constants/index","cs!models/md2d/models/aminoacids-helper","./math/index","./potentials/index","./potentials/index","cs!./pairwise-lj-properties","common/models/engines/clone-restore-wrapper","./cell-list","./neighbor-list","common/models/plugin-controller","./utils"],function(e,t){var n=e("arrays"),r=e("common/array-types"),i=e("common/console"),o=e("./constants/index"),a=o.unit,s=e("cs!models/md2d/models/aminoacids-helper"),l=e("./math/index"),u=e("./potentials/index").coulomb,c=e("./potentials/index").lennardJones,d=e("cs!./pairwise-lj-properties"),p=e("common/models/engines/clone-restore-wrapper"),h=e("./cell-list"),f=e("./neighbor-list"),m=e("common/models/plugin-controller"),g=e("./utils"),v=o.BOLTZMANN_CONSTANT.as(a.JOULES_PER_KELVIN),y=function(e,t,n,r){return e*r-t*n},b=function(e,t){return e*e+t*t},x=function(e,t){if(0===t)return 0;var n=e/t,r=o.convert(n,{from:a.MW_ENERGY_UNIT,to:a.JOULE});return r/v},w=function(e,t){var n=e*v,r=o.convert(n,{from:a.JOULE,to:a.MW_ENERGY_UNIT}),i=r*t;return i},_=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(0>t)throw new Error("md2d: requested temperature "+t+" was less than zero");if(1/0===t)throw new Error("md2d: requested temperature was Infinity!")};t.createEngine=function(){var e,t,v,T,C,A,S,P,E,k,R,M,N,O,L,I,D,B,V,F,j,G,U,z,W,$,q,H,Y,X,J,K,Z,Q,et,tt,nt,rt,it,ot,at,st,lt,ut,ct,dt,pt,ht,ft,mt,gt,vt,yt,bt,xt,wt,_t,Tt,Ct,At,St,Pt,Et,kt,Rt,Mt,Nt,Ot,Lt,It,Dt,Bt,Vt,Ft,jt,Gt,Ut,zt,Wt,$t,qt,Ht,Yt,Xt,Jt,Kt,Zt,Qt,en,tn,nn,rn,on,an,sn,ln,un,cn,dn,pn,hn,fn,mn,gn,vn,yn,bn,xn,wn,_n,Tn,Cn,An,Sn,Pn,En,kn,Rn,Mn,Nn,On,Ln,In,Dn,Bn,Vn=!1,Fn=new m,jn=!1,Gn=1,Un=!0,zn=0,Wn=!1,$n=1,qn=25,Hn=3,Yn=!0,Xn=!1,Jn=1.67,Kn=!1,Zn=[10,10],Qn=0,er=0,tr=10,nr=10,rr=0,ir=0,or=0,ar=[],sr=0,lr=!1,ur=0,cr=0,dr=0,pr=0,hr=0,fr=0,mr=0,gr=2,vr=[],yr=2.5,br=[],xr=[],wr=[],_r=function(){Rr(0),Mr(0),Lr(0),Nr(0),Or(0),Ir(0),Dr(0),Br(0),Vr(0),Fr(0),jr(0),J=new d(e)},Tr=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},Cr=function(e,t){var n,r,i=$[e],o=$[t],a=q[e],s=q[t],l=J.get(e,t);n=l&&void 0!==l.epsilon?l.epsilon:c.pairwiseEpsilon(i,o),r=l&&void 0!==l.sigma?l.sigma:c.pairwiseSigma(a,s),vr[e][t]=vr[t][e]=gr*r*gr*r,br[e][t]=br[t][e]=yr*r*yr*r,xr[e][t]=xr[t][e]=c.newLJCalculator({epsilon:n,sigma:r},Tr)},Ar=function(){var e,t,n,r,i=0;for(n=0;or>n;n++)for(r=0;n>=r;r++)ar[n]&&ar[r]&&(e=J.get(n,r),t=e&&void 0!==e.sigma?e.sigma:c.pairwiseSigma(q[n],q[r]),yr*t>i&&(i=yr*t));return i||Math.max(Zn[0],Zn[1])},Sr=function(){var e,t,n,r,i=1/0;for(n=0;or>n;n++)for(r=0;n>=r;r++)ar[n]&&ar[r]&&(e=J.get(n,r),t=e&&void 0!==e.sigma?e.sigma:c.pairwiseSigma(q[n],q[r]),i>(yr-gr)*t&&(i=(yr-gr)*t));return i},Pr=function(){void 0===An?An=new h(Zn[0],Zn[1],Ar()):An.reinitialize(Zn[0],Zn[1],Ar())},Er=function(){void 0===Sn?Sn=new f(ir,Sr()):Sn.reinitialize(ir,Sr())},kr={atoms:function(){A=z.radius,S=z.px,P=z.py,E=z.x,k=z.y,R=z.vx,M=z.vy,N=z.speed,O=z.ax,L=z.ay,I=z.charge,B=z.friction,V=z.radical,D=z.element,F=z.pinned,j=z.mass,G=z.hydrophobicity,U=z.visited},radialBonds:function(){K=nt.atom1,Z=nt.atom2,Q=nt.length,et=nt.strength,tt=nt.type},restraints:function(){rt=st.atomIndex,it=st.k,ot=st.x0,at=st.y0},angularBonds:function(){lt=ht.atom1,ut=ht.atom2,ct=ht.atom3,dt=ht.angle,pt=ht.strength},elements:function(){W=X.mass,$=X.epsilon,q=X.sigma,H=X.radius,Y=X.color},obstacles:function(){ft=Dt.x,mt=Dt.y,gt=Dt.width,vt=Dt.height,Tt=Dt.mass,yt=Dt.vx,bt=Dt.vy,xt=Dt.externalAx,wt=Dt.externalAy,_t=Dt.friction,Ct=Dt.westProbe,At=Dt.northProbe,St=Dt.eastProbe,Pt=Dt.southProbe,Nt=Dt.westProbeValue,Ot=Dt.northProbeValue,Lt=Dt.eastProbeValue,It=Dt.southProbeValue,Rt=Dt.xPrev,Mt=Dt.yPrev,Et=Dt.color,kt=Dt.visible},shapes:function(){Bt=Jt.type,Vt=Jt.x,Ft=Jt.y,jt=Jt.width,Gt=Jt.height,Ut=Jt.fence,zt=Jt.color,Wt=Jt.lineColor,$t=Jt.lineDashes,qt=Jt.lineWeight,Ht=Jt.layer,Yt=Jt.layerPosition,Xt=Jt.visible},lines:function(){Kt=dn.x1,Zt=dn.y1,Qt=dn.x2,en=dn.y2,tn=dn.beginStyle,nn=dn.endStyle,rn=dn.fence,on=dn.lineColor,an=dn.lineDashes,sn=dn.lineWeight,ln=dn.layer,un=dn.layerPosition,cn=dn.visible},electricFields:function(){pn=mn.intensity,hn=mn.orientation,fn=mn.shapeIdx},springForces:function(){xn=Cn[0],wn=Cn[1],_n=Cn[2],Tn=Cn[3]},vdwPairs:function(){yn=gn.atom1,bn=gn.atom2}},Rr=function(t){X=e.elements={},X.mass=n.create(t,0,r.floatType),X.epsilon=n.create(t,0,r.floatType),X.sigma=n.create(t,0,r.floatType),X.radius=n.create(t,0,r.floatType),X.color=n.create(t,0,r.int32Type),kr.elements()},Mr=function(e){z={},z.radius=n.create(e,0,r.floatType),z.px=n.create(e,0,r.floatType),z.py=n.create(e,0,r.floatType),z.x=n.create(e,0,r.floatType),z.y=n.create(e,0,r.floatType),z.vx=n.create(e,0,r.floatType),z.vy=n.create(e,0,r.floatType),z.speed=n.create(e,0,r.floatType),z.ax=n.create(e,0,r.floatType),z.ay=n.create(e,0,r.floatType),z.charge=n.create(e,0,r.floatType),z.friction=n.create(e,0,r.floatType),z.radical=n.create(e,0,r.uint8Type),z.element=n.create(e,0,r.uint8Type),z.pinned=n.create(e,0,r.uint8Type),z.mass=n.create(e,0,r.floatType),z.hydrophobicity=n.create(e,0,r.int8Type),z.visited=n.create(e,0,r.uint8Type),z.marked=n.create(e,0,r.uint8Type),z.visible=n.create(e,0,r.uint8Type),z.draggable=n.create(e,0,r.uint8Type),kr.atoms()},Nr=function(t){nt=e.radialBonds={},nt.atom1=n.create(t,0,r.uint16Type),nt.atom2=n.create(t,0,r.uint16Type),nt.length=n.create(t,0,r.floatType),nt.strength=n.create(t,0,r.floatType),nt.type=n.create(t,0,r.uint8Type),kr.radialBonds()},Or=function(t){st=e.restraints={},st.atomIndex=n.create(t,0,r.uint16Type),st.k=n.create(t,0,r.floatType),st.x0=n.create(t,0,r.floatType),st.y0=n.create(t,0,r.floatType),kr.restraints()},Lr=function(t){ht=e.angularBonds={},ht.atom1=n.create(t,0,r.uint16Type),ht.atom2=n.create(t,0,r.uint16Type),ht.atom3=n.create(t,0,r.uint16Type),ht.angle=n.create(t,0,r.floatType),ht.strength=n.create(t,0,r.floatType),kr.angularBonds()},Ir=function(t){gn=e.vdwPairs={},gn.count=0,gn.atom1=n.create(t,0,r.uint16Type),gn.atom2=n.create(t,0,r.uint16Type)},Dr=function(t){Cn=e.springForces=[],Cn[0]=n.create(t,0,r.uint16Type),Cn[1]=n.create(t,0,r.floatType),Cn[2]=n.create(t,0,r.floatType),Cn[3]=n.create(t,0,r.floatType),kr.springForces()},Br=function(t){Dt=e.obstacles={},Dt.x=n.create(t,0,r.floatType),Dt.y=n.create(t,0,r.floatType),Dt.width=n.create(t,0,r.floatType),Dt.height=n.create(t,0,r.floatType),Dt.mass=n.create(t,0,r.floatType),Dt.vx=n.create(t,0,r.floatType),Dt.vy=n.create(t,0,r.floatType),Dt.externalAx=n.create(t,0,r.floatType),Dt.externalAy=n.create(t,0,r.floatType),Dt.friction=n.create(t,0,r.floatType),Dt.westProbe=n.create(t,0,r.uint8Type),Dt.northProbe=n.create(t,0,r.uint8Type),Dt.eastProbe=n.create(t,0,r.uint8Type),Dt.southProbe=n.create(t,0,r.uint8Type),Dt.westProbeValue=n.create(t,0,r.floatType),Dt.northProbeValue=n.create(t,0,r.floatType),Dt.eastProbeValue=n.create(t,0,r.floatType),Dt.southProbeValue=n.create(t,0,r.floatType),Dt.xPrev=n.create(t,0,r.floatType),Dt.yPrev=n.create(t,0,r.floatType),Dt.color=[],Dt.visible=n.create(t,0,r.uint8Type),Dt.displayExternalAcceleration=n.create(t,0,r.uint8Type),kr.obstacles()},Vr=function(t){Jt=e.shapes={},Jt.type=[],Jt.x=n.create(t,0,r.floatType),Jt.y=n.create(t,0,r.floatType),Jt.width=n.create(t,0,r.floatType),Jt.height=n.create(t,0,r.floatType),Jt.color=[],Jt.lineColor=[],Jt.lineDashes=[],Jt.lineWeight=n.create(t,0,r.floatType),Jt.layer=n.create(t,0,r.uint8Type),Jt.layerPosition=n.create(t,0,r.uint8Type),Jt.visible=n.create(t,0,r.uint8Type),Jt.fence=n.create(t,0,r.uint8Type),kr.shapes()},Fr=function(t){dn=e.lines={},dn.x1=n.create(t,0,r.floatType),dn.y1=n.create(t,0,r.floatType),dn.x2=n.create(t,0,r.floatType),dn.y2=n.create(t,0,r.floatType),dn.beginStyle=[],dn.endStyle=[],dn.lineColor=[],dn.lineDashes=[],dn.lineWeight=n.create(t,0,r.floatType),dn.layer=n.create(t,0,r.uint8Type),dn.layerPosition=n.create(t,0,r.uint8Type),dn.visible=n.create(t,0,r.uint8Type),dn.fence=n.create(t,0,r.uint8Type),kr.lines()},jr=function(t){mn=e.electricFields={},mn.intensity=n.create(t,0,r.floatType),mn.orientation=[],mn.shapeIdx=[],kr.electricFields()},Gr=function(){var e,t=0;for(e=0;ir>e;e++)t+=j[e]*(R[e]*R[e]+M[e]*M[e]);for(e=0;dr>e;e++)1/0!==Tt[e]&&(t+=Tt[e]*(yt[e]*yt[e]+bt[e]*bt[e]));return x(t/2,ir)},Ur=function(e){var t,n,r=0;for(t=0;t<e.length;t++)n=e[t],r+=j[n]*(R[n]*R[n]+M[n]*M[n]);return x(r/2,e.length)},zr=function(e,t,n){R[e]+=t,M[e]+=n,S[e]=R[e]*j[e],P[e]=M[e]*j[e]},Wr=function(e,t){R[e]-=t*(k[e]-kn),M[e]+=t*(E[e]-En),S[e]=R[e]*j[e],P[e]=M[e]*j[e]},$r=function(){for(var e=0;ir>e;e++)zr(e,-Nn,-On),Wr(e,-Dn)},qr=function(){var t,n=0,r=0,i=0,o=0,a=e.getTotalMass();for(t=0;ir>t;t++)n+=E[t],r+=k[t],i+=S[t],o+=P[t];En=n/ir,kn=r/ir,Rn=i,Mn=o,Nn=i/a,On=o/a},Hr=function(){var e,t,n=0,r=0;for(t=0;ir>t;t++)e=j[t],n+=e*y(E[t]-En,k[t]-kn,R[t]-Nn,M[t]-On),r+=e*b(E[t]-En,k[t]-kn);Ln=n,In=r,Dn=Ln/In},Yr=function(){qr(),Hr()},Xr=function(e){var t=0,n=0,r=Zn[0],i=Zn[1],o=r-gt[e],a=i-vt[e];if(ft[e]<t){for(;ft[e]<t-r;)ft[e]+=r;ft[e]=t+(t-ft[e]),yt[e]*=-1}else if(ft[e]>o){for(;ft[e]>o+r;)ft[e]-=r;ft[e]=o-(ft[e]-o),yt[e]*=-1}if(mt[e]<n){for(;mt[e]<n-i;)mt[e]+=i;mt[e]=n+(n-mt[e]),bt[e]*=-1}else if(mt[e]>a){for(;mt[e]>a+r;)mt[e]-=r;mt[e]=a-(mt[e]-a),bt[e]*=-1}},Jr=function(e){var t=A[e],n=t,r=t,i=Zn[0],o=Zn[1],a=i-t,s=o-t;if(E[e]<n){for(;E[e]<n-i;)E[e]+=i;E[e]=n+(n-E[e]),R[e]*=-1,S[e]*=-1}else if(E[e]>a){for(;E[e]>a+i;)E[e]-=i;E[e]=a-(E[e]-a),R[e]*=-1,S[e]*=-1}if(k[e]<r){for(;k[e]<r-o;)k[e]+=o;k[e]=r+(r-k[e]),M[e]*=-1,P[e]*=-1}else if(k[e]>s){for(;k[e]>s+o;)k[e]-=o;k[e]=s-(k[e]-s),M[e]*=-1,P[e]*=-1}},Kr=function(e,t,n,r){if(!(1>dr)){var i,o,a,s,l,u,c,d,p,h,f,m,g,v,y,b,x,w,_,T;for(i=A[e],o=E[e],a=k[e],s=0;dr>s;s++)l=ft[s]-i,u=ft[s]+gt[s]+i,c=mt[s]+vt[s]+i,d=mt[s]-i,p=Rt[s]-i,h=Rt[s]+gt[s]+i,f=Mt[s]+vt[s]+i,m=Mt[s]-i,T=0,o>l&&u>o&&a>d&&c>a&&(p>=t?(E[e]=l-(o-l),T=1):t>=h?(E[e]=u+(u-o),T=2):m>=n?(k[e]=d-(a-d),T=-1):n>=f&&(k[e]=c+(c-a),T=-2)),w=Tt[s],0!==T&&(1/0!==w?(x=j[e],_=w+x,T>0?(g=R[e],y=yt[s],R[e]=(g*(x-w)+2*w*y)/_,yt[s]=(y*(w-x)+2*S[e])/_):(v=M[e],b=bt[s],M[e]=(v*(x-w)+2*w*b)/_,bt[s]=(b*(w-x)+2*P[e])/_)):T>0?R[e]*=-1:M[e]*=-1,r&&(Ct[s]&&1===T?Nt[s]+=j[e]*((g?g:-R[e])-R[e]):St[s]&&2===T?Lt[s]+=j[e]*(R[e]-(g?g:-R[e])):Pt[s]&&-1===T?It[s]+=j[e]*((v?v:-M[e])-M[e]):At[s]&&-2===T&&(Ot[s]+=j[e]*(M[e]-(v?v:-M[e])))))}},Zr=function(e,t,n){if(!(1>pr)){var r,i,o,a,s,l,u,c,d,p,h,f,m,g,v,y,x,w,_,T,C,S,P,N,O,L,I,D,B,V,F,j,G,U,z,W;for(r=A[e],i=E[e],o=k[e],a=0;pr>a;a++)Ut[a]&&("rectangle"===Bt[a]?(d=Vt[a]-r,p=Vt[a]+jt[a]+r,h=Ft[a]+Gt[a]+r,f=Ft[a]-r,s=Vt[a]+r,l=Vt[a]+jt[a]-r,u=Ft[a]+Gt[a]-r,c=Ft[a]+r,i>d&&p>i&&o>f&&h>o&&(d>=t?(E[e]=d-(i-d),R[e]*=-1):t>=p?(E[e]=p+(p-i),R[e]*=-1):f>=n?(k[e]=f-(o-f),M[e]*=-1):n>=h&&(k[e]=h+(h-o),M[e]*=-1)),t>s&&l>t&&n>c&&u>n&&(s>=i?(E[e]=s+(s-i),R[e]*=-1):i>=l&&(E[e]=l-(i-l),R[e]*=-1),c>=o?(k[e]=c+(c-o),M[e]*=-1):o>=u&&(k[e]=u-(o-u),M[e]*=-1))):"ellipse"===Bt[a]&&(C=jt[a]/2,S=Gt[a]/2,m=Vt[a]+C,g=Ft[a]+S,v=(i-m)/(C+r),y=(o-g)/(S+r),v*=v,y*=y,x=(t-m)/(C+r),w=(n-g)/(S+r),x*=x,w*=w,_=(C+r)/(C-r),T=(S+r)/(S-r),_*=_,T*=T,(1>=v+y&&x+w>1||v*_+y*T>=1&&1>x*_+w*T)&&(jt[a]>Gt[a]?(P=Math.sqrt(C*C-S*S),N=Vt[a]+C+P,I=Vt[a]+C-P,O=D=Ft[a]+S):(P=Math.sqrt(S*S-C*C),N=I=Vt[a]+C,O=Ft[a]+S+P,D=Ft[a]+S-P),j=(i+t)/2,G=(o+n)/2,L=Math.sqrt(b(N-j,O-G)),B=Math.sqrt(b(I-j,I-j)),U=j-(N*B+I*L)/(L+B),z=G-(O*B+D*L)/(L+B),W=Math.sqrt(b(U,z)),U/=W,z/=W,E[e]=j-t-2*((j-t)*U+(G-n)*z)*U+j,k[e]=G-n-2*((j-t)*U+(G-n)*z)*z+G,V=R[e],F=M[e],R[e]=V-2*(V*U+F*z)*U,M[e]=F-2*(V*U+F*z)*z)))}},Qr=function(e,t,n){if(!(1>hr)){var r,i,o,a,s,l,u,c,d,p,h,f,m,g,v,x;for(r=A[e],v=E[e],x=k[e],g=0;hr>g;g++)rn[g]&&(s=y(t-Kt[g],n-Zt[g],v-Kt[g],x-Zt[g]),l=y(t-Qt[g],n-en[g],v-Qt[g],x-en[g]),0>s*l&&(i=Math.sqrt(b(Kt[g]-Qt[g],Zt[g]-en[g])),o=y(Qt[g]-t,en[g]-n,Kt[g]-t,Zt[g]-n),a=y(Qt[g]-v,en[g]-x,Kt[g]-v,Zt[g]-x),(0>o&&a>-r*i||o>0&&r*i>a)&&o*s>0&&(u=(v+t)/2,c=(x+n)/2,d=en[g]-Zt[g],p=-(Qt[g]-Kt[g]),h=Math.sqrt(b(d,p)),d/=h,p/=h,E[e]=u-t-2*((u-t)*d+(c-n)*p)*d+u,k[e]=c-n-2*((u-t)*d+(c-n)*p)*p+c,f=R[e],m=M[e],R[e]=f-2*(f*d+m*p)*d,M[e]=m-2*(f*d+m*p)*p)))}},ei=function(e,t){var n,r,i,o=D[e],a=D[t],s=E[t]-E[e],l=k[t]-k[e],u=b(s,l);Pn&&u<br[o][a]&&Sn.markNeighbors(e,t),Mi&&Mi[e]&&Mi[e][t]||u<vr[o][a]&&(n=xr[o][a].forceOverDistanceFromSquaredDistance(u),r=n*s,i=n*l,O[e]+=r,L[e]+=i,O[t]-=r,L[t]-=i)},ti=function(){Yn&&(Pn?(i.time("cell lists"),ni(),i.timeEnd("cell lists")):(i.time("neighbor list"),ri(),i.timeEnd("neighbor list")))},ni=function(){var e,t,n,r,i,o,a,s,l,u,c,d,p,h,f=An.getRowsNum(),m=An.getColsNum();for(e=0;f>e;e++)for(n=e*m,t=0;m>t;t++)for(r=n+t,i=An.getCell(r),h=An.getNeighboringCells(e,t),a=0,u=i.length;u>a;a++){for(l=i[a],s=0;a>s;s++)ei(l,i[s]);for(d=0,p=h.length;p>d;d++)for(o=h[d],s=0,c=o.length;c>s;s++)ei(l,o[s])}},ri=function(){var e,t,n,r,i=Sn.getList();for(e=0;ir>e;e++)for(n=Sn.getStartIdxFor(e),r=Sn.getEndIdxFor(e);r>n;n++)t=i[n],ei(e,t)},ii=function(){if(jn&&0!==Ri.length){var e,t,n,r,i,o,a,s,l,c,d,p,h;for(e=0,n=Ri.length;n>e;e++)for(d=Ri[e],c=I[d],h=Mi&&Mi[d],t=0;e>t;t++)p=Ri[t],h&&h[p]||(r=E[p]-E[d],i=k[p]-k[d],o=r*r+i*i,a=u.forceOverDistanceFromSquaredDistance(o,c,I[p],Gn,Un),s=a*r,l=a*i,O[d]+=s,L[d]+=l,O[p]-=s,L[p]-=l)}},oi=function(){if(v){var e,t;for(e=0;ir>e;e++)t=v*B[e],O[e]+=-R[e]*t,L[e]+=-M[e]*t}},ai=function(){if(!(1>sr)){var e,t,n,r,i,s,l,u,c,d,p,h;for(e=0;sr>e;e++)t=K[e],n=Z[e],r=E[n]-E[t],i=k[n]-k[t],s=r*r+i*i,l=Math.sqrt(s),u=et[e],c=Q[e],d=o.convert(u*(l-c),{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/l,p=d*r,h=d*i,O[t]+=p,L[t]+=h,O[n]-=p,L[n]-=h}},si=function(){if(!(1>cr)){var e,t,n,r,i,s,l,u,c,d,p,h,f,m,g,v,y,b,x,w,_,T,C;for(e=0;cr>e;e++)t=lt[e],n=ut[e],r=ct[e],m=dt[e],f=pt[e],i=E[t]-E[r],l=E[n]-E[r],s=k[t]-k[r],u=k[n]-k[r],c=i*i+s*s,d=l*l+u*u,p=Math.sqrt(c),h=Math.sqrt(d),v=(i*l+s*u)/(p*h),v>1?v=1:-1>v&&(v=-1),y=Math.sqrt(1-v*v),g=Math.acos(v),1e-4>y&&(y=1e-4),T=o.convert(f*(g-m)/(y*p),{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/h,C=i*l+s*u,b=T*(l-C*i/c),x=T*(u-C*s/c),w=T*(i-C*l/d),_=T*(s-C*u/d),O[t]+=b,L[t]+=x,O[n]+=w,L[n]+=_,O[r]-=b+w,L[r]-=x+_}},li=function(){if(!(1>ur)){var e,t,n,r,i,s,l,u,c,d;for(e=0;ur>e;e++)d=rt[e],t=ot[e]-E[d],n=at[e]-k[d],(0!==t||0!==n)&&(i=t*t+n*n,r=Math.sqrt(i),s=it[e],l=o.convert(s*r,{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/r,u=l*t,c=l*n,O[d]+=u,L[d]+=c)}},ui=function(){if(!(1>mr)){var e,t,n,r,i,s,l,u,c,d;for(e=0;mr>e;e++)d=xn[e],t=wn[e]-E[d],n=_n[e]-k[d],(0!==t||0!==n)&&(i=t*t+n*n,r=Math.sqrt(i),s=Tn[e],l=o.convert(s*r,{from:a.EV_PER_NM,to:a.MW_FORCE_UNIT})/r,u=l*t,c=l*n,O[d]+=u,L[d]+=c)}},ci=function(e){var t,n,r,i,o=0,a=0,s=0;for(r=0,i=e.length;i>r;r++)t=e[r],n=j[t],o+=E[t]*n,a+=k[t]*n,s+=n;return o/=s,a/=s,{x:o,y:a}},di=function(){if(!(0===zn||0===$n||2>ir)){var t,n,r,i,o,a,s,l,u,c,d,p,h;for(d=0;ir>d;d++)U[d]=0;for(i=6e-5*zn*$n,d=0;ir>d;d++)if(1!==U[d])for(t=e.getMoleculeAtoms(d),t.push(d),r=ci(t),p=0,h=t.length;h>p;p++)n=t[p],U[n]=1,0!==G[n]&&(o=E[n]-r.x,a=k[n]-r.y,s=Math.sqrt(o*o+a*a),s>0&&(c=G[n]*i,c>0&&Hn>s&&(c*=(1-qn)*s/Hn+qn),l=c*o/s,u=c*a/s,O[n]-=l,L[n]-=u))}},pi=function(){if(Kn){var e;for(e=0;ir>e;e++)L[e]-=Kn}},hi=function(e,t,n){var r=Vt[e],i=Ft[e];return t>=r&&t<=r+jt[e]&&n>=i&&n<=i+Gt[e]},fi=function(e){var t=hn[e];return("N"===t||"E"===t?1:-1)*pn[e]},mi=function(){if(mn){var e,t,n,r,i,o;for(t=0;fr>t;t++)for(n=hn[t],r="N"===n||"S"===n,o=fi(t)/Gn,i=fn[t],e=0;ir>e;e++)(null==i||hi(i,E[e],k[e]))&&(r?L[e]+=o*I[e]/j[e]:O[e]+=o*I[e]/j[e])}},gi=function(){if(Wn){var e,t;for(e=0;ir>e;e++)t=Math.min(1,2.2-k[e]),t>0&&(L[e]+=1e-4*t,O[e]-=3e-6)}},vi=function(){var e,t,r=s.cysteineElement;for(wr.length=0,t=0;ir>t;t++)D[t]===r&&wr.push(t);for(t=0;sr>t;t++)D[K[t]]===r&&D[Z[t]]===r&&(e=wr.indexOf(K[t]),-1!==e&&n.remove(wr,e),e=wr.indexOf(Z[t]),-1!==e&&n.remove(wr,e))},yi=function(){var e,t;if(0!==ir){for(e=0;ir>e;e++)O[e]=L[e]=0;if(Pn=Sn.shouldUpdate(E,k))for(An.clear(),Sn.clear(),e=0;ir>e;e++)An.addToCell(e,E[e],k[e]),Sn.saveAtomPosition(e,E[e],k[e]);for(i.time("short-range forces"),ti(),i.timeEnd("short-range forces"),i.time("long-range forces"),ii(),i.timeEnd("long-range forces"),ai(),si(),li(),ui(),oi(),di(),e=0;ir>e;e++)t=1/j[e],O[e]*=t,L[e]*=t;pi(),mi(),gi()}},bi=function(){var e,t;for(e=0;ir>e;e++)t=j[e],R[e]+=.5*O[e]*T,S[e]=t*R[e],M[e]+=.5*L[e]*T,P[e]=t*M[e]},xi=function(){var e,t,n,r=100*Zn[0],i=100*Zn[1];for(n=0;ir>n;n++){if(e=E[n],t=k[n],E[n]+=R[n]*T,k[n]+=M[n]*T,isNaN(E[n])||isNaN(k[n])||Math.abs(E[n])>r||Math.abs(k[n])>i)throw new Error("Model has diverged!");Jr(n),Kr(n,e,t,!0),Zr(n,e,t),Qr(n,e,t)}},wi=function(){var e;for(e=0;ir>e;e++)F[e]&&(R[e]=M[e]=O[e]=L[e]=0)},_i=function(){var e;for(e=0;ir>e;e++)N[e]=Math.sqrt(R[e]*R[e]+M[e]*M[e])},Ti=function(){var e,t,n,r,i,o,a,s;for(s=0;dr>s;s++)1/0!==Tt[s]&&(n=yt[s],r=bt[s],o=xt[s],a=wt[s],(n||r||o||a||Kn)&&(i=v*_t[s],e=o-i*n,t=a-i*r-Kn,Rt[s]=ft[s],Mt[s]=mt[s],ft[s]+=n*T+.5*e*C,mt[s]+=r*T+.5*t*C,yt[s]+=e*T,bt[s]+=t*T,Xr(s)))},Ci=function(){var t,n,r,i,o,a,s,l;for(a=0;ir>a;a++)U[a]=0;for(a=0;ir>a;a++)if(1!==U[a]&&(t=e.getMoleculeAtoms(a),0!==t.length)){for(t.push(a),r=i=o=0,s=0,l=t.length;l>s;s++)n=t[s],U[n]=1,F[n]||(r+=R[n]*j[n],i+=M[n]*j[n],o+=j[n]);for(o=1/o,s=0,l=t.length;l>s;s++)n=t[s],F[n]||(R[n]-=r*o,M[n]-=i*o,S[n]=R[n]*j[n],P[n]=M[n]*j[n])}},Ai=function(e,n){var r,i;if(null==e&&(e=t),Bn=Gr(),0===Bn){for(i=0;ir>i;i++)F[i]===!1&&(R[i]=.02*Math.random()-.01,M[i]=.02*Math.random()-.01);if(Bn=Gr(),0===Bn)return}if(n||Xn&&Bn>0){for(r=Math.sqrt(e/Bn),i=0;ir>i;i++)R[i]*=r,M[i]*=r,S[i]*=r,P[i]*=r;for(i=0;dr>i;i++)yt[i]*=r,bt[i]*=r;Bn=e}},Si=function(){var t,r,i,o,a,s,l,u;for(s=0,u=wr.length;u>s;s++)for(t=wr[s],l=s+1;u>l;l++)r=wr[l],i=E[t]-E[r],o=k[t]-k[r],a=i*i+o*o,.07>a&&(e.addRadialBond({atom1:t,atom2:r,length:Math.sqrt(a),strength:1e4,type:109}),n.remove(wr,s),n.remove(wr,l),u=wr.length,t=wr[s],l=s+1)},Pi=function(){var e;for(e=0;dr>e;e++)At[e]&&(Ot[e]=0),Pt[e]&&(It[e]=0),St[e]&&(Lt[e]=0),Ct[e]&&(Nt[e]=0)},Ei=function(e){var t,n;for(t=13888.89/e,n=0;dr>n;n++)At[n]&&(Ot[n]*=t/gt[n]),Pt[n]&&(It[n]*=t/gt[n]),St[n]&&(Lt[n]*=t/vt[n]),Ct[n]&&(Nt[n]*=t/vt[n])},ki=function(t,n,r){var i;for(i=0;cr>i;)lt[i]===t&&ct[i]===n||lt[i]===n&&ct[i]===t||ut[i]===t&&ct[i]===n||ut[i]===n&&ct[i]===t?e.removeAngularBond(i,r):i++},Ri=[];Ri.reset=function(){var e,t=0;for(e=0;ir>e;e++)z.charge[e]&&(this[t++]=e);this.length=t};var Mi=[];Mi.reset=function(){var e,t,n;for(this.length=0,e=0;sr>e;e++)t=K[e],n=Z[e],this[t]=this[t]||[],this[t][n]=!0,this[n]=this[n]||[],this[n][t]=!0};var Ni=[];return Ni.reset=function(){var e,t,n;for(this.length=0,e=0;sr>e;e++)t=K[e],n=Z[e],this[t]=this[t]||[],this[t].push(n),this[n]=this[n]||[],this[n].push(t)},Ni.unset=function(e,t){if(this[e]){var n=this[t].indexOf(e),r=this[e].indexOf(t);-1!==n&&(this[e].splice(r,1),this[t].splice(n,1))}},Ni.set=function(e,t){null==this[e]&&(this[e]=[]),null==this[t]&&(this[t]=[]),this[e].push(t),this[t].push(e)},e={addPlugin:function(e){e.initialize&&e.initialize({atoms:z,elements:X,radialBonds:nt,angularBonds:ht}),Fn.registerPlugin(e)},useCoulombInteraction:function(e){jn=!!e},useLennardJonesInteraction:function(e){Yn=!!e},useThermostat:function(e){Xn=!!e},setVDWLinesRatio:function(e){"number"==typeof e&&0!==e&&(Jn=e)},setGravitationalField:function(e){Kn="number"==typeof e&&0!==e?e:!1},setTemperatureOfAtoms:function(t,n){var r,i,o,a,s,l,u,c,d,p=t.length;for(s=1e-4*(Ur(t)||n),l=w(s,1),r=0;p>r;r++)i=t[r],F[i]||0!==R[i]||0!==M[i]||(o=Math.random()-.5,a=Math.random()-.5,c=Math.sqrt(2*l/j[i]/(o*o+a*a)),R[i]=o*c,M[i]=a*c);for(Bn=Gr(),d=Ur(t),u=Math.sqrt(n/d),r=0;p>r;r++)i=t[r],e.setAtomProperties(i,{vx:R[i]*u,vy:M[i]*u})},getTemperatureOfAtoms:function(e){return Ur(e)},setTargetTemperature:function(e){_(e),t=e},setDielectricConstant:function(e){Gn=e},setRealisticDielectricEffect:function(e){Un=e},setSolventForceType:function(e){zn=e},setDNAState:function(e){Wn=0===e.indexOf("translation:")},setSolventForceFactor:function(e){$n=e},setAdditionalSolventForceMult:function(e){qn=e},setAdditionalSolventForceThreshold:function(e){Hn=e},setTime:function(e){rr=e},setDimensions:function(e){if(Vn)throw new Error("The molecular model's size has already been set, and cannot be reset.");Qn=e[0],er=e[1],tr=e[2],nr=e[3],Zn=[tr-Qn,nr-er],Vn=!0},getDimensions:function(){return[Qn,er,tr,nr]},getLJCalculator:function(){return xr},setAtomProperties:function(t,n){var r,i,o,a=s.cysteineElement;if(void 0!==n.element){if(n.element<0||n.element>=or)throw new Error("md2d: Unknown element "+n.element+", an atom can't be created.");if(D[t]===a&&n.element!==a)for(o=0;sr>o;o++)if((K[o]===t||Z[o]===t)&&109===tt[o]){e.removeRadialBond(o);
break}ar[n.element]=!0,n.mass=W[n.element],n.radius=H[n.element],s.isAminoAcid(n.element)&&(i=s.getAminoAcidByElement(n.element),n.charge=i.charge,n.hydrophobicity=i.hydrophobicity)}!I[t]&&n.charge?Ri.push(t):I[t]&&0===n.charge&&Ri.splice(Ri.indexOf(t),1);for(r in n)n.hasOwnProperty(r)&&(z[r][t]=n[r]);S[t]=R[t]*j[t],P[t]=M[t]*j[t],N[t]=Math.sqrt(R[t]*R[t]+M[t]*M[t])},setRadialBondProperties:function(e,t,n){var r,i,o;i=K[e],o=Z[e],Mi[i]&&Mi[i][o]&&(Mi[i][o]=!1),Mi[o]&&Mi[o][i]&&(Mi[o][i]=!1),Ni.unset(i,o),(void 0!==t.atom1&&t.atom1!==i||void 0!==t.atom2&&t.atom2!==o)&&ki(i,o,n);for(r in t)t.hasOwnProperty(r)&&(nt[r][e]=t[r]);i=K[e],o=Z[e],Mi[i]||(Mi[i]=[]),Mi[i][o]=!0,Mi[o]||(Mi[o]=[]),Mi[o][i]=!0,Ni.set(i,o)},setAngularBondProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(ht[n][e]=t[n])},setRestraintProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(st[n][e]=t[n])},setElementProperties:function(e,t){var n,r;if(null!=t.mass&&t.mass!==W[e])for(W[e]=t.mass,n=0;ir>n;n++)D[n]===e&&(j[n]=t.mass);if(null!=t.sigma&&(q[e]=t.sigma,r=c.radius(t.sigma),H[e]!==r))for(H[e]=r,n=0;ir>n;n++)D[n]===e&&(A[n]=r);for(null!=t.epsilon&&($[e]=t.epsilon),null!=t.color&&(Y[e]=t.color),n=0;or>n;n++)Cr(e,n);Pr(),Er()},setPairwiseLJProperties:function(e,t){Cr(e,t),Pr(),Er()},setObstacleProperties:function(t,n){var r;if(!e.canPlaceObstacle(n.x,n.y,n.width,n.height,t))throw new Error("Obstacle can't be placed at "+n.x+", "+n.y);void 0!==n.x&&(n.xPrev=n.x),void 0!==n.y&&(n.yPrev=n.y),"string"==typeof n.mass&&(n.mass=parseFloat(n.mass));for(r in n)n.hasOwnProperty(r)&&(Dt[r][t]=n[r])},setShapeProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Jt[n][e]=t[n])},setLineProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(dn[n][e]=t[n])},setElectricFieldProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(mn[n][e]=t[n])},addAtom:function(t){ir+1>z.x.length&&(g.extendArrays(z,Math.round(1.5*ir+10)),kr.atoms()),t.ax=t.ay=0,I[ir]=0,e.setAtomProperties(ir,t),ir++,Pr(),Er()},removeAtom:function(t){var r,i,o,a,s,l;if(t>=ir)throw new Error("Atom "+t+" doesn't exist, so it can't be removed.");for(r=0;sr>r;)K[r]===t||Z[r]===t?e.removeRadialBond(r):r++;for(r=Ri.indexOf(t),-1!==r&&n.remove(Ri,r),r=t;ir>r;r++)for(o in z)z.hasOwnProperty(o)&&(z[o][r]=r===ir-1?0:z[o][r+1]);for(ir--,l=[Ri,K,Z,lt,ut,ct],a=0;a<l.length;a++)for(s=l[a],r=0,i=s.length;i>r;r++)s[r]>t&&s[r]--;Mi.reset(),Ni.reset(),Pr(),Er(),Sn.invalidate(),yi()},addElement:function(e){var t;for(or>=$.length&&(g.extendArrays(X,or+10),kr.elements()),W[or]=e.mass,$[or]=e.epsilon,q[or]=e.sigma,H[or]=c.radius(e.sigma),Y[or]=e.color,xr[or]=[],vr[or]=[],br[or]=[],t=0;or>=t;t++)Cr(or,t);or++},addRadialBond:function(t){sr+1>K.length&&(g.extendArrays(nt,sr+10),kr.radialBonds()),sr++,e.setRadialBondProperties(sr-1,t),lr=!0},removeRadialBond:function(e,t){var n,r;if(e>=sr)throw new Error("Radial bond "+e+" doesn't exist, so it can't be removed.");for(ki(K[e],Z[e],t),Ni.unset(K[e],Z[e]),n=e;sr>n;n++)for(r in nt)nt.hasOwnProperty(r)&&(nt[r][n]=n===sr-1?0:nt[r][n+1]);sr--,Mi.reset(),lr=!0},addRestraint:function(t){ur+1>st.atomIndex.length&&(g.extendArrays(st,ur+10),kr.restraints()),ur++,e.setRestraintProperties(ur-1,t)},addAngularBond:function(t){cr+1>ht.atom1.length&&(g.extendArrays(ht,cr+10),kr.angularBonds()),cr++,e.setAngularBondProperties(cr-1,t)},removeAngularBond:function(t,n){var r,i,o,a,s,u;if(t>=cr)throw new Error("Angular bond "+t+" doesn't exist, so it can't be removed.");for(n&&(o=lt[t],a=ut[t],s=ct[t],u=dt[t]-l.getAngleBetweenVec(E[o],k[o],E[a],k[a],E[s],k[s]),e.addKEToAtoms(.5*pt[t]*u*u,o,a,s)),r=t;cr>r;r++)for(i in ht)ht.hasOwnProperty(i)&&(ht[i][r]=r===cr-1?0:ht[i][r+1]);cr--},addSpringForce:function(e,t,n,r){return mr+1>Cn[0].length&&(g.extendArrays(Cn,mr+1),kr.springForces()),xn[mr]=e,wn[mr]=t,_n[mr]=n,Tn[mr]=r,mr++},updateSpringForce:function(e,t,n){wn[e]=t,_n[e]=n},removeSpringForce:function(e){var t,n;if(e>=mr)throw new Error("Spring force "+e+" doesn't exist, so it can't be removed.");for(mr--,t=e;mr>t;t++)for(n=0;4>n;n++)Cn[n][t]=Cn[n][t+1]},springForceAtomIndex:function(e){return xn[e]},addObstacle:function(t){if(!e.canPlaceObstacle(t.x,t.y,t.width,t.height))throw new Error("Obstacle can't be placed at "+t.x+", "+t.y+".");dr+1>Dt.x.length&&(g.extendArrays(Dt,dr+1),kr.obstacles()),dr++,e.setObstacleProperties(dr-1,t)},removeObstacle:function(e){var t,n;if(e>=dr)throw new Error("Obstacle "+e+" doesn't exist, so it can't be removed.");for(dr--,t=e;dr>t;t++)for(n in Dt)Dt.hasOwnProperty(n)&&(Dt[n][t]=Dt[n][t+1]);g.extendArrays(Dt,dr),kr.obstacles()},addShape:function(t){pr+1>Jt.x.length&&(g.extendArrays(Jt,pr+1),kr.shapes()),pr++,e.setShapeProperties(pr-1,t)},removeShape:function(t){var n,r;if(t>=pr)throw new Error("Shape "+t+" doesn't exist, so it can't be removed.");for(n=0;fr>n;)fn[n]===t?e.removeElectricField(n):n++;for(pr--,n=t;pr>n;n++)for(r in Jt)Jt.hasOwnProperty(r)&&(Jt[r][n]=Jt[r][n+1]);for(n=0;fr>n;n++)fn[n]>t&&fn[n]--;g.extendArrays(Jt,pr),kr.shapes()},addLine:function(t){hr+1>dn.x1.length&&(g.extendArrays(dn,hr+1),kr.lines()),hr++,e.setLineProperties(hr-1,t)},removeLine:function(e){var t,n;if(e>=hr)throw new Error("Line "+e+" doesn't exist, so it can't be removed.");for(t=e;hr>t;t++)for(n in dn)dn.hasOwnProperty(n)&&(dn[n][t]=dn[n][t+1]);hr--,g.extendArrays(dn,hr),kr.lines()},addElectricField:function(t){fr+1>mn.intensity.length&&(g.extendArrays(mn,fr+1),kr.electricFields()),fr++,e.setElectricFieldProperties(fr-1,t)},removeElectricField:function(e){var t,n;if(e>=fr)throw new Error("Electric field "+e+" doesn't exist, so it can't be removed.");for(fr--,t=e;fr>t;t++)for(n in mn)mn.hasOwnProperty(n)&&(mn[n][t]=mn[n][t+1]);g.extendArrays(mn,fr),kr.electricFields()},atomInBounds:function(e,t,n){var r,i=A[n];if(i>e||e>Zn[0]-i||i>t||t>Zn[1]-i)return!1;for(r=0;dr>r;r++)if(e>ft[r]-i&&e<ft[r]+gt[r]+i&&t>mt[r]-i&&t<mt[r]+vt[r]+i)return!1;return!0},canPlaceAtom:function(t,n,r,i){var o,a,s,l,u,c,d,p;if(!e.atomInBounds(n,r,i))return!1;for(p=0;dr>p;p++)if(l=ft[p],u=mt[p],c=l+gt[p],d=u+vt[p],n>l&&c>n&&r>u&&d>r)return!1;return"number"==typeof i&&(o=E[i],a=k[i],E[i]=k[i]=1/0),s=e.newPotentialCalculator(t,0,!1)(n,r),"number"==typeof i&&(E[i]=o,k[i]=a),0>=s},canPlaceObstacle:function(e,t,n,r,i){var o,a,s,l,u,c,d=e+n,p=t+r;if(0>e||d>Zn[0]||0>t||p>Zn[0])return!1;for(c=0;ir>c;c++)if(u=A[c],E[c]>e-u&&E[c]<d+u&&k[c]>t-u&&k[c]<p+u)return!1;for(c=0;dr>c;c++)if((void 0===i||i!==c)&&(o=ft[c],a=mt[c],s=o+gt[c],l=a+vt[c],d>o&&s>e&&p>a&&l>t))return!1;return!0},setupAtomsRandomly:function(t){var n,r,i,o,a,s,u,c,d=t.temperature||100,p=Math.floor(Math.sqrt(ir)),h=Math.ceil(ir/p);for(_(d),a=Zn[0]/(1+h),o=Zn[1]/(1+p),n=-1,r=1;p>=r;r++)for(i=1;h>=i&&(n++,n!==ir);i++)s=l.normal(1,.25),u=2*Math.random()*Math.PI,c={element:Math.floor(Math.random()*t.userElements),x:i*a,y:r*o,vx:s*Math.cos(u),vy:s*Math.sin(u),charge:2*(n%2)-1},e.setAtomProperties(n,c);Yr(),$r(),Ai(d,!0)},getVdwPairsArray:function(){var e,t,n,r,i,o,a,s,l,u,c,d,p,h,f,m=Jn*Jn;for(vn=0,e=0;ir>e;e++)for(d=D[e],s=q[d],l=q[d],o=E[e],a=k[e],t=e+1;ir>t;t++)0!==sr&&Mi[e]&&Mi[e][t]||(p=D[t],u=q[p],c=q[p],I[e]*I[t]<=0&&(n=E[t]-o,r=k[t]-a,i=n*n+r*r,h=.5*(s+u),h*=h,f=l*c,h*m>i&&f>0&&(vn+1>gn.atom1.length&&(g.extendArrays(gn,2*(vn+1)),kr.vdwPairs()),yn[vn]=e,bn[vn]=t,vn++)));return gn.count=vn,gn},integrate:function(e,t){var n,r,i=rr;for(void 0===e&&(e=100),void 0===t&&(t=1),T=t,C=T*T,lr=!1,vi(),0===rr&&yi(),n=Math.floor(e/T),Pi(),r=1;n>=r;r++)rr=i+r*T,bi(),xi(),yi(),wi(),bi(),_i(),Ti(),0===zn||Wn||Ci(),Fn.callPluginFunction("performActionWithinIntegrationLoop",[Sn,T,rr]),Ai();Ei(e),Si()},updateParticlesAccelerations:yi,minimizeEnergy:function(){var e,t,n,r,i,o,a=.001,s=1e-4,l=3e3;for(yi(),wi(),e=0,i=0;ir>i;i++)e<Math.abs(O[i])&&(e=Math.abs(O[i])),e<Math.abs(L[i])&&(e=Math.abs(L[i]));for(o=0;e>s&&l>o;){for(o++,t=a/e,i=0;ir>i;i++)n=E[i],r=k[i],E[i]+=O[i]*t,k[i]+=L[i]*t,Jr(i),Kr(i,n,r,!1),Zr(i,n,r),Qr(i,n,r);for(yi(),wi(),e=0,i=0;ir>i;i++)e<Math.abs(O[i])&&(e=Math.abs(O[i])),e<Math.abs(L[i])&&(e=Math.abs(L[i]))}},getRadialBondsForAtom:function(e){var t,n,r,i=[];for(t=0;sr>t;t++)n=K[t],r=Z[t],(e===n||e===r)&&i.push(t);return i},getAngularBondsForAtom:function(e){var t,n,r,i,o=[];for(t=0;cr>t;t++)n=lt[t],r=ut[t],i=ct[t],(e===n||e===r||e===i)&&o.push(t);return o},getTotalMass:function(){var e,t=0;for(e=0;ir>e;e++)t+=j[e];return t},getRadiusOfElement:function(e){return H[e]},getNumberOfAtoms:function(){return ir},getNumberOfElements:function(){return or},getNumberOfObstacles:function(){return dr},getNumberOfShapes:function(){return pr},getNumberOfLines:function(){return hr},getNumberOfRadialBonds:function(){return sr},getNumberOfAngularBonds:function(){return cr},getNumberOfRestraints:function(){return ur},getNumberOfSpringForces:function(){return mr},getNumberOfElectricFields:function(){return fr},computeOutputState:function(e){var t,n,r,i,s,l,c,d,p,h,f,m,g,v,y,b,w,_,T,C,A,S,P,N,O,L,B;for(B=0,L=0,t=0;ir>t;t++){for(Kn&&(O=j[t]*Kn*k[t],B+=o.convert(O,{from:a.MW_ENERGY_UNIT,to:a.EV})),r=0;fr>r;r++)if(w=fn[r],null==w||hi(w,E[t],k[t])){switch(N=I[t]*fi(r),hn[r]){case"N":case"S":N*=(null!=w?Ft[w]:er)-k[t];break;case"W":case"E":N*=(null!=w?Vt[w]:Qn)-E[t]}B+=o.convert(N,{from:a.MW_ENERGY_UNIT,to:a.EV})}for(L+=.5*j[t]*(R[t]*R[t]+M[t]*M[t]),n=t+1;ir>n;n++)p=E[n]-E[t],h=k[n]-k[t],_=p*p+h*h,Yn&&(B-=xr[D[t]][D[n]].potentialFromSquaredDistance(_)),jn&&Ri.length>0&&(B+=u.potential(Math.sqrt(_),I[t],I[n],Gn,Un))}for(t=0;sr>t;t++)i=K[t],s=Z[t],c=D[i],d=D[s],p=E[s]-E[i],h=k[s]-k[i],_=p*p+h*h,A=et[t],S=Math.sqrt(_)-Q[t],B+=.5*A*S*S,Yn&&(B+=xr[c][d].potentialFromSquaredDistance(_)),jn&&I[i]&&I[s]&&(B-=u.potential(Math.sqrt(_),I[i],I[s],Gn,Un));for(t=0;cr>t;t++)i=lt[t],s=ut[t],l=ct[t],f=E[i]-E[l],g=E[s]-E[l],m=k[i]-k[l],v=k[s]-k[l],T=Math.sqrt(f*f+m*m),C=Math.sqrt(g*g+v*v),y=(f*g+m*v)/(T*C),y>1?y=1:-1>y&&(y=-1),b=Math.acos(y),P=b-dt[t],B+=.5*pt[t]*P*P;for(t=0;ur>t;t++)i=rt[t],c=D[i],p=ot[t]-E[i],h=at[t]-k[i],_=p*p+h*h,A=it[t],S=Math.sqrt(_),B+=.5*A*S*S;for(t=0;dr>t;t++)1/0!==Tt[t]&&(Kn&&(O=Tt[t]*Kn*mt[t],B+=o.convert(O,{from:a.MW_ENERGY_UNIT,to:a.EV})),L+=.5*Tt[t]*(yt[t]*yt[t]+bt[t]*bt[t]));Bn=x(L,ir),e.time=rr,e.PE=B,e.KE=o.convert(L,{from:a.MW_ENERGY_UNIT,to:a.EV}),e.temperature=Bn,e.pCM=[Rn,Mn],e.CM=[En,kn],e.vCM=[Nn,On],e.omega_CM=Dn,e.atoms=z,e.radialBonds=nt,Fn.callPluginFunction("processOutputState",[e])},newPotentialCalculator:function(e,t,n){return function(r,i){var s,l,c,d,p,h,f,m,g,v=0,y=0,b=0,x=xr[e];for(c=0;ir>c;c++)d=r-E[c],p=i-k[c],h=d*d+p*p,m=0,Yn&&(g=x[D[c]],v+=-g.potentialFromSquaredDistance(h,e,D[c]),n&&(m+=g.forceOverDistanceFromSquaredDistance(h))),jn&&Ri.length>0&&t&&(f=Math.sqrt(h),v+=-u.potential(f,t,I[c],Gn,Un),n&&(m+=u.forceOverDistanceFromSquaredDistance(h,t,I[c],Gn,Un))),m&&(y+=m*d,b+=m*p);return n?(s=o.convert(y,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),l=o.convert(b,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),[v,[s,l]]):v}},addKEToAtoms:function(t){var n,r,i,o,a,s=Array.prototype.slice.call(arguments,1),l=0;if(0===s.length)for(i=0;ir>i;i++)s.push(i);for(i=0,o=s.length;o>i;i++)l+=e.getAtomKineticEnergy(s[i]);if(n=l+t,0>=n)return!1;for(0===l&&(a=s[0],R[a]=2*Math.random()-1e-5,M[a]=2*Math.random()-1e-5,l=e.getAtomKineticEnergy(a)),r=Math.sqrt(n/l),i=0,o=s.length;o>i;i++)a=s[i],R[a]*=r,M[a]*=r,S[a]*=r,P[a]*=r;return!0},findMinimumPELocation:function(t,n,r,i){var o=e.newPotentialCalculator(t,i,!0),a=H[t],s=l.minimize(o,[n,r],{bounds:[[a,Zn[0]-a],[a,Zn[1]-a]]});return s.error?!1:s[1]},findMinimumPESquaredLocation:function(t,n,r,i){var o=e.newPotentialCalculator(t,i,!0),a=function(e,t){var n,r,i;return n=o(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},s=H[t],u=l.minimize(a,[n,r],{bounds:[[s,Zn[0]-s],[s,Zn[1]-s]],stopval:1e-4,precision:1e-6});return u.error?!1:u[1]},getMoleculeAtoms:function(t){var n,r,i,o,a=[],s=[],l={};for(s.push(t),l[t]=!0;s.length>0;)for(n=e.getBondedAtoms(s.pop()),i=0,o=n.length;o>i;i++)r=n[i],l[r]||(l[r]=!0,s.push(r),a.push(r));return a},getBondedAtoms:function(e){return Ni[e]||[]},getCoulombForceAt:function(e,t,n){if(n=n||{},!jn||0===Ri.length)return n.fx=n.fy=0,n;var r,i,s,l,c,d,p,h,f,m,g=0,v=0;for(r=0,i=Ri.length;i>r;r++)h=Ri[r],p=I[h],s=E[h]-e,l=k[h]-t,c=s*s+l*l,d=u.forceOverDistanceFromSquaredDistance(c,1,p,Gn,Un),g+=d*s,v+=d*l;for(r=0;fr>r;r++)f=fn[r],(null==f||hi(f,e,t))&&(m=hn[r],"N"===m||"S"===m?v+=fi(r):g+=fi(r));return n.fx=o.convert(g,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),n.fy=o.convert(v,{from:a.MW_FORCE_UNIT,to:a.EV_PER_NM}),n},getAtomKineticEnergy:function(e){var t=.5*j[e]*(R[e]*R[e]+M[e]*M[e]);return o.convert(t,{from:a.MW_ENERGY_UNIT,to:a.EV})},getAtomNeighbors:function(e){var t,n,r=[],i=Sn.getList();for(t=Sn.getStartIdxFor(e),n=Sn.getEndIdxFor(e);n>t;t++)r.push(i[t]);return r},getNeighborList:function(){return Sn},setViscosity:function(e){v=e},get ljCalculator(){return xr},get radialBondsChanged(){return lr},atomsBonded:function(e,t){return!!(Mi&&Mi[e]&&Mi[e][t])},getState:function(){var e=[new p(X),new p(z),new p(Dt),new p(Jt),new p(dn),new p(nt),new p(ht),new p(st),new p(Cn),J,{clone:function(){return{time:rr,N:ir,N_elements:or,N_obstacles:dr,N_shapes:pr,N_lines:hr,N_radialBonds:sr,N_angularBonds:cr,N_restraints:ur,N_springForces:mr}},restore:function(e){rr=e.time,ir=e.N,or=e.N_elements,pr=e.N_shapes,hr=e.N_lines,sr=e.N_radialBonds,cr=e.N_angularBonds,ur=e.N_restraints,mr=e.N_springForces,Sn.invalidate(),Mi.reset(),Ni.reset(),Ri.reset()}}];return Fn.callPluginFunction("getState",[],function(t){e=e.concat(t)}),e},callPluginAccessor:function(e,t){var n;return t=t||[],Fn.callPluginFunction(e,t,function(e){n=e}),n}},_r(),e.pairwiseLJProperties=J,e}}),define("models/md2d/models/unit-definitions/md2d",[],function(){return{name:"md2d",translated:!1,units:{length:{name:"nanometer",pluralName:"nanometers",symbol:"nm"},mass:{name:"atomic mass unit",pluralName:"atomic mass units",symbol:"amu"},time:{name:"femtosecond",pluralName:"femtoseconds",symbol:"fs",displayValue:{unitsPerBaseUnit:.001,pluralName:"picoseconds",name:"picosecond",symbol:"ps"}},inverseTime:{name:"1/femtosecond",pluralName:"1/femtoseconds",symbol:"1/fs"},velocity:{name:"nanometer per femtosecond",pluralName:"nanometers per second",symbol:"nm/s"},acceleration:{name:"nanometer per femtosecond squared",pluralName:"nanometers per femtosecond squared",symbol:"nm/fs²"},momentum:{name:"amu nanometer per femtosecond",pluralName:"amu nanometers per femtosecond",symbol:"amu⋅nm/fs"},force:{name:"amu nanometer per femtosecond squared",pluralName:"amu nanometers per femtosecond squared",symbol:"amu⋅nm/fs²"},energy:{name:"electron volt",pluralName:"electron volts",symbol:"eV"},dampingCoefficient:{name:"amu per femtosecond",pluralName:"amu per femtoseconds",symbol:"amu/fs"},stiffness:{name:"electron volt per nanometer squared",pluralName:"electron volts per nanometer squared",symbol:"eV/nm²"},rotationalStiffness:{name:"electron volt per radian",pluralName:"electron volts per radian",symbol:"eV/rad"},charge:{name:"elementary charge",pluralName:"elementary charges",symbol:"e"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},pressure:{name:"bar",pluralName:"bar",symbol:"bar"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("models/md2d/models/unit-definitions/mks",[],function(){return{name:"mks",translated:!0,units:{length:{name:"meter",pluralName:"meters",symbol:"m",representationInMD2DUnits:1,valueInSIUnits:1},mass:{name:"kilogram",pluralName:"kilograms",symbol:"kg",representationInMD2DUnits:1,valueInSIUnits:1},time:{name:"second",pluralName:"seconds",symbol:"s",representationInMD2DUnits:1e4,valueInSIUnits:1},inverseTime:{name:"1/second",pluralName:"1/seconds",symbol:"1/s",valueInSIUnits:1},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s",valueInSIUnits:1},acceleration:{name:"meter per second squared",pluralName:"meters per second squared",symbol:"m/s²",valueInSIUnits:1},force:{name:"Newton",pluralName:"Newtons",symbol:"N",valueInSIUnits:1},energy:{name:"Joule",pluralName:"Joules",symbol:"J",valueInSIUnits:1},dampingCoefficient:{name:"Newton second per meter",pluralName:"Newton seconds per meter",symbol:"N⋅s/m",valueInSIUnits:1},stiffness:{name:"Newton per meter",pluralName:"Newtons per meter",symbol:"N/m",valueInSIUnits:1},rotationalStiffness:{name:"Newton-meter per radian",pluralName:"Newton-meters per radian",symbol:"N⋅m/rad",valueInSIUnits:1},charge:{name:"Coulomb",pluralName:"Coulombs",symbol:"C",valueInSIUnits:1}}}}),define("models/md2d/models/unit-definitions/index",["require","models/md2d/models/unit-definitions/md2d","models/md2d/models/unit-definitions/mks","underscore"],function(e){var t={md2d:e("models/md2d/models/unit-definitions/md2d"),mks:e("models/md2d/models/unit-definitions/mks")},n=e("underscore");return{get:function(e){var r;return"md2d"===e?t.md2d:(r=n.extend({},t[e]),r.units=n.extend({},t.md2d.units,t[e].units),r)}}}),define("models/md2d/models/units-translation",["require","underscore","models/md2d/models/engine/constants/index","models/md2d/models/engine/potentials/coulomb"],function(e){var t=e("underscore"),n=e("models/md2d/models/engine/constants/index"),r=e("models/md2d/models/engine/potentials/coulomb"),i=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),o=["length","mass","time"];return function(e){var a,s={},l={};return t.each(o,function(t){var n=e.units[t];s[t]=n.valueInSIUnits/n.representationInMD2DUnits}),s.inverseTime=1/s.time,s.velocity=s.length/s.time,s.acceleration=s.velocity/s.time,s.force=s.mass*s.acceleration,s.energy=n.ratio(n.unit.MW_ENERGY_UNIT,{per:n.unit.EV}),s.energy*=s.force*s.length,s.dampingCoefficient=s.force/s.velocity,s.stiffness=s.energy/s.length/s.length,s.rotationalStiffness=s.energy/s.length,a=r.force(1,-1,1,1),s.charge=Math.sqrt(a*s.force*s.length*s.length/i),t.each(t.keys(s),function(t){l[t]=s[t]/e.units[t].valueInSIUnits}),{translateToModelUnits:function(e,t){return null==l[t]?e:e/l[t]},translateFromModelUnits:function(e,t){return null==l[t]?e:e*l[t]}}}}),function(){define("cs!models/md2d/models/solvent",["require"],function(){var e,t;return t={vacuum:{forceType:0,dielectricConstant:1,color:"#eee"},oil:{forceType:-1,dielectricConstant:10,color:"#f5f1dd"},water:{forceType:1,dielectricConstant:80,color:"#B8EBF0"}},e=function(){function e(e){var n,r,i;if(this.type=e,r=t[this.type],null==r)throw new Error("Solvent: unknown type. Use 'vacuum', 'oil' or 'water'.");for(n in r)i=r[n],this[n]=i}return e}()})}.call(this),define("models/md2d/views/nucleotide-paths",[],function(){return{outline:{A:"M20.7,0.4l-0.075-0.075C20.672,0.273,20.73,0.231,20.8,0.2             c0.122-0.049,0.247-0.058,0.375-0.025c0.031,0.002,0.064,0.011,0.1,0.025c0.151,0.054,0.26,0.154,0.325,0.3l6.35,14.15             c0.026,0.065,0.043,0.132,0.05,0.2c0.092,0.104,0.142,0.229,0.15,0.375c0.01,0.163-0.041,0.304-0.15,0.425l-9.025,9.85             c-1.65,1.667-3.292,3.55-4.925,5.65L0.2,15.65c-0.11-0.121-0.16-0.262-0.15-0.425c0.008-0.146,0.058-0.271,0.15-0.375             c0.005-0.068,0.021-0.134,0.05-0.2L6.6,0.5c0.074-0.146,0.19-0.246,0.35-0.3c0.151-0.064,0.301-0.064,0.45,0             c0.038,0.019,0.071,0.043,0.1,0.075C7.593,0.339,7.66,0.431,7.7,0.55c0.047,0.112-0.012,0.154-0.175,0.125             C7.461,0.656,7.386,0.63,7.3,0.6L1.65,15.125l12.4,13.625l12.6-13.725L20.7,0.4z",C:"M12.45,0c2.167,0.5,4.066,1.95,5.7,4.35             c2.033,2.967,3.05,6.533,3.05,10.7c0,3.8-0.867,7.117-2.6,9.95c-0.067,0.133-0.167,0.217-0.3,0.25c-0.133,0.067-0.267,0.067-0.4,0             c-0.133-0.033-0.233-0.117-0.3-0.25c-0.133-0.233-0.283-0.45-0.45-0.65V24.3c-1.8-2.667-3.983-4-6.55-4             c-2.567,0.034-4.767,1.383-6.6,4.05c-0.167,0.2-0.3,0.417-0.4,0.65c-0.1,0.133-0.217,0.217-0.35,0.25             c-0.133,0.067-0.267,0.067-0.4,0c-0.133-0.033-0.233-0.117-0.3-0.25C0.85,22.167,0,18.85,0,15.05c0-4.167,1-7.733,3-10.7             C4.633,1.95,6.55,0.5,8.75,0H12.45z M4,5.05V5C3.991,5.016,3.982,5.033,3.975,5.05C2.289,7.935,1.431,11.126,1.4,14.625             c-0.03,3.519,0.536,6.477,1.7,8.875c2.066-3.39,4.566-5.064,7.5-5.025c2.933,0.04,5.433,1.731,7.5,5.075             c1.088-2.518,1.605-5.559,1.55-9.125c-0.055-3.565-0.888-6.69-2.5-9.375V5c-1.8-2.397-3.983-3.589-6.55-3.575             C8.033,1.439,5.833,2.647,4,5.05z",G:"M8.75,0h3.675c2.191,0.504,4.1,1.963,5.725,4.375V4.35             c2.035,2.963,3.052,6.53,3.05,10.7c0.001,4.17-1.015,7.737-3.05,10.7v-0.025c-2.066,3.065-4.583,4.59-7.55,4.575             c-2.966,0.023-5.5-1.494-7.6-4.55v-0.025C0.999,22.77-0.001,19.211,0,15.05c-0.001-4.161,0.999-7.72,3-10.675V4.35             C4.647,1.953,6.564,0.503,8.75,0z M17.15,25.05c1.754-2.938,2.621-6.354,2.6-10.25c-0.022-3.895-0.889-7.145-2.6-9.75V5.025             c-1.8-2.269-3.984-3.402-6.55-3.4C8.033,1.63,5.833,2.771,4,5.05V5.025c-1.646,2.778-2.496,6.12-2.55,10.025             C1.396,18.955,2.246,22.297,4,25.075V25.05c1.583,2.593,3.667,3.985,6.25,4.175c2.583,0.189,4.883-1.194,6.9-4.15V25.05z",T:"M7.45,0.2H7.9C7.794,0.442,7.677,0.709,7.55,1             C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025             c0.148-0.186,0.314-0.336,0.5-0.45c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35             C24.252,8.584,22.369,3.909,21.15,1c-0.127-0.284-0.243-0.551-0.35-0.8h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15l6.35,14.15             c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2H7.45z",U:"M20.8,0.2h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15             l6.35,14.15c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2h0.75H7.9C7.794,0.442,7.677,0.709,7.55,1C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35             l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025c0.148-0.186,0.314-0.336,0.5-0.45             c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35C24.252,8.584,22.369,3.909,21.15,1             C21.023,0.716,20.907,0.449,20.8,0.2z"},interior:{A:"M21.175,0.175C21.046,0.143,20.921,0.151,20.8,0.2             c-0.069,0.031-0.128,0.073-0.175,0.125c-0.055,0.054-0.097,0.121-0.125,0.2c-0.063,0.16,0.003,0.118,0.2-0.125l5.95,14.625             L14.05,28.75L1.65,15.125L7.3,0.6c0.086,0.03,0.161,0.056,0.225,0.075C7.688,0.704,7.747,0.662,7.7,0.55             C7.66,0.431,7.593,0.339,7.5,0.275L7.6,0.2c4.8-0.067,7.283-0.1,7.45-0.1l6.1,0.05L21.175,0.175z",C:"M3.975,5.05H4c1.833-2.402,4.033-3.611,6.6-3.625             C13.167,1.411,15.35,2.603,17.15,5v0.05c1.612,2.685,2.445,5.81,2.5,9.375c0.055,3.566-0.461,6.607-1.55,9.125             c-2.067-3.344-4.567-5.035-7.5-5.075c-2.934-0.04-5.434,1.635-7.5,5.025c-1.164-2.398-1.73-5.356-1.7-8.875             C1.431,11.126,2.289,7.935,3.975,5.05z",G:"M17.15,25.05v0.025c-2.017,2.956-4.317,4.339-6.9,4.15             C7.667,29.035,5.583,27.643,4,25.05v0.025c-1.754-2.778-2.604-6.12-2.55-10.025C1.504,11.145,2.354,7.803,4,5.025V5.05             c1.833-2.278,4.033-3.42,6.6-3.425c2.566-0.002,4.75,1.131,6.55,3.4V5.05c1.711,2.605,2.578,5.855,2.6,9.75             C19.771,18.695,18.904,22.112,17.15,25.05z",T:"M21.4,0.2h-0.6c0.107,0.249,0.223,0.516,0.35,0.8             c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075             c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175             L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1C7.677,0.709,7.794,0.442,7.9,0.2H7.45c0.133-0.067,0.333-0.1,0.6-0.1             c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05C17.28,0.048,20.955,0.056,21.3,0.15C21.334,0.164,21.368,0.181,21.4,0.2z",U:"M7.9,0.2l0.15-0.1c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05             c6.009-0.066,9.568-0.066,10.675,0L20.8,0.2c0.107,0.249,0.223,0.516,0.35,0.8c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35             l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45             L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1             C7.677,0.709,7.794,0.442,7.9,0.2z"},letter:{A:{1:"M12.85,12.55h2.6l-1.3-3.95L12.85,12.55z M13,6.25h2.4l3.55,10.1               h-2.3L16,14.3h-3.7l-0.7,2.05H9.4L13,6.25z",2:"M18.7,5.95l-3.55,10.1h-2.4l-3.6-10.1h2.2L12.05,8h3.7l0.65-2.05               H18.7z M12.6,9.75l1.3,3.95l1.3-3.95H12.6z"},C:{1:"M10.45,6.4c1.667,0,2.883,0.55,3.65,1.65               c0.433,0.633,0.667,1.267,0.7,1.9h-2.1c-0.133-0.5-0.3-0.867-0.5-1.1c-0.4-0.434-0.967-0.65-1.7-0.65S9.183,8.5,8.75,9.1               C8.317,9.733,8.1,10.617,8.1,11.75c0,1.1,0.217,1.933,0.65,2.5c0.467,0.567,1.05,0.85,1.75,0.85c0.733,0,1.283-0.233,1.65-0.7               c0.233-0.267,0.417-0.667,0.55-1.2h2.05c-0.167,1.1-0.617,2-1.35,2.7c-0.733,0.7-1.683,1.05-2.85,1.05               c-1.433,0-2.566-0.467-3.4-1.4c-0.8-0.933-1.2-2.216-1.2-3.85c0-1.767,0.466-3.117,1.4-4.05C8.15,6.817,9.183,6.4,10.45,6.4z",2:"M15,12.35c-0.033,0.633-0.267,1.267-0.7,1.9               c-0.767,1.1-1.983,1.65-3.65,1.65c-1.267,0-2.3-0.417-3.1-1.25c-0.933-0.933-1.4-2.283-1.4-4.05c0-1.633,0.4-2.917,1.2-3.85               c0.833-0.933,1.967-1.4,3.4-1.4c1.167,0,2.117,0.35,2.85,1.05c0.733,0.7,1.183,1.6,1.35,2.7H12.9               c-0.133-0.533-0.316-0.934-0.55-1.2c-0.367-0.467-0.917-0.7-1.65-0.7c-0.7,0-1.284,0.283-1.75,0.85               c-0.434,0.567-0.65,1.4-0.65,2.5c0,1.133,0.217,2.017,0.65,2.65c0.433,0.6,1.017,0.9,1.75,0.9c0.733,0,1.3-0.217,1.7-0.65               c0.2-0.233,0.367-0.6,0.5-1.1H15z"},G:{1:"M14.8,10.8h-2.05c-0.167-0.667-0.567-1.133-1.2-1.4               c-0.333-0.167-0.716-0.25-1.15-0.25c-0.8,0-1.467,0.3-2,0.9c-0.5,0.633-0.75,1.567-0.75,2.8s0.283,2.1,0.85,2.6               c0.567,0.533,1.2,0.8,1.9,0.8c0.7,0,1.283-0.217,1.75-0.65c0.434-0.4,0.717-0.934,0.85-1.6h-2.35v-1.65h4.2v5.4h-1.4l-0.2-1.25               c-0.4,0.467-0.767,0.8-1.1,1C11.583,17.833,10.9,18,10.1,18c-1.333,0-2.434-0.467-3.3-1.4c-0.867-0.9-1.3-2.167-1.3-3.8               s0.45-2.933,1.35-3.9c0.867-1,2.05-1.5,3.55-1.5c1.267,0,2.3,0.333,3.1,1C14.267,9.033,14.7,9.833,14.8,10.8z",2:"M10.65,9.65c-0.7,0-1.333,0.267-1.9,0.8               c-0.567,0.5-0.85,1.367-0.85,2.6c0,1.233,0.25,2.167,0.75,2.8c0.533,0.6,1.2,0.9,2,0.9c0.434,0,0.817-0.083,1.15-0.25               c0.633-0.267,1.034-0.733,1.2-1.4h2.05c-0.1,0.967-0.533,1.767-1.3,2.4c-0.8,0.667-1.833,1-3.1,1c-1.5,0-2.683-0.5-3.55-1.5               c-0.9-0.967-1.35-2.267-1.35-3.9s0.433-2.9,1.3-3.8c0.867-0.933,1.967-1.4,3.3-1.4c0.8,0,1.483,0.167,2.05,0.5               c0.333,0.2,0.7,0.533,1.1,1l0.2-1.25h1.4v5.4h-4.2V11.9h2.35c-0.133-0.667-0.417-1.2-0.85-1.6C11.933,9.867,11.35,9.65,10.65,9.65z"},T:{1:"M10.3,5 L18.45,5 L18.45,6.8 L15.4,6.8 L15.4,15.1 L13.3,15.1               L13.3,6.8 L10.3,6.8z",2:"M10.2,14.65 L10.2,12.85 L13.2,12.85 L13.2,4.55 L15.3,4.55               L15.3,12.85 L18.35,12.85 L18.35,14.65z"},U:{1:"M10.15,10.8V4.6h2.15v6.2c0,0.7,0.083,1.217,0.25,1.55               c0.267,0.566,0.817,0.85,1.65,0.85c0.867,0,1.417-0.284,1.65-0.85c0.167-0.333,0.25-0.85,0.25-1.55V4.6h2.15v6.2               c0,1.067-0.167,1.9-0.5,2.5c-0.633,1.1-1.817,1.65-3.55,1.65c-1.733,0-2.917-0.55-3.55-1.65C10.317,12.7,10.15,11.867,10.15,10.8z",2:"M12.45,8.4v6.2H10.3V8.4c0-1.066,0.167-1.9,0.5-2.5               c0.633-1.1,1.817-1.65,3.55-1.65S17.267,4.8,17.9,5.9c0.333,0.6,0.5,1.434,0.5,2.5v6.2h-2.15V8.4c0-0.7-0.083-1.217-0.25-1.55               C15.767,6.283,15.217,6,14.35,6c-0.833,0-1.383,0.283-1.65,0.85C12.533,7.183,12.45,7.7,12.45,8.4z"}}}}),define("common/resources-url",["require","lab.config"],function(e){var t=e("lab.config");return function(e){return t.rootUrl+"/resources/"+e}}),define("models/md2d/views/nucleotides",["require","models/md2d/views/nucleotide-paths","common/resources-url"],function(e){function t(){function e(e){var n,r;e?(n=Math.random()>=.5?.25*Math.PI:1.25*Math.PI,n+=Math.random()*Math.PI*.5,r=6*t.HEIGHT,y=r*Math.cos(n),b=r*Math.sin(n)):y=b=0}function s(e){return"translate("+u(y+t.WIDTH*e.idx)+" "+u(b)+")"}function l(t){t.each(function(t,l){var y,b,x,w,_,T,C,A,S,P,E=d3.select(this),k=h?.9*a.BACKB:0,R=u(k+.5*a.A),M=u(k+.97*a.A),N="function"==typeof c?c(t,l):c;"string"==typeof N&&(N=N.split(""),N.forEach(function(e,t){N[t]={id:t,idx:t,type:e}})),y=E.selectAll(".nucleotide").data(N,function(e){return e.id}),b=y.enter(),x=y.exit(),e(m),b=b.append("g").attr({transform:s}).style({opacity:m?0:1}),w=b.append("g").attr({"class":"scale",transform:"scale(1, "+(1===d?1:-1)+")"}),w.append("path").attr("class","bonds").style({"stroke-width":u(.01),stroke:"#fff"}),T=w.append("g").classed("nucleo-shape",!0).classed("clickable-nucleo",function(e){return"c"===e.region&&g}).on("click",function(){}),g&&T.append("image").attr({"class":"glow",y:u(k-.17*o.G_GLOW),preserveAspectRatio:"none"}),C=T.append("svg").attr({y:u(k),preserveAspectRatio:"none"}),C.append("path").attr({"class":"outline","fill-rule":"evenodd","clip-rule":"evenodd"}),C.append("path").attr({"class":"interior","fill-rule":"evenodd","clip-rule":"evenodd"}),C.append("path").attr({"class":"letter","fill-rule":"evenodd","clip-rule":"evenodd",d:function(e){return n.letter[e.type][d]}}),h&&(_=w.append("image").attr({"class":"backbone",x:0,y:0,width:u(o.BACKB),height:u(a.BACKB),preserveAspectRatio:"none","xlink:href":r("dna/Backbone_"+h+".svg")})),v&&(y=b),y.attr("class",function(e){var t="";switch(e.region){case"c":t="coding-region";break;case"j":t="junk-region";break;case"p":t="promoter-region";break;case"t":t="terminator-region"}return"nucleotide "+t}),y.select(".bonds").attr("d",function(e){return"C"===e.type||"G"===e.type?"M"+u(20*i)+" "+R+" L "+u(20*i)+" "+M+"M"+u(26*i)+" "+R+" L "+u(26*i)+" "+M+"M"+u(32*i)+" "+R+" L "+u(32*i)+" "+M:"M"+u(22*i)+" "+R+" L "+u(22*i)+" "+M+"M"+u(30*i)+" "+R+" L "+u(30*i)+" "+M}),y.select(".glow").attr({x:function(e){return u(o.BACKB)/2-u(o[e.type+"_GLOW"])/2},width:function(e){return u(o[e.type+"_GLOW"])},height:function(e){return u(a[e.type+"_GLOW"])},"xlink:href":function(e){return r("dna/NucleotideGlow_"+e.type+".svg")}}),A=y.select(".nucleo-shape > svg"),A.attr({"class":function(e){var t="type-"+e.type;return f&&f[e.idx]&&(t+=" stop-codon"),t},viewBox:function(e){return"0 0 "+o[e.type]/i+" "+a[e.type]/i},x:function(e){return u(o.BACKB)/2-u(o[e.type])/2},width:function(e){return u(o[e.type])},height:function(e){return u(a[e.type])}}),A.select("path.interior").attr("d",function(e){return n.interior[e.type]}),A.select("path.outline").attr("d",function(e){return n.outline[e.type]}),e(!1),S=d3.transition(y).attr("transform",s).style("opacity",1),S.select(".bonds").style("opacity",p),S.attrTween?(P="scale(1, "+(1===d?1:-1)+")",S.select("g.scale").attrTween("transform",function(e,t,n){return d3.interpolateString(n,P)}),S.select("path.letter").attrTween("d",function(e,t,r){return function(t){return.5>t?r:n.letter[e.type][d]}})):(y.select("g.scale").attr("transform","scale(1, "+(1===d?1:-1)+")"),y.select("path.letter").attr("d",function(e){return n.letter[e.type][d]})),e(!0),d3.transition(x).attr("transform",s).style("opacity",0).remove()
})}var u=null,c="",d=1,p=1,h="DNA",f=null,m=!0,g=!1,v=!1,y=0,b=0;return l.sequence=function(e){return arguments.length?(c=e,l):c},l.model2px=function(e){return arguments.length?(u=e,l):u},l.direction=function(e){return arguments.length?(d=e,l):d},l.bonds=function(e){return arguments.length?(p=e,l):p},l.randomEnter=function(e){return arguments.length?(m=e,l):m},l.glow=function(e){return arguments.length?(g=e,l):g},l.backbone=function(e){return arguments.length?(h=e,l):h},l.stopCodonsHash=function(e){return arguments.length?(f=e,l):f},l.enterExitOnly=function(e){return arguments.length?(v=e,l):v},l}var n=e("models/md2d/views/nucleotide-paths"),r=e("common/resources-url"),i=.007,o={BACKB:52,A:28.151,C:21.2,G:21.2,T:28.651,U:28.651,A_GLOW:44.125,C_GLOW:37.2,G_GLOW:36.2,T_GLOW:45.566},a={BACKB:14,A:31.15,C:25.3,G:30.3,T:25.007,U:25.007,A_GLOW:44.55,C_GLOW:41.417,G_GLOW:45.3,T_GLOW:40.65};return function(){var e;for(e in o)o.hasOwnProperty(e)&&(o[e]*=i);for(e in a)a.hasOwnProperty(e)&&(a[e]*=i)}(),t.WIDTH=.92*o.BACKB,t.HEIGHT=.96*(.9*a.BACKB+a.A),t}),define("models/md2d/models/engine/genetic-engine",["require","cs!models/md2d/models/aminoacids-helper","common/alert","models/md2d/views/nucleotides"],function(e){function t(e){return e.replace(/A/g,"t").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g").toUpperCase()}function n(e){var t,n=["A","G","T","C"],r=n.length,i="";for(t=0;e>t;t++)i+=n[Math.floor(Math.random()*r)];return i}function r(){return c++}var i,o,a=e("cs!models/md2d/models/aminoacids-helper"),s=e("common/alert"),l=(e("models/md2d/views/nucleotides").WIDTH,["undefined","intro-cells","intro-zoom1","intro-zoom2","intro-zoom3","intro-polymerase","dna","transcription","transcription-end","after-transcription","before-translation","translation","translation-end"]),u={},c=0,d="TGACCTCTCCGCGCCATCTATAAACCGAAGCGCTAGCTACA",p="ACCACAGGCCGCCAGTTCCGCTGGCGGCATTTT",h=t(d),f=t(p),m="change";return function(){var e,r;for(e=0,r=l.length;r>e;e++)u[l[e]]=e;i=n(50),o=t(i)}(),function(e){var n,c,g,v=m,y=[],b="",x="",w=d3.dispatch("change","transition"),_=function(){for(var e=C(0),t="";e;)t+=e,e=C(t.length);return t},T=function(){var e,t,n;for(c={},g=null,t=0,n=x.length;n>t;t+=3)e=x.substr(t,3),"STOP"===a.codonToAbbr(e)&&(null===g&&(g=t/3),3===e.length&&(c[t]=c[t+1]=c[t+2]=!0));null===g&&(g=Math.floor(x.length/3))},C=function(e){if(e>=b.length)return null;switch(b[e]){case"A":return"U";case"G":return"C";case"T":return"A";case"C":return"G"}},A=function(e,t){var n,i,o;for(e.length=t.length,n=0,i=t.length;i>n;n++)o=e[n]||{},o.idx=n,o.type!==t[n]&&(o.type=t[n],o.id=r(),e[n]=o);return e},S=function(e,t,n){var a,s,l,u=n?o+h+t+f+o:i+d+t+p+i,c=i.length,m=c+d.length,g=m+t.length,v=g+p.length;for(e.length=u.length,a=0,s=u.length;s>a;a++)l=e[a]||{},l.idx=a,l.region=c>a?"j":m>a?"p":g>a?"c":v>a?"t":"j",l.type!==u[a]&&(l.type=u[a],l.id=r(),e[a]=l);return e},P=function(){var r=e.get("DNA");S(n.viewModel.DNA,r,!1),b=t(r),S(n.viewModel.DNAComp,b,!0),x=_(),T(),n.stateBefore("transcription:0")?A(n.viewModel.mRNA,""):"transcription"===n.state().name?A(n.viewModel.mRNA,x.substr(0,n.state().step)):n.stateAfter("transcription")&&A(n.viewModel.mRNA,x),"transition"!==v&&(n.stateBefore("translation:1")?E():n.stateEqual("translation-end")&&k())},E=function(){var t;if(t=e.getNumberOfAtoms(),t>0){for(e.startBatch();t>0;)e.removeAtom(t-1),t--;e.endBatch()}e.stop()},k=function(){for(var t=[],r=0,i=a.codonToAbbr(n.codon(0));"STOP"!==i;)t.push(i),i=a.codonToAbbr(n.codon(++r));n.generateProtein(t,void 0,2.3,.3),n.centerProtein(),e.start()},R=function(t){var r,i,o=t.name;return"transcription"===o?t.step<e.get("DNA").length-1?"transcription:"+(t.step+1):"transcription-end":"translation"===o?(i=a.codonToAbbr(n.codon(t.step)),"STOP"!==i?"translation:"+(t.step+1):"translation-end"):(r=l[u[t.name]+1],("transcription"===r||"translation"===r)&&(r+=":0"),r)},M=function(t){var n=t.name,r=t.step;return"transcription"===n&&r>0?"transcription:"+(r-1):"transcription-end"===n?"transcription:"+(e.get("DNA").length-1):"translation-end"===n||"translation"===n&&r>0?"translation:0":l[u[n]-1]},N=function(e,t){return e===t?0:(e=n.parseState(e),t=n.parseState(t),e.name===t.name?isNaN(e.step)||isNaN(t.step)?0:e.step<t.step?-1:1:u[e.name]<u[t.name]?-1:1)},O=function(e){"undefined"!=typeof e&&(y.length>0?y.push(e):(y.push(e),L(e)))},L=function(e){B("DNAState",e,"transition")},I=function(e){B("DNA",e,"transition")},D=function(t){y.length=0,e.cancelTransitions(),w.change(t)},B=function(t,n,r){v=r||m,e.properties[t]=n,v=m},V=function(){var t=e.get("DNAState");if("suppress"!==v)if(P(),"transition"===v)w.transition(t);else{if(n.stateAfter("translation:0")&&n.stateBefore("translation-end"))return s("'"+t+"' cannot be set explicitly. 'translation:0' should be set and then animation to '"+t+"' should be triggered."),void B("DNAState","translation:0");D()}},F=function(){if("suppress"!==v){if(n.stateAfter("translation:0")&&n.stateBefore("translation-end"))return void B("DNAState","translation:0");P(),"transition"===v?w.transition("dna-updated",!0):D(!0)}};return n={PRECODING_LEN:i.length+d.length,viewModel:{mRNA:[],DNA:[],DNAComp:[]},on:function(e,t){w.on(e,t)},mutate:function(r,i,o){var a=e.get("DNA"),s=r-n.PRECODING_LEN;if(0>s||s>=a.length)throw new Error("Mutation can be performed only on DNA coding region.");a=a.substr(0,s)+(o?t(i):i)+a.substr(s+1),B("DNA",a)},insert:function(i,o,a){var s={type:a?t(o):o,id:r(),region:"c"},l={type:a?o:t(o),id:r(),region:"c"},u={type:a?t(o):o,id:r(),region:"c"},c=e.get("DNA"),d=n.state(),p=i-n.PRECODING_LEN;if(0>p||p>=c.length)throw new Error("Mutation can be performed only on DNA coding region.");n.viewModel.DNA.splice(i,0,s),n.viewModel.DNAComp.splice(i,0,l),n.viewModel.mRNA.splice(p,0,u),c=c.substr(0,p)+s.type+c.substr(p),"transcription"===d.name&&p<d.step&&B("DNAState",d.name+":"+(d.step+1),"suppress"),I(c)},"delete":function(t){var r=e.get("DNA"),i=n.state(),o=t-n.PRECODING_LEN;if(0>o||o>=r.length)throw new Error("Mutation can be performed only on DNA coding region.");n.viewModel.DNA.splice(t,1),n.viewModel.DNAComp.splice(t,1),n.viewModel.mRNA.splice(o,1),r=r.substr(0,o)+r.substr(o+1),"transcription"===i.name&&o<i.step&&B("DNAState",M(i),"suppress"),I(r)},transitionToNextState:function(){n.stopTransition(),0===y.length&&O(R(n.lastState()))},stopTransition:function(){y.length>1&&(y.length=1)},jumpToNextState:function(){n.stateBefore("translation:0")?B("DNAState",R(n.state())):n.stateBefore("translation-end")&&B("DNAState","translation-end")},jumpToPrevState:function(){n.stateAfter("intro-cells")&&B("DNAState",M(n.state()))},transitionTo:function(e){for(;n.lastStateBefore(e);)O(R(n.lastState()))},transcribeStep:function(e){var t,r;if(t=n.state(),"dna"===t.name&&"undefined"==typeof e)n.transitionToNextState();else if("transcription"===t.name){if(r=C(t.step),e&&e.toUpperCase()!==r)return;n.transitionToNextState()}},state:function(){return n.parseState(e.get("DNAState"))},stateBefore:function(t){return-1===N(e.get("DNAState"),t)},stateEqual:function(t){return 0===N(e.get("DNAState"),t)},stateAfter:function(t){return 1===N(e.get("DNAState"),t)},lastState:function(){var e=y.length;return e>0?n.parseState(y[e-1]):n.state()},lastStateBefore:function(t){var n=y.length,r=n?y[n-1]:e.get("DNAState");return-1===N(r,t)?!0:!1},lastStateAfter:function(t){var n=y.length,r=n?y[n-1]:e.get("DNAState");return 1===N(r,t)?!0:!1},parseState:function(e){return e=e.split(":"),{name:e[0],step:Number(e[1])}},codon:function(e){return x.substr(3*e,3)},codonComplement:function(e){return n.codon(e).replace(/A/g,"u").replace(/G/g,"c").replace(/U/g,"a").replace(/C/g,"g").toUpperCase()},translationStepStarted:function(t,r,i,o,s,l){var u=a.codonToAbbr(n.codon(t)),c=a.abbrToElement(u);s+=.02*Math.random()-.01,e.addAtom({x:r,y:i,element:c,visible:!0,pinned:!0},{suppressCheck:!0}),e.atomTransition().id(t).duration(l).prop("x",o),e.atomTransition().id(t).duration(l).prop("y",s),e.start()},shiftAminoAcids:function(t,n,r){if(!(1>t)){var i,o,a;for(i=0;t>i;i++)o=e.getAtomProperties(i).x+n,a=e.getAtomProperties(i).y,e.atomTransition().id(i).duration(r).prop("x",o),e.atomTransition().id(i).duration(r).prop("y",a)}},centerProtein:function(t){e.batch(function(){var r,i,o,a=n.proteinCenterOfMass(),s=e.properties.viewPortX+e.properties.viewPortWidth/2-a.x,l=e.properties.viewPortY+e.properties.viewPortHeight/2-a.y,u=e.properties.minX+.1,c=e.properties.maxX-.1,d=e.properties.minY+.1,p=e.properties.maxY-.1,h=e.getNumberOfAtoms();for(r=0;h>r;r++)i=e.getAtomProperties(r).x,o=e.getAtomProperties(r).y,i+s>c&&(s=c-i),u>i+s&&(s=u-i),o+l>p&&(l=p-o),d>o+l&&(l=d-o);for(r=0;h>r;r++)i=e.getAtomProperties(r).x+s,o=e.getAtomProperties(r).y+l,t?(e.atomTransition().id(r).duration(t).prop("x",i),e.atomTransition().id(r).duration(t).prop("y",o)):e.setAtomProperties(r,{x:i,y:o})}),e.tickInPlace()},connectAminoAcid:function(t){if(!(1>t)){var n=e.getAtomProperties(t-1).radius,r=e.getAtomProperties(t).radius,i=1.25*(n+r);e.addRadialBond({atom1:t,atom2:t-1,length:i,strength:1e4}),e.setAtomProperties(t-1,{pinned:!1})}},translationCompleted:function(){var t=e.getNumberOfAtoms();t>0&&e.setAtomProperties(t-1,{pinned:!1})},transitionEnded:function(){y.shift(),y.length>0&&L(y[0])},stopCodonsHash:function(){return c},lastTranslationStep:function(){return g},proteinCenterOfMass:function(){var t,n,r=0,i=0,o=0,a=e.getNumberOfAtoms();if(0===a)return null;for(n=0,a=e.getNumberOfAtoms();a>n;n++)t=e.getAtomProperties(n),i+=t.x*t.mass,o+=t.y*t.mass,r+=t.mass;return i/=r,o/=r,{x:i,y:o}},generateProtein:function(t,n,r,i){n=t?t.length:n,r=r||0,i=i||0;var o=e.properties.minX,s=e.properties.minY+i,l=e.properties.maxX,u=e.properties.maxY-r,c=0;return E(),e.batch(function(){var r,i,d,p,h,f,m,g,v,y,b={suppressCheck:!0},x=l-o,w=u-s,_=a.lastElementID-a.firstElementID+1,T=.6,C=function(e){return e>w-T||T>e?.1:.02-.04*Math.random()},A=.3,S=function(e,t){return 0===t?e>.5*u?-.1:.1:i>u-A||A>i?0:t},P=function(){return Math.floor(_*Math.random())+a.firstElementID};for(r=o+.1,i=s+.1,d=0,p=0,h=t?a.abbrToElement(t[0]):P(),m=e.getElementProperties(h).radius,f={x:r,y:i,element:h,visible:!0},e.addAtom(f,b),c+=1,y=1;n>y;y++){if(r=f.x,i=f.y,d=C(i),p=S(i,p),r+=1.7*d,i+=1.7*p,r>x-.1)return;h=t?a.abbrToElement(t[y]):P(),f={x:r,y:i,element:h,visible:!0},e.addAtom(f,b),c+=1,g=m,m=e.getElementProperties(h).radius,v=1.25*(m+g),e.addRadialBond({atom1:y,atom2:y-1,length:v,strength:1e4})}}),e.batch(function(){var t,r=e.getAtomProperties(c-1).x,i=(r-o)/2,a=e.properties.viewPortX+e.properties.viewPortWidth/2,s=l-r,u=Math.max(0,Math.min(a-i,s));for(t=0;n>t;t++)e.setAtomProperties(t,{x:e.getAtomProperties(t).x+u})}),e.minimizeEnergy(),c}},e.addPropertiesListener(["DNA"],F),e.addPropertiesListener(["DNAState"],V),P(),n}}),define("models/md2d/models/performance-optimizer",[],function(){function e(e){this._model=e,this._initialTimeStep=this._model.get("timeStep"),this._maxTimeStep=2*this._initialTimeStep,this._targetProgressRate=this._initialTimeStep*this._model.get("timeStepsPerTick")*60,this.enabled=!1}var t=2.5;return e.prototype._assessPerformance=function(){if(this.enabled&&!this._model.isStopped()){var e=this._model.getSimulationProgressRate(),n=this._model.getFPS(),r=this._model.get("timeStep"),i=this._model.get("timeStepsPerTick"),o=this._model.get("temperatureControl")?2.5*this._maxTimeStep:this._maxTimeStep;e<.9*this._targetProgressRate?o>1.1*r?this._model.set("timeStep",1.1*r):n>t&&this._model.set("timeStepsPerTick",Math.round(1.1*i+.5)):e>1.1*this._targetProgressRate&&this._model.set("timeStepsPerTick",Math.round(.9*i-.5)),setTimeout($.proxy(this._assessPerformance,this),250)}},e.prototype.enable=function(){this.enabled||(this._model.start(),this.enabled=!0,this._model.set("timeStepsPerTick",5),setTimeout($.proxy(this._assessPerformance,this),250))},e.prototype.disable=function(){this.enabled=!1},e}),define("common/models/property-transition",[],function(){function e(){if(this.isFinished=!1,this._duration=0,this._easeFunc=d3.ease("cubic-in-out"),this._elapsedTime=0,this._id=null,this._propName=null,this._endValue=null,this._interpolator=null,null==this.getObjectProperties)throw new Error("getObjectProperties method must be implemented by descendant!");if(null==this.setObjectProperties)throw new Error("setObjectProperties method must be implemented by descendant!")}return e.prototype.id=function(e){return this._id=e,this},e.prototype.prop=function(e,t){return this._propName=e,this._endValue=t,this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.delay=function(e){return this._elapsedTime=-e,this},e.prototype.ease=function(e){return this._easeFunc=d3.ease(e),this},e.prototype.process=function(e){if(!this.isFinished&&!this._incompleteSpec()){var t,n;this._elapsedTime+=e,this._elapsedTime<0||(null==this._interpolator&&(this._interpolator=d3.interpolate(this.getObjectProperties(this._id)[this._propName],this._endValue)),t=Math.min(1,this._elapsedTime/this._duration),t=this._easeFunc(t),n={},n[this._propName]=this._interpolator(t),this.setObjectProperties(this._id,n),t>=1&&(this.isFinished=!0))}},e.prototype.getObjectProperties=null,e.prototype.setObjectProperties=null,e.prototype._incompleteSpec=function(){return null==this._id||null==this._propName||null==this._endValue},e}),define("models/md2d/models/atom-transition",["require","common/inherit","common/models/property-transition"],function(e){function t(e){r.call(this),this._model=e}var n=e("common/inherit"),r=e("common/models/property-transition");return n(t,r),t.prototype.setObjectProperties=function(e,t){this._model.setAtomProperties(e,t)},t.prototype.getObjectProperties=function(e){return this._model.getAtomProperties(e)},t}),define("models/md2d/models/engine/plugins/quantum-dynamics",["require","common/models/engines/clone-restore-wrapper","../constants/index","../utils","arrays","common/array-types","models/md2d/models/metadata","common/validator"],function(e){var t=e("common/models/engines/clone-restore-wrapper"),n=e("../constants/index"),r=e("../utils"),i=n.convert(.2,{from:n.unit.EV,to:n.unit.MW_ENERGY_UNIT}),o=n.convert(.05,{from:n.unit.EV,to:n.unit.MW_ENERGY_UNIT}),a=.002,s=2*Math.PI,l=200,u=1/l,c=1,d=2;return function(n,p){var h,f,m,g,v,y,b,x,w,_,T,C,A,S=e("arrays"),P=e("common/array-types"),E=e("models/md2d/models/metadata"),k=e("common/validator"),R=k.validateCompleteness(E.quantumDynamics,p),M=R.elementEnergyLevels,N=R.radiationlessEmissionProbability,O=0,L=R.lightSource,I=n.getDimensions(),D=[],B=0,V=function(){var e=m.x.length;m.excitation=S.create(e,0,P.int8Type)},F=function(e){var t=0;e.x&&(t=10*Math.ceil(e.x.length/10)),v={id:S.create(t,0,P.uint16Type),x:S.create(t,0,P.floatType),y:S.create(t,0,P.floatType),vx:S.create(t,0,P.floatType),vy:S.create(t,0,P.floatType),angularFrequency:S.create(t,0,P.floatType)}},j=[],G=0,U=function(e){if(e&&e.x){["x","y","vx","vy","angularFrequency"].forEach(function(t){S.copy(e[t],v[t])});for(var t=0;t<v.x.length;t++)(v.vx[t]||v.vy[t])&&(G++,v.id[t]=B++)}},z=function(){var e,t,r,i,o,a,s,l,u,d,p=n.getNumberOfAtoms();for(e=0,t=v.x.length;t>e;e++)if(v.vx[e]||v.vy[e])for(r=v.x[e],i=v.y[e],o=0;p>o&&(l=m.x[o]-r,u=m.y[o]-i,a=m.radius[o],s=a*a,!(s>l*l+u*u&&(d=W(e,o),d===c)));o++);},W=function(e,t){return Math.random()<O?d:$(e,t)?c:void 0},$=function(e,t){if(M){var n,r,a=M[m.element[t]],s=m.excitation[t],l=a[s],u=v.angularFrequency[e]*i;for(n=s+1,r=a.length;r>n;n++)if(Math.abs(a[n]-l-u)<o)return m.excitation[t]=n,D[t]=f,nt(e),!0;return!1}},q=function(e){var t,r,i,o,a,s,l,u,c,d,p,h,f,v,y,b,x,w=n.getNumberOfAtoms(),_=e.getList(),T=[];if(M){for(t=0;w>t;t++)for(c=m.x[t],d=m.y[t],i=e.getStartIdxFor(t),o=e.getEndIdxFor(t);o>i;i++)r=_[i],a=m.element[t],s=m.element[r],l=M[a],u=M[s],(l.length||u.length)&&(p=c-m.x[r],h=d-m.y[r],f=p*p+h*h,v=.55*(g.sigma[a]+g.sigma[s]),y=v*v,f>=y||(T[t]=r,j[t]!==r&&(b=H(t,r),b||(x=Z(t,r)),(b||x)&&(j[t]=r,j[r]=t))));for(t=0,o=j.length;o>t;t++)r=j[t],isNaN(r)||T[t]!==r&&T[r]!==t&&(delete j[t],delete j[r])}},H=function(e,t){var n,r;return y=e,b=t,r=Math.random()<.5?y:b,n=Y(r),n||(n=Y(y+b-r)),n},Y=function(e){var t,n,r,i,o,a,s,l,u,c=M[m.element[e]];if(c){for(X(),r=J(),t=m.excitation[e],n=c[t],l=t+1,u=c.length;u>l&&(i=c[l]-n,!(i>r));l++)o=l;return o?(o-=t,a=Math.ceil(Math.random()*o)+t,m.excitation[e]=a,D[e]=f,s=c[a]-n,K(s),!0):!1}},X=function(){var e=m.x[b]-m.x[y],t=m.y[b]-m.y[y],n=1/Math.sqrt(e*e+t*t);C=e*n,A=t*n,x=m.vx[y]*C+m.vy[y]*A,_=m.vy[y]*C-m.vx[y]*A,w=m.vx[b]*C+m.vy[b]*A,T=m.vy[b]*C-m.vx[b]*A},J=function(){var e=w-x,t=m.mass[y],n=m.mass[b];return.5*e*e*t*n/(t+n)},K=function(e){var t=m.mass[y],n=m.mass[b],r=t*x*x+n*w*w-e,i=t*x+n*w,o=(i-Math.sqrt(n/t*(r*(t+n)-i*i)))/(t+n),a=(i+Math.sqrt(t/n*(r*(t+n)-i*i)))/(t+n);m.vx[y]=o*C-_*A,m.vy[y]=o*A+_*C,m.vx[b]=a*C-T*A,m.vy[b]=a*A+T*C},Z=function(e,t){var n,r=m.excitation[e],i=m.excitation[t];if(y=e,b=t,!r&&!i)return!1;if(r)if(i){if(n=Math.random()<.5?y:b,!Q(n)&&(n=y+b-n,!Q(n)))return!1}else{if(!Q(y))return!1;n=y}else{if(!Q(b))return!1;n=b}return et(n),!0},Q=function(e){return f>D[e]+l?!0:void 0},et=function(e){var t=M[m.element[e]],n=m.excitation[e],r=Math.floor(Math.random()*n),i=t[r]-t[n];m.excitation[e]=r,Math.random()<N?(X(),K(i)):it(e,i)},tt=function(){var e,t=v.x.length;if(G+1>t)return r.extendArrays(v,t+10),t;for(e=0;t>e;e++)if(!v.vx[e]&&!v.vy[e])return e},nt=function(e){G--,v.x[e]=v.y[e]=v.vx[e]=v.vy[e]=v.angularFrequency[e]=0},rt=function(e,t,n,r){var o=Math.cos(n),s=Math.sin(n),l=a*o,u=a*s,c=r/i,d=tt();G++,v.id[d]=B++,v.x[d]=e,v.y[d]=t,v.vx[d]=l,v.vy[d]=u,v.angularFrequency[d]=c},it=function(e,t){var n=Math.random()*s-Math.PI,r=Math.cos(n),i=Math.sin(n),o=g.sigma[m.element[e]],a=m.x[e]+.51*o*r,l=m.y[e]+.51*o*i;rt(a,l,n,t)},ot=function(e){var t,n,r,i;for(t=0,n=v.x.length;n>t;t++)(v.vx[t]||v.vy[t])&&(r=v.x[t]+=v.vx[t]*e,i=v.y[t]+=v.vy[t]*e,(r<I[0]||r>I[2]||i<I[1]||i>I[3])&&nt(t))},at=function(e){if(M)for(var t=0,r=n.getNumberOfAtoms();r>t;t++)st(t,e)},st=function(e,t){if(0!==m.excitation[e]&&!(Math.random()>t*u)){var n,r,i,o=Math.random(),a=Math.random(),s=m.excitation[e],l=1/s;for(i=0;s>i;i++)if(o>=i*l&&(i+1)*l>o&&a>N)return n=M[m.element[e]],r=n[s]-n[i],m.excitation[e]=i,void it(e,r)}},lt=function(e){return e%=s,0>e||e>s?Math.abs(s-Math.abs(e)):e};return emitLightSourcePhotons=function(){var e,t,n,r,o,a,s,l,u,c=I[0],d=I[1],p=I[2]-c,h=I[3]-d,f=lt(L.angleOfIncidence),m=L.frequency*i,g=L.numberOfBeams;if(0==f)for(e=h/(g+1),u=1;g>=u;u++)rt(c,d+e*u,f,m);else if(f.toFixed(4)==(Math.PI/2).toFixed(4))for(e=p/(g+1),u=1;g>=u;u++)rt(c+e*u,d,f,m);else if(f.toFixed(4)==Math.PI.toFixed(4))for(e=h/(g+1),u=1;g>=u;u++)rt(c+p,d+e*u,f,m);else if(f.toFixed(4)==(3*Math.PI/2).toFixed(4))for(e=p/(g+1),u=1;g>=u;u++)rt(c+e*u,d+h,f,m);else if(t=Math.abs(Math.sin(f)),n=Math.abs(Math.cos(f)),r=n*p>t*h?h/n:p/t,e=r/g,o=e/t,a=e/n,s=Math.floor(p/o),l=Math.floor(h/a),f>=0&&f<.5*Math.PI){for(u=1;s>=u;u++)rt(c+o*u,d,f,m);for(u=0;l>=u;u++)rt(c,d+h-a*u,f,m)}else if(f>=3*Math.PI/2){for(u=1;s>=u;u++)rt(c+o*u,d+h,f,m);for(u=0;l>=u;u++)rt(c,d+a*u,f,m)}else if(f<Math.PI&&f>=.5*Math.PI){for(u=0;s>=u;u++)rt(c+p-o*u,d,f,m);for(u=1;l>=u;u++)rt(c+p,d+h-a*u,f,m)}else if(f>=Math.PI&&f<3*Math.PI/2){for(u=0;s>=u;u++)rt(c+p-o*u,d+h,f,m);for(u=1;l>=u;u++)rt(c+p,d+a*u,f,m)}},h={initialize:function(e){m=e.atoms,g=e.elements,V(),F(R.photons),U(R.photons)},performActionWithinIntegrationLoop:function(e,t,n){f=n,ot(t),z(),q(e),at(t),L.on&&n%L.radiationPeriod<t&&emitLightSourcePhotons()},turnOnLightSource:function(){L.on=!0},turnOffLightSource:function(){L.on=!1},setLightSourceAngle:function(e){L.angleOfIncidence=e},setLightSourceFrequency:function(e){L.frequency=e},setLightSourcePeriod:function(e){L.radiationPeriod=e},setLightSourceNumber:function(e){L.numberOfBeams=e},getPhotons:function(){return v},getNumPhotons:function(){return G},getViewPhotons:function(){function e(e,t){var n=e.vx[t],r=e.vy[t],i=-180*Math.atan2(r,n)/Math.PI;return{id:e.id[t],x:e.x[t],y:e.y[t],vx:n,vy:r,angle:i,angularFrequency:e.angularFrequency[t]}}var t=[],n=[];return function(){var r,i,o,a=this.getPhotons(),s=0;for(t.length=this.getNumPhotons(),n.length=a.x.length,r=0,i=a.x.length;i>r;r++)a.vx[r]||a.vy[r]?(o=n[r],o&&o.id===a.id[r]?(o.x=a.x[r],o.y=a.y[r]):(o=e(a,r),n[r]=o),t[s++]=o):n[r]=null;return t}}(),getElementEnergyLevels:function(){return M},getRadiationlessEmissionProbability:function(){return N},getLightSource:function(){return L?L:void 0},getState:function(){return[new t(v,{padArraysWithZeroes:!0}),{clone:function(){return{numPhotons:G}},restore:function(e){G=e.numPhotons}}]}}}}),define("models/md2d/models/engine/plugins/chemical-reactions",["require","arrays","common/array-types","models/md2d/models/metadata","common/validator","models/md2d/models/engine/constants/index","models/md2d/models/engine/math/utils"],function(e){function t(e,t,n,r){return e*n+t*r}function n(e,t){var n,r,i,o=e.length,a=t.length;for(n=0;o>n;n++)for(i=e[n],r=0;a>r;r++)if(i===t[r])return!0;return!1}var r=e("arrays"),i=e("common/array-types"),o=e("models/md2d/models/metadata"),a=e("common/validator"),s=e("models/md2d/models/engine/constants/index"),l=e("models/md2d/models/engine/math/utils").getAngleBetweenVec,u=s.unit,c=.6,d={1:101,2:107,3:108},p=function(){var e={};return Object.keys(d).forEach(function(t){e[d[t]]=t}),e}(),h=10,f=50;return function(e,m){function g(){var e=Z.x.length;Z.sharedElectrons=r.create(e,0,i.int8Type)}function v(e){var t=ot[Z.element[e]],n=Z.sharedElectrons[e];return t>n&&8>t+n}function y(e,t){return c*(Q.sigma[e]+Q.sigma[t])}function b(e,t){return 2e4*Math.sqrt(Q.epsilon[e]*Q.epsilon[t])}function x(e){var t=ot[Z.element[e]];return Math.min(Math.min(8-t,t)-Z.sharedElectrons[e])}function w(e,t,n){void 0===n&&(n=0);var r=Math.min(3,x(e),x(t)+n);if(1>=r)return r;var i=A(Z.element[e],Z.element[t]),o=Math.random();return 3===r?o<i[0]?1:o<i[0]+i[1]?2:3:o<i[0]+i[2]?1:2}function _(e){var t=et.type[e]-105;return 0>t?1:t}function T(e,t,n){switch(void 0===n&&(n=1),n){case 1:return null!=at[e+"-"+t]?at[e+"-"+t]:null!=at[t+"-"+e]?at[t+"-"+e]:at["default"];case 2:return null!=at[e+"="+t]?at[e+"="+t]:null!=at[t+"="+e]?at[t+"="+e]:2*T(e,t,1);case 3:return null!=at[e+"#"+t]?at[e+"#"+t]:null!=at[t+"#"+e]?at[t+"#"+e]:3*T(e,t,1)}}function C(e,t,n){return null!=st[e+"+"+t+"-"+n]?st[e+"+"+t+"-"+n]:null!=st[e+"+"+n+"-"+t]?st[e+"+"+n+"-"+t]:st["default"]}function A(e,t){return null!=lt[e+"-"+t]?lt[e+"-"+t]:null!=lt[t+"-"+e]?lt[t+"+"+e]:lt["default"]}function S(e,t,n,r,i){var o=T(t,n,r),a=T(e,t,i);return a>o?C(e,t,n):C(e,t,n)+o-a}function P(t,n,r,i){t.atom1=n,t.atom2=r,t.type=d[i],e.addRadialBond(t),ct=!0,dt[n]=!0,dt[r]=!0,Z.sharedElectrons[n]+=i,Z.sharedElectrons[r]+=i}function E(t,n,r,i){e.removeRadialBond(t,!0),ct=!0,dt[n]=!0,dt[r]=!0,Z.sharedElectrons[n]-=i,Z.sharedElectrons[r]-=i}function k(t,n,r,i,o,a,s){n.atom1=r,n.atom2=i,n.type=d[a],e.setRadialBondProperties(t,n,!0),ct=!0,dt[r]=!0,dt[i]=!0,dt[o]=!0,Z.sharedElectrons[r]+=a,Z.sharedElectrons[i]+=a-s,Z.sharedElectrons[o]-=s,ut[o]===t&&(ut[o]=void 0),ut[i]=void 0}function R(t){e.addAngularBond(t),ct=!0}function M(t,n){e.setAngularBondProperties(t,n),ct=!0}function N(){ct=!1,Object.keys(dt).forEach(function(e){delete dt[e]})}function O(){var t,n,r;for(n=0,r=e.getNumberOfAtoms();r>n;n++)Z.sharedElectrons[n]=0;for(n=0,r=e.getNumberOfRadialBonds();r>n;n++)t=_(n),Z.sharedElectrons[et.atom1[n]]+=t,Z.sharedElectrons[et.atom2[n]]+=t}function L(){var t,n;for(ut.length=0,t=0,n=e.getNumberOfRadialBonds();n>t;t++)ut[et.atom1[t]]=ut[et.atom2[t]]=t}function I(t){var n,r,i,o,a,s,l,u,c,d,p,h,f;for(n=0;n<e.getNumberOfRadialBonds();)f=!1,r=et.atom1[n],i=et.atom2[n],d=et.length[n],l=Z.x[r]-Z.x[i],u=Z.y[r]-Z.y[i],c=l*l+u*u,s=Math.sqrt(c)-d,(s>0||t)&&(s=.5*et.strength[n]*s*s,o=Z.element[r],a=Z.element[i],p=_(n),h=T(o,a,p),(s>h||t)&&(s-=h,s+=e.ljCalculator[o][a].potentialFromSquaredDistance(c),e.addKEToAtoms(s,r,i)?(E(n,r,i,p),f=!0):t&&(e.addKEToAtoms(s),E(n,r,i,p),f=!0))),f||n++}function D(t){var n,r,i,o,a,s,l,u,d,p,h,f,m=e.getNumberOfAtoms(),g=t.getList();for(i=0;m>i;i++)for(a=Z.element[i],l=Z.x[i],u=Z.y[i],n=t.getStartIdxFor(i),r=t.getEndIdxFor(i);r>n;n++)o=g[n],e.atomsBonded(i,o)||(s=Z.element[o],d=l-Z.x[o],p=u-Z.y[o],h=d*d+p*p,f=c*(Q.sigma[a]+Q.sigma[s]),f*f>h&&V(i,o,d,p,h))}function B(e,n,r,i){return!(t(Z.vx[e],Z.vy[e],r,i)>=0&&t(Z.vx[n],Z.vy[n],r,i)<=0)}function V(t,r,i,o,a){var s,l,u,c,d;if(B(t,r,i,o)&&(s=v(t),l=v(r),u=s&&l,c=s&&void 0!==ut[r],d=l&&void 0!==ut[t],u||c||d)){if(n(e.getBondedAtoms(t),e.getBondedAtoms(r)))return;if(it&&-1!==e.getMoleculeAtoms(r).indexOf(t))return;u?F(t,r,a):c?j(t,r,ut[r],i,o,a):d&&j(r,t,ut[t],i,o,a)}}function F(t,n,r){var i,o,a,s=Z.element[t],l=Z.element[n],u=w(t,n),c=T(s,l,u);0>=c||(i=y(s,l),o=b(s,l),a=Math.sqrt(r)-i,a=-.5*o*a*a,a+=c,a-=e.ljCalculator[s][l].potentialFromSquaredDistance(r),e.addKEToAtoms(a,t,n)&&P({length:i,strength:o},t,n,u))}function j(t,n,r,i,o,a){var l,c,d,p,h,f,m=Z.element[t],g=Z.element[n],v=et.atom1[r],x=et.atom2[r],C=Z.element[v],A=Z.element[x],P=v!==t&&v!==n?v:x,E=Z.element[P],R=_(r),M=w(t,n,R),N=S(m,g,E,R,M),O=1/Math.sqrt(a),L=Z.vx[t]-Z.vx[n],I=Z.vy[t]-Z.vy[n],D=L*i*O+I*o*O,B=Z.mass[t],V=Z.mass[n],F=s.convert(B*V/(B+V)*D*D,{from:u.MW_ENERGY_UNIT,to:u.EV});F>N&&(l=y(m,g),c=b(m,g),d=et.length[r],p=et.strength[r],h=Math.sqrt(a)-l,f=-.5*c*h*h,f+=T(m,g,M),f-=e.ljCalculator[m][g].potentialFromSquaredDistance(a),i=Z.x[v]-Z.x[x],o=Z.y[v]-Z.y[x],a=i*i+o*o,h=Math.sqrt(a)-d,f-=-.5*p*h*h,f-=T(C,A,R),f+=e.ljCalculator[C][A].potentialFromSquaredDistance(a),e.addKEToAtoms(f,t,n,P)&&k(r,{length:l,strength:c},t,n,P,M,R))}function G(){for(var t=0;t<e.getNumberOfAngularBonds();)dt[tt.atom3[t]]?e.removeAngularBond(t,!0):t++}function U(){var t,n,r,i,o,a;for(t=0,n=e.getNumberOfAngularBonds();n>t;t++)0===tt.strength[t]&&(r=tt.atom1[t],i=tt.atom2[t],o=tt.atom3[t],a=tt.angle[t]-z(r,i,o),a=-.5*f*a*a,e.addKEToAtoms(a,r,i,o)&&M(t,{strength:f}))}function z(e,t,n){return l(Z.x[e],Z.y[e],Z.x[t],Z.y[t],Z.x[n],Z.y[n])}function W(e,t,n){return 2*Math.PI/(Math.min(4,e)-(t-n))}function $(){var t,n,r,i,o,a,s,l,u=[];for(t=0,n=e.getNumberOfRadialBonds();n>t;t++)r=et.atom1[t],i=et.atom2[t],o=p[et.type],dt[r]&&(u[r]?u[r].push(i):u[r]=[i]),dt[i]&&(u[i]?u[i].push(r):u[i]=[r]);for(t=0,n=u.length;n>t;t++)s=u[t],!s||s.length<2||(a=W(ot[Z.element[t]],Z.sharedElectrons[t],s.length),2===s.length?(r=s[0],i=s[1],X(r,i,t,a)):(l=[],3===s.length?(q(l,s[0],s[1],t),q(l,s[0],s[2],t),q(l,s[1],s[2],t)):4===s.length&&(q(l,s[0],s[1],t),q(l,s[0],s[2],t),q(l,s[0],s[3],t),q(l,s[1],s[2],t),q(l,s[1],s[3],t),q(l,s[2],s[3],t)),l.sort(H),Y(l,s.length-1,a)))}function q(e,t,n,r){e.push({angle:z(t,n,r),a1:t,a2:n,aCentral:r})}function H(e,t){return e.angle<t.angle?-1:e.angle>t.angle?1:0}function Y(e,t,n){var r,i;for(r=0;t>r;r++)i=e[r],X(i.a1,i.a2,i.aCentral,n,i.angle)}function X(t,n,r,i,o){o||(o=z(t,n,r));var a={atom1:t,atom2:n,atom3:r,angle:i},s=i-o;s=-.5*f*s*s,a.strength=e.addKEToAtoms(s,t,n,r)?f:0,R(a)}function J(){var t,n,r=0;for(t=0,n=e.getNumberOfRadialBonds();n>t;++t)r-=T(Z.element[et.atom1[t]],Z.element[et.atom2[t]],_(t));return r}var K,Z,Q,et,tt,nt=a.validateCompleteness(o.chemicalReactions,m),rt=nt.createAngularBonds,it=nt.noLoops,ot=nt.valenceElectrons,at=nt.bondEnergy,st=nt.activationEnergy,lt=nt.bondProbability,ut=[],ct=!1,dt={};return K={initialize:function(e){Z=e.atoms,Q=e.elements,et=e.radialBonds,tt=e.angularBonds,g()},performActionWithinIntegrationLoop:function(t,n,r){var i=r%h;(0===i||n>i&&Math.floor(r/h)===Math.round(r/h))&&(N(),O(),I(),L(),D(t),rt&&(Object.keys(dt).length>0?(G(),U(),$()):U()),ct&&e.updateParticlesAccelerations())},getState:function(){return[]},processOutputState:function(e){e.PE+=J()},setBondEnergy:function(e,t){at[e]=t},setValenceElectrons:function(e,t){ot[e]=t,I(!0),O()}}}}),define("models/md2d/models/modeler",["require","common/performance","common/serialize","common/validator","common/lab-modeler-mixin","common/output-support","common/models/tick-history","models/md2d/models/engine/md2d","models/md2d/models/metadata","models/md2d/models/engine/constants/units","models/md2d/models/unit-definitions/index","models/md2d/models/units-translation","cs!models/md2d/models/solvent","models/md2d/models/aminoacids-props","cs!models/md2d/models/aminoacids-helper","models/md2d/models/engine/genetic-engine","models/md2d/models/performance-optimizer","models/md2d/models/atom-transition","underscore","models/md2d/models/engine/plugins/quantum-dynamics","models/md2d/models/engine/plugins/chemical-reactions"],function(e){var t=e("common/performance"),n=e("common/serialize"),r=e("common/validator"),i=e("common/lab-modeler-mixin"),o=e("common/output-support"),a=e("common/models/tick-history"),s=e("models/md2d/models/engine/md2d"),l=e("models/md2d/models/metadata"),u=e("models/md2d/models/engine/constants/units"),c=e("models/md2d/models/unit-definitions/index"),d=e("models/md2d/models/units-translation"),p=e("cs!models/md2d/models/solvent"),h=e("models/md2d/models/aminoacids-props"),f=e("cs!models/md2d/models/aminoacids-helper"),m=e("models/md2d/models/engine/genetic-engine"),g=e("models/md2d/models/performance-optimizer"),v=e("models/md2d/models/atom-transition"),y=e("underscore"),b=e("models/md2d/models/engine/plugins/quantum-dynamics"),x=e("models/md2d/models/engine/plugins/chemical-reactions"),w=0;return function(e,_){function T(e){var t,n;for(tt.startBatch(),t=0,n=ft.length;n>t;t++)ft[t].process(e);for(t=0;t<ft.length;)ft[t].isFinished?ft.splice(t,1):t++;tt.endBatch()}function C(e,t){e=y.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function A(e,t){return ot?C(e,function(e,n){return ot.translateToModelUnits(n,t[e]&&t[e].unitType)}):e}function S(e,t){return ot?C(e,function(e,n){return ot.translateFromModelUnits(n,t[e]&&t[e].unitType)}):e}function P(){mt.updateParticlesAccelerations(),mt.computeOutputState(ht),Z=mt.callPluginAccessor("getViewPhotons"),E(ht.atoms),k(ht.radialBonds,ht.atoms),R()}function E(e){var t,n,r,i,o=mt.getNumberOfAtoms();for(gt.length=o,t=0,o;o>t;t++){gt[t]||(gt[t]={idx:t}),i=gt[t];for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n][t]);i.aminoAcid=f.isAminoAcid(e.element[t]),i.aminoAcid&&(r=f.getAminoAcidByElement(e.element[t]),i.symbol=r.symbol,i.label=r.abbreviation)}}function k(e,t){var n,r,i,o=mt.getNumberOfRadialBonds();for(vt.length=o,i=0;o>i;i++){vt[i]||(vt[i]={idx:i}),n=vt[i];for(r in e)n[r]=e[r][i];n.x1=t.x[n.atom1],n.y1=t.y[n.atom1],n.x2=t.x[n.atom2],n.y2=t.y[n.atom2]}}function R(){if(yt.length&&tt.properties.showElectricField){var e,t,n;for(e=0,t=yt.length;t>e;e++)n=yt[e],mt.getCoulombForceAt(n.x,n.y,n)}}function M(){for(var e=mt.getNumberOfElements(),t=Math.floor(Math.random()*e);f.isAminoAcid(t);)t=Math.floor(Math.random()*e);return t}function N(){var e,t,n,r;for(n=mt.getNumberOfElements();n<=f.lastElementID;n++)tt.addElement({id:n});for(n=0,r=h.length;r>n;n++)e=18*Math.pow(h[n].volume/h[0].volume,.3333333333333),t=u.convert(e/10,{from:u.unit.ANGSTROM,to:u.unit.NANOMETER}),mt.setElementProperties(f.firstElementID+n,{mass:h[n].molWeight,sigma:t})}function O(e){var t=e.minX,n=e.minY,r=e.maxX,i=e.maxY;e.minX=null!=t?t:0,e.maxX=null!=r?r:e.width,e.minY=null!=n?n:0,e.maxY=null!=i?i:e.height}function L(e,t){mt.setDimensions([e.minX,e.minY,e.maxX,e.maxY]),t.quantumDynamics?(e.useQuantumDynamics=!0,mt.addPlugin(new b(mt,t.quantumDynamics))):e.useQuantumDynamics=!1,t.chemicalReactions?(e.useChemicalReactions=!0,mt.addPlugin(new x(mt,t.chemicalReactions))):e.useChemicalReactions=!1,W=mt.elements,X=mt.radialBonds,J=mt.angularBonds,K=mt.restraints,$=mt.obstacles,q=mt.shapes,H=mt.lines,Y=mt.electricFields}function I(e){var t={};return 0===e.length?{}:(Object.keys(e[0]).forEach(function(e){t[e]=[]}),e.forEach(function(e){Object.keys(e).forEach(function(n){t[n].push(e[n])})}),t)}function D(){var e=tt.getPhotons(),t={photons:n(l.photon,I(e),e.length),elementEnergyLevels:mt.callPluginAccessor("getElementEnergyLevels"),radiationlessEmissionProbability:mt.callPluginAccessor("getRadiationlessEmissionProbability"),lightSource:mt.callPluginAccessor("getLightSource")};
return t.lightSource||delete t.lightSource,t}function B(){return{}}function V(){lt.invalidatingChangePreHook(),lt.invalidatingChangePostHook()}this.constructor.type="md2d",_=_||{};var F,j,G,U,z,W,$,q,H,Y,X,J,K,Z,Q,et,tt={},nt="md2dModel"+ ++w,rt={targetTemperature:function(e){mt.setTargetTemperature(e)},temperatureControl:function(e){mt.useThermostat(e)},lennardJonesForces:function(e){mt.useLennardJonesInteraction(e)},coulombForces:function(e){mt.useCoulombInteraction(e)},solventForceType:function(e){mt.setSolventForceType(e)},DNAState:function(e){mt.setDNAState(e)},solventForceFactor:function(e){mt.setSolventForceFactor(e)},additionalSolventForceMult:function(e){mt.setAdditionalSolventForceMult(e)},additionalSolventForceThreshold:function(e){mt.setAdditionalSolventForceThreshold(e)},dielectricConstant:function(e){mt.setDielectricConstant(e)},realisticDielectricEffect:function(e){mt.setRealisticDielectricEffect(e)},VDWLinesCutoff:function(e){var t=ut[e];t&&mt.setVDWLinesRatio(t)},gravitationalField:function(e){mt.setGravitationalField(e)},modelSampleRate:function(){tt.isStopped()||tt.restart()},viscosity:function(e){mt.setViscosity(e)},polarAAEpsilon:function(e){var t,n,r,i,o,a;for(t=f.getPolarAminoAcids(),i=0,a=t.length;a>i;i++)for(n=t[i],o=i+1;a>o;o++)r=t[o],mt.pairwiseLJProperties.set(n,r,{epsilon:e})},electricFieldDensity:function(e){if(yt.length=0,e)for(var t,n=0,r=0,i=tt.properties.width,o=tt.properties.height,a=tt.properties.width/e,s=o/a%1*a,l=r+.5*(s+(o>=a?a:0));o>l;){for(t=n+.5*a;i>t;)yt.push({x:t,y:l}),t+=a;l+=a}}},it=c.get(e.unitsScheme||"md2d"),ot=function(){var t=e.unitsScheme||"md2d";return"md2d"!==t?new d(it):void 0}(),at=new i({metadata:l,setters:rt,unitsDefinition:it,unitsTranslation:ot,initialProperties:e}),st=function(){var e=at.dispatchSupport;return e.addEventTypes("tick","addAtom","removeAtom","addRadialBond","removeRadialBond","addElectricField","removeElectricField","changeElectricField","removeAngularBond","textBoxesChanged","imagesChanged"),e}(),lt=at.propertySupport,ut={"short":1.33,medium:1.67,"long":2},ct=1e3,dt=!1,pt=[],ht=window.state={},ft=[],mt=function(){var e=s.createEngine();return e.pairwiseLJProperties.registerChangeHooks(lt.invalidatingChangePreHook,lt.invalidatingChangePostHook),e}(),gt=[],vt=[],yt=[],bt=null,xt=function(){var e=[{getNum:"getNumberOfAtoms",addEvent:"addAtom",removeEvent:"removeAtom"},{getNum:"getNumberOfRadialBonds",addEvent:"addRadialBond",removeEvent:"removeRadialBond"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=mt[r.getNum]();for(t(),n=0;n<e.length;n++)r=e[n],i=mt[r.getNum](),i>r.num?st[r.addEvent]():i<r.num&&st[r.removeEvent]()}}();return tt.stepCounter=function(){return G.get("counter")},tt.stepStartCounter=function(){return G.get("startCounter")},tt.steps=function(){return G.get("length")},tt.isNewStep=function(){return dt},tt.seek=function(e){return arguments.length||(e=0),tt.isStopped()||tt.stop(),dt=!1,xt(function(){G.seekExtract(e),P(),tt.updateAllOutputProperties(),st.seek()}),G.get("counter")},tt.stepBack=function(e){return arguments.length||(e=1),tt.isStopped()||tt.stop(),dt=!1,xt(function(){var t,n;for(t=-1;++t<e;)n=G.get("index"),n>0&&(G.decrementExtract(),P(),tt.updateAllOutputProperties(),st.stepBack())}),G.get("counter")},tt.stepForward=function(e){return arguments.length||(e=1),tt.isStopped()||tt.stop(),xt(function(){var t,n,r;for(t=-1;++t<e;)n=G.get("index"),r=G.get("length"),r-1>n?(G.incrementExtract(),P(),tt.updateAllOutputProperties(),st.stepForward()):tt.tick()}),G.get("counter")},tt.createElements=function(e){var t,n,r,i;if(tt.startBatch(),void 0===e)return tt.addElement({id:0}),void tt.endBatch();for(t=0,n=e.mass.length;n>t;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);tt.addElement(i)}return tt.endBatch(),tt},tt.createAtoms=function(e){var t,n,r,i,o={suppressCheck:!0};for(st.willReset(),tt.startBatch(),n=e.x.length,t=0;n>t;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);tt.addAtom(i,o)}tt.endBatch(),st.reset()},tt.createRadialBonds=function(e){var t,n,r,i=e.strength.length;for(tt.startBatch(),t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addRadialBond(r)}return tt.endBatch(),tt},tt.createAngularBonds=function(e){var t,n,r,i=e.strength.length;for(tt.startBatch(),t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addAngularBond(r)}return tt.endBatch(),tt},tt.createRestraints=function(e){var t,n,r,i=e.atomIndex.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addRestraint(r)}return tt},tt.createObstacles=function(e){var t,n,r,i=e.x.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addObstacle(r)}return tt},tt.createShapes=function(e){var t,n,r,i=e.x.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addShape(r)}return tt},tt.createLines=function(e){var t,n,r,i=e.x1.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addLine(r)}return tt},tt.createElectricFields=function(e){return tt.batch(function(){var t,n,r,i=e.intensity.length;for(t=0;i>t;t++){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n][t]);tt.addElectricField(r)}}),tt},tt.reset=function(){st.willReset(),lt.invalidatingChangePreHook(),mt.setTime(0),G.restoreInitialState(),lt.invalidatingChangePostHook(),tt.resetAllOutputProperties(),st.reset()},tt.getTotalMass=function(){return mt.getTotalMass()},tt.getAtomKineticEnergy=function(e){return mt.getAtomKineticEnergy(e)},tt.addRandomAtom=function(e,t){null==e&&(e=M()),null==t&&(t=0);var n,r,i,o=tt.get("width"),a=tt.get("height"),s=tt.get("minX"),l=tt.get("minY"),u=mt.getRadiusOfElement(e),c=0,d=10;do if(n=s+Math.random()*o-2*u,r=l+Math.random()*a-2*u,i=mt.findMinimumPELocation(e,n,r,0,0,t),i&&tt.addAtom({element:e,x:i[0],y:i[1],charge:t}))return!0;while(++c<d);return!1},tt.addAtom=function(e,t){var n,i=tt.get("minX"),o=tt.get("minY"),a=tt.get("maxX"),s=tt.get("maxY");return t=t||{},e=r.validateCompleteness(l.atom,e),n=mt.getRadiusOfElement(e.element),e.x<i+n&&(e.x=i+n),e.x>a-n&&(e.x=a-n),e.y<o+n&&(e.y=o+n),e.y>s-n&&(e.y=s-n),t.suppressCheck||mt.canPlaceAtom(e.element,e.x,e.y)?(lt.invalidatingChangePreHook(),mt.addAtom(e),lt.invalidatingChangePostHook(),st.addAtom(),!0):!1},tt.removeAtom=function(e){var t=mt.getNumberOfRadialBonds(),n=mt.getNumberOfAngularBonds();lt.invalidatingChangePreHook(),mt.removeAtom(e),gt.length=0,lt.invalidatingChangePostHook(),st.removeAtom(),mt.getNumberOfRadialBonds()!==t&&st.removeRadialBond(),mt.getNumberOfAngularBonds()!==n&&st.removeAngularBond()},tt.addElement=function(e){e=r.validateCompleteness(l.element,e),mt.addElement(e)},tt.addObstacle=function(e){var t;t=r.validateCompleteness(l.obstacle,e),lt.invalidatingChangePreHook(),mt.addObstacle(t),lt.invalidatingChangePostHook()},tt.removeObstacle=function(e){lt.invalidatingChangePreHook(),mt.removeObstacle(e),lt.invalidatingChangePostHook()},tt.addShape=function(e){var t;t=r.validateCompleteness(l.shape,e),lt.invalidatingChangePreHook(),mt.addShape(t),lt.invalidatingChangePostHook()},tt.removeShape=function(e){var t=mt.getNumberOfElectricFields();lt.invalidatingChangePreHook(),mt.removeShape(e),lt.invalidatingChangePostHook(),mt.getNumberOfElectricFields()!==t&&st.removeElectricField()},tt.addLine=function(e){var t;t=r.validateCompleteness(l.line,e),lt.invalidatingChangePreHook(),mt.addLine(t),lt.invalidatingChangePostHook()},tt.removeLine=function(e){lt.invalidatingChangePreHook(),mt.removeLine(e),lt.invalidatingChangePostHook()},tt.addElectricField=function(e){var t;t=r.validateCompleteness(l.electricField,e),lt.invalidatingChangePreHook(),mt.addElectricField(t),lt.invalidatingChangePostHook(),st.addElectricField()},tt.removeElectricField=function(e){lt.invalidatingChangePreHook(),mt.removeElectricField(e),lt.invalidatingChangePostHook(),st.removeElectricField()},tt.addRadialBond=function(e){e=r.validateCompleteness(l.radialBond,e),lt.invalidatingChangePreHook(),mt.addRadialBond(e),lt.invalidatingChangePostHook(),st.addRadialBond()},tt.removeRadialBond=function(e){lt.invalidatingChangePreHook(),mt.removeRadialBond(e),lt.invalidatingChangePostHook(),st.removeRadialBond()},tt.addAngularBond=function(e){e=r.validateCompleteness(l.angularBond,e),lt.invalidatingChangePreHook(),mt.addAngularBond(e),lt.invalidatingChangePostHook()},tt.removeAngularBond=function(e){lt.invalidatingChangePreHook(),mt.removeAngularBond(e),lt.invalidatingChangePostHook(),st.removeAngularBond()},tt.addRestraint=function(e){e=r.validateCompleteness(l.restraint,e),lt.invalidatingChangePreHook(),mt.addRestraint(e),lt.invalidatingChangePostHook()},tt.getMoleculeBoundingBox=function(e){var t,n,r,i,o,a,s,l=ht.atoms,u=-1/0,c=1/0,d=1/0,p=-1/0;for(t=mt.getMoleculeAtoms(e),t.push(e),n=0;n<t.length;n++)r=l.x[t[n]],i=l.y[t[n]],o=l.radius[t[n]],c>r-o&&(c=r-o),r+o>p&&(p=r+o),d>i-o&&(d=i-o),i+o>u&&(u=i+o);return a=l.x[e],s=l.y[e],{top:u-s,left:c-a,bottom:d-s,right:p-a}},tt.setTemperatureOfAtoms=function(e,t){lt.invalidatingChangePreHook(),mt.setTemperatureOfAtoms(e,t),lt.invalidatingChangePostHook()},tt.addKEToAtoms=function(e,t){lt.invalidatingChangePreHook(),null==t?mt.addKEToAtoms(e):mt.addKEToAtoms.apply(mt,[e].concat(t)),lt.invalidatingChangePostHook()},tt.getTemperatureOfAtoms=function(e){return mt.getTemperatureOfAtoms(e)},tt.setAtomProperties=function(e,t,n,i){var o,a,s,u,c,d,p,h=ht.atoms;if(t=r.validate(l.atom,t),i&&(o=mt.getMoleculeAtoms(e),o.length>0))for(a="number"==typeof t.x?t.x-h.x[e]:0,s="number"==typeof t.y?t.y-h.y[e]:0,d=0,p=o.length;p>d;d++)if(u=h.x[o[d]]+a,c=h.y[o[d]]+s,!tt.setAtomProperties(o[d],{x:u,y:c},n,!1))return!1;if(n){var f="number"==typeof t.x?t.x:h.x[e],m="number"==typeof t.y?t.y:h.y[e],g="number"==typeof t.element?t.y:h.element[e];if(!mt.canPlaceAtom(g,f,m,e))return!1}return lt.invalidatingChangePreHook(),mt.setAtomProperties(e,A(t,l.atom)),lt.invalidatingChangePostHook(),!0},tt.getAtomProperties=function(e){var t,n=ht.atoms,r=l.atom,i={};for(t in r)r.hasOwnProperty(t)&&n[t]&&(i[t]=n[t][e]);return S(i,r)},tt.getRadialBondsForAtom=function(e){return mt.getRadialBondsForAtom(e)},tt.getBondedAtoms=function(e){return mt.getBondedAtoms(e)},tt.getAngularBondsForAtom=function(e){return mt.getAngularBondsForAtom(e)},tt.getMoleculeAtoms=function(e){return mt.getMoleculeAtoms(e)},tt.setElementProperties=function(e,t){if(t=r.validate(l.element,t),f.isAminoAcid(e))throw new Error("Elements: elements with ID "+e+" cannot be edited, as they define amino acids.");lt.invalidatingChangePreHook(),mt.setElementProperties(e,A(t,l.element)),lt.invalidatingChangePostHook()},tt.getElementProperties=function(e){var t,n=l.element,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=W[t][e]);return S(r,n)},tt.setObstacleProperties=function(e,t){t=r.validate(l.obstacle,t),lt.invalidatingChangePreHook(),mt.setObstacleProperties(e,A(t,l.obstacle)),lt.invalidatingChangePostHook()},tt.getObstacleProperties=function(e){var t,n=l.obstacle,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=$[t][e]);return S(r,n)},tt.setShapeProperties=function(e,t){t=r.validate(l.shape,t),lt.invalidatingChangePreHook(),mt.setShapeProperties(e,A(t,l.shape)),lt.invalidatingChangePostHook()},tt.getShapeProperties=function(e){var t,n=l.shape,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=q[t][e]);return S(r,n)},tt.setLineProperties=function(e,t){t=r.validate(l.line,t),lt.invalidatingChangePreHook(),mt.setLineProperties(e,A(t,l.line)),lt.invalidatingChangePostHook()},tt.getLineProperties=function(e){var t,n=l.line,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=H[t][e]);return S(r,n)},tt.setElectricFieldProperties=function(e,t){t=r.validate(l.electricField,t),lt.invalidatingChangePreHook(),mt.setElectricFieldProperties(e,A(t,l.electricField)),lt.invalidatingChangePostHook(),st.changeElectricField()},tt.getElectricFieldProperties=function(e){var t,n=l.electricField,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=Y[t][e]);return S(r,n)},tt.setRadialBondProperties=function(e,t){t=r.validate(l.radialBond,t),lt.invalidatingChangePreHook(),mt.setRadialBondProperties(e,A(t,l.radialBond)),lt.invalidatingChangePostHook()},tt.getRadialBondProperties=function(e){var t,n=l.radialBond,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=X[t][e]);return S(r,n)},tt.setRestraintProperties=function(e,t){t=r.validate(l.restraint,t),lt.invalidatingChangePreHook(),mt.setRestraintProperties(e,A(t,l.restraint)),lt.invalidatingChangePostHook()},tt.getRestraintProperties=function(e){var t,n=l.restraint,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=K[t][e]);return S(r,n)},tt.setAngularBondProperties=function(e,t){t=r.validate(l.angularBond,t),lt.invalidatingChangePreHook(),mt.setAngularBondProperties(e,A(t,l.angularBond)),lt.invalidatingChangePostHook()},tt.getAngularBondProperties=function(e){var t,n=l.angularBond,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=J[t][e]);return S(r,n)},tt.setSolvent=function(e){var t=new p(e),n={solventForceType:t.forceType,dielectricConstant:t.dielectricConstant,backgroundColor:t.color};tt.set(n)},tt.addSpringForce=function(e,t,n,r){return null==r&&(r=500),ot&&(r=ot.translateToModelUnits(r,"stiffness")),mt.addSpringForce(e,t,n,r)},tt.updateSpringForce=function(e,t,n){mt.updateSpringForce(e,t,n)},tt.removeSpringForce=function(e){mt.removeSpringForce(e)},tt.addTextBox=function(e){e=r.validateCompleteness(l.textBox,e),tt.get("textBoxes").push(e),st.textBoxesChanged()},tt.removeTextBox=function(e){var t=tt.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');tt.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),st.textBoxesChanged()},tt.setTextBoxProperties=function(e,t){var n,i=tt.get("textBoxes")[e];if(!i)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.textBox,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);st.textBoxesChanged()},tt.setImageProperties=function(e,t){var n,i=tt.get("images")[e];if(!i)throw new Error('Image "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.image,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);st.imagesChanged()},tt.getTextBoxProperties=function(e){return tt.get("textBoxes")[e]},tt.getImageProperties=function(e){return tt.get("images")[e]},tt.liveDragStart=function(e,t,n){null==bt&&(null==t&&(t=ht.atoms.x[e]),null==n&&(n=ht.atoms.y[e]),Q=tt.getAtomProperties(e).friction,tt.setAtomProperties(e,{friction:tt.LIVE_DRAG_FRICTION}),bt=tt.addSpringForce(e,t,n,500))},tt.liveDrag=function(e,t){tt.updateSpringForce(bt,e,t)},tt.liveDragEnd=function(){var e=mt.springForceAtomIndex(bt);tt.setAtomProperties(e,{friction:Q}),tt.removeSpringForce(bt),bt=null},tt.getFPS=function(){for(var e=0,t=pt.length,n=-1;++n<t;)e+=pt[n];return e/=t,e?1/e*1e3:0},tt.getSimulationProgressRate=function(){return tt.getFPS()*tt.get("timeStep")*tt.get("timeStepsPerTick")},tt.get_elements=function(){return W},tt.getAtoms=function(){return gt},tt.getRadialBonds=function(){return vt},tt.getElectricField=function(){return yt},tt.getPhotons=function(){return Z},tt.turnOnLightSource=function(){mt.callPluginAccessor("turnOnLightSource")},tt.turnOffLightSource=function(){mt.callPluginAccessor("turnOffLightSource")},tt.setLightSourceAngle=function(e){mt.callPluginAccessor("setLightSourceAngle",[e])},tt.setLightSourceFrequency=function(e){mt.callPluginAccessor("setLightSourceFrequency",[e])},tt.setLightSourcePeriod=function(e){mt.callPluginAccessor("setLightSourcePeriod",[e])},tt.setLightSourceNumber=function(e){mt.callPluginAccessor("setLightSourceNumber",[e])},tt.setBondEnergy=function(e,t){mt.callPluginAccessor("setBondEnergy",[e,t])},tt.setValenceElectrons=function(e,t){mt.callPluginAccessor("setValenceElectrons",[e,t])},tt.getNumberOfAtoms=function(e){return e?gt.reduce(function(t,n){return e(n)?t+1:t},0):gt.length},tt.get_obstacles=function(){return $},tt.get_shapes=function(){return q},tt.get_lines=function(){return H},tt.getNumberOfElements=function(){return mt.getNumberOfElements()},tt.getNumberOfObstacles=function(){return mt.getNumberOfObstacles()},tt.getNumberOfShapes=function(){return mt.getNumberOfShapes()},tt.getNumberOfLines=function(){return mt.getNumberOfLines()},tt.getNumberOfRadialBonds=function(){return mt.getNumberOfRadialBonds()},tt.getNumberOfAngularBonds=function(){return mt.getNumberOfAngularBonds()},tt.getNumberOfSpringForces=function(){return mt.getNumberOfSpringForces()},tt.getNumberOfElectricFields=function(){return mt.getNumberOfElectricFields()},tt.getNumberOfTextBoxes=function(){return tt.get("textBoxes").length},tt.get_restraints=function(){return K},tt.getPairwiseLJProperties=function(){return mt.pairwiseLJProperties},tt.geneticEngine=function(){return U},tt.get_vdw_pairs=function(){return mt.getVdwPairsArray()},tt.tickInPlace=function(){return st.tick(),tt},tt.tick=function(){var e,n,r=tt.get("timeStep");ot&&(r=ot.translateToModelUnits(r,"time")),tt.isStopped()||(e=t.now(),j?(n=e-j,j=e,pt.push(n),pt.splice(0,pt.length-64),T(n)):j=e),t.enterScope("engine"),mt.integrate(tt.get("timeStepsPerTick")*r,r),t.leaveScope("engine"),P(),tt.updateAllOutputProperties(),G.push(),dt=!0,mt.radialBondsChanged&&st.addRadialBond(),st.tick()},tt.minimizeEnergy=function(){return lt.invalidatingChangePreHook(),mt.minimizeEnergy(),lt.invalidatingChangePostHook(),st.tick(),tt},tt.dimensions=function(){return mt.getDimensions()},tt.format=function(e,t){t=t||{};var n=tt.getPropertyDescription(e);return n?n.format(tt.get(e),t):d3.format(t.format||"g")(tt.get(e))},tt.getUnitDefinition=function(e){return it.units[e]},tt.atomTransition=function(){var e=new v(tt);return ft.push(e),e},tt.cancelTransitions=function(){ft.length=0},tt.startBatch=function(){lt.startBatch(),st.startBatch()},tt.endBatch=function(){lt.endBatch(),st.endBatch()},tt.batch=function(e){tt.startBatch(),e(),tt.endBatch()},tt.serialize=function(){var e,t,r,i={},o=lt.rawValues,a=function(e,t){i.atoms[e].every(function(e){return e===t})&&delete i.atoms[e]};if(i=n(l.mainProperties,o),i.viewOptions=n(l.viewOptions,o),i.atoms=n(l.atom,ht.atoms,mt.getNumberOfAtoms()),mt.getNumberOfRadialBonds()&&(i.radialBonds=n(l.radialBond,X,mt.getNumberOfRadialBonds())),mt.getNumberOfAngularBonds()&&(i.angularBonds=n(l.angularBond,J,mt.getNumberOfAngularBonds())),mt.getNumberOfObstacles())for(i.obstacles=n(l.obstacle,$,mt.getNumberOfObstacles()),t=0,r=i.obstacles.x.length;r>t;t++)i.obstacles.westProbe[t]=Boolean(i.obstacles.westProbe[t]),i.obstacles.northProbe[t]=Boolean(i.obstacles.northProbe[t]),i.obstacles.eastProbe[t]=Boolean(i.obstacles.eastProbe[t]),i.obstacles.southProbe[t]=Boolean(i.obstacles.southProbe[t]);for(mt.getNumberOfShapes()&&(i.shapes=n(l.shape,q,mt.getNumberOfShapes())),mt.getNumberOfLines()&&(i.lines=n(l.line,H,mt.getNumberOfLines())),mt.getNumberOfElectricFields()&&(i.electricFields=n(l.electricField,Y,mt.getNumberOfElectricFields())),mt.getNumberOfRestraints()&&(i.restraints=n(l.restraint,K,mt.getNumberOfRestraints())),i.elements=n(l.element,W,5),i.pairwiseLJProperties=[],e=mt.pairwiseLJProperties.serialize(),t=0,r=e.length;r>t;t++)e[t].element1<=5&&e[t].element2<=5&&i.pairwiseLJProperties.push(e[t]);return i.temperatureControl===!1&&delete i.targetTemperature,i.viewOptions.showAtomTrace===!1&&delete i.viewOptions.atomTraceId,"default"===i.modelSampleRate&&delete i.modelSampleRate,tt.properties.useQuantumDynamics&&(i.quantumDynamics=D()),tt.properties.useChemicalReactions?i.chemicalReactions=B():delete i.atoms.radical,a("marked",l.atom.marked.defaultValue),a("visible",l.atom.visible.defaultValue),a("draggable",l.atom.draggable.defaultValue),i},tt.LIVE_DRAG_FRICTION=10,e.DNA&&(e.width=200,e.height=5,e.viewOptions=e.viewOptions||{},e.viewOptions.viewPortX=0,e.viewOptions.viewPortY=0,e.viewOptions.viewPortWidth=5,e.viewOptions.viewPortHeight=3),function(){if(e.viewOptions){var t,n,i=e.viewOptions.textBoxes||[],o=e.viewOptions.images||[];for(t=0,n=i.length;n>t;t++)i[t]=r.validateCompleteness(l.textBox,i[t]);for(t=0,n=o.length;n>t;t++)o[t]=r.validateCompleteness(l.image,o[t])}}(),et={quantumDynamics:e.quantumDynamics,chemicalReactions:e.chemicalReactions},z=e.elements,tt.createElements(z),N(),at.mixInto(tt),O(tt.properties),tt.on("stop.last-sample-time-reset",function(){j=null}),lt.on("afterInvalidatingChange.read-model-state",P),lt.on("afterInvalidatingChangeSequence.tick-history",function(){G&&G.invalidateFollowingState(),st.invalidation()}),L(tt.properties,et),U=new m(tt),tt.set({polarAAEpsilon:tt.get("polarAAEpsilon")}),e.atoms&&tt.createAtoms(e.atoms),e.radialBonds&&tt.createRadialBonds(e.radialBonds),e.angularBonds&&tt.createAngularBonds(e.angularBonds),e.restraints&&tt.createRestraints(e.restraints),e.obstacles&&tt.createObstacles(e.obstacles),e.shapes&&tt.createShapes(e.shapes),e.lines&&tt.createLines(e.lines),e.electricFields&&tt.createElectricFields(e.electricFields),e.pairwiseLJProperties&&mt.pairwiseLJProperties.deserialize(e.pairwiseLJProperties),G=new a({getProperties:function(){return lt.historyStateRawValues},restoreProperties:lt.setRawValues,state:mt.getState()},tt,ct),at.tickHistory=G,F=new o({propertySupport:lt,unitsDefinition:it,tickHistory:G}),F.mixInto(tt),dt=!0,tt.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){var e=ht.time;return ot&&(e=ot.translateFromModelUnits(e,"time")),e}),tt.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return tt.get("timeStep")*tt.get("timeStepsPerTick")}),function(){var e;it.units.time.displayValue?e=it.units.time.displayValue:(e=y.extend({},it.units.time),e.unitsPerBaseUnit=1),tt.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return tt.get("time")*e.unitsPerBaseUnit}),tt.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return tt.get("timePerTick")*e.unitsPerBaseUnit})}(),tt.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return G.get("counter")}),tt.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return dt}),tt.defineOutput("kineticEnergy",{label:"Kinetic Energy",unitType:"energy",format:".4g"},function(){var e=ht.KE;return ot&&(e=ot.translateFromModelUnits(e,"energy")),e}),tt.defineOutput("potentialEnergy",{label:"Potential Energy",unitType:"energy",format:".4g"},function(){var e=ht.PE;return ot&&(e=ot.translateFromModelUnits(e,"energy")),e}),tt.defineOutput("totalEnergy",{label:"Total Energy",unitType:"energy",format:".4g"},function(){var e=ht.KE+ht.PE;return ot&&(e=ot.translateFromModelUnits(e,"energy")),e}),tt.defineOutput("temperature",{label:"Temperature",unitType:"temperature",format:"f"},function(){var e=ht.temperature;return ot&&(e=ot.translateFromModelUnits(e,"temperature")),e}),tt.on("play.model",V),tt.on("stop.model",V),tt.defineOutput("isPlayable",{label:"Playable"},function(){return tt.isReady&&tt.isStopped()}),tt.defineOutput("hasPlayed",{label:"has Played"},function(){return tt.hasPlayed}),tt.defineOutput("isStopped",{label:"Stopped?"},function(){return tt.isStopped()}),P(),tt.updateAllOutputProperties(),_.waitForSetup||tt.ready(),tt.performanceOptimizer=new g(tt),tt.namespace=nt,tt}}),define("common/views/tab-index",[],function(){var e=0;return function(){return e++}}),define("common/feature-tests",[],function(){var e={};return{get cssPointerEvents(){return void 0===e.cssPointerEvents&&(e.cssPointerEvents=function(){var e,t,n,r;switch(e=$("<div class='supported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px"}).appendTo("body"),t=$("<div class='unsupported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px","pointer-events":"none"}).appendTo("body"),n=$("<svg class='unsupported'>").css({position:"fixed",left:0,top:0,width:"10px",height:"10px","pointer-events":"none"}).appendTo("body"),r=$(document.elementFromPoint(5,5)).attr("class"),n.remove(),t.remove(),e.remove(),r){case"supported":return!0;case"unsupported":return!1;default:return console.warn("CSS pointer-events feature test failed"),!1}}()),e.cssPointerEvents}}}),define("common/views/hit-testing-helper",["require","common/feature-tests"],function(e){function t(e,t,n){window.addEventListener(e,t,n),a.push({type:e,func:t,capture:n})}function n(){for(var e;a.length>0;)e=a.pop(),window.removeEventListener(e.type,e.func,e.capture)}function r(){}var i=e("common/feature-tests"),o=["mousedown","mouseup","contextmenu"],a=[];return function(e){function a(e,t){var n=document.createEvent("MouseEvent");if(n.initMouseEvent(e.type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n.target=t,n.forwardedTouchEvent=e.forwardedTouchEvent,0===n.pageX&&0===n.pageY&&Object.defineProperty){var r=document.documentElement,i=document.body,o=e.clientX,a=e.clientY;Object.defineProperty(n,"pageX",{get:function(){return o+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0)}}),Object.defineProperty(n,"pageY",{get:function(){return a+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)}})}return n}function s(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent("click",!0,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget),n.target=t,n}function l(e){var t=f[e];m[e]=t.style[x],t.style[x]=w}function u(e){for(var t=e;t>=0;t--)f[t].style[x]=m[t]}function c(e){m=[];var t,n,i,o,s,c;v=null;for(var d=0,p=f.length;p>d;d++)if(t=f[d],d>0&&l(d-1),"canvas"===t.tagName.toLowerCase()){if(i=a(e,t),h.hitTestCallback=function(e){o=e,e||(i.stopPropagation(),i.preventDefault())},h.mouseupCallback=function(e){s=e},t.dispatchEvent(i),h.hitTestCallback=r,h.mouseupCallback=r,s&&(v=t),o)return u(d-1),y=i.defaultPrevented,t}else if(c=t.style.backgroundColor,t.style.backgroundColor="rgba(0,0,0,0)",n=document.elementFromPoint(e.clientX,e.clientY),t.style.backgroundColor=c,n!==t)return u(d-1),i=a(e,n),n.dispatchEvent(i),y=i.defaultPrevented,n;u(f.length-2)}function d(e){function n(e,t){var n=document.createEvent("MouseEvent");return n.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,n}function r(e){return Math.abs(e.screenX-a)>10||Math.abs(e.screenY-s)>10}function i(t){var r=t.changedTouches[0];t.touches.length>1||r.target!==e||(b=!1,a=r.screenX,s=r.screenY,l=r.identifier,e.dispatchEvent(n(r,"mousedown")),y&&t.preventDefault(),t.stopPropagation())}function o(e){if(null!==l){if("touchmove"===e.type&&e.touches.length>1)return b=!0,void e.stopPropagation();var t,i,o,a;for(t=0,i=e.changedTouches.length;i>t;t++)if(o=e.changedTouches[t],o.identifier===l)return 1===i&&e.stopPropagation(),a=document.elementFromPoint(o.clientX,o.clientY)||window,"touchmove"===e.type?(b||(b=r(o)),a.dispatchEvent(n(o,"mousemove"))):"touchend"===e.type?(a.dispatchEvent(n(o,"mouseup")),l=null):"touchcancel"===e.type&&(b=!0,a.dispatchEvent(n(o,"mouseup")),l=null),void(("touchend"===e.type||y)&&e.preventDefault())}}var a,s,l=null;t("touchstart",i,!0),["touchmove","touchend","touchcancel"].forEach(function(e){t(e,o,!0)})}function p(){n(),f=[e],o.forEach(function(n){t(n,function(t){var n;t.target===e&&(t.stopPropagation(),"mousedown"!==t.type&&t.preventDefault(),n=c(t),"mousedown"===t.type?g=n:"mouseup"===t.type&&(n&&n===g&&"canvas"!==n.tagName.toLowerCase()&&!b&&n.dispatchEvent(s(t),n),v&&!b&&v.dispatchEvent(s(t),v)))},!0)}),t("click",function(t){t.target===e&&(t.stopPropagation(),t.preventDefault())},!0),d(e)}var h,f,m,g,v,y,b,x=i.cssPointerEvents?"pointerEvents":"visibility",w=i.cssPointerEvents?"none":"hidden";return h={passMouseMove:function(e,n){function i(e,t,n,r){var i=document.createEvent("MouseEvent");return i.initMouseEvent(t,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,r||e.relatedTarget),i.target=n,i}var o;t("mousemove",function(t){if(!t.synthetic){var s,l;s=t.target===e?n:t.target,s!==o&&(s===n?n.dispatchEvent(i(t,"mouseover",n,o)):o===n&&n.dispatchEvent(i(t,"mouseout",n,s))),t.stopPropagation(),t.preventDefault(),l=a(t,s),l.synthetic=!0,h.hitTestCallback=r,s.dispatchEvent(l),y=l.defaultPrevented,o=s}},!0)},addLayer:function(e){f.splice(1,0,e)},hitTestCallback:r,mouseupCallback:r},p(),h}}),function(){function e(){return i.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,i.Matrix}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}function t(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}var n=this,i=i||{};i.Point=function(e,t){this.x=e||0,this.y=t||0},i.Point.prototype.clone=function(){return new i.Point(this.x,this.y)},i.Point.prototype.constructor=i.Point,i.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Rectangle.prototype.clone=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},i.Rectangle.prototype.constructor=i.Rectangle,i.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var t=[],n=0,r=e.length;r>n;n+=2)t.push(new i.Point(e[n],e[n+1]));e=t}this.points=e},i.Polygon.prototype.clone=function(){for(var e=[],t=0;t<this.points.length;t++)e.push(this.points[t].clone());return new i.Polygon(e)},i.Polygon.prototype.contains=function(e,t){for(var n=!1,r=0,i=this.points.length-1;r<this.points.length;i=r++){var o=this.points[r].x,a=this.points[r].y,s=this.points[i].x,l=this.points[i].y,u=a>t!=l>t&&(s-o)*(t-a)/(l-a)+o>e;u&&(n=!n)}return n},i.Polygon.prototype.constructor=i.Polygon,i.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},i.Circle.prototype.clone=function(){return new i.Circle(this.x,this.y,this.radius)},i.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,i>=n+r},i.Circle.prototype.constructor=i.Circle,i.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},i.Ellipse.prototype.clone=function(){return new i.Ellipse(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width-.5,r=(t-this.y)/this.height-.5;return n*=n,r*=r,.25>n+r},i.Ellipse.getBounds=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)},i.Ellipse.prototype.constructor=i.Ellipse,e(),i.mat3={},i.mat3.create=function(){var e=new i.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},i.mat4={},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat3.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],p=t[0],h=t[1],f=t[2],m=t[3],g=t[4],v=t[5],y=t[6],b=t[7],x=t[8];return n[0]=p*r+h*a+f*u,n[1]=p*i+h*s+f*c,n[2]=p*o+h*l+f*d,n[3]=m*r+g*a+v*u,n[4]=m*i+g*s+v*c,n[5]=m*o+g*l+v*d,n[6]=y*r+b*a+x*u,n[7]=y*i+b*s+x*c,n[8]=y*o+b*l+x*d,n},i.mat3.clone=function(e){var t=new i.Matrix(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},i.mat3.toMat4=function(e,t){return t||(t=i.mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t
},i.mat4.create=function(){var e=new i.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},i.mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=i,e[13]=a,e[14]=s,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},i.mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],p=e[9],h=e[10],f=e[11],m=e[12],g=e[13],v=e[14],y=e[15],b=t[0],x=t[1],w=t[2],_=t[3];return n[0]=b*r+x*s+w*d+_*m,n[1]=b*i+x*l+w*p+_*g,n[2]=b*o+x*u+w*h+_*v,n[3]=b*a+x*c+w*f+_*y,b=t[4],x=t[5],w=t[6],_=t[7],n[4]=b*r+x*s+w*d+_*m,n[5]=b*i+x*l+w*p+_*g,n[6]=b*o+x*u+w*h+_*v,n[7]=b*a+x*c+w*f+_*y,b=t[8],x=t[9],w=t[10],_=t[11],n[8]=b*r+x*s+w*d+_*m,n[9]=b*i+x*l+w*p+_*g,n[10]=b*o+x*u+w*h+_*v,n[11]=b*a+x*c+w*f+_*y,b=t[12],x=t[13],w=t[14],_=t[15],n[12]=b*r+x*s+w*d+_*m,n[13]=b*i+x*l+w*p+_*g,n[14]=b*o+x*u+w*h+_*v,n[15]=b*a+x*c+w*f+_*y,n},i.DisplayObject=function(){this.last=this,this.first=this,this.position=new i.Point,this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=i.mat3.create(),this.localTransform=i.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},i.DisplayObject.prototype.constructor=i.DisplayObject,i.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(i.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(i.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,e?this.addFilter(e):this.removeFilter()}}),i.DisplayObject.prototype.addFilter=function(e){if(!this.filter){this.filter=!0;var t=new i.FilterBlock,n=new i.FilterBlock;t.mask=e,n.mask=e,t.first=t.last=this,n.first=n.last=this,t.open=!0;var r,o,a=t,s=t;o=this.first._iPrev,o?(r=o._iNext,a._iPrev=o,o._iNext=a):r=this,r&&(r._iPrev=s,s._iNext=r);var a=n,s=n,r=null,o=null;o=this.last,r=o._iNext,r&&(r._iPrev=s,s._iNext=r),a._iPrev=o,o._iNext=a;for(var l=this,u=this.last;l;)l.last==u&&(l.last=n),l=l.parent;this.first=t,this.__renderGroup&&this.__renderGroup.addFilterBlocks(t,n),e.renderable=!1}},i.DisplayObject.prototype.removeFilter=function(){if(this.filter){this.filter=!1;var e=this.first,t=e._iNext,n=e._iPrev;t&&(t._iPrev=n),n&&(n._iNext=t),this.first=e._iNext;var r=this.last,t=r._iNext,n=r._iPrev;t&&(t._iPrev=n),n._iNext=t;for(var i=r._iPrev,o=this;o.last==r&&(o.last=i,o=o.parent););var a=e.mask;a.renderable=!0,this.__renderGroup&&this.__renderGroup.removeFilterBlocks(e,r)}},i.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,t=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var r=this.pivot.x,o=this.pivot.y,a=e[0],s=e[1],l=this.position.x-e[0]*r-o*e[1],u=e[3],c=e[4],d=this.position.y-e[4]*o-r*e[3],p=t[0],h=t[1],f=t[2],m=t[3],g=t[4],v=t[5];e[2]=l,e[5]=d,n[0]=p*a+h*u,n[1]=p*s+h*c,n[2]=p*l+h*d+f,n[3]=m*a+g*u,n[4]=m*s+g*c,n[5]=m*l+g*d+v,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=i.visibleCount},i.visibleCount=0,i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[]},i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype.addChild=function(e){if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.stage){var t=e;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}var n,r,i=e.first,o=e.last;r=this.filter?this.last._iPrev:this.last,n=r._iNext;for(var a=this,s=r;a;)a.last==s&&(a.last=e.last),a=a.parent;n&&(n._iPrev=o,o._iNext=n),i._iPrev=r,r._iNext=i,this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);if(void 0!=e.parent&&e.parent.removeChild(e),e.parent=this,this.stage){var n=e;do n.interactive&&(this.stage.dirty=!0),n.stage=this.stage,n=n._iNext;while(n)}var r,i,o=e.first,a=e.last;if(t==this.children.length){i=this.last;for(var s=this,l=this.last;s;)s.last==l&&(s.last=e.last),s=s.parent}else i=0==t?this:this.children[t-1].last;r=i._iNext,r&&(r._iPrev=a,a._iNext=r),o._iPrev=i,i._iNext=o,this.children.splice(t,0,e),this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},i.DisplayObjectContainer.prototype.swapChildren=function(){},i.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},i.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);var n=e.first,r=e.last,i=r._iNext,o=n._iPrev;if(i&&(i._iPrev=o),o._iNext=i,this.last==r)for(var a=n._iPrev,s=this;s.last==r.last&&(s.last=a,s=s.parent););if(r._iNext=null,n._iPrev=null,this.stage){var l=e;do l.interactive&&(this.stage.dirty=!0),l.stage=null,l=l._iNext;while(l)}e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),e.parent=void 0,this.children.splice(t,1)},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){i.DisplayObject.prototype.updateTransform.call(this);for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform()}},i.blendModes={},i.blendModes.NORMAL=0,i.blendModes.SCREEN=1,i.Sprite=function(e){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=e,this.blendMode=i.blendModes.NORMAL,this._width=0,this._height=0,e.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Sprite.prototype.constructor=i.Sprite,Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),i.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!=e.baseTexture?(this.textureChange=!0,this.texture=e,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=e,this.updateFrame=!0},i.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},i.Sprite.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache"+this);return new i.Sprite(t)},i.Sprite.fromImage=function(e){var t=i.Texture.fromImage(e);return new i.Sprite(t)},i.MovieClip=function(e){i.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},i.MovieClip.prototype=Object.create(i.Sprite.prototype),i.MovieClip.prototype.constructor=i.MovieClip,i.MovieClip.prototype.stop=function(){this.playing=!1},i.MovieClip.prototype.play=function(){this.playing=!0},i.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},i.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},i.MovieClip.prototype.updateTransform=function(){if(i.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},i.FilterBlock=function(e){this.graphics=e,this.visible=!0,this.renderable=!0},i.Text=function(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),i.Sprite.call(this,i.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.Text.prototype=Object.create(i.Sprite.prototype),i.Text.prototype.constructor=i.Text,i.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},i.Sprite.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},i.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,o=0;o<t.length;o++){var a=this.context.measureText(t[o]).width;n[o]=a,r=Math.max(r,a)}this.canvas.width=r+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*t.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",o=0;o<t.length;o++){var l=new i.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+o*s);"right"==this.style.align?l.x+=r-n[o]:"center"==this.style.align&&(l.x+=(r-n[o])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[o],l.x,l.y),this.style.fill&&this.context.fillText(t[o],l.x,l.y)}this.updateTexture()},i.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,i.texturesToUpdate.push(this.texture.baseTexture)},i.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),i.Sprite.prototype.updateTransform.call(this)},i.Text.prototype.determineFontHeight=function(e){var t=i.Text.heightCache[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),o=document.createTextNode("M");r.appendChild(o),r.setAttribute("style",e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,i.Text.heightCache[e]=t,n.removeChild(r)}return t},i.Text.prototype.wordWrap=function(e){for(var t=function(e,t,n,r,i){var o=Math.floor((r-n)/2)+n;return o==n?1:e.measureText(t.substring(0,o)).width<=i?e.measureText(t.substring(0,o+1)).width>i?o:arguments.callee(e,t,o,r,i):arguments.callee(e,t,n,o,i)},n=function(e,n,r){if(e.measureText(n).width<=r||n.length<1)return n;var i=t(e,n,0,n.length,r);return n.substring(0,i)+"\n"+arguments.callee(e,n.substring(i),r)},r="",i=e.split("\n"),o=0;o<i.length;o++)r+=n(this.context,i[o],this.style.wordWrapWidth)+"\n";return r},i.Text.prototype.destroy=function(e){e&&this.texture.destroy()},i.Text.heightCache={},i.BitmapText=function(e,t){i.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},i.BitmapText.prototype=Object.create(i.DisplayObjectContainer.prototype),i.BitmapText.prototype.constructor=i.BitmapText,i.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},i.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var t=e.font.split(" ");this.fontName=t[t.length-1],this.fontSize=t.length>=2?parseInt(t[t.length-2],10):i.BitmapText.fonts[this.fontName].size,this.dirty=!0},i.BitmapText.prototype.updateText=function(){for(var e=i.BitmapText.fonts[this.fontName],t=new i.Point,n=null,r=[],o=0,a=[],s=0,l=this.fontSize/e.size,u=0;u<this.text.length;u++){var c=this.text.charCodeAt(u);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(u)))a.push(t.x),o=Math.max(o,t.x),s++,t.x=0,t.y+=e.lineHeight,n=null;else{var d=e.chars[c];d&&(n&&d[n]&&(t.x+=d.kerning[n]),r.push({texture:d.texture,line:s,charCode:c,position:new i.Point(t.x+d.xOffset,t.y+d.yOffset)}),t.x+=d.xAdvance,n=c)}}a.push(t.x),o=Math.max(o,t.x);var p=[];for(u=0;s>=u;u++){var h=0;"right"==this.style.align?h=o-a[u]:"center"==this.style.align&&(h=(o-a[u])/2),p.push(h)}for(u=0;u<r.length;u++){var f=new i.Sprite(r[u].texture);f.position.x=(r[u].position.x+p[r[u].line])*l,f.position.y=r[u].position.y*l,f.scale.x=f.scale.y=l,this.addChild(f)}this.width=t.x*l,this.height=(t.y+e.lineHeight)*l},i.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.BitmapText.fonts={},i.InteractionManager=function(e){this.stage=e,this.mouse=new i.InteractionData,this.touchs={},this.tempPoint=new i.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.last=0},i.InteractionManager.prototype.constructor=i.InteractionManager,i.InteractionManager.prototype.collectInteractiveSprite=function(e,t){for(var n=e.children,r=n.length,i=r-1;i>=0;i--){var o=n[i];o.interactive?(t.interactiveChildren=!0,this.interactiveItems.push(o),o.children.length>0&&this.collectInteractiveSprite(o,o)):(o.__iParent=null,o.children.length>0&&this.collectInteractiveSprite(o,t))}},i.InteractionManager.prototype.setTarget=function(e){window.navigator.msPointerEnabled&&(e.view.style["-ms-content-zooming"]="none",e.view.style["-ms-touch-action"]="none"),this.target=e,e.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),e.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),e.view.addEventListener("mouseout",this.onMouseOut.bind(this),!0),e.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),e.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),e.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},i.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),t=e-this.last;if(t=30*t/1e3,!(1>t)){if(this.last=e,this.dirty){this.dirty=!1;for(var n=this.interactiveItems.length,r=0;n>r;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var i=this.interactiveItems.length;this.target.view.style.cursor="default";for(var r=0;i>r;r++){var o=this.interactiveItems[r];(o.mouseover||o.mouseout||o.buttonMode)&&(o.__hit=this.hitTest(o,this.mouse),this.mouse.target=o,o.__hit?(o.buttonMode&&(this.target.view.style.cursor="pointer"),o.__isOver||(o.mouseover&&o.mouseover(this.mouse),o.__isOver=!0)):o.__isOver&&(o.mouseout&&o.mouseout(this.mouse),o.__isOver=!1))}}}},i.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||window.event;var t=this.target.view.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height);for(var n=this.interactiveItems.length,r=(this.mouse.global,0);n>r;r++){var i=this.interactiveItems[r];i.mousemove&&i.mousemove(this.mouse)}},i.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||window.event;for(var t=this.interactiveItems.length,n=(this.mouse.global,this.stage,0);t>n;n++){var r=this.interactiveItems[n];if((r.mousedown||r.click)&&(r.__mouseIsDown=!0,r.__hit=this.hitTest(r,this.mouse),r.__hit&&(r.mousedown&&r.mousedown(this.mouse),r.__isDown=!0,!r.interactiveChildren)))break}},i.InteractionManager.prototype.onMouseOut=function(){var e=this.interactiveItems.length;this.target.view.style.cursor="default";for(var t=0;e>t;t++){var n=this.interactiveItems[t];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}},i.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||window.event;for(var t=(this.mouse.global,this.interactiveItems.length),n=!1,r=0;t>r;r++){var i=this.interactiveItems[r];(i.mouseup||i.mouseupoutside||i.click)&&(i.__hit=this.hitTest(i,this.mouse),i.__hit&&!n?(i.mouseup&&i.mouseup(this.mouse),i.__isDown&&i.click&&i.click(this.mouse),i.interactiveChildren||(n=!0)):i.__isDown&&i.mouseupoutside&&i.mouseupoutside(this.mouse),i.__isDown=!1)}},i.InteractionManager.prototype.hitTest=function(e,t){var n=t.global;if(e.vcount!==i.visibleCount)return!1;var r=e instanceof i.Sprite,o=e.worldTransform,a=o[0],s=o[1],l=o[2],u=o[3],c=o[4],d=o[5],p=1/(a*c+s*-u),h=c*p*n.x+-s*p*n.y+(d*s-l*c)*p,f=a*p*n.y+-u*p*n.x+(-d*a+l*u)*p;if(t.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(h,f)?(t.target=e,!0):!1;if(r){var m,g=e.texture.frame.width,v=e.texture.frame.height,y=-g*e.anchor.x;if(h>y&&y+g>h&&(m=-v*e.anchor.y,f>m&&m+v>f))return t.target=e,!0}for(var b=e.children.length,x=0;b>x;x++){var w=e.children[x],_=this.hitTest(w,t);if(_)return t.target=e,!0}return!1},i.InteractionManager.prototype.onTouchMove=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier];o.originalEvent=e||window.event,o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height)}for(var a=this.interactiveItems.length,r=0;a>r;r++){var s=this.interactiveItems[r];s.touchmove&&s.touchmove(o)}},i.InteractionManager.prototype.onTouchStart=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var o=n[r],a=this.pool.pop();a||(a=new i.InteractionData),a.originalEvent=e||window.event,this.touchs[o.identifier]=a,a.global.x=(o.clientX-t.left)*(this.target.width/t.width),a.global.y=(o.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,l=0;s>l;l++){var u=this.interactiveItems[l];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,a),u.__hit&&(u.touchstart&&u.touchstart(a),u.__isDown=!0,u.__touchData=a,!u.interactiveChildren)))break}}},i.InteractionManager.prototype.onTouchEnd=function(e){for(var t=this.target.view.getBoundingClientRect(),n=e.changedTouches,r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier],a=!1;o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height);for(var s=this.interactiveItems.length,l=0;s>l;l++){var u=this.interactiveItems[l],c=u.__touchData;u.__hit=this.hitTest(u,o),c==o&&(o.originalEvent=e||window.event,(u.touchend||u.tap)&&(u.__hit&&!a?(u.touchend&&u.touchend(o),u.__isDown&&u.tap&&u.tap(o),u.interactiveChildren||(a=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(o),u.__isDown=!1),u.__touchData=null)}this.pool.push(o),this.touchs[i.identifier]=null}},i.InteractionData=function(){this.global=new i.Point,this.local=new i.Point,this.target,this.originalEvent},i.InteractionData.prototype.getLocalPosition=function(e){var t=e.worldTransform,n=this.global,r=t[0],o=t[1],a=t[2],s=t[3],l=t[4],u=t[5],c=1/(r*l+o*-s);return new i.Point(l*c*n.x+-o*c*n.y+(u*o-a*l)*c,r*c*n.y+-s*c*n.x+(-u*r+a*s)*c)},i.InteractionData.prototype.constructor=i.InteractionData,i.Stage=function(e,t){i.DisplayObjectContainer.call(this),this.worldTransform=i.mat3.create(),this.interactive=t,this.interactionManager=new i.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new i.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e),this.worldVisible=!0},i.Stage.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Stage.prototype.constructor=i.Stage,i.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=i.visibleCount;for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},i.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},i.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var o=0,s=["ms","moz","webkit","o"],l=0;l<s.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[s[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[l]+"CancelAnimationFrame"]||window[s[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-o)),r=window.setTimeout(function(){e(t+n)},n);return o=t+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var o=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,o)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function o(e){return e&&(o.prototype=e),this instanceof o?void 0:new o}(r.prototype),n}}());var u=i.AjaxRequest=function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}};i.runList=function(e){console.log(">>>>>>>>>"),console.log("_");var t=0,n=e.first;for(console.log(n);n._iNext;)if(t++,n=n._iNext,console.log(n),t>100){console.log("BREAK");break}},i.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)},this.dispatchEvent=this.emit=function(t){for(var n in e[t.type])e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},i.autoDetectRenderer=function(e,t,n,r,o){e||(e=800),t||(t=600);var a=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}();return a?new i.WebGLRenderer(e,t,n,r,o):new i.CanvasRenderer(e,t,n,r)},i.PolyK={},i.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(3>n)return[];for(var r=[],o=[],a=0;n>a;a++)o.push(a);for(var a=0,s=n;s>3;){var l=o[(a+0)%s],u=o[(a+1)%s],c=o[(a+2)%s],d=e[2*l],p=e[2*l+1],h=e[2*u],f=e[2*u+1],m=e[2*c],g=e[2*c+1],v=!1;if(i.PolyK._convex(d,p,h,f,m,g,t)){v=!0;for(var y=0;s>y;y++){var b=o[y];if(b!=l&&b!=u&&b!=c&&i.PolyK._PointInTriangle(e[2*b],e[2*b+1],d,p,h,f,m,g)){v=!1;break}}}if(v)r.push(l,u,c),o.splice((a+1)%s,1),s--,a=0;else if(a++>3*s){if(!t)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];o=[];for(var a=0;n>a;a++)o.push(a);a=0,s=n,t=!1}}return r.push(o[0],o[1],o[2]),r},i.PolyK._PointInTriangle=function(e,t,n,r,i,o,a,s){var l=a-n,u=s-r,c=i-n,d=o-r,p=e-n,h=t-r,f=l*l+u*u,m=l*c+u*d,g=l*p+u*h,v=c*c+d*d,y=c*p+d*h,b=1/(f*v-m*m),x=(v*g-m*y)*b,w=(f*y-m*g)*b;return x>=0&&w>=0&&1>x+w},i.PolyK._convex=function(e,t,n,r,i,o,a){return(t-r)*(i-n)+(n-e)*(o-r)>=0==a},i.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],i.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],i.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],i.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],i.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],i.initPrimitiveShader=function(){var e=i.gl,t=i.compileProgram(i.primitiveShaderVertexSrc,i.primitiveShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),i.primitiveProgram=t},i.initDefaultShader=function(){var e=this.gl,t=i.compileProgram(i.shaderVertexSrc,i.shaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.shaderProgram=t},i.initDefaultStripShader=function(){var e=this.gl,t=i.compileProgram(i.stripShaderVertexSrc,i.stripShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),i.stripShaderProgram=t},i.CompileVertexShader=function(e,t){return i._CompileShader(e,t,e.VERTEX_SHADER)},i.CompileFragmentShader=function(e,t){return i._CompileShader(e,t,e.FRAGMENT_SHADER)},i._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},i.compileProgram=function(e,t){var n=i.gl,r=i.CompileFragmentShader(n,t),o=i.CompileVertexShader(n,e),a=n.createProgram();return n.attachShader(a,o),n.attachShader(a,r),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||alert("Could not initialise shaders"),a},i.activateDefaultShader=function(){var e=i.gl,t=i.shaderProgram;e.useProgram(t),e.enableVertexAttribArray(t.vertexPositionAttribute),e.enableVertexAttribArray(t.textureCoordAttribute),e.enableVertexAttribArray(t.colorAttribute)},i.activatePrimitiveShader=function(){var e=i.gl;e.disableVertexAttribArray(i.shaderProgram.textureCoordAttribute),e.disableVertexAttribArray(i.shaderProgram.colorAttribute),e.useProgram(i.primitiveProgram),e.enableVertexAttribArray(i.primitiveProgram.vertexPositionAttribute),e.enableVertexAttribArray(i.primitiveProgram.colorAttribute)},i.WebGLGraphics=function(){},i.WebGLGraphics.renderGraphics=function(e,t){var n=i.gl;e._webGL||(e._webGL={points:[],indices:[],lastIndex:0,buffer:n.createBuffer(),indexBuffer:n.createBuffer()}),e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,e._webGL.lastIndex=0,e._webGL.points=[],e._webGL.indices=[]),i.WebGLGraphics.updateGraphics(e)),i.activatePrimitiveShader();var r=i.mat3.clone(e.worldTransform);i.mat3.transpose(r),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(i.primitiveProgram.translationMatrix,!1,r),n.uniform2f(i.primitiveProgram.projectionVector,t.x,t.y),n.uniform1f(i.primitiveProgram.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e._webGL.buffer),n.vertexAttribPointer(i.shaderProgram.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(i.primitiveProgram.vertexPositionAttribute,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(i.primitiveProgram.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,e._webGL.indices.length,n.UNSIGNED_SHORT,0),i.activateDefaultShader()},i.WebGLGraphics.updateGraphics=function(e){for(var t=e._webGL.lastIndex;t<e.graphicsData.length;t++){var n=e.graphicsData[t];n.type==i.Graphics.POLY?(n.fill&&n.points.length>3&&i.WebGLGraphics.buildPoly(n,e._webGL),n.lineWidth>0&&i.WebGLGraphics.buildLine(n,e._webGL)):n.type==i.Graphics.RECT?i.WebGLGraphics.buildRectangle(n,e._webGL):(n.type==i.Graphics.CIRC||n.type==i.Graphics.ELIP)&&i.WebGLGraphics.buildCircle(n,e._webGL)}e._webGL.lastIndex=e.graphicsData.length;var r=i.gl;e._webGL.glPoints=new Float32Array(e._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,e._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,e._webGL.glPoints,r.STATIC_DRAW),e._webGL.glIndicies=new Uint16Array(e._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._webGL.glIndicies,r.STATIC_DRAW)},i.WebGLGraphics.buildRectangle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],l=r[3];if(e.fill){var u=t(e.fillColor),c=e.fillAlpha,d=u[0]*c,p=u[1]*c,h=u[2]*c,f=n.points,m=n.indices,g=f.length/6;f.push(o,a),f.push(d,p,h,c),f.push(o+s,a),f.push(d,p,h,c),f.push(o,a+l),f.push(d,p,h,c),f.push(o+s,a+l),f.push(d,p,h,c),m.push(g,g,g+1,g+2,g+3,g+3)}e.lineWidth&&(e.points=[o,a,o+s,a,o+s,a+l,o,a+l,o,a],i.WebGLGraphics.buildLine(e,n))},i.WebGLGraphics.buildCircle=function(e,n){var r=e.points,o=r[0],a=r[1],s=r[2],l=r[3],u=40,c=2*Math.PI/u;if(e.fill){var d=t(e.fillColor),p=e.fillAlpha,h=d[0]*p,f=d[1]*p,m=d[2]*p,g=n.points,v=n.indices,y=g.length/6;v.push(y);for(var b=0;u+1>b;b++)g.push(o,a,h,f,m,p),g.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*l,h,f,m,p),v.push(y++,y++);v.push(y-1)}if(e.lineWidth){e.points=[];for(var b=0;u+1>b;b++)e.points.push(o+Math.sin(c*b)*s,a+Math.cos(c*b)*l);i.WebGLGraphics.buildLine(e,n)}},i.WebGLGraphics.buildLine=function(e,n){var r=e.points;if(0!=r.length){var o=new i.Point(r[0],r[1]),a=new i.Point(r[r.length-2],r[r.length-1]);if(o.x==a.x&&o.y==a.y){r.pop(),r.pop(),a=new i.Point(r[r.length-2],r[r.length-1]);var s=a.x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);r.unshift(s,l),r.push(s,l)}var u,c,d,p,h,f,m,g,v,y,b,x,w,_,T,C,A,S,P,E,k,R=n.points,M=n.indices,N=r.length/2,O=r.length,L=R.length/6,I=e.lineWidth/2,D=t(e.lineColor),B=e.lineAlpha,V=D[0]*B,F=D[1]*B,j=D[2]*B;
u=r[0],c=r[1],d=r[2],p=r[3],m=-(c-p),g=u-d,k=Math.sqrt(m*m+g*g),m/=k,g/=k,m*=I,g*=I,R.push(u-m,c-g,V,F,j,B),R.push(u+m,c+g,V,F,j,B);for(var G=1;N-1>G;G++)u=r[2*(G-1)],c=r[2*(G-1)+1],d=r[2*G],p=r[2*G+1],h=r[2*(G+1)],f=r[2*(G+1)+1],m=-(c-p),g=u-d,k=Math.sqrt(m*m+g*g),m/=k,g/=k,m*=I,g*=I,v=-(p-f),y=d-h,k=Math.sqrt(v*v+y*y),v/=k,y/=k,v*=I,y*=I,w=-g+c-(-g+p),_=-m+d-(-m+u),T=(-m+u)*(-g+p)-(-m+d)*(-g+c),C=-y+f-(-y+p),A=-v+d-(-v+h),S=(-v+h)*(-y+p)-(-v+d)*(-y+f),P=w*A-C*_,0==P&&(P+=1),px=(_*S-A*T)/P,py=(C*T-w*S)/P,E=(px-d)*(px-d)+(py-p)+(py-p),E>19600?(b=m-v,x=g-y,k=Math.sqrt(b*b+x*x),b/=k,x/=k,b*=I,x*=I,R.push(d-b,p-x),R.push(V,F,j,B),R.push(d+b,p+x),R.push(V,F,j,B),R.push(d-b,p-x),R.push(V,F,j,B),O++):(R.push(px,py),R.push(V,F,j,B),R.push(d-(px-d),p-(py-p)),R.push(V,F,j,B));u=r[2*(N-2)],c=r[2*(N-2)+1],d=r[2*(N-1)],p=r[2*(N-1)+1],m=-(c-p),g=u-d,k=Math.sqrt(m*m+g*g),m/=k,g/=k,m*=I,g*=I,R.push(d-m,p-g),R.push(V,F,j,B),R.push(d+m,p+g),R.push(V,F,j,B),M.push(L);for(var G=0;O>G;G++)M.push(L++);M.push(L-1)}},i.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(!(r.length<6)){for(var o=n.points,a=n.indices,s=r.length/2,l=t(e.fillColor),u=e.fillAlpha,c=l[0]*u,d=l[1]*u,p=l[2]*u,h=i.PolyK.Triangulate(r),f=o.length/6,m=0;m<h.length;m+=3)a.push(h[m]+f),a.push(h[m]+f),a.push(h[m+1]+f),a.push(h[m+2]+f),a.push(h[m+2]+f);for(var m=0;s>m;m++)o.push(r[2*m],r[2*m+1],c,d,p,u)}},i._defaultFrame=new i.Rectangle(0,0,1,1),i.gl,i.WebGLRenderer=function(e,t,n,r,o){this.transparent=!!r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var a=this;this.view.addEventListener("webglcontextlost",function(e){a.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){a.handleContextRestored(e)},!1),this.batchs=[];try{i.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!!o,premultipliedAlpha:!0,stencil:!0})}catch(s){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}i.initPrimitiveShader(),i.initDefaultShader(),i.initDefaultStripShader(),i.activateDefaultShader();var l=this.gl;i.WebGLRenderer.gl=l,this.batch=new i.WebGLBatch(l),l.disable(l.DEPTH_TEST),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.colorMask(!0,!0,!0,this.transparent),i.projection=new i.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new i.WebGLRenderGroup(this.gl)},i.WebGLRenderer.prototype.constructor=i.WebGLRenderer,i.WebGLRenderer.getBatch=function(){return 0==i._batchs.length?new i.WebGLBatch(i.WebGLRenderer.gl):i._batchs.pop()},i.WebGLRenderer.returnBatch=function(e){e.clean(),i._batchs.push(e)},i.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(this.__stage=e,this.stageRenderGroup.setRenderable(e)),i.WebGLRenderer.updateTextures(),i.visibleCount++,e.updateTransform();var t=this.gl;if(t.colorMask(!0,!0,!0,this.transparent),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.transparent?t.clearColor(0,0,0,0):t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=e.backgroundColorSplit,this.stageRenderGroup.render(i.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0){for(var n=0;n<i.Texture.frameUpdates.length;n++)i.Texture.frameUpdates[n].updateFrame=!1;i.Texture.frameUpdates=[]}}},i.WebGLRenderer.updateTextures=function(){for(var e=0;e<i.texturesToUpdate.length;e++)i.WebGLRenderer.updateTexture(i.texturesToUpdate[e]);for(var e=0;e<i.texturesToDestroy.length;e++)i.WebGLRenderer.destroyTexture(i.texturesToDestroy[e]);i.texturesToUpdate=[],i.texturesToDestroy=[]},i.WebGLRenderer.updateTexture=function(e){var t=i.gl;e._glTexture||(e._glTexture=t.createTexture()),e.hasLoaded&&(t.bindTexture(t.TEXTURE_2D,e._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindTexture(t.TEXTURE_2D,null))},i.WebGLRenderer.destroyTexture=function(e){var t=i.gl;e._glTexture&&(e._glTexture=t.createTexture(),t.deleteTexture(t.TEXTURE_2D,e._glTexture))},i.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),i.projection.x=this.width/2,i.projection.y=this.height/2},i.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},i.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var e in i.TextureCache){var t=i.TextureCache[e].baseTexture;t._glTexture=null,i.WebGLRenderer.updateTexture(t)}for(var n=0;n<this.batchs.length;n++)this.batchs[n].restoreLostContext(this.gl),this.batchs[n].dirty=!0;i._restoreBatchs(this.gl),this.contextLost=!1},i._batchs=[],i._getBatch=function(e){return 0==i._batchs.length?new i.WebGLBatch(e):i._batchs.pop()},i._returnBatch=function(e){e.clean(),i._batchs.push(e)},i._restoreBatchs=function(e){for(var t=0;t<i._batchs.length;t++)i._batchs[t].restoreLostContext(e)},i.WebGLBatch=function(e){this.gl=e,this.size=0,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.blendMode=i.blendModes.NORMAL,this.dynamicSize=1},i.WebGLBatch.prototype.constructor=i.WebGLBatch,i.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},i.WebGLBatch.prototype.restoreLostContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()},i.WebGLBatch.prototype.init=function(e){e.batch=this,this.dirty=!0,this.blendMode=e.blendMode,this.texture=e.texture.baseTexture,this.head=e,this.tail=e,this.size=1,this.growBatch()},i.WebGLBatch.prototype.insertBefore=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__prev;t.__prev=e,e.__next=t,n?(e.__prev=n,n.__next=e):this.head=e},i.WebGLBatch.prototype.insertAfter=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__next;t.__next=e,e.__prev=t,n?(e.__next=n,n.__prev=e):this.tail=e},i.WebGLBatch.prototype.remove=function(e){return this.size--,0==this.size?(e.batch=null,e.__prev=null,void(e.__next=null)):(e.__prev?e.__prev.__next=e.__next:(this.head=e.__next,this.head.__prev=null),e.__next?e.__next.__prev=e.__prev:(this.tail=e.__prev,this.tail.__next=null),e.batch=null,e.__next=null,e.__prev=null,void(this.dirty=!0))},i.WebGLBatch.prototype.split=function(e){this.dirty=!0;var t=new i.WebGLBatch(this.gl);t.init(e),t.texture=this.texture,t.tail=this.tail,this.tail=e.__prev,this.tail.__next=null,e.__prev=null;for(var n=0;e;)n++,e.batch=t,e=e.__next;return t.size=n,this.size-=n,t},i.WebGLBatch.prototype.merge=function(e){this.dirty=!0,this.tail.__next=e.head,e.head.__prev=this.tail,this.size+=e.size,this.tail=e.tail;for(var t=e.head;t;)t.batch=this,t=t.__next},i.WebGLBatch.prototype.growBatch=function(){var e=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var t=this.indices.length/6,n=0;t>n;n++){var r=6*n,i=4*n;this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},i.WebGLBatch.prototype.refresh=function(){this.gl;this.dynamicSize<this.size&&this.growBatch();for(var e,t=0,n=this.head;n;){e=8*t;var r=n.texture,i=r.frame,o=r.baseTexture.width,a=r.baseTexture.height;this.uvs[e+0]=i.x/o,this.uvs[e+1]=i.y/a,this.uvs[e+2]=(i.x+i.width)/o,this.uvs[e+3]=i.y/a,this.uvs[e+4]=(i.x+i.width)/o,this.uvs[e+5]=(i.y+i.height)/a,this.uvs[e+6]=i.x/o,this.uvs[e+7]=(i.y+i.height)/a,n.updateFrame=!1,colorIndex=4*t,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=n.worldAlpha,n=n.__next,t++}this.dirtyUVS=!0,this.dirtyColors=!0},i.WebGLBatch.prototype.update=function(){for(var e,t,n,r,o,a,s,l,u,c,d,p,h,f,m,g,v=(this.gl,0),y=this.head;y;){if(y.vcount===i.visibleCount){if(t=y.texture.frame.width,n=y.texture.frame.height,r=y.anchor.x,o=y.anchor.y,a=t*(1-r),s=t*-r,l=n*(1-o),u=n*-o,c=8*v,e=y.worldTransform,d=e[0],p=e[3],h=e[1],f=e[4],m=e[2],g=e[5],this.verticies[c+0]=d*s+h*u+m,this.verticies[c+1]=f*u+p*s+g,this.verticies[c+2]=d*a+h*u+m,this.verticies[c+3]=f*u+p*a+g,this.verticies[c+4]=d*a+h*l+m,this.verticies[c+5]=f*l+p*a+g,this.verticies[c+6]=d*s+h*l+m,this.verticies[c+7]=f*l+p*s+g,y.updateFrame||y.texture.updateFrame){this.dirtyUVS=!0;var b=y.texture,x=b.frame,w=b.baseTexture.width,_=b.baseTexture.height;this.uvs[c+0]=x.x/w,this.uvs[c+1]=x.y/_,this.uvs[c+2]=(x.x+x.width)/w,this.uvs[c+3]=x.y/_,this.uvs[c+4]=(x.x+x.width)/w,this.uvs[c+5]=(x.y+x.height)/_,this.uvs[c+6]=x.x/w,this.uvs[c+7]=(x.y+x.height)/_,y.updateFrame=!1}if(y.cacheAlpha!=y.worldAlpha){y.cacheAlpha=y.worldAlpha;var T=4*v;this.colors[T]=this.colors[T+1]=this.colors[T+2]=this.colors[T+3]=y.worldAlpha,this.dirtyColors=!0}}else c=8*v,this.verticies[c+0]=0,this.verticies[c+1]=0,this.verticies[c+2]=0,this.verticies[c+3]=0,this.verticies[c+4]=0,this.verticies[c+5]=0,this.verticies[c+6]=0,this.verticies[c+7]=0;v++,y=y.__next}},i.WebGLBatch.prototype.render=function(e,t){if(e=e||0,void 0==t&&(t=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var n=this.gl,r=i.shaderProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=t-e;n.drawElements(n.TRIANGLES,6*o,n.UNSIGNED_SHORT,2*e*6)}},i.WebGLRenderGroup=function(e){this.gl=e,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},i.WebGLRenderGroup.prototype.constructor=i.WebGLRenderGroup,i.WebGLRenderGroup.prototype.setRenderable=function(e){this.root&&this.removeDisplayObjectAndChildren(this.root),e.worldVisible=e.visible,this.root=e,this.addDisplayObjectAndChildren(e)},i.WebGLRenderGroup.prototype.render=function(e){i.WebGLRenderer.updateTextures();var t=this.gl;t.uniform2f(i.shaderProgram.projectionVector,e.x,e.y),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);for(var n,r=0;r<this.batchs.length;r++)if(n=this.batchs[r],n instanceof i.WebGLBatch)this.batchs[r].render();else{var o=n.vcount===i.visibleCount;n instanceof i.TilingSprite?o&&this.renderTilingSprite(n,e):n instanceof i.Strip?o&&this.renderStrip(n,e):n instanceof i.Graphics?o&&n.renderable&&i.WebGLGraphics.renderGraphics(n,e):n instanceof i.FilterBlock&&(n.open?(t.enable(t.STENCIL_TEST),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE),i.WebGLGraphics.renderGraphics(n.mask,e),t.colorMask(!0,!0,!0,!1),t.stencilFunc(t.NOTEQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)):t.disable(t.STENCIL_TEST))}},i.WebGLRenderGroup.prototype.handleFilter=function(){},i.WebGLRenderGroup.prototype.renderSpecific=function(e,t){i.WebGLRenderer.updateTextures();var n=this.gl;n.uniform2f(i.shaderProgram.projectionVector,t.x,t.y);for(var r,o,a,s,l=e.first;l._iNext&&(l=l._iNext,!l.renderable||!l.__renderGroup););var u=l.batch;if(l instanceof i.Sprite){u=l.batch;var c=u.head;if(c==l)r=0;else for(r=1;c.__next!=l;)r++,c=c.__next}else u=l;for(var d,p=e,h=e;h.children.length>0;)h=h.children[h.children.length-1],h.renderable&&(p=h);if(p instanceof i.Sprite){d=p.batch;var c=d.head;if(c==p)a=0;else for(a=1;c.__next!=p;)a++,c=c.__next}else d=p;if(u==d)return void(u instanceof i.WebGLBatch?u.render(r,a+1):this.renderSpecial(u,t));o=this.batchs.indexOf(u),s=this.batchs.indexOf(d),u instanceof i.WebGLBatch?u.render(r):this.renderSpecial(u,t);for(var f=o+1;s>f;f++)renderable=this.batchs[f],renderable instanceof i.WebGLBatch?this.batchs[f].render():this.renderSpecial(renderable,t);d instanceof i.WebGLBatch?d.render(0,a+1):this.renderSpecial(d,t)},i.WebGLRenderGroup.prototype.renderSpecial=function(e,t){var n=e.vcount===i.visibleCount;if(e instanceof i.TilingSprite)n&&this.renderTilingSprite(e,t);else if(e instanceof i.Strip)n&&this.renderStrip(e,t);else if(e instanceof i.CustomRenderable)n&&e.renderWebGL(this,t);else if(e instanceof i.Graphics)n&&e.renderable&&i.WebGLGraphics.renderGraphics(e,t);else if(e instanceof i.FilterBlock){var r=i.gl;e.open?(r.enable(r.STENCIL_TEST),r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),i.WebGLGraphics.renderGraphics(e.mask,t),r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)):r.disable(r.STENCIL_TEST)}},i.WebGLRenderGroup.prototype.updateTexture=function(e){this.removeObject(e);for(var t=e.first;t!=this.root&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););this.insertObject(e,t,n)},i.WebGLRenderGroup.prototype.addFilterBlocks=function(e,t){e.__renderGroup=this,t.__renderGroup=this;for(var n=e;n!=this.root&&(n=n._iPrev,!n.renderable||!n.__renderGroup););this.insertAfter(e,n);for(var r=t;r!=this.root&&(r=r._iPrev,!r.renderable||!r.__renderGroup););this.insertAfter(t,r)},i.WebGLRenderGroup.prototype.removeFilterBlocks=function(e,t){this.removeObject(e),this.removeObject(t)},i.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(e){e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e);for(var t=e.first;t!=this.root.first&&(t=t._iPrev,!t.renderable||!t.__renderGroup););for(var n=e.last;n._iNext&&(n=n._iNext,!n.renderable||!n.__renderGroup););var r=e.first,i=e.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,t,n),t=r),r=r._iNext;while(r!=i)},i.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(e){if(e.__renderGroup==this){{e.last}do e.__renderGroup=null,e.renderable&&this.removeObject(e),e=e._iNext;while(e)}},i.WebGLRenderGroup.prototype.insertObject=function(e,t,n){var r=t,o=n;if(e instanceof i.Sprite){var a,s;if(r instanceof i.Sprite){if(a=r.batch,a&&a.texture==e.texture.baseTexture&&a.blendMode==e.blendMode)return void a.insertAfter(e,r)}else a=r;if(o)if(o instanceof i.Sprite){if(s=o.batch){if(s.texture==e.texture.baseTexture&&s.blendMode==e.blendMode)return void s.insertBefore(e,o);if(s==a){var l=a.split(o),u=i.WebGLRenderer.getBatch(),c=this.batchs.indexOf(a);return u.init(e),void this.batchs.splice(c+1,0,u,l)}}}else s=o;var u=i.WebGLRenderer.getBatch();if(u.init(e),a){var c=this.batchs.indexOf(a);this.batchs.splice(c+1,0,u)}else this.batchs.push(u)}else e instanceof i.TilingSprite?this.initTilingSprite(e):e instanceof i.Strip&&this.initStrip(e),this.insertAfter(e,r)},i.WebGLRenderGroup.prototype.insertAfter=function(e,t){if(t instanceof i.Sprite){var n=t.batch;if(n)if(n.tail==t){var r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e)}else{var o=n.split(t.__next),r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e,o)}else this.batchs.push(e)}else{var r=this.batchs.indexOf(t);this.batchs.splice(r+1,0,e)}},i.WebGLRenderGroup.prototype.removeObject=function(e){var t;if(e instanceof i.Sprite){var n=e.batch;if(!n)return;n.remove(e),0==n.size&&(t=n)}else t=e;if(t){var r=this.batchs.indexOf(t);if(-1==r)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),void(t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t));if(this.batchs[r-1]instanceof i.WebGLBatch&&this.batchs[r+1]instanceof i.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t),i.WebGLRenderer.returnBatch(this.batchs[r+1]),void this.batchs.splice(r,2);this.batchs.splice(r,1),t instanceof i.WebGLBatch&&i.WebGLRenderer.returnBatch(t)}},i.WebGLRenderGroup.prototype.initTilingSprite=function(e){var t=this.gl;e.verticies=new Float32Array([0,0,e.width,0,e.width,e.height,0,e.height]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.colors=new Float32Array([1,1,1,1]),e.indices=new Uint16Array([0,1,3,2]),e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),e.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,e.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),e.texture.baseTexture._powerOf2=!0):e.texture.baseTexture._powerOf2=!0},i.WebGLRenderGroup.prototype.renderStrip=function(e,t){var n=this.gl,r=i.shaderProgram;n.useProgram(i.stripShaderProgram);var o=i.mat3.clone(e.worldTransform);i.mat3.transpose(o),n.uniformMatrix3fv(i.stripShaderProgram.translationMatrix,!1,o),n.uniform2f(i.stripShaderProgram.projectionVector,t.x,t.y),n.uniform1f(i.stripShaderProgram.alpha,e.worldAlpha),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.bufferData(n.ARRAY_BUFFER,e.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),n.useProgram(i.shaderProgram)},i.WebGLRenderGroup.prototype.renderTilingSprite=function(e,t){var n=this.gl,r=(i.shaderProgram,e.tilePosition),o=e.tileScale,a=r.x/e.texture.baseTexture.width,s=r.y/e.texture.baseTexture.height,l=e.width/e.texture.baseTexture.width/o.x,u=e.height/e.texture.baseTexture.height/o.y;e.uvs[0]=0-a,e.uvs[1]=0-s,e.uvs[2]=1*l-a,e.uvs[3]=0-s,e.uvs[4]=1*l-a,e.uvs[5]=1*u-s,e.uvs[6]=0-a,e.uvs[7]=1*u-s,n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.uvs),this.renderStrip(e,t)},i.WebGLRenderGroup.prototype.initStrip=function(e){{var t=this.gl;this.shaderProgram}e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},i.CanvasRenderer=function(e,t,n,r){this.transparent=r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},i.CanvasRenderer.prototype.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(e){i.texturesToUpdate=[],i.texturesToDestroy=[],i.visibleCount++,e.updateTransform(),this.view.style.backgroundColor==e.backgroundColorString||this.transparent||(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),i.Texture.frameUpdates.length>0&&(i.Texture.frameUpdates=[])},i.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},i.CanvasRenderer.prototype.renderDisplayObject=function(e){var t,n=this.context;n.globalCompositeOperation="source-over";var r=e.last._iNext;e=e.first;do if(t=e.worldTransform,e.visible)if(e.renderable){if(e instanceof i.Sprite){var o=e.texture.frame;o&&(n.globalAlpha=e.worldAlpha,n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),n.drawImage(e.texture.baseTexture.source,o.x,o.y,o.width,o.height,e.anchor.x*-o.width,e.anchor.y*-o.height,o.width,o.height))}else if(e instanceof i.Strip)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderStrip(e);else if(e instanceof i.TilingSprite)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderTilingSprite(e);else if(e instanceof i.CustomRenderable)e.renderCanvas(this);else if(e instanceof i.Graphics)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),i.CanvasGraphics.renderGraphics(e,n);else if(e instanceof i.FilterBlock)if(e.open){n.save();var a=e.mask.alpha,s=e.mask.worldTransform;n.setTransform(s[0],s[3],s[1],s[4],s[2],s[5]),e.mask.worldAlpha=.5,n.worldAlpha=0,i.CanvasGraphics.renderGraphicsMask(e.mask,n),n.clip(),e.mask.worldAlpha=a}else n.restore();e=e._iNext}else e=e._iNext;else e=e.last._iNext;while(e!=r)},i.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=(e.uvs,n.length/2);this.count++,t.beginPath();for(var i=1;r-2>i;i++){var o=2*i,a=n[o],s=n[o+2],l=n[o+4],u=n[o+1],c=n[o+3],d=n[o+5];t.moveTo(a,u),t.lineTo(s,c),t.lineTo(l,d)}t.fillStyle="#FF0000",t.fill(),t.closePath()},i.CanvasRenderer.prototype.renderTilingSprite=function(e){var t=this.context;t.globalAlpha=e.worldAlpha,e.__tilePattern||(e.__tilePattern=t.createPattern(e.texture.baseTexture.source,"repeat")),t.beginPath();var n=e.tilePosition,r=e.tileScale;t.scale(r.x,r.y),t.translate(n.x,n.y),t.fillStyle=e.__tilePattern,t.fillRect(-n.x,-n.y,e.width/r.x,e.height/r.y),t.scale(1/r.x,1/r.y),t.translate(-n.x,-n.y),t.closePath()},i.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var o=1;i-2>o;o++){var a=2*o,s=n[a],l=n[a+2],u=n[a+4],c=n[a+1],d=n[a+3],p=n[a+5],h=r[a]*e.texture.width,f=r[a+2]*e.texture.width,m=r[a+4]*e.texture.width,g=r[a+1]*e.texture.height,v=r[a+3]*e.texture.height,y=r[a+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(s,c),t.lineTo(l,d),t.lineTo(u,p),t.closePath(),t.clip();var b=h*v+g*m+f*y-v*m-g*f-h*y,x=s*v+g*u+l*y-v*u-g*l-s*y,w=h*l+s*m+f*u-l*m-s*f-h*u,_=h*v*u+g*l*m+s*f*y-s*v*m-g*f*u-h*l*y,T=c*v+g*p+d*y-v*p-g*d-c*y,C=h*d+c*m+f*p-d*m-c*f-h*p,A=h*v*p+g*d*m+c*f*y-c*v*m-g*f*p-h*d*y;t.transform(x/b,T/b,w/b,C/b,_/b,A/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},i.CanvasGraphics=function(){},i.CanvasGraphics.renderGraphics=function(e,t){for(var n=e.worldAlpha,r=0;r<e.graphicsData.length;r++){var o=e.graphicsData[r],a=o.points;if(t.strokeStyle=color="#"+("00000"+(0|o.lineColor).toString(16)).substr(-6),t.lineWidth=o.lineWidth,o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}else if(o.type==i.Graphics.RECT)void 0!=o.fillColor&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fillRect(a[0],a[1],a[2],a[3])),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.strokeRect(a[0],a[1],a[2],a[3]));else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke());else if(o.type==i.Graphics.ELIP){var l=o.points,u=2*l[2],c=2*l[3],d=l[0]-u/2,p=l[1]-c/2;t.beginPath();var h=.5522848,f=u/2*h,m=c/2*h,g=d+u,v=p+c,y=d+u/2,b=p+c/2;t.moveTo(d,b),t.bezierCurveTo(d,b-m,y-f,p,y,p),t.bezierCurveTo(y+f,p,g,b-m,g,b),t.bezierCurveTo(g,b+m,y+f,v,y,v),t.bezierCurveTo(y-f,v,d,b+m,d,b),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*n,t.fillStyle=color="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*n,t.stroke())}}},i.CanvasGraphics.renderGraphicsMask=function(e,t){var n=(e.worldAlpha,e.graphicsData.length);n>1&&(n=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;1>r;r++){var o=e.graphicsData[r],a=o.points;if(o.type==i.Graphics.POLY){t.beginPath(),t.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)t.lineTo(a[2*s],a[2*s+1]);a[0]==a[a.length-2]&&a[1]==a[a.length-1]&&t.closePath()}else if(o.type==i.Graphics.RECT)t.beginPath(),t.rect(a[0],a[1],a[2],a[3]),t.closePath();else if(o.type==i.Graphics.CIRC)t.beginPath(),t.arc(a[0],a[1],a[2],0,2*Math.PI),t.closePath();else if(o.type==i.Graphics.ELIP){var l=o.points,u=2*l[2],c=2*l[3],d=l[0]-u/2,p=l[1]-c/2;t.beginPath();var h=.5522848,f=u/2*h,m=c/2*h,g=d+u,v=p+c,y=d+u/2,b=p+c/2;t.moveTo(d,b),t.bezierCurveTo(d,b-m,y-f,p,y,p),t.bezierCurveTo(y+f,p,g,b-m,g,b),t.bezierCurveTo(g,b+m,y+f,v,y,v),t.bezierCurveTo(y-f,v,d,b+m,d,b),t.closePath()}}},i.Graphics=function(){i.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},i.Graphics.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Graphics.prototype.constructor=i.Graphics,i.Graphics.prototype.lineStyle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=void 0==n?1:n,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.graphicsData.push(this.currentPath)},i.Graphics.prototype.moveTo=function(e,t){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:i.Graphics.POLY},this.currentPath.points.push(e,t),this.graphicsData.push(this.currentPath)},i.Graphics.prototype.lineTo=function(e,t){this.currentPath.points.push(e,t),this.dirty=!0},i.Graphics.prototype.beginFill=function(e,t){this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0==t?1:t},i.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},i.Graphics.prototype.drawRect=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawCircle=function(e,t,n){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,n],type:i.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.drawElipse=function(e,t,n,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:i.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},i.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},i.Graphics.POLY=0,i.Graphics.RECT=1,i.Graphics.CIRC=2,i.Graphics.ELIP=3,i.Strip=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=i.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=t,this.height=n,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.constructor=i.Strip,i.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},i.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Rope=function(e,t){i.Strip.call(this,e),this.points=t;try{this.verticies=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length)}catch(n){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.constructor=i.Rope,i.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,n=this.indices,r=this.colors,i=e[0],o=e[0];this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;for(var a=e.length,s=1;a>s;s++){var o=e[s],l=4*s,u=s/(a-1);s%2?(t[l]=u,t[l+1]=0,t[l+2]=u,t[l+3]=1):(t[l]=u,t[l+1]=0,t[l+2]=u,t[l+3]=1),l=2*s,r[l]=1,r[l+1]=1,l=2*s,n[l]=l,n[l+1]=l+1,i=o
}}},i.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var t,n=this.verticies,r=e[0],o={x:0,y:0},a=e[0];this.count-=.2,n[0]=a.x+o.x,n[1]=a.y+o.y,n[2]=a.x-o.x,n[3]=a.y-o.y;for(var s=e.length,l=1;s>l;l++){var a=e[l],u=4*l;t=l<e.length-1?e[l+1]:a,o.y=-(t.x-r.x),o.x=t.y-r.y;var c=10*(1-l/(s-1));c>1&&(c=1);var d=Math.sqrt(o.x*o.x+o.y*o.y),p=this.texture.height/2;o.x/=d,o.y/=d,o.x*=p,o.y*=p,n[u]=a.x+o.x,n[u+1]=a.y+o.y,n[u+2]=a.x-o.x,n[u+3]=a.y-o.y,r=a}i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite=function(e,t,n){i.DisplayObjectContainer.call(this),this.texture=e,this.width=t,this.height=n,this.tileScale=new i.Point(1,1),this.tilePosition=new i.Point(0,0),this.renderable=!0,this.blendMode=i.blendModes.NORMAL},i.TilingSprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.TilingSprite.prototype.constructor=i.TilingSprite,i.TilingSprite.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},i.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Spine=function(e){if(i.DisplayObjectContainer.call(this),this.spineData=i.AnimCache[e],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData),this.slotContainers=[];for(var t=0,n=this.skeleton.drawOrder.length;n>t;t++){var r=this.skeleton.drawOrder[t],o=r.attachment,a=new i.DisplayObjectContainer;if(this.slotContainers.push(a),this.addChild(a),o instanceof c.RegionAttachment){var s=o.rendererObject.name,l=this.createSprite(r,o.rendererObject);r.currentSprite=l,r.currentSpriteName=s,a.addChild(l)}}},i.Spine.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Spine.prototype.constructor=i.Spine,i.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var t=this.skeleton.drawOrder,n=0,r=t.length;r>n;n++){var o=t[n],a=o.attachment,s=this.slotContainers[n];if(a instanceof c.RegionAttachment){if(a.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!=a.name)){var l=a.rendererObject.name;if(void 0!==o.currentSprite&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{},void 0!==o.sprites[l])o.sprites[l].visible=!0;else{var u=this.createSprite(o,a.rendererObject);s.addChild(u)}o.currentSprite=o.sprites[l],o.currentSpriteName=l}s.visible=!0;var d=o.bone;s.position.x=d.worldX+a.x*d.m00+a.y*d.m01,s.position.y=d.worldY+a.x*d.m10+a.y*d.m11,s.scale.x=d.worldScaleX,s.scale.y=d.worldScaleY,s.rotation=-(o.bone.worldRotation*Math.PI/180)}else s.visible=!1}i.DisplayObjectContainer.prototype.updateTransform.call(this)},i.Spine.prototype.createSprite=function(e,t){var n=i.TextureCache[t.name]?t.name:t.name+".png",r=new i.Sprite(i.Texture.fromFrame(n));return r.scale=t.scale,r.rotation=t.rotation,r.anchor.x=r.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[t.name]=r,r};var c={};c.BoneData=function(e,t){this.name=e,this.parent=t},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(e,t){this.name=e,this.boneData=t},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var n=this.parent;null!=n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,i=Math.cos(r),o=Math.sin(r);this.m00=i*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=i*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},c.Slot=function(e,t,n){this.data=e,this.skeleton=t,this.bone=n,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;for(var t=this.skeleton.data.slots,n=0,r=t.length;r>n;n++)if(t[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},c.Skin=function(e){this.name=e,this.attachments={}},c.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":"),i=parseInt(n.substring(0,r)),o=n.substring(r+1),a=e.slots[i];if(a.attachment&&a.attachment.name==o){var s=this.getAttachment(i,o);s&&a.setAttachment(s)}}}},c.Animation=function(e,t,n){this.name=e,this.timelines=t,this.duration=n},c.Animation.prototype={apply:function(e,t,n){n&&0!=this.duration&&(t%=this.duration);for(var r=this.timelines,i=0,o=r.length;o>i;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){n&&0!=this.duration&&(t%=this.duration);for(var i=this.timelines,o=0,a=i.length;a>o;o++)i[o].apply(e,t,r)}},c.binarySearch=function(e,t,n){var r=0,i=Math.floor(e.length/n)-2;if(0==i)return n;for(var o=i>>>1;;){if(e[(o+1)*n]<=t?r=o+1:i=o,r==i)return(r+1)*n;o=r+i>>>1}},c.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;i>=r;r+=n)if(e[r]>t)return r;return-1},c.Curves=function(e){this.curves=[],this.curves.length=6*(e-1)},c.Curves.prototype={setLinear:function(e){this.curves[6*e]=0},setStepped:function(e){this.curves[6*e]=-1},setCurve:function(e,t,n,r,i){var o=.1,a=o*o,s=a*o,l=3*o,u=3*a,c=6*a,d=6*s,p=2*-t+r,h=2*-n+i,f=3*(t-r)+1,m=3*(n-i)+1,g=6*e,v=this.curves;v[g]=t*l+p*u+f*s,v[g+1]=n*l+h*u+m*s,v[g+2]=p*c+f*d,v[g+3]=h*c+m*d,v[g+4]=f*d,v[g+5]=m*d},getCurvePercent:function(e,t){t=0>t?0:t>1?1:t;var n=6*e,r=this.curves,i=r[n];if(!i)return t;if(-1==i)return 0;for(var o=r[n+1],a=r[n+2],s=r[n+3],l=r[n+4],u=r[n+5],c=i,d=o,p=8;;){if(c>=t){var h=c-i,f=d-o;return f+(d-f)*(t-h)/(c-h)}if(0==p)break;p--,i+=a,o+=s,a+=l,s+=u,c+=i,d+=o}return d+(1-d)*(t-c)/(1-c)}},c.RotateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=2*e},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2,this.frames[e]=t,this.frames[e+1]=n},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-2]){for(var o=i.data.rotation+r[r.length-1]-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;return void(i.rotation+=o*n)}var a=c.binarySearch(r,t,2),s=r[a-1],l=r[a],u=1-(t-l)/(r[a-2]-l);u=this.curves.getCurvePercent(a/2-1,u);for(var o=r[a+1]-s;o>180;)o-=360;for(;-180>o;)o+=360;for(o=i.data.rotation+(s+o*u)-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;i.rotation+=o*n}}},c.TranslateTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.x+=(i.data.x+r[r.length-2]-i.x)*n,void(i.y+=(i.data.y+r[r.length-1]-i.y)*n);var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],l=r[o],u=1-(t-l)/(r[o+-3]-l);u=this.curves.getCurvePercent(o/3-1,u),i.x+=(i.data.x+a+(r[o+1]-a)*u-i.x)*n,i.y+=(i.data.y+s+(r[o+2]-s)*u-i.y)*n}}},c.ScaleTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=3*e},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.bones[this.boneIndex];if(t>=r[r.length-3])return i.scaleX+=(i.data.scaleX-1+r[r.length-2]-i.scaleX)*n,void(i.scaleY+=(i.data.scaleY-1+r[r.length-1]-i.scaleY)*n);var o=c.binarySearch(r,t,3),a=r[o-2],s=r[o-1],l=r[o],u=1-(t-l)/(r[o+-3]-l);u=this.curves.getCurvePercent(o/3-1,u),i.scaleX+=(i.data.scaleX-1+a+(r[o+1]-a)*u-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+s+(r[o+2]-s)*u-i.scaleY)*n}}},c.ColorTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=5*e},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t){e*=5,this.frames[e]=t,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,t,n){var r=this.frames;if(!(t<r[0])){var i=e.slots[this.slotIndex];if(t>=r[r.length-5]){var o=r.length-1;return i.r=r[o-3],i.g=r[o-2],i.b=r[o-1],void(i.a=r[o])}var a=c.binarySearch(r,t,5),s=r[a-4],l=r[a-3],u=r[a-2],d=r[a-1],p=r[a],h=1-(t-p)/(r[a-5]-p);h=this.curves.getCurvePercent(a/5-1,h);var f=s+(r[a+1]-s)*h,m=l+(r[a+2]-l)*h,g=u+(r[a+3]-u)*h,v=d+(r[a+4]-d)*h;1>n?(i.r+=(f-i.r)*n,i.g+=(m-i.g)*n,i.b+=(g-i.b)*n,i.a+=(v-i.a)*n):(i.r=f,i.g=m,i.b=g,i.a=v)}}},c.AttachmentTimeline=function(e){this.curves=new c.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,n){this.frames[e]=t,this.attachmentNames[e]=n},apply:function(e,t){var n=this.frames;if(!(t<n[0])){var r;r=t>=n[n.length-1]?n.length-1:c.binarySearch(n,t,1)-1;var i=this.attachmentNames[r];e.slots[this.slotIndex].setAttachment(i?e.getAttachmentBySlotIndex(this.slotIndex,i):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].name==e)return slot[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){for(var t=this.skins,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){for(var t=this.animations,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null}},c.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,n=e.bones.length;n>t;t++){var r=e.bones[t],i=r.parent?this.bones[e.bones.indexOf(r.parent)]:null;this.bones.push(new c.Bone(r,i))}this.slots=[],this.drawOrder=[];for(var t=0,n=e.slots.length;n>t;t++){var o=e.slots[t],a=this.bones[e.bones.indexOf(o.boneData)],s=new c.Slot(o,this,a);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var e=this.flipX,t=this.flipY,n=this.bones,r=0,i=n.length;i>r;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,t=0,n=e.length;n>t;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){for(var e=this.slots,t=0,n=e.length;n>t;t++)e[t].setToSetupPose(t)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){for(var t=this.bones,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){for(var t=this.slots,n=0,r=t.length;r>n;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){for(var n=this.slots,r=0,i=n.size;i>r;r++){var o=n[r];if(o.data.name==e){var a=null;if(t&&(a=this.getAttachment(r,t),null==a))throw"Attachment not found: "+t+", for slot: "+e;return void o.setAttachment(a)}}throw"Slot not found: "+e},update:function(e){time+=e}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var o=this.uvs;i?(o[2]=e,o[3]=r,o[4]=e,o[5]=t,o[6]=n,o[7]=t,o[0]=n,o[1]=r):(o[0]=e,o[1]=r,o[2]=e,o[3]=t,o[4]=n,o[5]=t,o[6]=n,o[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,r=-this.height/2*this.scaleY+this.regionOffsetY*t,i=n+this.regionWidth*e,o=r+this.regionHeight*t,a=this.rotation*Math.PI/180,s=Math.cos(a),l=Math.sin(a),u=n*s+this.x,c=n*l,d=r*s+this.y,p=r*l,h=i*s+this.x,f=i*l,m=o*s+this.y,g=o*l,v=this.offset;v[0]=u-p,v[1]=d+c,v[2]=u-g,v[3]=m+c,v[4]=h-g,v[5]=m+f,v[6]=h-p,v[7]=d+f},computeVertices:function(e,t,n,r){e+=n.worldX,t+=n.worldY;var i=n.m00,o=n.m01,a=n.m10,s=n.m11,l=this.offset;r[0]=l[0]*i+l[1]*o+e,r[1]=l[0]*a+l[1]*s+t,r[2]=l[2]*i+l[3]*o+e,r[3]=l[2]*a+l[3]*s+t,r[4]=l[4]*i+l[5]*o+e,r[5]=l[4]*a+l[5]*s+t,r[6]=l[6]*i+l[7]*o+e,r[7]=l[6]*a+l[7]*s+t}},c.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},c.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:this.defaultMix}},c.AnimationState=function(e){this.data=e,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){if(this.currentTime+=e,this.previousTime+=e,this.mixTime+=e,this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(this.current)if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};if(r.animation=e,r.loop=t,!n||0>=n){var i=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;n=null!=i?i.duration-this.data.getMix(i,e)+(n||0):0}r.delay=n,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(e){this.attachmentLoader=e},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){for(var t=new c.SkeletonData,n=e.bones,r=0,i=n.length;i>r;r++){var o=n[r],a=null;if(o.parent&&(a=t.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;var s=new c.BoneData(o.name,a);s.length=(o.length||0)*this.scale,s.x=(o.x||0)*this.scale,s.y=(o.y||0)*this.scale,s.rotation=o.rotation||0,s.scaleX=o.scaleX||1,s.scaleY=o.scaleY||1,t.bones.push(s)}for(var l=e.slots,r=0,i=l.length;i>r;r++){var u=l[r],s=t.findBone(u.bone);if(!s)throw"Slot bone not found: "+u.bone;var d=new c.SlotData(u.name,s),p=u.color;p&&(d.r=c.SkeletonJson.toColor(p,0),d.g=c.SkeletonJson.toColor(p,1),d.b=c.SkeletonJson.toColor(p,2),d.a=c.SkeletonJson.toColor(p,3)),d.attachmentName=u.attachment,t.slots.push(d)}var h=e.skins;for(var f in h)if(h.hasOwnProperty(f)){var m=h[f],g=new c.Skin(f);for(var v in m)if(m.hasOwnProperty(v)){var y=t.findSlotIndex(v),b=m[v];for(var x in b)if(b.hasOwnProperty(x)){var w=this.readAttachment(g,x,b[x]);null!=w&&g.addAttachment(y,x,w)}}t.skins.push(g),"default"==g.name&&(t.defaultSkin=g)}var _=e.animations;for(var T in _)_.hasOwnProperty(T)&&this.readAnimation(T,_[T],t);return t},readAttachment:function(e,t,n){t=n.name||t;var r=c.AttachmentType[n.type||"region"];if(r==c.AttachmentType.region){var i=new c.RegionAttachment;return i.x=(n.x||0)*this.scale,i.y=(n.y||0)*this.scale,i.scaleX=n.scaleX||1,i.scaleY=n.scaleY||1,i.rotation=n.rotation||0,i.width=(n.width||32)*this.scale,i.height=(n.height||32)*this.scale,i.updateOffset(),i.rendererObject={},i.rendererObject.name=t,i.rendererObject.scale={},i.rendererObject.scale.x=i.scaleX,i.rendererObject.scale.y=i.scaleY,i.rendererObject.rotation=-i.rotation*Math.PI/180,i}throw"Unknown attachment type: "+r},readAnimation:function(e,t,n){var r=[],i=0,o=t.bones;for(var a in o)if(o.hasOwnProperty(a)){var s=n.findBoneIndex(a);if(-1==s)throw"Bone not found: "+a;var l=o[a];for(var u in l)if(l.hasOwnProperty(u)){var d=l[u];if("rotate"==u){var p=new c.RotateTimeline(d.length);p.boneIndex=s;for(var h=0,f=0,m=d.length;m>f;f++){var g=d[f];p.setFrame(h,g.time,g.angle),c.SkeletonJson.readCurve(p,h,g),h++}r.push(p),i=Math.max(i,p.frames[2*p.getFrameCount()-2])}else{if("translate"!=u&&"scale"!=u)throw"Invalid timeline type for a bone: "+u+" ("+a+")";var p,v=1;"scale"==u?p=new c.ScaleTimeline(d.length):(p=new c.TranslateTimeline(d.length),v=this.scale),p.boneIndex=s;for(var h=0,f=0,m=d.length;m>f;f++){var g=d[f],y=(g.x||0)*v,b=(g.y||0)*v;p.setFrame(h,g.time,y,b),c.SkeletonJson.readCurve(p,h,g),h++}r.push(p),i=Math.max(i,p.frames[3*p.getFrameCount()-3])}}}var x=t.slots;for(var w in x)if(x.hasOwnProperty(w)){var _=x[w],T=n.findSlotIndex(w);for(var u in _)if(_.hasOwnProperty(u)){var d=_[u];if("color"==u){var p=new c.ColorTimeline(d.length);p.slotIndex=T;for(var h=0,f=0,m=d.length;m>f;f++){var g=d[f],C=g.color,A=c.SkeletonJson.toColor(C,0),S=c.SkeletonJson.toColor(C,1),P=c.SkeletonJson.toColor(C,2),E=c.SkeletonJson.toColor(C,3);p.setFrame(h,g.time,A,S,P,E),c.SkeletonJson.readCurve(p,h,g),h++}r.push(p),i=Math.max(i,p.frames[5*p.getFrameCount()-5])}else{if("attachment"!=u)throw"Invalid timeline type for a slot: "+u+" ("+w+")";var p=new c.AttachmentTimeline(d.length);p.slotIndex=T;for(var h=0,f=0,m=d.length;m>f;f++){var g=d[f];p.setFrame(h++,g.time,g.name)}r.push(p),i=Math.max(i,p.frames[p.getFrameCount()-1])}}}n.animations.push(new c.Animation(e,r,i))}},c.SkeletonJson.readCurve=function(e,t,n){var r=n.curve;r&&("stepped"==r?e.curves.setStepped(t):r instanceof Array&&e.curves.setCurve(t,r[0],r[1],r[2],r[3]))},c.SkeletonJson.toColor=function(e,t){if(8!=e.length)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(2*t,2),16)/255},c.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var n=new c.AtlasReader(e),r=[];r.length=4;for(var i=null;;){var o=n.readLine();if(null==o)break;if(o=n.trim(o),0==o.length)i=null;else if(i){var a=new c.AtlasRegion;a.name=o,a.page=i,a.rotate="true"==n.readValue(),n.readTuple(r);var s=parseInt(r[0]),l=parseInt(r[1]);n.readTuple(r);var u=parseInt(r[0]),d=parseInt(r[1]);a.u=s/i.width,a.v=l/i.height,a.rotate?(a.u2=(s+d)/i.width,a.v2=(l+u)/i.height):(a.u2=(s+u)/i.width,a.v2=(l+d)/i.height),a.x=s,a.y=l,a.width=Math.abs(u),a.height=Math.abs(d),4==n.readTuple(r)&&(a.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==n.readTuple(r)&&(a.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),a.originalWidth=parseInt(r[0]),a.originalHeight=parseInt(r[1]),n.readTuple(r),a.offsetX=parseInt(r[0]),a.offsetY=parseInt(r[1]),a.index=parseInt(n.readValue()),this.regions.push(a)}else{i=new c.AtlasPage,i.name=o,i.format=c.Atlas.Format[n.readValue()],n.readTuple(r),i.minFilter=c.Atlas.TextureFilter[r[0]],i.magFilter=c.Atlas.TextureFilter[r[1]];var p=n.readValue();i.uWrap=c.Atlas.TextureWrap.clampToEdge,i.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==p?i.uWrap=c.Atlas.TextureWrap.repeat:"y"==p?i.vWrap=c.Atlas.TextureWrap.repeat:"xy"==p&&(i.uWrap=i.vWrap=c.Atlas.TextureWrap.repeat),t.load(i,o),this.pages.push(i)}}},c.Atlas.prototype={findRegion:function(e){for(var t=this.regions,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},dispose:function(){for(var e=this.pages,t=0,n=e.length;n>t;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){for(var t=this.regions,n=0,r=t.length;r>n;n++){var i=t[n];i.page==e&&(i.u=i.x/e.width,i.v=i.y/e.height,i.rotate?(i.u2=(i.x+i.height)/e.width,i.v2=(i.y+i.width)/e.height):(i.u2=(i.x+i.width)/e.width,i.v2=(i.y+i.height)/e.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(-1==t)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),n=t.indexOf(":");if(-1==n)throw"Invalid line: "+t;for(var r=0,i=n+1;3>r;r++){var o=t.indexOf(",",i);if(-1==o){if(0==r)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,o-i)),i=o+1}return e[r]=this.trim(t.substring(i)),r+1}},c.AtlasAttachmentLoader=function(e){this.atlas=e},c.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,n){switch(t){case c.AttachmentType.region:var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" ("+t+")";var i=new c.RegionAttachment(n);return i.rendererObject=r,i.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),i.regionOffsetX=r.offsetX,i.regionOffsetY=r.offsetY,i.regionWidth=r.width,i.regionHeight=r.height,i.regionOriginalWidth=r.originalWidth,i.regionOriginalHeight=r.originalHeight,i}throw"Unknown attachment type: "+t}},i.AnimCache={},c.Bone.yDown=!0,i.CustomRenderable=function(){i.DisplayObject.call(this)},i.CustomRenderable.prototype=Object.create(i.DisplayObject.prototype),i.CustomRenderable.prototype.constructor=i.CustomRenderable,i.CustomRenderable.prototype.renderCanvas=function(){},i.CustomRenderable.prototype.initWebGL=function(){},i.CustomRenderable.prototype.renderWebGL=function(){},i.BaseTextureCache={},i.texturesToUpdate=[],i.texturesToDestroy=[],i.BaseTexture=function(e){if(i.EventTarget.call(this),this.width=100,this.height=100,this.hasLoaded=!1,this.source=e,e){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);else{var t=this;this.source.onload=function(){t.hasLoaded=!0,t.width=t.source.width,t.height=t.source.height,i.texturesToUpdate.push(t),t.dispatchEvent({type:"loaded",content:t})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,i.texturesToUpdate.push(this);this._powerOf2=!1}},i.BaseTexture.prototype.constructor=i.BaseTexture,i.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,i.texturesToDestroy.push(this)},i.BaseTexture.fromImage=function(e,t){var n=i.BaseTextureCache[e];if(!n){var r=new Image;t&&(r.crossOrigin=""),r.src=e,n=new i.BaseTexture(r),i.BaseTextureCache[e]=n}return n},i.TextureCache={},i.FrameCache={},i.Texture=function(e,t){if(i.EventTarget.call(this),t||(this.noFrame=!0,t=new i.Rectangle(0,0,1,1)),e instanceof i.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=t,this.trim=new i.Point,this.scope=this,e.hasLoaded)this.noFrame&&(t=new i.Rectangle(0,0,e.width,e.height)),this.setFrame(t);else{var n=this;e.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},i.Texture.prototype.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new i.Rectangle(0,0,e.width,e.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},i.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},i.Texture.prototype.setFrame=function(e){if(this.frame=e,this.width=e.width,this.height=e.height,e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,i.Texture.frameUpdates.push(this)},i.Texture.fromImage=function(e,t){var n=i.TextureCache[e];return n||(n=new i.Texture(i.BaseTexture.fromImage(e,t)),i.TextureCache[e]=n),n},i.Texture.fromFrame=function(e){var t=i.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache "+this);return t},i.Texture.fromCanvas=function(e){var t=new i.BaseTexture(e);return new i.Texture(t)},i.Texture.addTextureToCache=function(e,t){i.TextureCache[t]=e},i.Texture.removeTextureFromCache=function(e){var t=i.TextureCache[e];return i.TextureCache[e]=null,t},i.Texture.frameUpdates=[],i.RenderTexture=function(e,t){i.EventTarget.call(this),this.width=e||100,this.height=t||100,this.indetityMatrix=i.mat3.create(),this.frame=new i.Rectangle(0,0,this.width,this.height),i.gl?this.initWebGL():this.initCanvas()},i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.constructor=i.RenderTexture,i.RenderTexture.prototype.initWebGL=function(){var e=i.gl;this.glFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.baseTexture._glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new i.Point(this.width/2,this.height/2),this.render=this.renderWebGL},i.RenderTexture.prototype.resize=function(e,t){if(this.width=e,this.height=t,i.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var n=i.gl;n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},i.RenderTexture.prototype.initCanvas=function(){this.renderer=new i.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new i.BaseTexture(this.renderer.view),this.frame=new i.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},i.RenderTexture.prototype.renderWebGL=function(e,t,n){var r=i.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),n&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var o=e.children,a=e.worldTransform;e.worldTransform=i.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=2*this.projection.y,t&&(e.worldTransform[2]=t.x,e.worldTransform[5]-=t.y),i.visibleCount++,e.vcount=i.visibleCount;for(var s=0,l=o.length;l>s;s++)o[s].updateTransform();var u=e.__renderGroup;u?e==u.root?u.render(this.projection):u.renderSpecific(e,this.projection):(this.renderGroup||(this.renderGroup=new i.WebGLRenderGroup(r)),this.renderGroup.setRenderable(e),this.renderGroup.render(this.projection)),e.worldTransform=a},i.RenderTexture.prototype.renderCanvas=function(e,t,n){var r=e.children;e.worldTransform=i.mat3.create(),t&&(e.worldTransform[2]=t.x,e.worldTransform[5]=t.y);for(var o=0,a=r.length;a>o;o++)r[o].updateTransform();n&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(e),this.renderer.context.setTransform(1,0,0,1,0,0)},i.AssetLoader=function(e,t){i.EventTarget.call(this),this.assetURLs=e,this.crossorigin=t,this.loadersByType={jpg:i.ImageLoader,jpeg:i.ImageLoader,png:i.ImageLoader,gif:i.ImageLoader,json:i.JsonLoader,anim:i.SpineLoader,xml:i.BitmapFontLoader,fnt:i.BitmapFontLoader}},i.AssetLoader.prototype.constructor=i.AssetLoader,i.AssetLoader.prototype.load=function(){var e=this;this.loadCount=this.assetURLs.length;for(var t=0;t<this.assetURLs.length;t++){var n=this.assetURLs[t],r=n.split(".").pop().toLowerCase(),i=this.loadersByType[r];if(!i)throw new Error(r+" is an unsupported file type");var o=new i(n,this.crossorigin);o.addEventListener("loaded",function(){e.onAssetLoaded()}),o.load()}},i.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},i.JsonLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},i.JsonLoader.prototype.constructor=i.JsonLoader,i.JsonLoader.prototype.load=function(){this.ajaxRequest=new u;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onJSONLoaded()
},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},i.JsonLoader.prototype.onJSONLoaded=function(){if(4==this.ajaxRequest.readyState)if(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()}else if(this.json.bones){var s=new c.SkeletonJson,l=s.readSkeletonData(this.json);i.AnimCache[this.url]=l,this.onLoaded()}else this.onLoaded();else this.onError()},i.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},i.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},i.SpriteSheetLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},i.SpriteSheetLoader.prototype.constructor=i.SpriteSheetLoader,i.SpriteSheetLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpriteSheetLoader.prototype.onJSONLoaded=function(){var e=this,t=this.baseUrl+this.json.meta.image,n=new i.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(){e.onLoaded()});for(var o in r){var a=r[o].frame;a&&(i.TextureCache[o]=new i.Texture(this.texture,{x:a.x,y:a.y,width:a.w,height:a.h}),r[o].trimmed&&(i.TextureCache[o].realSize=r[o].spriteSourceSize,i.TextureCache[o].trim.x=0))}n.load()},i.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.ImageLoader=function(e,t){i.EventTarget.call(this),this.texture=i.Texture.fromImage(e,t)},i.ImageLoader.prototype.constructor=i.ImageLoader,i.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}},i.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.BitmapFontLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},i.BitmapFontLoader.prototype.constructor=i.BitmapFontLoader,i.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},i.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var e=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,t=new i.ImageLoader(e,this.crossorigin);this.texture=t.texture.baseTexture;var n={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],o=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];n.font=r.attributes.getNamedItem("face").nodeValue,n.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),n.lineHeight=parseInt(o.attributes.getNamedItem("lineHeight").nodeValue,10),n.chars={};for(var a=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<a.length;s++){var l=parseInt(a[s].attributes.getNamedItem("id").nodeValue,10),u={x:parseInt(a[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(a[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(a[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(a[s].attributes.getNamedItem("height").nodeValue,10)};i.TextureCache[l]=new i.Texture(this.texture,u),n.chars[l]={xOffset:parseInt(a[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(a[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(a[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new i.Texture(this.texture,u)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var d=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),p=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),h=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);n.chars[p].kerning[d]=h}i.BitmapText.fonts[n.font]=n;var f=this;t.addEventListener("loaded",function(){f.onLoaded()}),t.load()}},i.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},i.SpineLoader=function(e,t){i.EventTarget.call(this),this.url=e,this.crossorigin=t,this.loaded=!1},i.SpineLoader.prototype.constructor=i.SpineLoader,i.SpineLoader.prototype.load=function(){var e=this,t=new i.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},i.SpineLoader.prototype.onJSONLoaded=function(){var e=new c.SkeletonJson,t=e.readSkeletonData(this.json);i.AnimCache[this.url]=t,this.onLoaded()},i.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.PIXI=i):n.PIXI=i}.call(this),define("pixi",function(e){return function(){var t;return t||e.PIXI}}(this)),define("common/views/svg-container",["require","common/performance","common/benchmark/benchmark","common/views/tab-index","common/views/hit-testing-helper","common/console","pixi"],function(e){function t(e,n){if(null==t.instance){var i,o=r.browser;i="Firefox"===o.browser&&o.oscpu.match(/Mac OS X 10.6/)?function(e,t,n,r){return new s.CanvasRenderer(e,t,n,r)}:s.autoDetectRenderer,t.instance=i(e*l,n*l,null,!0)}else t.instance.resize(e,n);return t.instance}var n=e("common/performance"),r=e("common/benchmark/benchmark"),i=e("common/views/tab-index"),o=e("common/views/hit-testing-helper"),a=e("common/console"),s=e("pixi"),l=2,u=1e3;return t.instance=null,function(e,r,c,d){function p(){return X++}function h(){return parseFloat(S.css("font-size"))||18}function f(){var t,n,r=e.get("viewPortWidth"),i=e.get("viewPortHeight"),o=e.get("viewPortX"),a=e.get("viewPortY");U=e.get("viewPortZoom")||1,n={minX:e.get("minX"),minY:e.get("minY"),maxX:e.get("maxX"),maxY:e.get("maxY")},G={width:null!=r?r:n.maxX-n.minX,height:null!=i?i:n.maxY-n.minY,x:null!=o?o:n.minX,y:null!=a?a:n.minY},G.scaledWidth=G.width/U,G.scaledHeight=G.height/U,"bottom-left"===Y&&(G.y+=G.scaledHeight),t=G.width/G.height,F=S.width(),j=F/t,P.style.height=j+"px",Z.domain([0,G.width]).range([0,F]),J.domain([0,G.scaledWidth]).range([0,F*l]),Q.domain([G.height,0]).range("bottom-left"===Y?[0,j]:[j,0]),K.domain([G.scaledHeight,0]).range("bottom-left"===Y?[0,j*l]:[j*l,0]),q&&q.x(Z).y(Q)}function m(){var t,n,r=.7*h(),i=d3.scale.linear().domain([G.x+.07*G.scaledWidth,G.x+G.scaledWidth]).range([.07*F,F]),o=d3.scale.linear().domain([G.y,G.y-.93*G.scaledHeight]).range([0,.93*j]),a=function(e){return"translate("+i(e)+",0)"},s=function(e){return"translate(0,"+o(e)+")"},l=function(e){return e?"#ccc":"#666"},u=i.tickFormat(5),c=o.tickFormat(5),d=e.getUnitDefinition?e.getUnitDefinition("length"):"",p=e.get("xunits"),f=e.get("yunits"),m=e.get("xlabel"),g=e.get("ylabel");d3.event&&d3.event.transform&&d3.event.transform(i,o),E.selectAll("g.x, g.y").remove();var v=E.selectAll("g.x").data(i.ticks(5),String).attr("transform",a).classed("axes",!0);v.select("text").text(u);var y=v.enter().append("g").attr("class","x").attr("transform",a);e.get("gridLines")?y.append("line").attr("stroke",l).attr("y1",0).attr("y2",j-(m?r:0)-(p?r:0)):y.selectAll("line").remove(),t=E.selectAll("text.xlabel").data(m?[d.pluralName]:[]),t.enter().append("text"),t.attr("class","axis").attr("class","xlabel").attr("x",F/2).attr("y",j).attr("dy","-0.1em").style("text-anchor","middle").text(String),t.exit().remove(),p?y.append("text").attr("class","xunits").attr("y",j).attr("dy",e.get("xlabel")?"-1em":"-0.1em").attr("text-anchor","middle").text(u):y.select("text.xunits").remove();var b=E.selectAll("g.y").data(o.ticks(5),String).attr("transform",s).classed("axes",!0);b.select("text").text(c);var x=b.enter().append("g").attr("class","y").attr("transform",s).attr("background-fill","#FFEEB6");e.get("gridLines")?x.append("line").attr("stroke",l).attr("x1",(g?r:0)+(f?2*r:0)).attr("x2",F):x.selectAll("line").remove(),n=E.selectAll("text.ylabel").data(g?[d.pluralName]:[]),n.enter().append("text"),n.attr("class","axis").attr("class","ylabel").attr("transform","translate(0 "+.5*j+") rotate(-90)").attr("dy","0.75em").style("text-anchor","middle").text(String),n.exit().remove(),f?x.append("text").attr("class","yunits").attr("dy","0.34em").attr("dx",e.get("ylabel")?"1em":"0.1em").text(c):y.select("text.yunits").remove()}function g(){var t=e.get("backgroundColor")||"rgba(0, 0, 0, 0)";M.attr("fill",t),D.forEach(function(e){e.setBackgroundColor(parseInt(d3.rgb(t.replace("rgba","rgb")).toString().substr(1),16))})}function v(){y()}function y(){e.get("enableKeyboardHandlers")&&P.focus()}function b(){return this.attr({xmlns:"http://www.w3.org/2000/svg","xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",overflow:"hidden"})}function x(){return this.style({position:"absolute",top:0,left:0})}function w(){var t;void 0===E&&(E=d3.select(P).append("svg").attr("class","root-layer container plot-container").style("z-index",p()).call(b),M=E.append("rect").attr("class","container-background background"),k=d3.select(P).append("svg").attr("class","root-layer container background-container svg-viewport").style("z-index",p()).call(b),N=k.append("g"),R=d3.select(P).append("svg").attr("class","root-layer container foreground-container svg-viewport").style("z-index",u).style("background-color","rgba(0,0,0,0)").on("contextmenu",function(){d3.event.preventDefault()}).call(b),O=R.append("g"),L=R.append("g").attr("class","brush-container"),d3.select(P).selectAll(".root-layer").call(x),e.get("enableKeyboardHandlers")&&d3.select(P).attr("tabindex",0).on("mousedown",v),I=[],D=[],B=[],V=new o(R.node()),V.addLayer(E.node()),V.addLayer(k.node())),f(),d3.select(P).selectAll(".root-layer").attr({width:F,height:j}).style({width:F+"px",height:j+"px"}),I.forEach(function(e){e.resize(F*l,j*l),$(e.view).css({width:F,height:j})}),t=Z(G.x)+" "+Q(G.y)+" "+Z(G.scaledWidth)+" "+Z(G.scaledHeight),d3.select(P).selectAll(".svg-viewport").attr({viewBox:t,x:0,y:0,width:Z(G.width),height:Z(G.height)}),B.forEach(function(e){e.pivot.x=J(G.x),e.pivot.y=K(G.y)}),M.attr({width:Z(G.width),height:Z(G.height),x:0,y:0}),m(),A.renderCanvas()}function _(){function t(){l.push(e.properties.viewPortX),u.push(e.properties.viewPortY),c.push(n.now()),l.length>d&&(l.shift(),u.shift(),c.shift())}function r(){if(p)return!0;var t=n.now(),r=t-a,s=-.003*i,l=-.003*o;return e.properties.viewPortX+=i*r+.5*s*r*r,e.properties.viewPortY+=o*r+.5*l*r*r,et.viewportDrag(),i+=s*r,o+=l*r,a=t,Math.abs(i)<1e-5&&Math.abs(o)<1e-5?!0:!1}var i,o,a,s,l=[],u=[],c=[],d=8,p=!1,h=e.properties.viewPortDrag||!1;return h===!1?void E.on("mousedown.drag",null).on("touchstart.drag",null).classed("draggable",!1):(s=d3.behavior.drag(),s.on("dragstart",function(){p=!0,l.length=0,u.length=0,c.length=0,t(),d3.select(window).on("mousemove.viewport-drag",function(){d3.event.preventDefault()})}).on("drag",function(){var n="y"===h?0:Z.invert(d3.event.dx),r="x"===h?0:Z.invert(d3.event.dy);e.properties.viewPortX-=n,e.properties.viewPortY+=r,et.viewportDrag(),t()}).on("dragend",function(){d3.select(window).on("mousemove.viewport-drag",null),t();var e=l.length-1,n=c[e]-c[0];1e-5>n||c[e]-c[e-1]>100||(i=(l[e]-l[0])/n,o=(u[e]-u[0])/n,a=c[e],p=!1,d3.timer(r))}),void E.call(s).classed("draggable",!0))}function T(){var e;for(e in z)z.hasOwnProperty(e)&&E.selectAll(e).on("click.custom",null)}function C(){w(),_(),z={},W={},e.addPropertiesListener(["backgroundColor"],A.repaint),e.addPropertiesListener(["gridLines","xunits","yunits","xlabel","ylabel","viewPortX","viewPortY","viewPortZoom"],w),e.addPropertiesListener(["viewPortDrag"],_)}var A,S,P,E,k,R,M,N,O,L,I,D,B,V,F,j,G,U,z,W,q,H,Y=d&&d.origin||"bottom-left",X=0,J=d3.scale.linear(),K=d3.scale.linear(),Z=d3.scale.linear(),Q=d3.scale.linear(),et=d3.dispatch("viewportDrag");return A={get $el(){return S},get node(){return P},get foregroundContainer(){return R},get model2px(){return Z},get model2canvas(){return J},get model2pxInv(){return Q},get model2canvasInv(){return K},get setFocus(){return y},get getFontSizeInPixels(){return h},get url(){return r},get clickHandler(){return z},get dragHandler(){return W},get hitTestCallback(){return V.hitTestCallback},get mouseupCallback(){return V.mouseupCallback},repaint:function(){g(),H.repaint&&H.repaint(),A.updateClickHandlers(),A.renderCanvas()},appendViewport:function(){var e=I.length>0?O:N;return e.append("g")},appendPixiViewport:function(){var e,n;0===I.length&&(e=t(F,j),n=new s.Stage(null),P.appendChild(e.view),d3.select(e.view).attr("class","pixi-viewport").style("z-index",p()).call(x),I.push(e),D.push(n),V.addLayer(e.view),V.passMouseMove(R.node(),I[0].view));var r=new s.DisplayObjectContainer;return D[0].addChild(r),B.push(r),{pixiContainer:r,canvas:I[0].view}},resize:function(){w(),A.repaint(),q&&L.select("g.select-area").call(q),H.resize&&H.resize(),A.renderCanvas()},setup:function(){H.setup&&H.setup(e),A.renderCanvas()},update:function(){H.update&&H.update(),A.renderCanvas()},renderCanvas:function(){var e,t;for(e=0,t=I.length;t>e;e++)I[e].render(D[e])},getHeightForWidth:function(e){var t=G.width/G.height;return e/t},bindModel:function(t,n){r=n||r,e=t||e,T(),A.setSelectHandler(null),C(),H.bindModel&&H.bindModel(t,n)},pos:function(){var e={bottom:0,top:0,height:0,left:0,right:0,width:0};return S&&(e.top=S.position().top,e.left=S.position().left,e.width=S.width(),e.height=S.height(),e.bottom=e.top+e.height,e.right=e.left+e.width),e},on:function(e,t){et.on(e,t)},setClickHandler:function(e,t){if("function"!=typeof t)throw new Error("Click handler should be a function.");z[e]=t,A.updateClickHandlers()},updateClickHandlers:function(){function e(e){return function(t,n){if(!d3.event.defaultPrevented){var r=d3.mouse(M.node()),i=Z.invert(r[0]),o=Q.invert(r[1]);a.log("[view] click at ("+i.toFixed(3)+", "+o.toFixed(3)+")"),e(i,o,t,n)}}}var t;for(t in z)z.hasOwnProperty(t)&&d3.selectAll(t).on("click.custom",e(z[t]))},setSelectHandler:function(e){if("function"!=typeof e&&null!==e)throw new Error("Select handler should be a function or null.");return L.select("g.select-area").remove(),null===e?void(q=null):(q=d3.svg.brush().x(Z).y(Q).on("brushstart.select",function(){d3.select(window).on("mousemove.select",function(){d3.event.preventDefault()})}).on("brushend.select",function(){d3.select(window).on("mousemove.select",null);var t=q.extent(),n=t[0][0],r=t[0][1],i=t[1][0]-n,o=t[1][1]-r;a.log("[view] selection area ("+n.toFixed(3)+", "+r.toFixed(3)+"), width: "+i+", height: "+o),e(n,r,i,o),q.clear(),L.select("g.select-area").call(q)}),void L.append("g").classed("select-area",!0).call(q))},setDragHandler:function(e,t){W[e]=t}},S=$("<div>").attr({id:"model-container","class":"container",tabindex:i}).css({width:"50px",height:"50px"}),P=S[0],e&&C(),H=new c(A,e),A}}),define("rgbcolor",function(e){return function(){var t;return t||e.rgbcolor}}(this)),function(){function e(){var e={};return e.FRAMERATE=30,e.MAX_VIRTUAL_PIXELS=3e4,e.init=function(t){var n=0;e.UniqueId=function(){return n++,"canvg"+n},e.Definitions={},e.Styles={},e.Animations=[],e.Images=[],e.ctx=t,e.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},e.init(),e.ImagesLoaded=function(){for(var t=0;t<e.Images.length;t++)if(!e.Images[t].loaded)return!1;return!0},e.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},e.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},e.ajax=function(e){var t;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t?(t.open("GET",e,!1),t.send(null),t.responseText):null},e.parseXml=function(e){if(window.DOMParser){var t=new DOMParser;return t.parseFromString(e,"text/xml")}e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var n=new ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(e),n},e.Property=function(e,t){this.name=e,this.value=t},e.Property.prototype.getValue=function(){return this.value},e.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},e.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},e.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},e.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},e.Property.prototype.addOpacity=function(t){var n=this.value;if(null!=t&&""!=t&&"string"==typeof this.value){var r=new RGBColor(this.value);r.ok&&(n="rgba("+r.r+", "+r.g+", "+r.b+", "+t+")")}return new e.Property(this.name,n)},e.Property.prototype.getDefinition=function(){var t=this.value.match(/#([^\)'"]+)/);return t&&(t=t[1]),t||(t=this.value),e.Definitions[t]},e.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},e.Property.prototype.getFillStyleDefinition=function(t,n){var r=this.getDefinition();if(null!=r&&r.createGradient)return r.createGradient(e.ctx,t,n);if(null!=r&&r.createPattern){if(r.getHrefAttribute().hasValue()){var i=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition(),i.hasValue()&&(r.attribute("patternTransform",!0).value=i.value)}return r.createPattern(e.ctx,t)}return null},e.Property.prototype.getDPI=function(){return 96},e.Property.prototype.getEM=function(t){var n=12,r=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);return r.hasValue()&&(n=r.toPixels(t)),n},e.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},e.Property.prototype.toPixels=function(t,n){if(!this.hasValue())return 0;var r=this.value+"";if(r.match(/em$/))return this.numValue()*this.getEM(t);if(r.match(/ex$/))return this.numValue()*this.getEM(t)/2;if(r.match(/px$/))return this.numValue();if(r.match(/pt$/))return this.numValue()*this.getDPI(t)*(1/72);if(r.match(/pc$/))return 15*this.numValue();if(r.match(/cm$/))return this.numValue()*this.getDPI(t)/2.54;if(r.match(/mm$/))return this.numValue()*this.getDPI(t)/25.4;if(r.match(/in$/))return this.numValue()*this.getDPI(t);if(r.match(/%$/))return this.numValue()*e.ViewPort.ComputeSize(t);var i=this.numValue();return n&&1>i?i*e.ViewPort.ComputeSize(t):i},e.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():(e.match(/ms$/),this.numValue())},e.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},e.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(t,n,r,i,o,a){var s=null!=a?this.Parse(a):this.CreateFont("","","","","",e.ctx.font);return{fontFamily:o||s.fontFamily,fontSize:i||s.fontSize,fontStyle:t||s.fontStyle,fontWeight:r||s.fontWeight,fontVariant:n||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var t=this;this.Parse=function(n){for(var r={},i=e.trim(e.compressSpaces(n||"")).split(" "),o={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",s=0;s<i.length;s++)o.fontStyle||-1==t.Styles.indexOf(i[s])?o.fontVariant||-1==t.Variants.indexOf(i[s])?o.fontWeight||-1==t.Weights.indexOf(i[s])?o.fontSize?"inherit"!=i[s]&&(a+=i[s]):("inherit"!=i[s]&&(r.fontSize=i[s].split("/")[0]),o.fontStyle=o.fontVariant=o.fontWeight=o.fontSize=!0):("inherit"!=i[s]&&(r.fontWeight=i[s]),o.fontStyle=o.fontVariant=o.fontWeight=!0):("inherit"!=i[s]&&(r.fontVariant=i[s]),o.fontStyle=o.fontVariant=!0):("inherit"!=i[s]&&(r.fontStyle=i[s]),o.fontStyle=!0);return""!=a&&(r.fontFamily=a),r}},e.ToNumberArray=function(t){for(var n=e.trim(e.compressSpaces((t||"").replace(/,/g," "))).split(" "),r=0;r<n.length;r++)n[r]=parseFloat(n[r]);return n},e.Point=function(e,t){this.x=e,this.y=t},e.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},e.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],n=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=n},e.CreatePoint=function(t){var n=e.ToNumberArray(t);return new e.Point(n[0],n[1])},e.CreatePath=function(t){for(var n=e.ToNumberArray(t),r=[],i=0;i<n.length;i+=2)r.push(new e.Point(n[i],n[i+1]));return r},e.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,r,i,o){var a=e+2/3*(n-e),s=t+2/3*(r-t),l=a+1/3*(i-e),u=s+1/3*(o-t);this.addBezierCurve(e,t,a,l,s,u,i,o)},this.addBezierCurve=function(e,t,n,r,o,a,s,l){var u=[e,t],c=[n,r],d=[o,a],p=[s,l];for(this.addPoint(u[0],u[1]),this.addPoint(p[0],p[1]),i=0;1>=i;i++){var h=function(e){return Math.pow(1-e,3)*u[i]+3*Math.pow(1-e,2)*e*c[i]+3*(1-e)*Math.pow(e,2)*d[i]+Math.pow(e,3)*p[i]},f=6*u[i]-12*c[i]+6*d[i],m=-3*u[i]+9*c[i]-9*d[i]+3*p[i],g=3*c[i]-3*u[i];if(0!=m){var v=Math.pow(f,2)-4*g*m;if(!(0>v)){var y=(-f+Math.sqrt(v))/(2*m);y>0&&1>y&&(0==i&&this.addX(h(y)),1==i&&this.addY(h(y)));var b=(-f-Math.sqrt(v))/(2*m);b>0&&1>b&&(0==i&&this.addX(h(b)),1==i&&this.addY(h(b)))}}else{if(0==f)continue;var x=-g/f;x>0&&1>x&&(0==i&&this.addX(h(x)),1==i&&this.addY(h(x)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,r)},e.Transform=function(t){var n=this;this.Type={},this.Type.translate=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(t){var n=e.ToNumberArray(t);this.angle=new e.Property("angle",n[0]),this.cx=n[1]||0,this.cy=n[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(t){this.p=e.CreatePoint(t),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(t){this.m=e.ToNumberArray(t),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(t){this.base=n.Type.matrix,this.base(t),this.angle=new e.Property("angle",t)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;t>=0;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var r=e.trim(e.compressSpaces(t)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<r.length;i++){var o=e.trim(r[i].split("(")[0]),a=r[i].split("(")[1].replace(")",""),s=new this.Type[o](a);s.type=o,this.transforms.push(s)}},e.AspectRatio=function(t,n,r,i,o,a,s,l,u,c){n=e.compressSpaces(n),n=n.replace(/^defer\s/,"");var d=n.split(" ")[0]||"xMidYMid",p=n.split(" ")[1]||"meet",h=r/i,f=o/a,m=Math.min(h,f),g=Math.max(h,f);"meet"==p&&(i*=m,a*=m),"slice"==p&&(i*=g,a*=g),u=new e.Property("refX",u),c=new e.Property("refY",c),u.hasValue()&&c.hasValue()?t.translate(-m*u.toPixels("x"),-m*c.toPixels("y")):(d.match(/^xMid/)&&("meet"==p&&m==f||"slice"==p&&g==f)&&t.translate(r/2-i/2,0),d.match(/YMid$/)&&("meet"==p&&m==h||"slice"==p&&g==h)&&t.translate(0,o/2-a/2),d.match(/^xMax/)&&("meet"==p&&m==f||"slice"==p&&g==f)&&t.translate(r-i,0),d.match(/YMax$/)&&("meet"==p&&m==h||"slice"==p&&g==h)&&t.translate(0,o-a)),"none"==d?t.scale(h,f):"meet"==p?t.scale(m,m):"slice"==p&&t.scale(g,g),t.translate(null==s?0:-s,null==l?0:-l)},e.Element={},e.EmptyProperty=new e.Property("EMPTY",""),e.Element.ElementBase=function(t){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(t,n){var r=this.attributes[t];return null!=r?r:(1==n&&(r=new e.Property(t,""),this.attributes[t]=r),r||e.EmptyProperty)},this.getHrefAttribute=function(){for(var t in this.attributes)if(t.match(/:href$/))return this.attributes[t];return e.EmptyProperty},this.style=function(t,n){var r=this.styles[t];if(null!=r)return r;var i=this.attribute(t);if(null!=i&&i.hasValue())return this.styles[t]=i,i;var o=this.parent;if(null!=o){var a=o.style(t);if(null!=a&&a.hasValue())return a}return 1==n&&(r=new e.Property(t,""),this.styles[t]=r),r||e.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(e.save(),this.attribute("mask").hasValue()){var t=this.attribute("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var n=this.style("filter").getDefinition();null!=n&&n.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(t,n){var r=t;n&&(r=e.CreateElement(t)),r.parent=this,this.children.push(r)},null!=t&&1==t.nodeType){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1==r.nodeType&&this.addChild(r,!0),this.captureTextNodes&&3==r.nodeType){var i=r.nodeValue||r.text||"";""!=e.trim(e.compressSpaces(i))&&this.addChild(new e.Element.tspan(r),!1)}}for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n];this.attributes[o.nodeName]=new e.Property(o.nodeName,o.nodeValue)}var a=e.Styles[t.nodeName];if(null!=a)for(var s in a)this.styles[s]=a[s];if(this.attribute("class").hasValue())for(var l=e.compressSpaces(this.attribute("class").value).split(" "),u=0;u<l.length;u++){if(a=e.Styles["."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s];if(a=e.Styles[t.nodeName+"."+l[u]],null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("id").hasValue()){var a=e.Styles["#"+this.attribute("id").value];if(null!=a)for(var s in a)this.styles[s]=a[s]}if(this.attribute("style").hasValue())for(var a=this.attribute("style").value.split(";"),n=0;n<a.length;n++)if(""!=e.trim(a[n])){var c=a[n].split(":"),s=e.trim(c[0]),d=e.trim(c[1]);this.styles[s]=new e.Property(s,d)}this.attribute("id").hasValue()&&null==e.Definitions[this.attribute("id").value]&&(e.Definitions[this.attribute("id").value]=this)}},e.Element.RenderedElementBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=n&&(t.fillStyle=n)}else if(this.style("fill").hasValue()){var r=this.style("fill");"currentColor"==r.value&&(r.value=this.style("color").value),t.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value}if(this.style("fill-opacity").hasValue()){var r=new e.Property("fill",t.fillStyle);r=r.addOpacity(this.style("fill-opacity").value),t.fillStyle=r.value}if(this.style("stroke").isUrlDefinition()){var n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=n&&(t.strokeStyle=n)}else if(this.style("stroke").hasValue()){var i=this.style("stroke");"currentColor"==i.value&&(i.value=this.style("color").value),t.strokeStyle="none"==i.value?"rgba(0,0,0,0)":i.value}if(this.style("stroke-opacity").hasValue()){var i=new e.Property("stroke",t.strokeStyle);i=i.addOpacity(this.style("stroke-opacity").value),t.strokeStyle=i.value}if(this.style("stroke-width").hasValue()){var o=this.style("stroke-width").toPixels();t.lineWidth=0==o?.001:o}if(this.style("stroke-linecap").hasValue()&&(t.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(t.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(t.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var a=e.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof t.setLineDash?t.setLineDash(a):"undefined"!=typeof t.webkitLineDash?t.webkitLineDash=a:"undefined"!=typeof t.mozDash&&(t.mozDash=a);var s=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof t.lineDashOffset?t.lineDashOffset=s:"undefined"!=typeof t.webkitLineDashOffset?t.webkitLineDashOffset=s:"undefined"!=typeof t.mozDashOffset&&(t.mozDashOffset=s)}if("undefined"!=typeof t.font&&(t.font=e.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var l=new e.Transform(this.attribute("transform").value);l.apply(t)}if(this.style("clip-path").hasValue()){var u=this.style("clip-path").getDefinition();null!=u&&u.apply(t)}this.style("opacity").hasValue()&&(t.globalAlpha=this.style("opacity").numValue())}},e.Element.RenderedElementBase.prototype=new e.Element.ElementBase,e.Element.PathElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.path=function(t){return null!=t&&t.beginPath(),new e.BoundingBox
},this.renderChildren=function(t){this.path(t),e.Mouse.checkPath(this,t),""!=t.fillStyle&&(this.attribute("fill-rule").hasValue()?t.fill(this.attribute("fill-rule").value):t.fill()),""!=t.strokeStyle&&t.stroke();var n=this.getMarkers();if(null!=n){if(this.style("marker-start").isUrlDefinition()){var r=this.style("marker-start").getDefinition();r.render(t,n[0][0],n[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var r=this.style("marker-mid").getDefinition(),i=1;i<n.length-1;i++)r.render(t,n[i][0],n[i][1]);if(this.style("marker-end").isUrlDefinition()){var r=this.style("marker-end").getDefinition();r.render(t,n[n.length-1][0],n[n.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},e.Element.PathElementBase.prototype=new e.Element.RenderedElementBase,e.Element.svg=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseClearContext=this.clearContext,this.clearContext=function(t){this.baseClearContext(t),e.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4,this.baseSetContext(t),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),t.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=e.ViewPort.width(),r=e.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){n=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var i=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(i=-this.attribute("refX").toPixels("x"),o=-this.attribute("refY").toPixels("y")),t.beginPath(),t.moveTo(i,o),t.lineTo(n,o),t.lineTo(n,r),t.lineTo(i,r),t.closePath(),t.clip()}if(e.ViewPort.SetCurrent(n,r),this.attribute("viewBox").hasValue()){var a=e.ToNumberArray(this.attribute("viewBox").value),s=a[0],l=a[1];n=a[2],r=a[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,e.ViewPort.width(),n,e.ViewPort.height(),r,s,l,this.attribute("refX").value,this.attribute("refY").value),e.ViewPort.RemoveCurrent(),e.ViewPort.SetCurrent(a[2],a[3])}}},e.Element.svg.prototype=new e.Element.RenderedElementBase,e.Element.rect=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(s=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=s),a=Math.min(a,i/2),s=Math.min(s,o/2),null!=t&&(t.beginPath(),t.moveTo(n+a,r),t.lineTo(n+i-a,r),t.quadraticCurveTo(n+i,r,n+i,r+s),t.lineTo(n+i,r+o-s),t.quadraticCurveTo(n+i,r+o,n+i-a,r+o),t.lineTo(n+a,r+o),t.quadraticCurveTo(n,r+o,n,r+o-s),t.lineTo(n,r+s),t.quadraticCurveTo(n,r,n+a,r),t.closePath()),new e.BoundingBox(n,r,n+i,r+o)}},e.Element.rect.prototype=new e.Element.PathElementBase,e.Element.circle=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=this.attribute("cx").toPixels("x"),r=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return null!=t&&(t.beginPath(),t.arc(n,r,i,0,2*Math.PI,!0),t.closePath()),new e.BoundingBox(n-i,r-i,n+i,r+i)}},e.Element.circle.prototype=new e.Element.PathElementBase,e.Element.ellipse=function(t){this.base=e.Element.PathElementBase,this.base(t),this.path=function(t){var n=4*((Math.sqrt(2)-1)/3),r=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),o=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=t&&(t.beginPath(),t.moveTo(o,a-i),t.bezierCurveTo(o+n*r,a-i,o+r,a-n*i,o+r,a),t.bezierCurveTo(o+r,a+n*i,o+n*r,a+i,o,a+i),t.bezierCurveTo(o-n*r,a+i,o-r,a+n*i,o-r,a),t.bezierCurveTo(o-r,a-n*i,o-n*r,a-i,o,a-i),t.closePath()),new e.BoundingBox(o-r,a-i,o+r,a+i)}},e.Element.ellipse.prototype=new e.Element.PathElementBase,e.Element.line=function(t){this.base=e.Element.PathElementBase,this.base(t),this.getPoints=function(){return[new e.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new e.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(t){var n=this.getPoints();return null!=t&&(t.beginPath(),t.moveTo(n[0].x,n[0].y),t.lineTo(n[1].x,n[1].y)),new e.BoundingBox(n[0].x,n[0].y,n[1].x,n[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},e.Element.line.prototype=new e.Element.PathElementBase,e.Element.polyline=function(t){this.base=e.Element.PathElementBase,this.base(t),this.points=e.CreatePath(this.attribute("points").value),this.path=function(t){var n=new e.BoundingBox(this.points[0].x,this.points[0].y);null!=t&&(t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y));for(var r=1;r<this.points.length;r++)n.addPoint(this.points[r].x,this.points[r].y),null!=t&&t.lineTo(this.points[r].x,this.points[r].y);return n},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},e.Element.polyline.prototype=new e.Element.PathElementBase,e.Element.polygon=function(t){this.base=e.Element.polyline,this.base(t),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},e.Element.polygon.prototype=new e.Element.polyline,e.Element.path=function(t){this.base=e.Element.PathElementBase,this.base(t);var n=this.attribute("d").value;n=n.replace(/,/gm," "),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),n=n.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([0-9])([+\-])/gm,"$1 $2"),n=n.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),n=n.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),n=e.compressSpaces(n),n=e.trim(n),this.PathParser=new function(t){this.tokens=t.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new e.Point(0,0),this.control=new e.Point(0,0),this.current=new e.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var t=new e.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var t=new e.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return t},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,n){null!=n&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(n),this.path=function(t){var n=this.PathParser;n.reset();var r=new e.BoundingBox;for(null!=t&&t.beginPath();!n.isEnd();)switch(n.nextCommand(),n.command){case"M":case"m":var i=n.getAsCurrentPoint();for(n.addMarker(i),r.addPoint(i.x,i.y),null!=t&&t.moveTo(i.x,i.y),n.start=n.current;!n.isCommandOrEnd();){var i=n.getAsCurrentPoint();n.addMarker(i,n.start),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"L":case"l":for(;!n.isCommandOrEnd();){var o=n.current,i=n.getAsCurrentPoint();n.addMarker(i,o),r.addPoint(i.x,i.y),null!=t&&t.lineTo(i.x,i.y)}break;case"H":case"h":for(;!n.isCommandOrEnd();){var a=new e.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"V":case"v":for(;!n.isCommandOrEnd();){var a=new e.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar());n.addMarker(a,n.current),n.current=a,r.addPoint(n.current.x,n.current.y),null!=t&&t.lineTo(n.current.x,n.current.y)}break;case"C":case"c":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getPoint(),u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,l),r.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"S":case"s":for(;!n.isCommandOrEnd();){var s=n.current,l=n.getReflectedControlPoint(),u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,l),r.addBezierCurve(s.x,s.y,l.x,l.y,u.x,u.y,c.x,c.y),null!=t&&t.bezierCurveTo(l.x,l.y,u.x,u.y,c.x,c.y)}break;case"Q":case"q":for(;!n.isCommandOrEnd();){var s=n.current,u=n.getAsControlPoint(),c=n.getAsCurrentPoint();n.addMarker(c,u,u),r.addQuadraticCurve(s.x,s.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"T":case"t":for(;!n.isCommandOrEnd();){var s=n.current,u=n.getReflectedControlPoint();n.control=u;var c=n.getAsCurrentPoint();n.addMarker(c,u,u),r.addQuadraticCurve(s.x,s.y,u.x,u.y,c.x,c.y),null!=t&&t.quadraticCurveTo(u.x,u.y,c.x,c.y)}break;case"A":case"a":for(;!n.isCommandOrEnd();){var s=n.current,d=n.getScalar(),p=n.getScalar(),h=n.getScalar()*(Math.PI/180),f=n.getScalar(),m=n.getScalar(),c=n.getAsCurrentPoint(),g=new e.Point(Math.cos(h)*(s.x-c.x)/2+Math.sin(h)*(s.y-c.y)/2,-Math.sin(h)*(s.x-c.x)/2+Math.cos(h)*(s.y-c.y)/2),v=Math.pow(g.x,2)/Math.pow(d,2)+Math.pow(g.y,2)/Math.pow(p,2);v>1&&(d*=Math.sqrt(v),p*=Math.sqrt(v));var y=(f==m?-1:1)*Math.sqrt((Math.pow(d,2)*Math.pow(p,2)-Math.pow(d,2)*Math.pow(g.y,2)-Math.pow(p,2)*Math.pow(g.x,2))/(Math.pow(d,2)*Math.pow(g.y,2)+Math.pow(p,2)*Math.pow(g.x,2)));isNaN(y)&&(y=0);var b=new e.Point(y*d*g.y/p,y*-p*g.x/d),x=new e.Point((s.x+c.x)/2+Math.cos(h)*b.x-Math.sin(h)*b.y,(s.y+c.y)/2+Math.sin(h)*b.x+Math.cos(h)*b.y),w=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},_=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(w(e)*w(t))},T=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(_(e,t))},C=T([1,0],[(g.x-b.x)/d,(g.y-b.y)/p]),A=[(g.x-b.x)/d,(g.y-b.y)/p],S=[(-g.x-b.x)/d,(-g.y-b.y)/p],P=T(A,S);_(A,S)<=-1&&(P=Math.PI),_(A,S)>=1&&(P=0);var E=1-m?1:-1,k=C+E*(P/2),R=new e.Point(x.x+d*Math.cos(k),x.y+p*Math.sin(k));if(n.addMarkerAngle(R,k-E*Math.PI/2),n.addMarkerAngle(c,k-E*Math.PI),r.addPoint(c.x,c.y),null!=t){var _=d>p?d:p,M=d>p?1:d/p,N=d>p?p/d:1;t.translate(x.x,x.y),t.rotate(h),t.scale(M,N),t.arc(0,0,_,C,C+P,1-m),t.scale(1/M,1/N),t.rotate(-h),t.translate(-x.x,-x.y)}}break;case"Z":case"z":null!=t&&t.closePath(),n.current=n.start}return r},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[],r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}},e.Element.path.prototype=new e.Element.PathElementBase,e.Element.pattern=function(t){this.base=e.Element.ElementBase,this.base(t),this.createPattern=function(t){var n=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),i=new e.Element.svg;i.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),i.attributes.width=new e.Property("width",n+"px"),i.attributes.height=new e.Property("height",r+"px"),i.attributes.transform=new e.Property("transform",this.attribute("patternTransform").value),i.children=this.children;var o=document.createElement("canvas");o.width=n,o.height=r;var a=o.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&a.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var s=-1;1>=s;s++)for(var l=-1;1>=l;l++)a.save(),a.translate(s*o.width,l*o.height),i.render(a),a.restore();var u=t.createPattern(o,"repeat");return u}},e.Element.pattern.prototype=new e.Element.ElementBase,e.Element.marker=function(t){this.base=e.Element.ElementBase,this.base(t),this.baseRender=this.render,this.render=function(t,n,r){t.translate(n.x,n.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(r),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(t.lineWidth,t.lineWidth),t.save();var i=new e.Element.svg;i.attributes.viewBox=new e.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new e.Property("refX",this.attribute("refX").value),i.attributes.refY=new e.Property("refY",this.attribute("refY").value),i.attributes.width=new e.Property("width",this.attribute("markerWidth").value),i.attributes.height=new e.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new e.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new e.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(t),t.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&t.scale(1/t.lineWidth,1/t.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&t.rotate(-r),t.translate(-n.x,-n.y)}},e.Element.marker.prototype=new e.Element.ElementBase,e.Element.defs=function(t){this.base=e.Element.ElementBase,this.base(t),this.render=function(){}},e.Element.defs.prototype=new e.Element.ElementBase,e.Element.GradientBase=function(t){this.base=e.Element.ElementBase,this.base(t),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"stop"==r.type&&this.stops.push(r)}this.getGradient=function(){},this.createGradient=function(t,n,r){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition());var o=function(t){if(r.hasValue()){var n=new e.Property("color",t);return n.addOpacity(r.value).value}return t},a=this.getGradient(t,n);if(null==a)return o(i.stops[i.stops.length-1].color);for(var s=0;s<i.stops.length;s++)a.addColorStop(i.stops[s].offset,o(i.stops[s].color));if(this.attribute("gradientTransform").hasValue()){var l=e.ViewPort.viewPorts[0],u=new e.Element.rect;u.attributes.x=new e.Property("x",-e.MAX_VIRTUAL_PIXELS/3),u.attributes.y=new e.Property("y",-e.MAX_VIRTUAL_PIXELS/3),u.attributes.width=new e.Property("width",e.MAX_VIRTUAL_PIXELS),u.attributes.height=new e.Property("height",e.MAX_VIRTUAL_PIXELS);var c=new e.Element.g;c.attributes.transform=new e.Property("transform",this.attribute("gradientTransform").value),c.children=[u];var d=new e.Element.svg;d.attributes.x=new e.Property("x",0),d.attributes.y=new e.Property("y",0),d.attributes.width=new e.Property("width",l.width),d.attributes.height=new e.Property("height",l.height),d.children=[c];var p=document.createElement("canvas");p.width=l.width,p.height=l.height;var h=p.getContext("2d");return h.fillStyle=a,d.render(h),h.createPattern(p,"no-repeat")}return a}},e.Element.GradientBase.prototype=new e.Element.ElementBase,e.Element.linearGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==o&&i==a?null:e.createLinearGradient(r,i,o,a)}},e.Element.linearGradient.prototype=new e.Element.GradientBase,e.Element.radialGradient=function(t){this.base=e.Element.GradientBase,this.base(t),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),i="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),o=r,a=i;this.attribute("fx").hasValue()&&(o="objectBoundingBox"==this.gradientUnits?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var s="objectBoundingBox"==this.gradientUnits?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(o,a,0,r,i,s)}},e.Element.radialGradient.prototype=new e.Element.GradientBase,e.Element.stop=function(t){this.base=e.Element.ElementBase,this.base(t),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var n=this.style("stop-color");this.style("stop-opacity").hasValue()&&(n=n.addOpacity(this.style("stop-opacity").value)),this.color=n.value},e.Element.stop.prototype=new e.Element.ElementBase,e.Element.AnimateBase=function(t){this.base=e.Element.ElementBase,this.base(t),e.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var n=this.calcValue();if(this.attribute("type").hasValue()){var r=this.attribute("type").value;n=r+"("+n+")"}this.getProperty().value=n,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var t={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var n=t.progress*(this.values.value.length-1),r=Math.floor(n),i=Math.ceil(n);t.from=new e.Property("from",parseFloat(this.values.value[r])),t.to=new e.Property("to",parseFloat(this.values.value[i])),t.progress=(n-r)/(i-r)}else t.from=this.from,t.to=this.to;return t}},e.Element.AnimateBase.prototype=new e.Element.ElementBase,e.Element.animate=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress;return t+this.initialUnits}},e.Element.animate.prototype=new e.Element.AnimateBase,e.Element.animateColor=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){var e=this.progress(),t=new RGBColor(e.from.value),n=new RGBColor(e.to.value);if(t.ok&&n.ok){var r=t.r+(n.r-t.r)*e.progress,i=t.g+(n.g-t.g)*e.progress,o=t.b+(n.b-t.b)*e.progress;return"rgb("+parseInt(r,10)+","+parseInt(i,10)+","+parseInt(o,10)+")"}return this.attribute("from").value}},e.Element.animateColor.prototype=new e.Element.AnimateBase,e.Element.animateTransform=function(t){this.base=e.Element.AnimateBase,this.base(t),this.calcValue=function(){for(var t=this.progress(),n=e.ToNumberArray(t.from.value),r=e.ToNumberArray(t.to.value),i="",o=0;o<n.length;o++)i+=n[o]+(r[o]-n[o])*t.progress+" ";return i}},e.Element.animateTransform.prototype=new e.Element.animate,e.Element.font=function(t){this.base=e.Element.ElementBase,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];"font-face"==r.type?(this.fontFace=r,r.style("font-family").hasValue()&&(e.Definitions[r.style("font-family").value]=this)):"missing-glyph"==r.type?this.missingGlyph=r:"glyph"==r.type&&(""!=r.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[r.unicode]&&(this.glyphs[r.unicode]=[]),this.glyphs[r.unicode][r.arabicForm]=r):this.glyphs[r.unicode]=r)}},e.Element.font.prototype=new e.Element.ElementBase,e.Element.fontface=function(t){this.base=e.Element.ElementBase,this.base(t),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},e.Element.fontface.prototype=new e.Element.ElementBase,e.Element.missingglyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=0},e.Element.missingglyph.prototype=new e.Element.path,e.Element.glyph=function(t){this.base=e.Element.path,this.base(t),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},e.Element.glyph.prototype=new e.Element.path,e.Element.text=function(t){this.captureTextNodes=!0,this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new e.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(e,this,0);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,t)},this.getAnchorDelta=function(e,t,n){var r=this.style("text-anchor").valueOrDefault("start");if("start"!=r){for(var i=0,o=n;o<t.children.length;o++){var a=t.children[o];if(o>n&&a.attribute("x").hasValue())break;i+=a.measureTextRecursive(e)}return-1*("end"==r?i:i/2)}return 0},this.renderChild=function(e,t,n){var r=t.children[n];r.attribute("x").hasValue()?r.x=r.attribute("x").toPixels("x")+this.getAnchorDelta(e,t,n):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),r.attribute("dx").hasValue()&&(this.x+=r.attribute("dx").toPixels("x")),r.x=this.x),this.x=r.x+r.measureText(e),r.attribute("y").hasValue()?r.y=r.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),r.attribute("dy").hasValue()&&(this.y+=r.attribute("dy").toPixels("y")),r.y=this.y),this.y=r.y,r.render(e);for(var n=0;n<r.children.length;n++)this.renderChild(e,r,n)}},e.Element.text.prototype=new e.Element.RenderedElementBase,e.Element.TextElementBase=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getGlyph=function(e,t,n){var r=t[n],i=null;if(e.isArabic){var o="isolated";(0==n||" "==t[n-1])&&n<t.length-2&&" "!=t[n+1]&&(o="terminal"),n>0&&" "!=t[n-1]&&n<t.length-2&&" "!=t[n+1]&&(o="medial"),n>0&&" "!=t[n-1]&&(n==t.length-1||" "==t[n+1])&&(o="initial"),"undefined"!=typeof e.glyphs[r]&&(i=e.glyphs[r][o],null==i&&"glyph"==e.glyphs[r].type&&(i=e.glyphs[r]))}else i=e.glyphs[r];return null==i&&(i=e.missingGlyph),i},this.renderChildren=function(t){var n=this.parent.style("font-family").getDefinition();if(null==n)""!=t.fillStyle&&t.fillText(e.compressSpaces(this.getText()),this.x,this.y),""!=t.strokeStyle&&t.strokeText(e.compressSpaces(this.getText()),this.x,this.y);else{var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(e.Font.Parse(e.ctx.font).fontStyle),o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s),u=r/n.fontFace.unitsPerEm;t.translate(this.x,this.y),t.scale(u,-u);var c=t.lineWidth;t.lineWidth=t.lineWidth*n.fontFace.unitsPerEm/r,"italic"==i&&t.transform(1,0,.4,1,0,0),l.render(t),"italic"==i&&t.transform(1,0,-.4,1,0,0),t.lineWidth=c,t.scale(1/u,-1/u),t.translate(-this.x,-this.y),this.x+=r*(l.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(this.x+=a[s])}}},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),n=0;n<this.children.length;n++)t+=this.children[n].measureTextRecursive(e);return t},this.measureText=function(t){var n=this.parent.style("font-family").getDefinition();if(null!=n){var r=this.parent.style("font-size").numValueOrDefault(e.Font.Parse(e.ctx.font).fontSize),i=0,o=this.getText();n.isRTL&&(o=o.split("").reverse().join(""));for(var a=e.ToNumberArray(this.parent.attribute("dx").value),s=0;s<o.length;s++){var l=this.getGlyph(n,o,s);i+=(l.horizAdvX||n.horizAdvX)*r/n.fontFace.unitsPerEm,"undefined"==typeof a[s]||isNaN(a[s])||(i+=a[s])}return i}var u=e.compressSpaces(this.getText());if(!t.measureText)return 10*u.length;t.save(),this.setContext(t);var c=t.measureText(u).width;return t.restore(),c}},e.Element.TextElementBase.prototype=new e.Element.RenderedElementBase,e.Element.tspan=function(t){this.captureTextNodes=!0,this.base=e.Element.TextElementBase,this.base(t),this.text=t.nodeValue||t.text||"",this.getText=function(){return this.text}},e.Element.tspan.prototype=new e.Element.TextElementBase,e.Element.tref=function(t){this.base=e.Element.TextElementBase,this.base(t),this.getText=function(){var e=this.getHrefAttribute().getDefinition();return null!=e?e.children[0].getText():void 0}},e.Element.tref.prototype=new e.Element.TextElementBase,e.Element.a=function(t){this.base=e.Element.TextElementBase,this.base(t),this.hasText=!0;for(var n=0;n<t.childNodes.length;n++)3!=t.childNodes[n].nodeType&&(this.hasText=!1);this.text=this.hasText?t.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var n=new e.Property("fontSize",e.Font.Parse(e.ctx.font).fontSize);e.Mouse.checkBoundingBox(this,new e.BoundingBox(this.x,this.y-n.toPixels("y"),this.x+this.measureText(t),this.y))}else{var r=new e.Element.g;r.children=this.children,r.parent=this,r.render(t)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){e.ctx.canvas.style.cursor="pointer"}},e.Element.a.prototype=new e.Element.TextElementBase,e.Element.image=function(t){this.base=e.Element.RenderedElementBase,this.base(t);var n=this.getHrefAttribute().value,r=n.match(/\.svg$/);if(e.Images.push(this),this.loaded=!1,r)this.img=e.ajax(n),this.loaded=!0;else{this.img=document.createElement("img");var i=this;this.img.onload=function(){i.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+n+'" not found'),i.loaded=!0)},this.img.src=n}this.renderChildren=function(t){var n=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");0!=o&&0!=a&&(t.save(),r?t.drawSvg(this.img,n,i,o,a):(t.translate(n,i),e.AspectRatio(t,this.attribute("preserveAspectRatio").value,o,this.img.width,a,this.img.height,0,0),t.drawImage(this.img,0,0)),t.restore())},this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new e.BoundingBox(t,n,t+r,n+i)}},e.Element.image.prototype=new e.Element.RenderedElementBase,e.Element.g=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.getBoundingBox=function(){for(var t=new e.BoundingBox,n=0;n<this.children.length;n++)t.addBoundingBox(this.children[n].getBoundingBox());return t}},e.Element.g.prototype=new e.Element.RenderedElementBase,e.Element.symbol=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(t){if(this.baseSetContext(t),this.attribute("viewBox").hasValue()){var n=e.ToNumberArray(this.attribute("viewBox").value),r=n[0],i=n[1];width=n[2],height=n[3],e.AspectRatio(t,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,r,i),e.ViewPort.SetCurrent(n[2],n[3])}}},e.Element.symbol.prototype=new e.Element.RenderedElementBase,e.Element.style=function(t){this.base=e.Element.ElementBase,this.base(t);for(var n="",r=0;r<t.childNodes.length;r++)n+=t.childNodes[r].nodeValue;n=n.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),n=e.compressSpaces(n);for(var i=n.split("}"),r=0;r<i.length;r++)if(""!=e.trim(i[r]))for(var o=i[r].split("{"),a=o[0].split(","),s=o[1].split(";"),l=0;l<a.length;l++){var u=e.trim(a[l]);if(""!=u){for(var c={},d=0;d<s.length;d++){var p=s[d].indexOf(":"),h=s[d].substr(0,p),f=s[d].substr(p+1,s[d].length-p);null!=h&&null!=f&&(c[e.trim(h)]=new e.Property(e.trim(h),e.trim(f)))}if(e.Styles[u]=c,"@font-face"==u)for(var m=c["font-family"].value.replace(/"/g,""),g=c.src.value.split(","),v=0;v<g.length;v++)if(g[v].indexOf('format("svg")')>0)for(var y=g[v].indexOf("url"),b=g[v].indexOf(")",y),x=g[v].substr(y+5,b-y-6),w=e.parseXml(e.ajax(x)),_=w.getElementsByTagName("font"),T=0;T<_.length;T++){var C=e.CreateElement(_[T]);e.Definitions[m]=C}}}},e.Element.style.prototype=new e.Element.ElementBase,e.Element.use=function(t){this.base=e.Element.RenderedElementBase,this.base(t),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var e=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e
},this.path=function(e){var t=this.getDefinition();null!=t&&t.path(e)},this.getBoundingBox=function(){var e=this.getDefinition();return null!=e?e.getBoundingBox():void 0},this.renderChildren=function(e){var t=this.getDefinition();if(null!=t){var n=t.parent;t.parent=null,t.render(e),t.parent=n}}},e.Element.use.prototype=new e.Element.RenderedElementBase,e.Element.mask=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(t,n){var r=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),o=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y");if(0==o&&0==a){for(var s=new e.BoundingBox,l=0;l<this.children.length;l++)s.addBoundingBox(this.children[l].getBoundingBox());var r=Math.floor(s.x1),i=Math.floor(s.y1),o=Math.floor(s.width()),a=Math.floor(s.height())}var u=n.attribute("mask").value;n.attribute("mask").value="";var c=document.createElement("canvas");c.width=r+o,c.height=i+a;var d=c.getContext("2d");this.renderChildren(d);var p=document.createElement("canvas");p.width=r+o,p.height=i+a;var h=p.getContext("2d");n.render(h),h.globalCompositeOperation="destination-in",h.fillStyle=d.createPattern(c,"no-repeat"),h.fillRect(0,0,r+o,i+a),t.fillStyle=h.createPattern(p,"no-repeat"),t.fillRect(0,0,r+o,i+a),n.attribute("mask").value=u},this.render=function(){}},e.Element.mask.prototype=new e.Element.ElementBase,e.Element.clipPath=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(t){for(var n=0;n<this.children.length;n++){var r=this.children[n];if("undefined"!=typeof r.path){var i=null;r.attribute("transform").hasValue()&&(i=new e.Transform(r.attribute("transform").value),i.apply(t)),r.path(t),t.clip(),i&&i.unapply(t)}}},this.render=function(){}},e.Element.clipPath.prototype=new e.Element.ElementBase,e.Element.filter=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t){var n=t.getBoundingBox(),r=Math.floor(n.x1),i=Math.floor(n.y1),o=Math.floor(n.width()),a=Math.floor(n.height()),s=t.style("filter").value;t.style("filter").value="";for(var l=0,u=0,c=0;c<this.children.length;c++){var d=this.children[c].extraFilterDistance||0;l=Math.max(l,d),u=Math.max(u,d)}var p=document.createElement("canvas");p.width=o+2*l,p.height=a+2*u;var h=p.getContext("2d");h.translate(-r+l,-i+u),t.render(h);for(var c=0;c<this.children.length;c++)this.children[c].apply(h,0,0,o+2*l,a+2*u);e.drawImage(p,0,0,o+2*l,a+2*u,r-l,i-u,o+2*l,a+2*u),t.style("filter",!0).value=s},this.render=function(){}},e.Element.filter.prototype=new e.Element.ElementBase,e.Element.feMorphology=function(t){this.base=e.Element.ElementBase,this.base(t),this.apply=function(){}},e.Element.feMorphology.prototype=new e.Element.ElementBase,e.Element.feColorMatrix=function(t){function n(e,t,n,r,i,o){return e[n*r*4+4*t+o]}function r(e,t,n,r,i,o,a){e[n*r*4+4*t+o]=a}this.base=e.Element.ElementBase,this.base(t),this.apply=function(e,t,i,o,a){for(var s=e.getImageData(0,0,o,a),i=0;a>i;i++)for(var t=0;o>t;t++){var l=n(s.data,t,i,o,a,0),u=n(s.data,t,i,o,a,1),c=n(s.data,t,i,o,a,2),d=(l+u+c)/3;r(s.data,t,i,o,a,0,d),r(s.data,t,i,o,a,1,d),r(s.data,t,i,o,a,2,d)}e.clearRect(0,0,o,a),e.putImageData(s,0,0)}},e.Element.feColorMatrix.prototype=new e.Element.ElementBase,e.Element.feGaussianBlur=function(t){this.base=e.Element.ElementBase,this.base(t),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(t,n,r,i,o){return"undefined"==typeof stackBlurCanvasRGBA?void("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work")):(t.canvas.id=e.UniqueId(),t.canvas.style.display="none",document.body.appendChild(t.canvas),stackBlurCanvasRGBA(t.canvas.id,n,r,i,o,this.blurRadius),void document.body.removeChild(t.canvas))}},e.Element.feGaussianBlur.prototype=new e.Element.ElementBase,e.Element.title=function(){},e.Element.title.prototype=new e.Element.ElementBase,e.Element.desc=function(){},e.Element.desc.prototype=new e.Element.ElementBase,e.Element.MISSING=function(e){"undefined"!=typeof console&&console.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},e.Element.MISSING.prototype=new e.Element.ElementBase,e.CreateElement=function(t){var n=t.nodeName.replace(/^[^:]+:/,"");n=n.replace(/\-/g,"");var r=null;return r="undefined"!=typeof e.Element[n]?new e.Element[n](t):new e.Element.MISSING(t),r.type=t.nodeName,r},e.load=function(t,n){e.loadXml(t,e.ajax(n))},e.loadXml=function(t,n){e.loadXmlDoc(t,e.parseXml(n))},e.loadXmlDoc=function(t,n){e.init(t);var r=function(e){for(var n=t.canvas;n;)e.x-=n.offsetLeft,e.y-=n.offsetTop,n=n.offsetParent;return window.scrollX&&(e.x+=window.scrollX),window.scrollY&&(e.y+=window.scrollY),e};1!=e.opts.ignoreMouse&&(t.canvas.onclick=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onclick(n.x,n.y)},t.canvas.onmousemove=function(t){var n=r(new e.Point(null!=t?t.clientX:event.clientX,null!=t?t.clientY:event.clientY));e.Mouse.onmousemove(n.x,n.y)});var i=e.CreateElement(n.documentElement);i.root=!0;var o=!0,a=function(){e.ViewPort.Clear(),t.canvas.parentNode&&e.ViewPort.SetCurrent(t.canvas.parentNode.clientWidth,t.canvas.parentNode.clientHeight),1!=e.opts.ignoreDimensions&&(i.style("width").hasValue()&&(t.canvas.width=i.style("width").toPixels("x"),t.canvas.style.width=t.canvas.width+"px"),i.style("height").hasValue()&&(t.canvas.height=i.style("height").toPixels("y"),t.canvas.style.height=t.canvas.height+"px"));var r=t.canvas.clientWidth||t.canvas.width,a=t.canvas.clientHeight||t.canvas.height;if(1==e.opts.ignoreDimensions&&i.style("width").hasValue()&&i.style("height").hasValue()&&(r=i.style("width").toPixels("x"),a=i.style("height").toPixels("y")),e.ViewPort.SetCurrent(r,a),null!=e.opts.offsetX&&(i.attribute("x",!0).value=e.opts.offsetX),null!=e.opts.offsetY&&(i.attribute("y",!0).value=e.opts.offsetY),null!=e.opts.scaleWidth&&null!=e.opts.scaleHeight){var s=1,l=1,u=e.ToNumberArray(i.attribute("viewBox").value);i.attribute("width").hasValue()?s=i.attribute("width").toPixels("x")/e.opts.scaleWidth:isNaN(u[2])||(s=u[2]/e.opts.scaleWidth),i.attribute("height").hasValue()?l=i.attribute("height").toPixels("y")/e.opts.scaleHeight:isNaN(u[3])||(l=u[3]/e.opts.scaleHeight),i.attribute("width",!0).value=e.opts.scaleWidth,i.attribute("height",!0).value=e.opts.scaleHeight,i.attribute("viewBox",!0).value="0 0 "+r*s+" "+a*l,i.attribute("preserveAspectRatio",!0).value="none"}1!=e.opts.ignoreClear&&t.clearRect(0,0,r,a),i.render(t),o&&(o=!1,"function"==typeof e.opts.renderCallback&&e.opts.renderCallback(n))},s=!0;e.ImagesLoaded()&&(s=!1,a()),e.intervalID=setInterval(function(){var t=!1;if(s&&e.ImagesLoaded()&&(s=!1,t=!0),1!=e.opts.ignoreMouse&&(t|=e.Mouse.hasEvents()),1!=e.opts.ignoreAnimation)for(var n=0;n<e.Animations.length;n++)t|=e.Animations[n].update(1e3/e.FRAMERATE);"function"==typeof e.opts.forceRedraw&&1==e.opts.forceRedraw()&&(t=!0),t&&(a(),e.Mouse.runEvents())},1e3/e.FRAMERATE)},e.stop=function(){e.intervalID&&clearInterval(e.intervalID)},e.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInPath&&t.isPointInPath(r.x,r.y)&&(this.eventElements[n]=e)}},this.checkBoundingBox=function(e,t){for(var n=0;n<this.events.length;n++){var r=this.events[n];t.isPointInBox(r.x,r.y)&&(this.eventElements[n]=e)}},this.runEvents=function(){e.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++)for(var n=this.events[t],r=this.eventElements[t];r;)n.run(r),r=r.parent;this.events=[],this.eventElements=[]}},e}this.canvg=function(t,n,r){if(null!=t||null!=n||null!=r){r=r||{},"string"==typeof t&&(t=document.getElementById(t)),null!=t.svg&&t.svg.stop();var i=e();(1!=t.childNodes.length||"OBJECT"!=t.childNodes[0].nodeName)&&(t.svg=i),i.opts=r;var o=t.getContext("2d");"undefined"!=typeof n.documentElement?i.loadXmlDoc(o,n):"<"==n.substr(0,1)?i.loadXml(o,n):i.load(o,n)}else for(var a=document.getElementsByTagName("svg"),s=0;s<a.length;s++){var l=a[s],u=document.createElement("canvas");u.width=l.clientWidth,u.height=l.clientHeight,l.parentNode.insertBefore(u,l),l.parentNode.removeChild(l);var c=document.createElement("div");c.appendChild(l),canvg(u,c.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,n,r,i){canvg(this.canvas,e,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:n,scaleWidth:r,scaleHeight:i})}),define("canvg",["rgbcolor"],function(e){return function(){var t;return t||e.canvg}}(this)),function(){define("cs!models/md2d/views/aminoacid-context-menu",["require","cs!models/md2d/models/aminoacids-helper"],function(e){var t,n,r,i,o,a,s,l,u,c;return u=e("cs!models/md2d/models/aminoacids-helper"),a="aminoacids-menu",i="hydrophobic",r="hydrophobic-category",n="hydrophilic",t="hydrophilic-category",l="pos-charge",s="neg-charge",o="marked",c=function(e,o){var a;return a={show:o?"slideDown":"show",hide:o?"slideUp":"hide"},"hydrophobic"===e?($("."+i)[a.show](),$("."+n)[a.hide](),$("."+r).addClass("expanded"),$("."+t).removeClass("expanded")):($("."+i)[a.hide](),$("."+n)[a.show](),$("."+r).removeClass("expanded"),$("."+t).addClass("expanded"))},{register:function(e,d,p,h){return $.contextMenu("destroy",p),$.contextMenu({selector:p,appendTo:".lab-responsive-content",className:a,animation:{show:"show",hide:"hide"},callback:function(t,n){var r,i,a;return a=h(),i=u.getAminoAcidByElement(a.element).abbreviation,n.items[i].$node.removeClass(o),r=u.abbrToElement(t),e.setAtomProperties(a.idx,{element:r}),d.repaint()},position:function(e,t,n){var r,i,o,a,s,l,u;return r=$(window),t||n?("maintain"===t&&"maintain"===n?a=e.$menu.position():(l=e.$trigger.parents().andSelf().filter(function(){return"fixed"===$(this).css("position")}).length,l&&(n-=r.scrollTop(),t-=r.scrollLeft()),a={top:n,left:t}),i=r.scrollTop()+r.height(),s=r.scrollLeft()+r.width(),o=e.$menu[0].scrollHeight,u=e.$menu[0].scrollWidth,a.top+o>i&&(a.top-=o),a.left+u>s&&(a.left-=u),a.left+=1,e.$menu.css(a)):void e.determinePosition.call(this,e.$menu)},events:{show:function(e){var t,n,r;return(r=h())?(n=u.getAminoAcidByElement(r.element).abbreviation,t=e.items[n].$node,t.addClass(o),c(t.hasClass(i)?"hydrophobic":"hydrophilic"),!0):!1},hide:function(e){var t,n;return n=h(),t=u.getAminoAcidByElement(n.element).abbreviation,e.items[t].$node.removeClass(o),!0}},items:{Hydrophobic:{name:"Hydrophobic",className:""+r,callback:function(){return c("hydrophobic",!0),!1}},Gly:{name:"Glycine",className:""+i},Ala:{name:"Alanine",className:""+i},Val:{name:"Valine",className:""+i},Leu:{name:"Leucine",className:""+i},Ile:{name:"Isoleucine",className:""+i},Phe:{name:"Phenylalanine",className:""+i},Pro:{name:"Proline",className:""+i},Trp:{name:"Tryptophan",className:""+i},Met:{name:"Methionine",className:""+i},Cys:{name:"Cysteine",className:""+i},Tyr:{name:"Tyrosine",className:""+i},Hydrophilic:{name:"Hydrophilic",className:""+t,callback:function(){return c("hydrophilic",!0),!1}},Asn:{name:"Asparagine",className:""+n},Gln:{name:"Glutamine",className:""+n},Ser:{name:"Serine",className:""+n},Thr:{name:"Threonine",className:""+n},Asp:{name:"Asparticacid",className:""+n+" "+s},Glu:{name:"Glutamicacid",className:""+n+" "+s},Lys:{name:"Lysine",className:""+n+" "+l},Arg:{name:"Arginine",className:""+n+" "+l},His:{name:"Histidine",className:""+n+" "+l}}}),c("hydrophobic")}}})}.call(this),define("models/md2d/views/atoms-interactions",["require","common/alert","cs!models/md2d/views/aminoacid-context-menu"],function(e){var t=e("common/alert"),n=e("cs!models/md2d/views/aminoacid-context-menu"),r={};return function(e,i,o){function a(e,t,n,r){0===r.button&&C(B)}function s(){}function l(){}function u(){}function c(t,n,r){!j&&e.clickHandler[".atom"]&&e.clickHandler[".atom"](t,n,r,r.idx)}function d(){}function p(t){var n=T(t);B=_(n.x,n.y),V=null,j=!1,e.hitTestCallback(!!B),B&&a(n.x,n.y,B,t)}function h(t){var n=T(t),r=_(n.x,n.y);e.hitTestCallback(!!r),r?s(n.x,n.y,r,t):l(n.x,n.y,t),F||b(r)}function f(t){var n=T(t),r=_(n.x,n.y),i=!1;e.hitTestCallback(!!r),r&&(u(n.x,n.y,r,t),r===B&&(i=!0,c(n.x,n.y,B))),e.mouseupCallback(i),B=null}function m(){}function g(e){var t=T(e);l(t.x,t.y,e),x("auto")}function v(t){var n=T(t);V=_(n.x,n.y),e.hitTestCallback(!!V),V&&d(n.x,n.y,V)}function y(e){if(e.target!==o)return void x("auto");var t=T(e);b(_(t.x,t.y))}function b(e){x(e&&(i.isStopped()||e.draggable)?"move":"auto")}function x(e){G!==e&&(G=e,document.documentElement.style.cursor=e)}function w(){P=e.model2canvas,E=e.model2canvasInv,N=$(o),N.addClass("atoms-interaction-layer"),N.on("mousedown.atoms-interactions",p),N.on("mouseup.atoms-interactions",f),N.on("mousemove.atoms-interactions",h),N.on("mouseover.atoms-interactions",m),N.on("mouseout.atoms-interactions",g),N.on("contextmenu.atoms-interactions",v),n.register(i,e,".atoms-interaction-layer",function(){return V}),S.bindModel(i)}function _(e,t){for(var n,r,i,o,a=0,s=k.length;s>a;a++)if(n=k[a],r=n.x,i=n.y,o=n.radius,e>r-o&&r+o>e&&t>i-o&&i+o>t)return n;return null}function T(e,t){return t||(O=N.offset(),L=N.attr("width")/N.width(),I=i.get("viewPortX")||0,D=i.get("viewPortY")||0),r.x=P.invert((e.pageX-O.left)*L)+I,r.y=E.invert((e.pageY-O.top)*L)+D,r}function C(n){if(i.isStopped()||n.draggable){var r,o,a,s,l,u=n.idx;$(window).on("mousemove.lab-drag",function(t){t.preventDefault(),j||(i.isStopped()?(s=n.x,l=n.y):n.draggable&&i.liveDragStart(u),F=!0,j=!0),r=T(t,!0),o=r.x,a=r.y;var c=i.getMoleculeBoundingBox(u);c.left+o<0&&(o=0-c.left),c.right+o>R&&(o=R-c.right),c.bottom+a<0&&(a=0-c.bottom),c.top+a>M&&(a=M-c.top),i.isStopped()?(A(u,o,a,!1,!0),e.update()):i.liveDrag(o,a),x("move"),e.dragHandler.atom&&e.dragHandler.atom(o,a,n,u)}).on("selectstart.lab-drag",function(e){e.preventDefault()}).one("mouseup.lab-drag",function(r){$(window).off(".lab-drag"),j&&(F=!1,r.preventDefault(),y(r),i.isStopped()?A(u,n.x,n.y,!0,!0)||(t("You can't drop the object there."),A(u,s,l,!1,!0),e.update()):i.liveDragEnd())})}}function A(e,t,n,r,o){return i.setAtomProperties(e,{x:t,y:n},r,o)}var S,P,E,k,R,M,N,O,L,I,D,B,V,F,j,G;return S={bindModel:function(e){i=e,k=i.getAtoms(),R=i.get("width"),M=i.get("height")}},w(),S}}),define("models/md2d/views/atoms-renderer",["require","pixi","canvg","mustache","models/md2d/views/atoms-interactions","common/layout/detect-font-change"],function(e){var t=e("pixi"),n=e("canvg"),r=e("mustache"),i=e("models/md2d/views/atoms-interactions"),o=e("common/layout/detect-font-change"),a='<svg x="0px" y="0px" width="{{ width }}px" height="{{ height }}px"        viewBox="0 0 32 32" xml:space="preserve">         <style type="text/css">         <![CDATA[           text {             font-family: Lato, "Open Sans", helvetica, sans-serif;             font-size: {{ fontSize }}px;             font-weight: bold;             fill: #222;           }           .shadow {             stroke: rgba(255, 255, 255, 0.7);             stroke-width: 3px;           }         ]]>         </style>          <defs>             <radialGradient id="grad" cx="50%" cy="47%" r="53%" fx="35%" fy="30%">               <stop stop-color="{{ lightCol }}" offset="0%"></stop>               <stop stop-color="{{ medCol }}" offset="40%"></stop>               <stop stop-color="{{ darkCol }}" offset="80%"></stop>               <stop stop-color="{{ medCol }}" offset="100%"></stop>             </radialGradient>          </defs>          {{#excited}}           <circle fill="#ffe600" cx="16" cy="16" r="12" fill-opacity="{{ opacity }}"/>           <circle fill="url(#grad)" cx="16" cy="16" r="8" fill-opacity="{{ opacity }}"/>          {{/excited}}          {{^excited}}           <circle fill="url(#grad)" cx="16" cy="16" r="16" fill-opacity="{{ opacity }}"/>          {{/excited}}          <text class="shadow" text-anchor="middle" x="16" y="16" dy="0.31em">{{ label }}</text>          <text text-anchor="middle" x="16" y="16" dy="0.31em">{{ label }}</text>        </svg>',s=["#FFFFFF","#F2F2F2","#A4A4A4"],l=["#FFFFFF","#FF8080","#FF2020"],u=25,c=["#FFFFFF","#f2f2f2","#A4A4A4"],d=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#ffefff"]),p=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#9090FF"]),h=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#3030FF"]),f=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#dfffff"]),m=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#FF8080"]),g=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),v=function(e){var t=Math.round(Math.min(Math.abs(e)/3,1)*u);return t/=u,e>0?[d(t),p(t),h(t)]:0>e?[f(t),m(t),g(t)]:c},y=function(e){return e>0?["#F0E6D1","#E0A21B","#AD7F1C"]:["#dfffef","#75a643","#2a7216"]},b=["keShading","chargeShading","atomNumbers","showChargeSymbols","aminoAcidColorScheme","useThreeLetterCode","viewPortZoom"];return function(e,u,c,d){function p(){E=u.get("width"),k=u.get("height"),h(),u.addPropertiesListener(b,function(){h(),_.setup(),e.renderCanvas()})}function h(){b.forEach(function(e){M[e]=u.get(e)})}function f(e){var t,n,r=S[e],i=r.element,o=u.getElementProperties(i);if(r.marked)return t=u.get("markColor"),n=d3.rgb(t),[n.brighter(1).toString(),n.toString(),n.darker(1).toString()];if(r.aminoAcid)switch(M.aminoAcidColorScheme){case"charge":return v(r.charge);case"hydrophobicity":return y(r.hydrophobicity);case"chargeAndHydro":return 0!==r.charge?v(r.charge):y(r.hydrophobicity)}return M.keShading?s:M.chargeShading?v(r.charge):(t=(o.color+Math.pow(2,24)).toString(16),t="000000".substr(0,6-t.length)+t,n=d3.rgb("#"+t),[n.brighter(1).toString(),n.toString(),n.darker(1).toString()])}function m(e,i){var o,s=S[e].element,l=C(u.getElementProperties(s).radius),c=S[e].visible,d=S[e].excitation,p=w(e);if(i=i||f(e),o=c?s+"-"+l+"-"+i.join("")+"-"+p.text+"-"+d+"-"+p.fontSize:l+"-invisible",void 0===R[o]){var h,m=document.createElement("canvas");x("bold "+p.fontSize+"px Lato"),x("bold "+p.fontSize+'px "Open Sans"'),h={width:d?4*l:2*l,height:d?4*l:2*l,lightCol:i[0],medCol:i[1],darkCol:i[2],opacity:Number(c),label:p.text,fontSize:p.fontSize,excited:d},n(m,r.render(a,h)),m.width<2&&(m.width=2),m.height<2&&(m.height=2),R[o]=new t.Texture.fromCanvas(m),m.svg.stop()}return R[o]}function g(){R={},P.forEach(function(e,t){e.setTexture(m(t))}),e.renderCanvas()}function x(e){o({font:e,onchange:g})}function w(e){var t="",n=0;return M.atomNumbers?(t=e,n=1.2):M.useThreeLetterCode&&S[e].label?(t=S[e].label,n=1):!M.useThreeLetterCode&&S[e].symbol?(t=S[e].symbol,n=1.4):M.showChargeSymbols&&(S[e].charge>0?t="+":S[e].charge<0&&(t="-"),n=1.6),{text:t,fontSize:16*n}}var _,T,C,A,S,P,E,k,R={},M={},N=new i(e,u,d);return _={setup:function(){var n,r,i,o;for(T&&c.removeChild(T),T=new t.DisplayObjectContainer,c.addChild(T),C=e.model2canvas,A=e.model2canvasInv,P=[],S=u.getAtoms(),n=0,r=S.length;r>n;++n)i=new t.Sprite(m(n)),i.anchor.x=.5,i.anchor.y=.5,i.i=n,i.marked=S[n].marked,P.push(i),T.addChild(i);if(M.keShading)for(n=0,r=S.length;r>n;++n)o=new t.Sprite(m(n,l)),o.anchor.x=.5,o.anchor.y=.5,P[n].keSprite=o,T.addChild(o);_.update()},bindModel:function(e){u=e,p(),N.bindModel(e)},update:function(){var e,t,n,r,i,o;for(e=0,t=P.length;t>e;++e)n=P[e],r=S[e],i=C(r.x),o=A(r.y),n.position.x=i,n.position.y=o,r.marked!==n.marked&&(n.setTexture(m(e)),n.marked=S[e].marked),M.keShading&&(n.keSprite.alpha=Math.min(5*u.getAtomKineticEnergy(e),1),n.keSprite.position.x=i,n.keSprite.position.y=o),u.properties.useQuantumDynamics&&n.setTexture(m(e))},getAtomColors:f},p(),_}}),define("models/md2d/views/bonds-renderer",["require","pixi"],function(e){var t=e("pixi"),n={STANDARD_STICK:101,LONG_SPRING:102,BOND_SOLID_LINE:103,GHOST:104,UNICOLOR_STICK:105,SHORT_SPRING:106,DOUBLE_BOND:107,TRIPLE_BOND:108,DISULPHIDE_BOND:109},r=["keShading","chargeShading","aminoAcidColorScheme"];return function(e,i,o,a){function s(){i.addPropertiesListener(r,function(){p.setup(),e.renderCanvas()})}function l(e){var t,n,r,i=h(e.x1),o=f(e.y1),a=h(e.x2),s=f(e.y2),l=a-i,u=s-o,p=Math.sqrt(l*l+u*u)/h(.01),m=Math.floor(24*e.length),g=p/m,y=l/p,b=u/p,x=y*g,w=b*g,_=y*m,T=b*m;for(v.lineStyle(d(e),c(e,1)),v.moveTo(i,o),r=0;m>r;r++)r%2===0?(t=i+(r+.5)*x-.5*T,n=o+(r+.5)*w+.5*_):(t=i+(r+.5)*x+.5*T,n=o+(r+.5)*w-.5*_),v.lineTo(t,n);v.lineTo(a,s)}function u(e){var t=h(e.x1),r=f(e.y1),i=h(e.x2),o=f(e.y2),a=h(g[e.atom1].radius),s=h(g[e.atom2].radius),l=i-t,u=o-r,p=Math.sqrt(l*l+u*u);if(!(0>=2*p-a-s)){var m,y,b,x,w=.5*(p+a-s)/p,_=t+w*l,T=r+w*u,C=d(e);e.type===n.DOUBLE_BOND?(m=.4*h(Math.min(g[e.atom1].radius,g[e.atom2].radius)),y=Math.atan2(u,l),b=Math.sin(y)*m,x=-Math.cos(y)*m,v.lineStyle(C,c(e,1)),v.moveTo(t+b,r+x),v.lineTo(_+b,T+x),v.moveTo(t-b,r-x),v.lineTo(_-b,T-x),v.lineStyle(C,c(e,2)),v.moveTo(_+b,T+x),v.lineTo(i+b,o+x),v.moveTo(_-b,T-x),v.lineTo(i-b,o-x)):e.type===n.TRIPLE_BOND?(m=.52*h(Math.min(g[e.atom1].radius,g[e.atom2].radius)),y=Math.atan2(u,l),b=Math.sin(y)*m,x=-Math.cos(y)*m,v.lineStyle(C,c(e,1)),v.moveTo(t,r),v.lineTo(_,T),v.moveTo(t+b,r+x),v.lineTo(_+b,T+x),v.moveTo(t-b,r-x),v.lineTo(_-b,T-x),v.lineStyle(C,c(e,2)),v.moveTo(_,T),v.lineTo(i,o),v.moveTo(_+b,T+x),v.lineTo(i+b,o+x),v.moveTo(_-b,T-x),v.lineTo(i-b,o-x)):(v.lineStyle(C,c(e,1)),v.moveTo(t,r),v.lineTo(_,T),v.lineStyle(C,c(e,2)),v.moveTo(_,T),v.lineTo(i,o))}}function c(e,t){return e.type===n.SHORT_SPRING?8947848:e.type===n.DISULPHIDE_BOND?16771418:1===t?parseInt(a.getAtomColors(e.atom1)[2].substr(1),16):2===t?parseInt(a.getAtomColors(e.atom2)[2].substr(1),16):void 0}function d(e){if(e.type===n.SHORT_SPRING)return h(.012);var t=h(Math.min(g[e.atom1].radius,g[e.atom2].radius));return e.type===n.DOUBLE_BOND?.5*t:e.type===n.TRIPLE_BOND?.35*t:.75*t}var p,h,f,m,g,v=new t.Graphics;return p={setup:function(){m=i.getRadialBonds(),g=i.getAtoms(),h=e.model2canvas,f=e.model2canvasInv,p.update()},bindModel:function(e){i=e,s()},update:function(){var e,t,r;for(v.clear(),e=0,t=m.length;t>e;++e)r=m[e],r.type===n.SHORT_SPRING?l(r):u(r)}},s(),o.addChild(v),p}}),define("models/md2d/views/vectors-renderer",["require","pixi"],function(e){var t=e("pixi");return function(e,n){function r(){h=n.count,f=n.x,m=n.y,g=n.vx,v=n.vy,y=n.alpha,p=n.show,b=n.length,x=n.width,w=n.color,_=n.dirOnly,l=n.m2px,u=n.m2pxInv}function i(){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=1,e.height=1,n.fillStyle=w,n.fillRect(0,0,1,1),new t.Texture.fromCanvas(e)}function o(){var e=document.createElement("canvas"),n=e.getContext("2d"),r=l(3.5*x);return e.width=r,e.height=r,n.fillStyle=w,n.beginPath(),n.moveTo(0,0),n.lineTo(r,0),n.lineTo(.5*r,r),n.closePath(),n.fill(),new t.Texture.fromCanvas(e)}function a(e){var t=d[e],n=f(e),r=m(e),i=g(e)*b,o=v(e)*b,a=Math.sqrt(i*i+o*o),s=Math.PI+Math.atan2(i,o),c=t.arrowHead;_&&(i=.15*b*i/a,o=.15*b*o/a,a=.15*b);var p=l(a);if(1>p)return t.alpha=0,void(c.alpha=0);if(y?(t.alpha=y(e),c.alpha=y(e)):(t.alpha=1,c.alpha=1),p>1e6){var h=p/1e6;i/=h,o/=h,a/=h,p/=h}t.position.x=l(n),t.position.y=u(r),t.scale.y=p,t.rotation=s,c.position.x=l(n+i),c.position.y=u(r+o),c.rotation=s}var s,l,u,c,d,p,h,f,m,g,v,y,b,x,w,_;return s={setup:function(){if(r(),c&&(e.removeChild(c),c=null),p&&0!==h){c=new t.DisplayObjectContainer,e.addChild(c);var n,a,u,f;for(d=[],f=i(),n=0;h>n;++n)a=new t.Sprite(f),a.anchor.x=.5,a.scale.x=l(x),a.i=n,d.push(a),c.addChild(a);for(f=o(),n=0;h>n;++n)u=new t.Sprite(f),u.anchor.x=.5,d[n].arrowHead=u,c.addChild(u);s.update()}},update:function(){if(p&&0!==h)for(var e=0;h>e;++e)a(e)}}}}),define("models/md2d/views/field-renderer",["require","pixi"],function(e){function t(e){return 1/(1+Math.exp(-e))}var n=e("pixi");return function(e,r){function i(){h=r.count,f=r.x,m=r.y,g=r.vx,v=r.vy,y=r.alpha,p=r.show,b=r.length,x=r.color,c=r.m2px,d=r.m2pxInv}function o(){var e=document.createElement("canvas"),r=e.getContext("2d"),i=.2,o=1/3,a=30,s=60,l=c(b),u=(l-a)/(s-a),d=i+t(-8*(u-.5))*(o-i),p=l*d;return e.height=l,e.width=p,r.beginPath(),r.moveTo(0,0),r.lineTo(.5*p,l),r.lineTo(p,0),r.fillStyle=x,r.fill(),new n.Texture.fromCanvas(e)}function a(e){var t=u[e],n=f(e),r=m(e);t.position.x=c(n),t.position.y=d(r),t.rotation=Math.PI+Math.atan2(g(e),v(e)),t.alpha=y(e)}var s,l,u,c,d,p,h,f,m,g,v,y,b,x;return s={setup:function(){var t,r,a;if(i(),l&&(e.removeChild(l),l=null),p&&0!==h){for(l=new n.DisplayObjectContainer,e.addChild(l),u=[],a=o(),t=0;h>t;++t)r=new n.Sprite(a),r.anchor.x=.5,r.anchor.y=.5,r.i=t,u.push(r),l.addChild(r);s.update()}},update:function(){if(p&&0!==h)for(var e=0;h>e;++e)a(e)}}}}),define("models/md2d/views/vdw-lines-renderer",["require","pixi"],function(e){"use strict";var t=e("pixi"),n=5;return function(e,r,i){function o(r){var i=document.createElement("canvas"),o=i.getContext("2d"),a=e.model2canvas(.02),s=e.model2canvas(.03),l=r/2;f=n*(s+a)+s,i.width=f,i.height=r,o.strokeStyle="#aaa",o.lineWidth=r;for(var u=0,c=0;n>c;c++)o.moveTo(u,l),o.lineTo(u+s,l),o.stroke(),u+=s+a;return t.Texture.fromCanvas(i)}function a(){d&&(i.removeChild(d),d=null),m=[]}function s(){d=new t.DisplayObjectContainer,i.addChild(d),m=[]}function l(){var t;return r.properties.showVDWLines?(t=e.model2canvas(.02),t!==h&&(h=t,p=o(h),a(),s()),d||s(),void u()):void a()}function u(){if(r.properties.showVDWLines){var n,i,o,a,s,l,u,c,h,g=r.get_vdw_pairs(),v=r.getAtoms();for(n=m.length;n<g.count;n++)m[n]=new t.Sprite(p),m[n].anchor.y=.5,d.addChild(m[n]);for(n=0;n<g.count;n++)i=v[g.atom1[n]],o=v[g.atom2[n]],l=e.model2canvas(i.x),u=e.model2canvasInv(i.y),c=e.model2canvas(o.x),h=e.model2canvasInv(o.y),a=c-l,s=h-u,m[n].visible=!0,m[n].scale.x=Math.ceil(Math.sqrt(a*a+s*s))/f,m[n].position.x=l,m[n].position.y=u,m[n].rotation=Math.atan2(s,a);for(;n<m.length;n++)m[n].visible=!1}}function c(e){r=e}var d,p,h,f,m=[];return{setup:l,update:u,bindModel:c}}}),define("models/md2d/views/genetic-elements-renderer",["require","models/md2d/views/nucleotides","common/resources-url"],function(e){function t(e){var t=e.select("defs");return t.empty()&&(t=e.append("defs")),t}function n(e){var n,r=t(e);r.select("#transcription-bg").empty()&&(n=r.append("linearGradient").attr("id","transcription-bg").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),n.append("stop").attr("stop-color","#C8DD69").attr("offset","0%"),n.append("stop").attr("stop-color","#778B3D").attr("offset","100%"))}function r(e,t,r,a){function u(e){return"scale("+e.scale+")"}function c(e){return e.opacity}function d(e){var n=e.translateX||0,i=e.translateY||0;return"translate("+t(n)+" "+r(i)+")"}function p(e){return d(e)+" "+u(e)}function h(e){var t=e?a.geneticEngine().PRECODING_LEN:0,n=Math.floor(a.properties.viewPortX/i.WIDTH)-2,r=Math.ceil((a.properties.viewPortX+a.properties.viewPortWidth)/i.WIDTH)+4;return[Math.max(0,n+t),r+t]}return{cells:function(e,n){var r=e.select(".background-layer").selectAll(".cells").data(n.cells);r.enter().append("image").attr({"class":"cells",x:t(s.CELLS*-.567),y:t(l.CELLS*-.445),width:t(s.CELLS),height:t(l.CELLS),preserveAspectRatio:"none","xlink:href":o("dna/Cells.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna1:function(e,n){var r=e.select(".dna-layer").selectAll(".dna1").data(n.dna1);r.enter().append("image").attr({"class":"dna1",x:t(s.DNA1*-.5),y:t(l.DNA1*-.5),width:t(s.DNA1),height:t(l.DNA1),preserveAspectRatio:"none","xlink:href":o("dna/DNA_InsideNucleus_1.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna2:function(e,n){var r=e.select(".dna-layer").selectAll(".dna2").data(n.dna2);r.enter().append("image").attr({"class":"dna2",x:t(s.DNA2*-.5),y:t(l.DNA2*-.404),width:t(s.DNA2),height:t(l.DNA2),preserveAspectRatio:"none","xlink:href":o("dna/DNA_InsideNucleus_2.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna3:function(e,n){var r,i,a=14;r=e.select(".dna-layer").selectAll(".dna3").data(n.dna3),i=r.enter().append("g").attr({"class":"dna3 main-dna",transform:p}).style("opacity",c),i.selectAll("dna3-unit").data(new Array(a)).enter().append("image").attr({"class":"dna3-unit",x:function(e,n){return(n-.5*a)*t(s.DNA3)*.98},y:t(l.DNA3*-.5),width:t(s.DNA3),height:t(l.DNA3),preserveAspectRatio:"none","xlink:href":o("dna/DoubleHelix_Unit.svg")}),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},dna:function(e,n,r){var o=a.geneticEngine().viewModel,s=h(!0),l=n.dna[0]?n.dna[0].bonds:0,u=i(),c=e.select(".dna-layer").selectAll(".dna");return u.model2px(t).sequence(o.DNA.slice(s[0],s[1])).glow(a.get("DNAMutations")).bonds(l),r?void c.call(u.enterExitOnly(!0)):(c=c.data(n.dna),c.enter().append("g").attr({"class":"dna",transform:d}),c.call(u),d3.transition(c).attr("transform",d),void d3.transition(c.exit()).remove())},dnaComp:function(e,n,r){var o=a.geneticEngine().viewModel,s=h(!0),l=n.dnaComp[0]?n.dnaComp[0].bonds:0,u=i(),c=e.select(".dna-layer").selectAll(".dna-comp");return u.model2px(t).sequence(o.DNAComp.slice(s[0],s[1])).direction(2).glow(a.get("DNAMutations")).bonds(l),r?void c.call(u.enterExitOnly(!0)):(c=c.data(n.dnaComp),c.enter().append("g").attr({"class":"dna-comp",transform:d}),c.call(u),d3.transition(c).attr("transform",d),void d3.transition(c.exit()).remove())},mrna:function(e,n,r){var o=a.geneticEngine(),s=o.viewModel.mRNA,l=h(),u=o.stopCodonsHash(),c=n.mrna[0]?n.mrna[0].bonds:0,p=n.mrna[0]?n.mrna[0].direction:1,f=i(),m=e.select(".dna-layer").selectAll(".mrna");return f.model2px(t).sequence(s.slice(l[0],l[1])).backbone("RNA").direction(p).bonds(c).stopCodonsHash(u),r?void m.call(f.enterExitOnly(!0)):(m=m.data(n.mrna),m.enter().append("g").attr({"class":"mrna",transform:d}),m.call(f),d3.transition(m).attr("transform",d),void d3.transition(m.exit()).remove())},polymeraseUnder:function(e,n){var r=e.select(".under-dna-layer").selectAll(".polymerase-under").data(n.polymeraseUnder);r.enter().append("image").attr({"class":"polymerase-under",x:t(s.POLY_UNDER*-.5),y:t(l.POLY_UNDER*-.5),width:t(s.POLY_UNDER),height:t(l.POLY_UNDER),preserveAspectRatio:"none","xlink:href":o("dna/Polymerase_Under.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},polymeraseOver:function(e,n){var r=e.select(".over-dna-layer").selectAll(".polymerase-over").data(n.polymeraseOver);r.enter().append("image").attr({"class":"polymerase-over",x:t(s.POLY_OVER*-.5),y:t(l.POLY_OVER*-.5),width:t(s.POLY_OVER),height:t(l.POLY_OVER),preserveAspectRatio:"none","xlink:href":o("dna/Polymerase_Over.svg"),transform:p}).style("opacity",c),d3.transition(r).attr("transform",p).style("opacity",c),d3.transition(r.exit()).remove()},nucleus:function(e,n){var r=e.select(".background-layer").selectAll(".nucleus").data(n.nucleus);r.enter().append("image").attr({"class":"nucleus",x:t(s.NUCLEUS*-.5),y:t(l.NUCLEUS*-.5),width:t(s.NUCLEUS),height:t(l.NUCLEUS),preserveAspectRatio:"none","xlink:href":o("dna/BG_Nucleus.svg"),transform:d}).style("opacity",c),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).remove()},ribosomeBottom:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-bottom").data(n.ribosomeBottom);r.enter().append("image").attr({"class":"ribosome-bottom",x:t(s.RIBO_BOTTOM*-.5),y:t(l.RIBO_BOTTOM*-.5),width:t(s.RIBO_BOTTOM),height:t(l.RIBO_BOTTOM),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_bottom1.svg"),transform:d}).style("opacity",0),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).style("opacity",0).remove()},ribosomeTop:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-top").data(n.ribosomeTop);
r.enter().append("image").attr({"class":"ribosome-top",x:t(s.RIBO_TOP*-.5),y:t(l.RIBO_TOP*-.5),width:t(s.RIBO_TOP),height:t(l.RIBO_TOP),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_top1.svg"),transform:d}).style("opacity",0),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).style("opacity",0).remove()},ribosomeUnder:function(e,n){var r=e.select(".under-dna-layer").selectAll(".ribosome-under").data(n.ribosomeUnder);r.enter().append("image").attr({"class":"ribosome-under",x:t(s.RIBO_UNDER*-.5),y:t(l.RIBO_UNDER*-.5),width:t(s.RIBO_UNDER),height:t(l.RIBO_UNDER),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_under.png"),transform:d}).style({opacity:c}),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).remove()},ribosomeOver:function(e,n){var r=e.select(".over-dna-layer").selectAll(".ribosome-over").data(n.ribosomeOver);r.enter().append("image").attr({"class":"ribosome-over",x:t(s.RIBO_OVER*-.5),y:t(l.RIBO_OVER*-.5),width:t(s.RIBO_OVER),height:t(l.RIBO_OVER),preserveAspectRatio:"none","xlink:href":o("dna/Ribosome_over.png"),transform:d}).style("opacity",c),d3.transition(r).attr("transform",d).style("opacity",c),d3.transition(r.exit()).remove()},trna:function(e,n){var r,u,p,h,f=a.geneticEngine(),m=3*i.WIDTH,g=.55*(m-s.TRNA);r=e.select(".top-layer").selectAll(".trna").data(n.trna,function(e){return e.index}),u=r.enter().append("g").attr({"class":"trna",display:function(e){return e.index<0?"none":"inline"},transform:function(e,n){return"translate("+t(2*i.HEIGHT)+", "+t(-2.78)+") "+d(e,n)+" rotate(30)"}}).style("opacity",c),u.append("g").attr("transform","translate(0, "+t(-l.A)+")").call(i().model2px(t).sequence(function(e){return f.codonComplement(e.index)}).backbone(!1).randomEnter(!1)),u.append("image").attr({"class":"trna-neck",x:t(.52*(m-s.TRNA_NECK)),y:t(-l.TRNA_NECK-.95*l.TRNA-.92*l.A),width:t(s.TRNA_NECK),height:t(l.TRNA_NECK),preserveAspectRatio:"none","xlink:href":o("dna/tRNA_neck.png")}),u.append("image").attr({"class":"trna-base",x:t(g),y:t(-l.TRNA-.92*l.A),width:t(s.TRNA),height:t(l.TRNA),preserveAspectRatio:"none","xlink:href":o("dna/tRNA_base.png")}),p=d3.transition(r).attr("transform",d).style("opacity",c),p.select(".trna-neck").style("opacity",function(e){return e.neck}),h=d3.transition(r.exit()).attr("transform",function(e,n){return"translate("+t(-5*i.HEIGHT)+", "+t(-4*i.HEIGHT)+") "+d(e,n)+" rotate(-30)"}).style("opacity",0),h.selectAll(".bonds").style("opacity",0),h.remove()},viewPort:function(t,n){var r=n.viewPort[0].position,o=n.viewPort[0].ease,s=n.viewPort[0].drag,l=d3.transition(d3.select(e));a.set("viewPortDrag",s?"x":!1),l.duration?(l.ease(o),l.tween("model-update",function(){var e=d3.interpolate(Number(a.properties.viewPortX),r*i.WIDTH);return function(t){var n=e(t);Math.abs(a.properties.viewPortX-n)>.001&&(a.properties.viewPortX=n)}})):a.set("viewPortX",r*i.WIDTH)},background:function(t,r){n(t),d3.transition(d3.select(e).select(".container-background")).attr("fill",r.background[0].color)}}}var i=e("models/md2d/views/nucleotides"),o=e("common/resources-url"),a=.007,s={CELLS:720,DNA1:661,DNA2:720,DNA3:337.4,POLY_UNDER:426.15,POLY_OVER:402.525,NUCLEUS:729.45,RIBO_TOP:550.7,RIBO_BOTTOM:509.031,RIBO_UNDER:550.55,RIBO_OVER:550.7,TRNA:117.325,TRNA_NECK:15.925},l={CELLS:500,DNA1:550,DNA2:414.263,DNA3:89.824,POLY_UNDER:368.6,POLY_OVER:368.6,NUCLEUS:543.199,RIBO_TOP:250,RIBO_BOTTOM:147.15,RIBO_UNDER:311.6,RIBO_OVER:311.6,TRNA:67.9,TRNA_NECK:21.14,A:31.15},u=["background","cells","dna1","dna2","dna3","polymeraseUnder","polymeraseOver","polymeraseUnder","polymeraseOver","dna","dnaComp","mrna","nucleus","ribosomeBottom","ribosomeTop","ribosomeUnder","ribosomeOver","trna","viewPort"];return function(){var e;for(e in s)s.hasOwnProperty(e)&&(s[e]*=a);for(e in l)l.hasOwnProperty(e)&&(l[e]*=a)}(),r.W=s,r.H=l,r.OBJECT_NAMES=u,r}),define("common/views/state-manager",[],function(){return function(e){var t,n=[],r={};return t={newState:function(t,i){var o=$.extend(!0,{},i);e.forEach(function(e){"undefined"==typeof o[e]&&(o[e]=[])}),n.push(o),r[t]=o},extendLastState:function(t,i){var o=n[n.length-1],a={};e.forEach(function(e){a[e]=[],"undefined"!=typeof i[e]&&i[e].forEach(function(t,n){a[e].push($.extend(!0,{},o[e][n],t))})}),n.push(a),r[t]=a},getState:function(e){var t,n=r[e],i=$.extend(!0,{},n);for(t in i)i.hasOwnProperty(t)&&i[t].forEach(function(e,r){var i;for(i in e)"function"==typeof e[i]&&(e[i]=n[t][r][i]())});return i}}}}),define("models/md2d/views/genetic-anim-states",["require","models/md2d/views/nucleotides","models/md2d/views/genetic-elements-renderer","common/views/state-manager"],function(e){var t=e("models/md2d/views/nucleotides"),n=e("models/md2d/views/genetic-elements-renderer"),r=e("common/views/state-manager"),i=n.H,o=n.OBJECT_NAMES;return function(e){function n(){var t=c.state();return"translation-end"===t.name?e.geneticEngine().lastTranslationStep():l=isNaN(t.step)?l:t.step}function a(){return(1.65+3*Math.max(0,n()-2))*t.WIDTH}function s(){return 3*this.index()*t.WIDTH}var l,u=new r(o),c=e.geneticEngine(),d=e.get("viewPortWidth"),p=e.get("viewPortHeight"),h=.5*d,f=.5*p;return u.newState("intro-cells",{cells:[{translateX:h+.33,translateY:f,scale:1}],dna1:[{translateX:h+.33,translateY:f,scale:.13,opacity:0}],viewPort:[{position:0,ease:"cubic-in-out",drag:!1}],background:[{color:"#8492ef"}]}),u.extendLastState("intro-zoom1",{cells:[{translateX:h,scale:6}],dna1:[{translateX:h,scale:.78,opacity:5}],dna2:[{translateX:h,translateY:f,scale:.5,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom2",{cells:[{scale:24}],dna1:[{scale:3.12,opacity:0}],dna2:[{scale:2,opacity:1}],dna3:[{translateX:h,translateY:f,scale:.2,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom3-s0",{cells:[{}],dna2:[{scale:3.8,opacity:0}],dna3:[{scale:.4,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-zoom3",{cells:[{}],dna3:[{scale:.6}],polymeraseUnder:[{scale:.2,translateX:-2,translateY:4,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-polymerase-s0",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:.8,translateX:h,translateY:f,opacity:1}],polymeraseOver:[{translateX:h,translateY:f,scale:.8,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("intro-polymerase",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:1}],polymeraseOver:[{scale:1,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("dna-s0",{cells:[{opacity:0}],dna3:[{scale:1.5}],polymeraseUnder:[{scale:2.5}],polymeraseOver:[{scale:2.5}],viewPort:[{}],background:[{}]}),u.extendLastState("dna",{polymeraseUnder:[{opacity:0}],polymeraseOver:[{opacity:0}],dna3:[{opacity:0}],dna:[{translateX:-e.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:p/2+t.HEIGHT,bonds:1}],dnaComp:[{translateX:-e.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:p/2-t.HEIGHT,bonds:1}],viewPort:[{position:-2,drag:!0}],background:[{color:"url(#transcription-bg)"}]}),u.extendLastState("transcription",{dna:[{translateY:p/2+2.5*t.HEIGHT,bonds:0}],dnaComp:[{translateY:p/2-2.5*t.HEIGHT,bonds:function(){var t=n()+e.geneticEngine().PRECODING_LEN;return function(e){return"c"===e.region&&e.idx<t?1:0}}}],mrna:[{translateY:p/2-.5*t.HEIGHT,bonds:1,direction:1}],viewPort:[{position:function(){return Math.max(0,Math.min(e.get("DNA").length-10,n()-6))-2},ease:"linear"}],background:[{}]}),u.extendLastState("transcription-end",{dna:[{}],dnaComp:[{bonds:function(){return function(e){return"c"===e.region?1:0}}}],mrna:[{}],polymeraseUnder:[{translateX:function(){return e.get("DNA").length*t.WIDTH},translateY:.5*p,scale:3.5,opacity:0}],polymeraseOver:[{translateX:function(){return e.get("DNA").length*t.WIDTH},translateY:.5*p,scale:3.5,opacity:0}],viewPort:[{position:function(){return Math.max(0,e.get("DNA").length-10)-2}}],background:[{}]}),u.extendLastState("after-transcription",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{opacity:1}],polymeraseOver:[{opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation-s0",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{scale:1.4}],polymeraseOver:[{scale:1.4,opacity:0}],viewPort:[{}],background:[{color:"#8492ef"}]}),u.extendLastState("before-translation-s1",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{translateX:function(){return e.get("viewPortX")+.5*d+5},translateY:.5*p-2,scale:.7}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation-s2",{dna:[{}],dnaComp:[{}],mrna:[{}],nucleus:[{translateX:.5*d-2*t.WIDTH,translateY:.5*p}],viewPort:[{position:-2,ease:"cubic-in-out"}],background:[{}]}),u.extendLastState("before-translation-s3",{dna:[{translateY:4*t.HEIGHT}],dnaComp:[{translateY:2*t.HEIGHT,bonds:0}],mrna:[{bonds:0}],nucleus:[{translateY:0}],viewPort:[{}],background:[{color:function(){return e.get("backgroundColor")}}]}),u.extendLastState("before-translation-s4",{dna:[{translateY:-1*t.HEIGHT}],dnaComp:[{translateY:-3*t.HEIGHT}],mrna:[{translateY:2.5*t.HEIGHT}],nucleus:[{translateY:i.NUCLEUS*-.5}],viewPort:[{}],background:[{}]}),u.extendLastState("before-translation",{mrna:[{translateY:1.5*t.HEIGHT,direction:2,bonds:0}],ribosomeBottom:[{translateX:-3,translateY:f,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-s0",{mrna:[{}],ribosomeBottom:[{translateX:a,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:-3,translateY:6,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-s1",{mrna:[{}],ribosomeBottom:[{}],ribosomeTop:[{translateX:a,translateY:4.52*t.HEIGHT,opacity:1}],ribosomeUnder:[{translateX:a,translateY:3.7*t.HEIGHT,opacity:0}],ribosomeOver:[{translateX:a,translateY:3.7*t.HEIGHT,opacity:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-2)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{opacity:1}],ribosomeOver:[{opacity:1}],trna:[{index:function(){return n()-2},translateX:s,translateY:2.5*t.HEIGHT,neck:0},{index:function(){return n()-1},translateX:s,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{position:function(){return Math.max(0,3*(n()-3))-2},ease:"linear"}],background:[{}]}),u.extendLastState("translation-step0",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-3)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-3}},{index:function(){return n()-2}},{index:function(){return n()-1},translateX:s,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-step1",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{},{neck:0},{}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s0",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-2}},{index:function(){return n()-1},neck:0}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s1",{mrna:[{bonds:function(){var e=n();return function(t){return t.idx<3*(e-1)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return n()-1}}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s2",{mrna:[{bonds:0}],ribosomeUnder:[{}],ribosomeOver:[{}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s3",{mrna:[{}],ribosomeBottom:[{translateX:a,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:a,translateY:4.52*t.HEIGHT,opacity:1}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s4",{mrna:[{}],ribosomeBottom:[{translateY:1.75*t.HEIGHT-.3}],ribosomeTop:[{translateY:4.52*t.HEIGHT+.5}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end-s5",{mrna:[{}],ribosomeBottom:[{translateX:function(){return a()+8},translateY:1.75*t.HEIGHT-.5}],ribosomeTop:[{translateX:function(){return a()+8},translateY:4.52*t.HEIGHT+5}],viewPort:[{}],background:[{}]}),u.extendLastState("translation-end",{mrna:[{}],viewPort:[{}],background:[{}]}),u}}),define("common/jquery-svg-class",[],function(){function e(e,t,n,r){for(var i,o=[],a=0,s=e.length;s>a;a++)i=e[a],o.push(i instanceof SVGElement?n.apply(i,t):r.apply($(i),t));return o}var t=$.fn.hasClass,n=$.fn.addClass,r=$.fn.removeClass,i=function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(this.getAttribute("class"))},o=function(e){i.apply(this,arguments)||this.setAttribute("class",this.getAttribute("class")+" "+e)},a=function(e){var t=this.getAttribute("class").replace(new RegExp("(\\s|^)"+e+"(\\s|$)","g"),"$2");i.apply(this,arguments)&&this.setAttribute("class",t)};$.fn.hasClass=function(){for(var n=e(this,arguments,i,t),r=0,o=n.length;o>r;r++)if(n[r])return!0;return!1},$.fn.addClass=function(t){return $.isFunction(t)?n.apply(this,arguments):(e(this,arguments,o,n),this)},$.fn.removeClass=function(t){return $.isFunction(t)?r.apply(this,arguments):(e(this,arguments,a,r),this)}}),function(){var e={}.hasOwnProperty;define("cs!models/md2d/views/mutations-context-menu",["require","common/jquery-svg-class"],function(t){return t("common/jquery-svg-class"),{register:function(t,n,r){var i,o,a;i=null,a=function(t){var n,r,o;i=d3.select(t.$trigger[0]).datum().type,o=t.items.Substitution.items;for(r in o)e.call(o,r)&&(n=o[r],r=r.split(":")[1],n.$node.addClass(""+i+"-to-"+r));return d3.select(t.$trigger[0]).classed("glowing",!0),!0},o=function(t){var n,r,o;o=t.items.Substitution.items;for(r in o)e.call(o,r)&&(n=o[r],r=r.split(":")[1],n.$node.removeClass(""+i+"-to-"+r));return d3.select(t.$trigger[0]).classed("glowing",!1),!0},$.contextMenu("destroy",t),$.contextMenu({selector:t,appendTo:".lab-responsive-content",className:"mutations-menu",trigger:"left",events:{show:a,hide:o},callback:function(e,t){var i;switch(e=e.split(":"),i=d3.select(t.$trigger[0]).datum(),e[0]){case"substitute":return n.geneticEngine().mutate(i.idx,e[1],r);case"insert":return n.geneticEngine().insert(i.idx,e[1],r);case"delete":return n.geneticEngine()["delete"](i.idx)}},items:{Substitution:{name:"Substitution mutation",className:"substitution-submenu",items:{"substitute:A":{name:""},"substitute:T":{name:""},"substitute:G":{name:""},"substitute:C":{name:""}}},Insertion:{name:"Insertion mutation",className:"insertion-submenu",items:{"insert:A":{name:"Insert",className:"A"},"insert:T":{name:"Insert",className:"T"},"insert:G":{name:"Insert",className:"G"},"insert:C":{name:"Insert",className:"C"}}},"delete":{name:"Deletion mutation"}}})}}})}.call(this),define("models/md2d/views/genetic-renderer",["require","models/md2d/views/nucleotides","models/md2d/views/genetic-elements-renderer","models/md2d/views/genetic-anim-states","cs!models/md2d/views/mutations-context-menu"],function(e){function t(e,t){function s(){t.geneticEngine().on("change",u),t.geneticEngine().on("transition",h),t.addPropertiesListener(["DNAMutations"],l),t.addPropertiesListener(["viewPortX"],function(){if(x&&t.get("DNA")&&("transcription"!==_.name||!S)){var e=E.getState(P||_.name);k.mrna(x,e,!0),k.dna(x,e,!0),k.dnaComp(x,e,!0),!S&&"translation-end"===_.name&&t.getNumberOfAtoms()>0&&t.geneticEngine().centerProtein()}}),o.register('[class~="dna"] [class~="clickable-nucleo"]',t,!1),o.register('[class~="dna-comp"] [class~="clickable-nucleo"]',t,!0)}function l(){_=t.geneticEngine().state(),p(),b.selectAll("g.genetics").remove(),x=null,t.get("DNA")&&(x=b.insert("g",".image-container-below").attr("class","genetics"),x.append("g").attr("class","background-layer"),x.append("g").attr("class","under-dna-layer"),x.append("g").attr("class","dna-layer"),x.append("g").attr("class","over-dna-layer"),x.append("g").attr("class","top-layer"),u())}function u(e){A=e,_=t.geneticEngine().state(),p(),c(x,_.name,null,S),S=!1}function c(e,t,n,r){function i(e){var t=!!s[e].length,n=!(!l||!l[e].length);return A&&"viewPort"===e?!1:r||t||n?!0:!1}function o(){e.each(function(){var e=d3.select(this);a.forEach(function(t){i(t)&&k[t](e,s)})}),n&&n(e)}var s=E.getState(t),l=T?E.getState(T):null;e.duration?(e.each("start.transition-name",function(){P=t,o()}),e.each("end.transition-name",function(){P=null})):o(),T=t,C=_.step||0}function d(e){var t;return t=!e&&w&&w.node().__transition__?w.transition():x.transition(),w=t,t}function p(){var e=d3.select(g),t=e.select("g.genetics");!t.empty()&&t.node().__transition__&&(e.selectAll("g.genetics, g.genetics *").interrupt(),e.select(".container-background").interrupt(),w=null,P=null)}function h(e,n){S=!0,A=n,_=t.geneticEngine().state(),Number(e.split(":")[1])>0&&(e=e.split(":")[0]),m[e](),w.each("end.trans-end",function(){S=!1,t.geneticEngine().transitionEnded()})}var f,m,g=e.node,v=e.model2px,y=e.model2pxInv,b=d3.select(g).select(".below-atoms"),x=null,w=null,_=null,T=null,C=null,A=!1,S=!1,P=null,E=new i(t),k=new r(g,v,y,t);return m={"dna-updated":function(){var e=d(!0).ease("cubic-in-out").duration(800);c(e,_.name,null,!0)},"intro-zoom1":function(){var e=d(!0).ease("cubic").duration(3e3);c(e,"intro-zoom1")},"intro-zoom2":function(){var e=d(!0).ease("linear").duration(3e3);c(e,"intro-zoom2")},"intro-zoom3":function(){var e=d(!0).ease("linear").duration(2e3);c(e,"intro-zoom3-s0"),e=d().ease("quad-out").duration(3300),c(e,"intro-zoom3")},"intro-polymerase":function(){var e=d(!0).ease("quad-out").duration(3e3);c(e,"intro-polymerase-s0"),e=d().ease("cubic-in-out").duration(1e3),c(e,"intro-polymerase")},dna:function(){var e=d(!0).duration(2e3);c(e,"dna-s0"),e=d().duration(1e3),c(e,"dna",function(e){e.selectAll(".nucleotide").duration(5),e.selectAll(".container-background").duration(5)})},"transcription:0":function(){var e=d(!0).duration(1500);c(e,"transcription",function(e){e.selectAll(".bonds").duration(250)})},transcription:function(){var e=d(!0).duration(500);c(e,"transcription",function(e){e.selectAll(".bonds").ease("cubic")})},"transcription-end":function(){var e=d(!0).duration(500);c(e,"transcription-end",function(e){e.selectAll(".bonds").ease("cubic")})},"after-transcription":function(){var e=d(!0).ease("cubic-in-out").duration(700);c(e,"after-transcription")},"before-translation":function(){var e=d(!0).ease("cubic-in-out").duration(1e3);c(e,"before-translation-s0",function(e){e.selectAll(".container-background").duration(1)}),e=d().ease("cubic-in-out").duration(1500),c(e,"before-translation-s1"),e=d().ease("cubic-in-out").duration(1500),c(e,"before-translation-s2"),e=d().ease("cubic").duration(1e3),c(e,"before-translation-s3",function(e){e.selectAll(".bonds").duration(250),e.selectAll(".container-background").duration(1)}),e=d().ease("cubic-out").duration(1e3),c(e,"before-translation-s4"),e=d().ease("cubic-out").duration(500),c(e,"before-translation")},"translation:0":function(){var e=d(!0).ease("cubic-in-out").duration(1e3);c(e,"translation-s0"),e=d().ease("cubic-in-out").duration(1e3),c(e,"translation-s1"),e=d().ease("cubic-in-out").duration(500),c(e,"translation")},translation:function(){var e,r=t.geneticEngine(),i=_.step-1,o=1e3,a=500;e=d(!0).duration(o),c(e,"translation-step0",function(e){e.selectAll(".bonds").ease("cubic"),r.translationStepStarted(i,1.45+3*i*n.WIDTH,3.95,.53+3*i*n.WIDTH,1.57,o)}),e=d().duration(a),c(e,"translation-step1",function(e){e.selectAll(".trna-neck").duration(150),r.shiftAminoAcids(i,2*n.WIDTH,a)}),i>0&&(e=d().duration(900),c(e,"translation",function(e){r.connectAminoAcid(i),e.selectAll(".bonds").duration(150)}))},"translation-end":function(){var e,n=t.geneticEngine(),r=t.getNumberOfAtoms();r>=1?(e=d(!0).duration(150),c(e,"translation-end-s0"),e=d().duration(800),c(e,"translation-end-s1",function(e){n.translationCompleted(),e.selectAll(".bonds").duration(150)}),e=d().duration(800),c(e,"translation-end-s2",function(e){e.selectAll(".bonds").duration(150)}),e=d().duration(500),c(e,"translation-end-s3")):(e=d(!0).duration(500),c(e,"translation-end-s3")),e=d().duration(300),c(e,"translation-end-s4"),e=d().duration(1e3),c(e,"translation-end-s5"),e=d().duration(700),c(e,"translation-end",function(){n.centerProtein(700)})}},f={setup:l,render:u},s(),f}var n=e("models/md2d/views/nucleotides"),r=e("models/md2d/views/genetic-elements-renderer"),i=e("models/md2d/views/genetic-anim-states"),o=e("cs!models/md2d/views/mutations-context-menu"),a=r.OBJECT_NAMES;return d3.selection.prototype.interrupt=function(){return this.each(function(){var e=this.__transition__;if(e){var t=-1;for(var n in e)(n=+n)>t&&(t=n);e.active=t+1}})},t}),function(){define("cs!common/layout/wrap-svg-text",["require"],function(){var e,t;return e="http://www.w3.org/2000/svg",t=window.wrapSVGText=function(t,n,r,i,o){var a,s,l,u,c,d,p,h,f,m,g,v,y,b,x,w,_,T,C;for(u=/-/gi,t.search("\n")>0?(_=t.split("\n"),h=!0,l=[]):(_=t.split(/[\s-]/),h=!1,l=function(){var e;for(e=[];m=u.exec(t);)e.push(m.index);return e}()),s=0,a=0,f=1,b=0,c=T=0,C=_.length;C>T;c=++T)w=_[c],s+=w.length+1,0===c||h||r>0&&a>r?(c>0&&(h?(b=Math.max(y.getComputedTextLength(),b),f++):(g=y.firstChild.nodeValue,g.length>_[c-1].length+1?(d=g.slice(g.length-_[c-1].length-1),y.firstChild.nodeValue=g.slice(0,g.length-_[c-1].length-1)):g.length===_[c-1].length+1&&(y.firstChild.nodeValue=g.slice(0,g.length-1)),b=Math.max(y.getComputedTextLength(),b),f++)),y=document.createElementNS(e,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",0===c?0:o),v=document.createTextNode(p),y.appendChild(v),n.appendChild(y),p=~l.indexOf(s-1)?w+"-":w+" ",c&&d&&(p=d+p)):p+=~l.indexOf(s-1)?w+"-":w+" ",y.firstChild.nodeValue=p,a=y.getComputedTextLength(),h&&(b=Math.max(y.getComputedTextLength(),b)),h||c&&c===_.length-1&&r>0&&a>r&&(g=y.firstChild.nodeValue,y.firstChild.nodeValue=g.slice(0,g.length-_[c].length-1),y=document.createElementNS(e,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",o),v=document.createTextNode(_[c]),y.appendChild(v),n.appendChild(y),f++);return 0===b&&(b=n.childNodes[0].getComputedTextLength()),x=r>b?r:b,{lines:f,width:x,textWidth:b}}})}.call(this),define("common/views/gradients",[],function(){return{createRadialGradient:function(e,t,n,r,i){var o,a,s;return a=i.select("defs"),a.empty()&&(a=i.append("defs")),s=a.select("#"+e),s.empty()?s=a.append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"):s.selectAll("stop").remove(),s.append("stop").attr("stop-color",t).attr("offset","0%"),s.append("stop").attr("stop-color",n).attr("offset","40%"),s.append("stop").attr("stop-color",r).attr("offset","80%"),s.append("stop").attr("stop-color",n).attr("offset","100%"),o="url(#"+e+")",this.mainColorOfGradient[o]=r,o},mainColorOfGradient:{},settleParens:function(e,t){var n,r,i;for(r=!1,e=e.split(""),n=0;n<e.length;n++)r?")"==e[n]?r=!1:"("==e[n]&&(e[i]=" ",i=n):"("==e[n]?t?(e[n]=" ",t=!1):(r=!0,i=n):")"==e[n]&&(e[n]=" ");return e.join("").replace(/\s+/," ").trim()},smartSplit:function(e,t){var n,r,i,o,a;for(e=this.settleParens(e,t),o=!1,i=[],r=1;r<e.length;r++)o?")"==e[r]&&(o=!1):","==e[r]||" "==e[r]?(a=e.slice(n,r).trim(),a.length>0&&i.push(this.parseWord(a)),n=r+1):"("==e[r]&&(o=!0);return r==e.length&&i.push(this.parseWord(e.slice(n,r).trim())),i},parseWord:function(e){var t,n;return t=new String(e),-1!=e.search(/(^|[^a-zA-Z])li?n?e?a?r?($|[^a-zA-Z])/)&&(t.linear=!0),-1!=e.search(/(^|[^a-zA-Z])ra?d?i?a?l?($|[^a-zA-Z])/)&&(t.radial=!0),-1!=e.search(/(^|[^a-zA-Z])gr?a?d?i?e?n?t?($|[^a-zA-Z])/)&&(t.gradient=!0),-1!=e.search(/(\(|\))/)?(t.parens=!0,t):(n=parseFloat(e),isNaN(n)||(t.number=n),-1!=e.search(/(^|[^a-zA-Z])de?g?r?e?e?s?($|[^a-zA-Z])/)&&(t.degrees=!0),-1!=e.search(/(^|[^a-zA-Z])ri?g?h?t?($|[^a-zA-Z])/)&&(t.right=!0),-1!=e.search(/(^|[^a-zA-Z])le?f?t?($|[^a-zA-Z])/)&&(t.left=!0),-1!=e.search(/(^|[^a-zA-Z])(t|u)o?p?($|[^a-zA-Z])/)&&(t.top=!0),-1!=e.search(/(^|[^a-zA-Z])bo?t?t?o?m?($|[^a-zA-Z])/)&&(t.bottom=!0),-1!=e.search(/(^|[^a-zA-Z])re?pe?a?t?($|[^a-zA-Z])/)&&(t.repeat=!0),-1!=e.search(/(^|[^a-zA-Z])re?fl?e?c?t?($|[^a-zA-Z])/)&&(t.reflect=!0),t)},interpolateStops:function(e){var t,n,r,i,o,a;if(0==e.length)return e;if("offset"in e[0]||(e[0].offset=0),1==e.length)return e;"offset"in e[e.length-1]||(e[e.length-1].offset=100);for(t=2;t<e.length;t++)if("offset"in e[t]&&!("offset"in e[t-1])){for(i=0,o=e[t].offset,n=t-2;n>=0;n--)if("offset"in e[n]){i=e[n].offset;break}a=(o-i)/(t-n);for(var r=n+1;t>r;r++)e[r].offset=i+a*(r-n)}return e},fullParse:function(e){if(e=e.trim().toLowerCase(),-1==e.search(/[^#0-9a-zA-Z-]/))return{color:e};var t,n,r,i,o,a,s,l,u,c,d;for(e=e.replace(/[\n\r:;]/g," ").replace(/\/\*.*\*\/$/,"").replace(/\{\[/,"(").replace(/\}\]/,")").replace(/[^a-zA-Z0-9%#\-\(\)\., ]*/g,"").replace(/\s*-\s+/g,"-").replace(/\s*\(/g,"(").replace(/\s+/g," "),n=this.smartSplit(e,!1),s={},a=0;a<n.length;a++)"parens"in n[a]&&("gradient"in n[a]||"linear"in n[a]||"radial"in n[a])&&n.splice.apply(n,[a,1].concat(this.smartSplit(n[a],!0)));for(r=!1,o=!1,i=!1,d=!1,u=0,c=0,a=0;a<n.length;a++)l=!1,"left"in n[a]?(u-=1,l=!0):"right"in n[a]&&(u+=1,l=!0),"top"in n[a]?(c+=1,l=!0):"bottom"in n[a]&&(c-=1,l=!0),"radial"in n[a]&&!("right"in n[a])&&(o=!0,l=!0),"linear"in n[a]&&!("left"in n[a])&&(i=!0,l=!0),"number"in n[a]&&("degrees"in n[a]||a+1<n.length&&"degrees"in n[a+1])&&(r===!1&&(r=n[a].number),l=!0),"repeat"in n[a]?(d="repeat",l=!0):"reflect"in n[a]&&(d="reflect",l=!0),(l||"degrees"in n[a]||"gradient"in n[a])&&(n.splice(a,1),a--);for(r!==!1||0==u&&0==c||(r=180*Math.atan2(c,u)/Math.PI%360),t=[],a=0;a<n.length;a++)"number"in n[a]||(a+1<n.length&&"number"in n[a+1]?(t.push({color:n[a],offset:n[a+1].number}),n.splice(a,2)):(t.push({color:n[a]}),n.splice(a,1)),a--);if(1==t.length)return{color:t[0].color};if(0==t.length)return{color:"none"};for(this.interpolateStops(t),a=0;a<n.length;a++)"number"in n[a]&&r===!1&&(r=n[a].number);return o&&!i?(r=!1,s.gradient="radial"):(r===!1&&(r=0),r%=360,0>r&&(r+=360),s.gradient="linear",s.direction=r),d!==!1&&(s.repeat=d),s.stops=t,s.standard=this.toStandardForm(s),s},parse:function(e){if(e=e.trim().toLowerCase().replace(/\s+/g," "),-1==e.search(/ /))return{color:e,standard:e};var t,n,r,i,o,a,s;if(t=e.split(" "),r={},i=t.shift(),"linear"!=i&&"radial"!=i)return this.fullParse(e);if(r.gradient=i,"linear"==i){if(n=parseFloat(t.shift()),isNaN(n))return this.fullParse(e);n%=360,0>n&&(n+=360),r.direction=n,s=!0}if(r.stops=[],t.length%2!=0)return this.fullParse(e);for(o=0;o<t.length;o+=2){if(a=parseFloat(t[o+1]),isNaN(a))return this.fullParse(e);r.stops.push({color:t[o],offset:a})}return r.standard=s?this.toStandardForm(r):e,r},toCSS:function(e,t){var n,r;if("color"in e)t.style.backgroundColor=e.color.length?e.color:"inherit",t.style.backgroundImage="none";else{for(n="radial"==e.gradient?"-webkit-radial-gradient(ellipse,":"-webkit-linear-gradient("+e.direction+"deg, ",r=0;r<e.stops.length;r++)n+=e.stops[r].color+" "+e.stops[r].offset+"%",r<e.stops.length-1&&(n+=",");n+=")",t.style.backgroundColor="none",t.style.backgroundImage=n}},toStandardForm:function(e){var t,n;if("color"in e)return e.standard=e.color,e.color;for(t=e.gradient+" "+("linear"==e.gradient?e.direction+"deg ":""),n=0;n<e.stops.length;n++)t+=e.stops[n].color+" "+e.stops[n].offset+"%",n<e.stops.length-1&&(t+=" ");return e.standard=t,t},toSVG:function(e,t){if(e.color)return e.color;var n,r,i,o,a,s,l,u,c,d;if(n=t.select("defs"),n.empty()&&(n=t.append("defs")),i=e.standard.replace(/[^a-z0-9]/g,""),r=n.select("#"+i),!r.empty())return"url(#"+i+")";for("linear"==e.gradient?(l=-Math.cos(Math.PI*e.direction/180),u=-Math.sin(Math.PI*e.direction/180),Math.abs(u)>Math.abs(l)?(a=l*Math.abs(50/u),s=50*(0>u?-1:1)):(a=50*(0>l?-1:1),s=u*Math.abs(50/l)),r=n.append("linearGradient").attr("id",i).attr("x1",50+a+"%").attr("y1",50+s+"%").attr("x2",50-a+"%").attr("y2",50-s+"%")):r=n.append("radialGradient").attr("id",i).attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx","50%").attr("fy","50%"),o=0;o<e.stops.length;o++)d=r.append("stop").attr("stop-color",e.stops[o].color).attr("offset",e.stops[o].offset+"%"),c=e.stops[o].color.split(","),4!=c.length||isNaN(c=parseFloat(c[3]))||d.attr("stop-opacity",c);return"url(#"+i+")"}}}),define("common/views/color",[],function(){function e(e){var t=e.match(/rgba\(([0-9]+),([0-9]+),([0-9]+),([0-9]+)\)/i);return null!==t?d3.rgb(t[1],t[2],t[3]):d3.rgb(e)}return{contrastingColor:function(t){return t=e(t),(299*t.r+587*t.g+114*t.b)/1e3>=128?"#000":"#fff"},color2number:function(t){return parseInt(e(t).toString().substr(1),16)}}}),define("models/md2d/views/images-renderer",["require","lab.config"],function(e){var t=e("lab.config"),n=0,r=1;return function(e,i){function o(t){if(!m[t]){m[t]={width:0,height:0};var n=new Image;n.src=t,n.onload=function(){var r=$(n).appendTo("body"),i=m[t];i.width=r.width(),i.height=r.height(),r.remove(),d3.select(e.node).selectAll("image").each(function(){d3.select(this).attr("xlink:href")===t&&d3.select(this).attr("width",a(i.width)).attr("height",a(i.height)).attr("transform",c)})}}}function a(t){return e.model2px(.01*t)}function s(){f=[[],[]],(i.properties.images||[]).forEach(function(t){var i,a,s,l,c=1===t.imageLayer?f[1]:f[0],d=u(t);t.imageHostType?(i=r,a=!1):(i=n,a=!0,s=e.model2px(t.imageX),l=e.model2pxInv(t.imageY)),o(d),c.push({imageDescription:t,src:d,x:s,y:l,referencePoint:i,capturesPointer:a,zOrder:t.imageLayerPosition||0,visible:t.visible})}),f.forEach(function(e){e.sort(function(e,t){return d3.ascending(e.zOrder,t.zOrder)})}),l()}function l(){f.forEach(function(t){t.forEach(function(t){var n,r,o,a,s=t.imageDescription,l=s.imageHostType,u=s.imageHostIndex;"Atom"===l?(n=i.getAtoms(),o=n[u].x,a=n[u].y):"RectangularObstacle"===l&&(r=i.get_obstacles(),o=r.x[u]+r.width[u]/2,a=r.y[u]+r.height[u]/2),void 0!==o&&(t.x=e.model2px(o),t.y=e.model2pxInv(a))})})}function u(n){var r,o=i.properties.imageMapping;return i.properties.imagePath?r=t.actualRoot+i.properties.imagePath:e.url&&(r=t.actualRoot+e.url.slice(0,e.url.lastIndexOf("/")+1)),r+(o[n.imageUri]||n.imageUri)}function c(e){if(e.referencePoint===n)return"";var t=m[e.src];return"translate("+-a(t.width/2)+","+-a(t.height/2)+")"}function d(){s(),d3.select(e.node).selectAll(".image-container").data(f).each(function(e){var t=d3.select(this).selectAll("image").data(e);t.enter().append("image"),t.attr({"xlink:href":function(e){return e.src},x:function(e){return e.x},y:function(e){return e.y},height:function(e){return a(m[e.src].height)},width:function(e){return a(m[e.src].width)},transform:c,"pointer-events":function(e){return e.capturesPointer?"auto":"none"}}),t.style("display",function(e){return e.visible?"":"none"}),t.exit().remove()})}function p(){l(),d3.select(e.node).selectAll(".image-container image").attr({x:function(e){return e.x},y:function(e){return e.y}})}function h(e){i=e}var f,m={};return{setup:d,update:p,bindModel:h}}}),define("models/md2d/views/renderer",["require","lab.config","common/console","common/benchmark/benchmark","models/md2d/views/atoms-renderer","models/md2d/views/bonds-renderer","models/md2d/views/vectors-renderer","models/md2d/views/field-renderer","./vdw-lines-renderer","models/md2d/views/genetic-renderer","cs!common/layout/wrap-svg-text","common/views/gradients","common/views/color","./images-renderer"],function(e){var t=e("lab.config"),n=e("common/console"),r=e("common/benchmark/benchmark"),i=e("models/md2d/views/atoms-renderer"),o=e("models/md2d/views/bonds-renderer"),a=e("models/md2d/views/vectors-renderer"),s=e("models/md2d/views/field-renderer"),l=e("./vdw-lines-renderer"),u=e("models/md2d/views/genetic-renderer"),c=e("cs!common/layout/wrap-svg-text"),d=e("common/views/gradients"),p=e("common/views/color").contrastingColor,h=e("./images-renderer");return function(e,f){function m(e,t,n){if(!t||"none"===t)return"none";var r="arrowhead-path"+t.toLowerCase().replace(/[^a-z0-9]/g,"")+(n?"start":"")+at.lineColor[e].toLowerCase().replace(/[^a-z0-9]/g,"");if(!Q[r]){var i,o;i=Tt.select("defs"),i.empty()&&(i=Tt.append("defs")),o=i.select("#"+r),o=Tt.append("marker").attr("id",r).attr("class","custom-arrow-head").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","4").attr("orient","auto"),o.append("path").attr("d",t).attr("fill",at.lineColor[e]).attr("transform",n?"translate(10, 10) rotate(180)":""),Q[r]=!0
}return"url(#"+r+")"}function g(e,t){var n,r,i="Triangle-"+t;n=Tt.select("defs"),n.empty()&&(n=Tt.append("defs")),r=n.select("#"+i).remove(),r=n.append("marker").attr("id","Triangle-"+t).attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").attr("stroke",e).attr("fill",e),r.append("path").attr("d","M 0 0 L 10 5 L 0 10 z")}function v(){var e,t;e=Tt.select("defs"),e.empty()&&(e=Tt.append("defs")),t=e.select("#glow"),t.empty()&&(t=e.append("filter").attr("id","glow").attr("x","-2").attr("y","-2").attr("width","800%").attr("height","800%"),t.append("feMorphology").attr("result","bigger").attr("in","SourceGraphic").attr("operator","dilate").attr("radius","6"),t.append("feGaussianBlur").attr("result","blurOut").attr("in","bigger").attr("stdDeviation","10"),t.append("feBlend").attr("in","SourceGraphic").attr("in2","blurOut").attr("mode","normal"))}function y(){var e="1%",t=Math.max(et,12);Ot.select("#heat-bath").empty()&&Ot.append("image").attr({id:"heat-bath",x:e,width:2*t,height:2*t,preserveAspectRatio:"xMinYMin","xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDQzMzYzKSAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9Ijk2LjIzNnB4IiBoZWlnaHQ9IjUzLjMyMXB4IiB2aWV3Qm94PSIxLjc2NCAxMy44MSA5Ni4yMzYgNTMuMzIxIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDEuNzY0IDEzLjgxIDk2LjIzNiA1My4zMjEiDQoJIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8xXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSItNjIyIiB5MT0iOTQ1LjU2MSIgeDI9Ii02MjIiIHkyPSI5MjYuNDM5OSI+DQoJPHN0b3AgIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6IzU1NTU1NSIvPg0KCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRkZGRkYiLz4NCjwvbGluZWFyR3JhZGllbnQ+DQo8cGF0aCBmaWxsPSIjRTZFN0U4IiBzdHJva2U9InVybCgjU1ZHSURfMV8pIiBzdHJva2Utd2lkdGg9IjAuNSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNzEuMzMsMTQuMzg0DQoJYy04Ljk0MiwwLTE2LjgyNyw0LjQ1OS0yMS41OTYsMTEuMjY1Yy00Ljc3LTYuODAzLTEyLjY1NS0xMS4yNjUtMjEuNTk4LTExLjI2NWMtMTQuNTY0LDAtMjYuMzczLDExLjgwNi0yNi4zNzMsMjYuMzczDQoJYzAsMTQuNTY4LDExLjgwNSwyNi4zNzQsMjYuMzczLDI2LjM3NGM4Ljk0MiwwLDE2LjgyOC00LjQ2LDIxLjU5OC0xMS4yNjZjNC43NjksNi44MDIsMTIuNjUzLDExLjI2NiwyMS41OTYsMTEuMjY2DQoJYzE0LjU2NiwwLDI2LjM3Mi0xMS44MDYsMjYuMzcyLTI2LjM3NEM5Ny43MDIsMjYuMTksODUuODk2LDE0LjM4NCw3MS4zMywxNC4zODR6Ii8+DQo8cGF0aCBmaWxsPSIjNTU1NTU1IiBkPSJNMzEuNDQ4LDQ3LjcxOVYyNy4xMzNjMC0xLjE2LTAuOTQxLTIuMS0yLjEwMi0yLjFjLTEuMTU3LDAtMi4wOTUsMC45NC0yLjA5NSwyLjF2MjAuNTg2DQoJYy0xLjM4NSwwLjc1Mi0yLjMzOCwyLjE5Ni0yLjMzOCwzLjg4MWMwLDIuNDQ3LDEuOTg2LDQuNDI4LDQuNDMzLDQuNDI4YzIuNDUxLDAsNC40MzQtMS45OCw0LjQzNC00LjQyOA0KCUMzMy43ODMsNDkuOTE2LDMyLjgzLDQ4LjQ3MSwzMS40NDgsNDcuNzE5eiIvPg0KPHBhdGggZmlsbD0iIzU1NTU1NSIgZD0iTTgwLjIwOSwzNy42NjN2LTMuOTc0YzAtNC43NzUtMy44ODItOC42NTktOC42NTMtOC42NTlTNjIuOSwyOC45MTUsNjIuOSwzMy42ODl2My45NzRoLTIuMDY3djE1Ljk3M2gyMS43Mg0KCVYzNy42NjNIODAuMjA5eiBNNjYuMjM5LDMzLjY4OWMwLTIuOTMsMi4zODQtNS4zMTYsNS4zMTMtNS4zMTZjMi45MzEsMCw1LjMxNiwyLjM4Niw1LjMxNiw1LjMxNnYzLjk3NGgtMTAuNjNWMzMuNjg5eiIvPg0KPC9zdmc+DQo=","class":"opaque-on-hover"}).append("title").text("Heatbath active"),Ot.select("#ke-gradient").empty()&&Ot.append("image").attr({id:"ke-gradient",x:"0",width:2.2*t,height:6*t,preserveAspectRatio:"xMinYMin","xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDQzMzYzKSAgLS0+DQo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgd2lkdGg9IjM5cHgiIGhlaWdodD0iMTExcHgiIHZpZXdCb3g9IjI1LjUgNC4wOTMgMzkgMTExIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDI1LjUgNC4wOTMgMzkgMTExIiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxwYXRoIGZpbGw9IiNFNkU3RTgiIGQ9Ik02MC45MTUsMTA2LjAzOGMwLDYuODEtMS4wNTMsNy45Mi03LjY4LDcuOTJsLTE0LjQ0NSwwLjI3M2MtNi42MjcsMC03LjYyNS0xLjM4NC03LjYyNS04LjE5M1YxMy41NjMNCgljMC02LjgxLDAuOTk4LTguMjIsNy42MjUtOC4yMmgxNC40NDVjNi42MjcsMCw3LjY4LDEuNDEsNy42OCw4LjIyVjEwNi4wMzh6Ii8+DQo8bGluZWFyR3JhZGllbnQgaWQ9IlNWR0lEXzFfIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk4Ni4wNDQ5IiB5MT0iMTI5MC41MjY2IiB4Mj0iOTg2LjA0NDkiIHkyPSIxMjI2LjEzMjEiPg0KCTxzdG9wICBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiNBN0E5QUMiLz4NCgk8c3RvcCAgb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojRkZGRkZGIi8+DQo8L2xpbmVhckdyYWRpZW50Pg0KPHBhdGggZmlsbD0iI0U2RTdFOCIgc3Ryb2tlPSJ1cmwoI1NWR0lEXzFfKSIgc3Ryb2tlLXdpZHRoPSIwLjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTM2Ljk3MSwyNC43NjMNCgljMC0yLjAwNSwxLjYyNC0zLjYyOCwzLjYyOC0zLjYyOGgxMC45MzdjMi4wMDQsMCwzLjYyOCwxLjYyMiwzLjYyOCwzLjYyOHY2OC40NThjMCwyLjAwMy0xLjYyNCwzLjYyOS0zLjYyOCwzLjYyOUg0MC41OTkNCgljLTIuMDA0LDAtMy42MjgtMS42MjUtMy42MjgtMy42MjlWMjQuNzYzeiIvPg0KPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8yXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjQ1LjU4ODkiIHkxPSI4OTAuMDQ1MiIgeDI9IjEyNDUuNTg4OSIgeTI9Ijk2Mi4yNiIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgtMSAwIDAgMSAxMjkxLjYyODkgLTg2Ny4yMzgzKSI+DQoJPHN0b3AgIG9mZnNldD0iMC4wMDQzIiBzdHlsZT0ic3RvcC1jb2xvcjojRUY0MTM2Ii8+DQoJPHN0b3AgIG9mZnNldD0iMC4xNjUzIiBzdHlsZT0ic3RvcC1jb2xvcjojRjE2MDRCIi8+DQoJPHN0b3AgIG9mZnNldD0iMC41MTg5IiBzdHlsZT0ic3RvcC1jb2xvcjojRjc5RTg1Ii8+DQoJPHN0b3AgIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6I0ZGRkZGRiIvPg0KPC9saW5lYXJHcmFkaWVudD4NCjxwYXRoIGZpbGw9InVybCgjU1ZHSURfMl8pIiBkPSJNNDIuODI3LDk1LjAyM2MtMi4yMTUsMC00LjAwOS0xLjc5Ni00LjAwOS00LjAxMVYyNi44OTNjMC0yLjI1NywxLjgyOC00LjA4Niw0LjA4NS00LjA4Nmg2LjI3NA0KCWMyLjI1NywwLDQuMDg2LDEuODI5LDQuMDg2LDQuMDg2djY0LjExOWMwLDIuMjE1LTEuNzk1LDQuMDExLTQuMDExLDQuMDExSDQyLjgyN3oiLz4NCjxyZWN0IHg9IjE0LjM5NyIgeT0iOS42MDciIGZpbGw9Im5vbmUiIHdpZHRoPSI2MS4zNiIgaGVpZ2h0PSIxNC44MTIiLz4NCjx0ZXh0IHRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIDEgMzQuNjA2IDE3LjAxMjkpIiBmb250LWZhbWlseT0iJ0FyaWFsTVQnIiBmb250LXNpemU9IjkuNDc5OCI+SElHSDwvdGV4dD4NCjxyZWN0IHg9IjE0LjM5NyIgeT0iMTAzLjAzMyIgZmlsbD0ibm9uZSIgd2lkdGg9IjYxLjM2IiBoZWlnaHQ9IjE0LjgxMiIvPg0KPHRleHQgdHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgMSAzNS4yOTMgMTA4LjY2OTIpIiBmb250LWZhbWlseT0iJ0FyaWFsTVQnIiBmb250LXNpemU9IjkuNDc5OCI+TE9XPC90ZXh0Pg0KPC9zdmc+DQo=","class":"opaque-on-hover"}).append("title").text("Kinetic energy gradient")}function b(){var e,t,n=f.get("temperatureControl"),r=f.get("keShading"),i=0,o=1,a=Math.max(et,12);n?(i+=o,e=Ot.select("#heat-bath").attr({y:i,width:2*a,height:2*a}).style("display",""),t=parseInt(e.attr("height"),10),i+=t):Ot.select("#heat-bath").style("display","none"),r?(i+=o,Ot.select("#ke-gradient").attr({y:i,width:2.2*a,height:6*a}).style("display","")):Ot.select("#ke-gradient").style("display","none")}function x(){mt.enter().append("path").attr({"class":"atomTrace",d:M,"stroke-width":J(.01),stroke:ft,fill:"none","stroke-dasharray":"6, 6"})}function w(){var e=tt.enter().append("g");e.attr("class","obstacle").attr("transform",function(e,t){return"translate("+J(nt.x[t])+" "+K(nt.y[t]+nt.height[t])+")"}),e.append("rect").attr({"class":"obstacle-shape",x:0,y:0,width:function(e,t){return J(nt.width[t])},height:function(e,t){return J(nt.height[t])},fill:function(e,t){return nt.visible[t]?d.toSVG(d.parse(nt.color[t]),Tt):"transparent"},"stroke-width":function(e,t){return nt.visible[t]?.2:0},stroke:function(e,t){return nt.visible[t]?d.toSVG(d.parse(nt.color[t]),Tt):"transparent"}}),e.each(function(e,t){if(nt.displayExternalAcceleration[t]&&(nt.externalAx[t]||nt.externalAy[t])){var n,r,i=d3.select(this),o=nt.height[t],a=nt.width[t],s=nt.externalAx[t],l=nt.externalAy[t],u=.06,c=.06;s&&(n=(o-2*c)/Math.round((o-2*c)/.2),r=d3.range(c,o,n),i.selectAll("path.obstacle-force-hor").data(r).enter().append("path").attr({"class":"obstacle-force-hor",d:function(e){return 0>s?"M "+J(a+u+c)+","+J(e)+" L "+J(a+c)+","+J(e):"M "+J(-u-c)+","+J(e)+" L "+J(-c)+","+J(e)}})),l&&(n=(a-2*c)/Math.round((a-2*c)/.2),r=d3.range(c,a,n),i.selectAll("path.obstacle-force-vert").data(r).enter().append("path").attr({"class":"obstacle-force-vert",d:function(e){return 0>l?"M "+J(e)+","+J(-u-c)+" L "+J(e)+","+J(-c):"M "+J(e)+","+J(o+u+c)+" L "+J(e)+","+J(o+c)}})),i.selectAll("path.obstacle-force-hor, path.obstacle-force-vert").attr({"marker-end":Yt?"":"url(#Triangle-force)","stroke-width":J(ct),stroke:ut,fill:"none"})}})}function _(){var e,t=[it,ot];for(e=0;e<t.length;e++){var n=t[e].enter().append("g");n.attr("class","shape").attr("transform",function(e){return"translate("+J(rt.x[e.index])+" "+K(rt.y[e.index]+rt.height[e.index])+")"}),n.append("rect").attr({"class":"shape-rectangle",x:0,y:0,width:function(e){return J(rt.width[e.index])},height:function(e){return J(rt.height[e.index])},fill:function(e){return rt.visible[e.index]&&"rectangle"===rt.type[e.index]?d.toSVG(d.parse(rt.color[e.index]),Tt):"transparent"},"stroke-width":function(e){return rt.lineWeight[e.index]},"stroke-dasharray":function(e){return rt.lineDashes[e.index]},stroke:function(e){return rt.visible[e.index]&&"rectangle"===rt.type[e.index]?rt.lineColor[e.index]:"transparent"}}),n.append("ellipse").attr({"class":"shape-ellipse",cx:function(e){return J(rt.width[e.index])/2},cy:function(e){return J(rt.height[e.index])/2},rx:function(e){return J(rt.width[e.index])/2},ry:function(e){return J(rt.height[e.index])/2},fill:function(e){return rt.visible[e.index]&&"ellipse"===rt.type[e.index]?d.toSVG(d.parse(rt.color[e.index]),Tt):"transparent"},"stroke-width":function(e){return rt.lineWeight[e.index]},"stroke-dasharray":function(e){return rt.lineDashes[e.index]},stroke:function(e){return rt.visible[e.index]&&"ellipse"===rt.type[e.index]?rt.lineColor[e.index]:"transparent"}})}}function T(e){var t,n,r,i,o,a,s,l,u,c,d=J(e.fontSize);return t=e.x,n=e.y,e.hostType&&($t=!1,"Atom"===e.hostType?(r=z[e.hostIndex].x,i=z[e.hostIndex].y):(r=nt.x[e.hostIndex]+nt.width[e.hostIndex]/2,i=nt.y[e.hostIndex]+nt.height[e.hostIndex]/2)),e.hostType&&!e.calloutPoint&&(t=r,n=i),e.calloutPoint&&(e.hostType?(u=r,c=i):(u=e.calloutPoint[0],c=e.calloutPoint[1])),s=J(t),l=K(n),o=s+.75*d,a=l+1.2*d,u=J(u),c=K(c),[o,a,s,l,u,c]}function C(e,t,n,r,i){var o=[parseFloat(e[0]),parseFloat(e[1])],a=[parseFloat(t.getAttribute("x"))+n/2,parseFloat(t.getAttribute("y"))+r/2],s=Ht-Math.atan((o[0]-a[0])/(o[1]-a[1])),l=Math.min(i,r/2),u=Math.sin(s)*l,c=Math.cos(s)*l;return a[0]+u+", "+(a[1]-c)+" "+(a[0]-u)+", "+(a[1]+c)+" "+o}function A(){var e,t=[Nt,wt];e=function(e){var n=t[e-1],r=dt.filter(function(t){return t.layer===e});n.selectAll("g.textBoxWrapper rect").data(r.filter(function(e){return e.frame})).attr({x:function(e){return T(e)[2]},y:function(e){return T(e)[3]},transform:function(e){var t=e.rotate,n=T(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"}}),n.selectAll("g.textBoxWrapper text").data(r).attr({y:function(e){return $(this).find("tspan").attr("x",T(e)[0]),T(e)[1]}}),n.selectAll("g.textBoxWrapper polygon").data(r.filter(function(e){return e.calloutPoint})).attr({"callout-location-data":function(e){var t=T(e);return t[4]+", "+t[5]}})},e(1),e(2),$(".textBox").each(function(){var e,t,n,r,i=$(this.parentNode),o=i.find("polygon"),a=i.find("rect")[0];a&&0!==o.length&&(e=parseFloat(this.getAttributeNS(null,"font-size")),t=a.getAttribute("width"),n=a.getAttribute("height"),r=o.attr("callout-location-data").split(", "),o.attr("points",C(r,a,t,n,e)))})}function S(){var e,r,i,o="Chrome"===qt.browser&&!!qt.oscpu.match(/Windows|Mac OS X/);dt=f.get("textBoxes"),e=[f.get("width"),f.get("height")],r=[Nt,wt],i=function(i){var a,s,l,u=r[i-1];u.selectAll("g.textBoxWrapper").remove(),s=dt.filter(function(e){return e.layer===i}),l=u.selectAll("g.textBoxWrapper").data(s),a=l.enter().append("svg:g").attr("class","textBoxWrapper"),a.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*et,r=e.strokeOpacity,i=e.strokeColor;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:"+i+";stroke-width:"+2*n+";stroke-opacity:"+r},"callout-location-data":function(e){var t=T(e);return t[4]+", "+t[5]}}),a.filter(function(e){return e.frame}).append("rect").attr({"class":function(e,t){return"textBoxFrame text-"+t},id:function(e,t){return"text-"+t},transform:function(e){var t=e.rotate,n=T(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*et,r=e.strokeOpacity,i=e.strokeColor;return o&&1>n&&(r*=n,n=1),"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:"+i+";stroke-width:"+n+";stroke-opacity:"+r},width:0,height:0,rx:function(e){return"rounded rectangle"===e.frame?J(e.fontSize)/2.5:0},ry:function(e){return"rounded rectangle"===e.frame?J(e.fontSize)/2:0},x:function(e){return T(e)[2]},y:function(e){return T(e)[3]}}),a.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:0;"}}),a.append("text").attr({"class":function(){return"textBox"+(AUTHORING?" draggable":"")},transform:function(e){var t=e.rotate,n=T(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},"x-data":function(e){return T(e)[0]},y:function(e){return T(e)[1]},"width-data":function(e){return e.width},"height-data":function(e){return e.height},width:J(e[0]),height:J(e[1]),"xml:space":"preserve","font-family":"'"+t.fontface+"', sans-serif","font-size":function(e){return J(e.fontSize)+"px"},fill:function(e){return e.color||"black"},"text-data":function(e){return e.text},"text-anchor":function(e){var t=e.textAlign||"left";return"center"===t&&(t="middle"),t},"has-host":function(e){return!!e.hostType}}).call(d3.behavior.drag().on("drag",O).on("dragend",function(e){n.log('"x": '+e.x+","),n.log('"y": '+e.y+",")})),l.exit().remove()},i(1),i(2),$(".textBox").each(function(){var e,t,n,r,i,o,a,s,l,u,d,p=this.getAttributeNS(null,"text-data"),h=this.getAttributeNS(null,"x-data"),f=this.getAttributeNS(null,"width-data"),m=this.getAttributeNS(null,"height-data"),g=parseFloat(this.getAttributeNS(null,"font-size")),v=this.getAttributeNS(null,"transform"),y=this.getAttributeNS(null,"has-host"),b=this.getAttributeNS(null,"text-anchor"),x=$(this.parentNode);for(a=1.2*g,e=1.5*+g,t=g/1.8,f=""===f?-1:J(f),m=""===m?-1:J(m);this.firstChild;)this.removeChild(this.firstChild);n=c(p,this,f,h,a),x.find("rect").length>0&&(o=x.find("rect")[0],r=n.width+e,o.setAttributeNS(null,"width",r),i=m>0?m:n.lines*a+t,o.setAttributeNS(null,"height",i)),u=x.find("polygon"),o&&u.length>0&&(d=u.attr("callout-location-data").split(", "),u.attr("points",C(d,o,r,i,g))),"middle"===b&&(s=n.width/2,l=m>0?m/2-1.5*t-(n.lines-1)*a/2:0,v=v+" translate("+s+","+l+")",$(this).attr("transform",v)),"true"===y&&0===u.length&&(s=n.width/-2-e/2,l=n.lines*a/-2-t/2,x.attr("transform","translate("+s+","+l+")"))})}function P(){nt=f.get_obstacles(),Tt.selectAll("g.obstacle").remove(),nt&&(Gt.length=nt.x.length,tt=Tt.selectAll("g.obstacle").data(Gt),w())}function E(){if(rt=f.get_shapes(),Rt.selectAll(".shape").remove(),xt.selectAll(".shape").remove(),rt){Ut=[],zt=[];for(var e=0;e<rt.x.length;e++)1===rt.layer[e]?Ut.push({index:e,layerPosition:rt.layerPosition[e]}):zt.push({index:e,layerPosition:rt.layerPosition[e]});Ut.sort(function(e,t){return e.layerPosition-t.layerPosition}),zt.sort(function(e,t){return e.layerPosition-t.layerPosition}),it=Rt.selectAll(".shape").data(Ut),ot=xt.selectAll(".shape").data(zt),_()}}function k(){at=f.get_lines(),Wt.length=at.x1.length,st=Mt.selectAll(".line").data(Wt),st.exit().remove(),at&&(st.enter().append("line"),st.attr({"class":"line",x1:function(e,t){return J(at.x1[t])},y1:function(e,t){return K(at.y1[t])},x2:function(e,t){return J(at.x2[t])},y2:function(e,t){return K(at.y2[t])},"stroke-width":function(e,t){return at.lineWeight[t]},"stroke-dasharray":function(e,t){return at.lineDashes[t]},stroke:function(e,t){return at.lineColor[t]},"marker-start":function(e,t){return m(t,at.beginStyle[t],!0)},"marker-end":function(e,t){return m(t,at.endStyle[t])},visibility:function(e,t){return at.visible[t]?"visible":"hidden"}}))}function R(){Tt.selectAll("path.atomTrace").remove(),gt="",pt=f.get("showAtomTrace"),ht=f.get("atomTraceId"),pt&&(mt=Tt.selectAll("path.atomTrace").data([z[ht]]),x())}function M(e){var t,n,r=Math.floor(100*J(e.x))/100,i=Math.floor(100*K(e.y))/100;return gt?(gt+=r+","+i+" ",gt.length>4e3&&(t=gt.indexOf("L"),n=gt.indexOf(" "),gt="M"+gt.slice(t+1,n)+"L"+gt.slice(n+1)),gt):(gt="M"+r+","+i+"L","M "+r+","+i)}function N(){mt.attr({d:M})}function O(e){var t=J.invert(d3.event.dx),n=J.invert(d3.event.dy);AUTHORING&&f.isStopped()&&(e.x=e.x+t,e.y=e.y-n,A())}function L(){function t(t,n,r){if(t()){var i=e.$el.parent().find("#"+n);0===i.length&&(i=$("<div id='"+n+"' class='warning-pane'>"+r+"</div>"),i.on("click",function(){$(this).fadeOut()}),i.appendTo(e.$el.parent()));var o=e.pos();i.css({width:o.width-20,top:o.bottom-i.height()-10,left:o.left+10})}}var n=r.what_browser();t(function(){return"Firefox"===n.browser&&n.version>="18"&&n.version<"23"},"ff1823warning","<a href='http://blog.concord.org/serious-performance-regression-in-firefox-18-and-newer' class='opens-in-new-window' target='_blank'>Firefox v18-22 performance issue...</a>)"),t(function(){return"Firefox"===n.browser&&-1!==n.oscpu.indexOf("Windows")&&n.version>="27"&&n.version<"28"},"ff27warning","Because of a problem in Firefox 27 with certain types of graphics (SVG), you may see minor visual problems with some models. We recommend using another browser until Firefox 28 becomes available."),t(function(){return f.get("DNA")&&"Safari"===n.browser&&0===n.version.indexOf("6.1")},"saf61DNAwarning","This model may have visual problems on Safari 6. We recommend upgrading Safari, or using another browser.")}function I(){ut=f.get("forceVectors").color,ct=f.get("forceVectors").width,g(ut,"force"),Q={},Tt.selectAll(".custom-arrow-head").remove(),ft=f.get("atomTraceColor")}function D(){lt=f.properties.useQuantumDynamics,lt&&v(),y(),Z=new u(e,f)}function B(e){var t,n=[],r=40,i=d3.svg.line().x(function(e){return J(.5/r*e.x)}).y(function(e){return J(.1*e.y)}),o=2*e.angularFrequency*Math.PI/r;for(t=0;r>t;t++)n.push({x:t-r/2,y:Math.sin(t*o)/(1+.01*(t-.5*r)*(t-.5*r))});return i(n)}function V(){var e=Tt.selectAll(".photon").data(f.getPhotons(),function(e){return e.id});e.enter().append("path").attr({"class":"photon",d:B,"stroke-width":.5,stroke:"rgba(0,0,0,0.8)","fill-opacity":0}),e.exit().remove(),e.attr("transform",function(e){return"translate("+J(e.x)+", "+K(e.y)+") rotate("+e.angle+")"})}function F(){function t(t){return function(){t(),e.updateClickHandlers()}}function n(){Ft.setup(),e.renderCanvas()}J=e.model2px,K=e.model2pxInv,et=e.getFontSizeInPixels(),z=f.getAtoms(),W=f.getElectricField(),q=f.get_elements(),H=f.get("width"),Y=f.get("height"),X=H/Y,D(),f.addPropertiesListener(["temperatureControl","keShading"],b),f.addPropertiesListener(["chargeShading","showChargeSymbols","useThreeLetterCode","showAtomTrace","atomTraceId","aminoAcidColorScheme","backgroundColor","markColor","forceVectorsDirectionOnly"],t(G)),f.addPropertiesListener(["electricFieldDensity","showElectricField","electricFieldColor"],n),f.addPropertiesListener(["showVelocityVectors","velocityVectors"],function(){Bt.setup(),e.renderCanvas()}),f.addPropertiesListener(["showForceVectors","forceVectors","forceVectorsDirectionOnly"],function(){Vt.setup(),e.renderCanvas()}),f.addPropertiesListener(["showVDWLines","VDWLinesCutoff"],function(){Dt.setup(),e.renderCanvas()}),f.on("addAtom",t(function(){Lt.setup(),Bt.setup(),Vt.setup(),Ft.update(),e.renderCanvas()})),f.on("removeAtom",t(function(){Lt.setup(),Bt.setup(),Vt.setup(),Ft.update(),e.renderCanvas()})),f.on("addRadialBond",t(function(){It.setup(),e.renderCanvas()})),f.on("removeRadialBond",t(function(){It.setup(),e.renderCanvas()})),f.on("textBoxesChanged",t(S)),f.on("imagesChanged",t(jt.setup)),f.on("addElectricField",n),f.on("removeElectricField",n),f.on("changeElectricField",n),L(),yt=!0}function j(e){f=e,Lt.bindModel(e),It.bindModel(e),Dt.bindModel(e),jt.bindModel(e),F()}function G(t,n){arguments.length&&(J=t,K=n),et=e.getFontSizeInPixels(),I(),P(),Lt.setup(),It.setup(),Dt.setup(),E(),k(),Z.setup(),Bt.setup(),Vt.setup(),Ft.setup(),R(),jt.setup(),S(),b(),L(),lt&&V()}function U(){n.time("view update"),nt&&tt.attr("transform",function(e,t){return"translate("+J(nt.x[t])+" "+K(nt.y[t]+nt.height[t])+")"}),rt&&(it.attr("transform",function(e){return"translate("+J(rt.x[e.index])+" "+K(rt.y[e.index]+rt.height[e.index])+")"}),ot.attr("transform",function(e){return"translate("+J(rt.x[e.index])+" "+K(rt.y[e.index]+rt.height[e.index])+")"})),Lt.update(),It.update(),Dt.update(),Bt.update(),Vt.update(),Ft.update(),pt&&N(),f.properties.images&&0!==f.properties.images.length&&jt.update(),dt&&dt.length>0&&!$t&&A(),lt&&V(),n.timeEnd("view update")}var z,W,q,H,Y,X,J,K,Z,Q,et,tt,nt,rt,it,ot,at,st,lt,ut,ct,dt,pt,ht,ft,mt,gt,vt={},yt=!1,bt=e.appendViewport().classed("below-atoms",!0),xt=bt.append("g").attr("class","shape-container-below"),wt=(bt.append("g").attr("class","image-container image-container-below"),bt.append("g").attr("class","text-container-below")),_t=e.appendViewport().classed("atoms",!0),Tt=_t.append("g").attr("class","atoms-container"),Ct=e.appendPixiViewport(),At=e.appendPixiViewport(),St=e.appendPixiViewport(),Pt=e.appendPixiViewport(),Et=e.appendPixiViewport(),kt=e.appendViewport().classed("above-atoms",!0),Rt=kt.append("g").attr("class","shape-container-top"),Mt=kt.append("g").attr("class","line-container-top"),Nt=(kt.append("g").attr("class","image-container image-container-top"),kt.append("g").attr("class","text-container-top")),Ot=e.foregroundContainer.append("g").attr("class","icon-container"),Lt=new i(e,f,Pt.pixiContainer,Pt.canvas),It=new o(e,f,St.pixiContainer,Lt),Dt=new l(e,f,At.pixiContainer),Bt=new a(Et.pixiContainer,{get show(){return f.get("showVelocityVectors")},get length(){return f.get("velocityVectors").length},get width(){return f.get("velocityVectors").width},get color(){return f.get("velocityVectors").color},get dirOnly(){return!1},get count(){return z.length},x:function(e){return z[e].x},y:function(e){return z[e].y},vx:function(e){return 100*z[e].vx},vy:function(e){return 100*z[e].vy},m2px:e.model2canvas,m2pxInv:e.model2canvasInv}),Vt=new a(Et.pixiContainer,{get show(){return f.get("showForceVectors")},get length(){return f.get("forceVectors").length},get width(){return f.get("forceVectors").width},get color(){return f.get("forceVectors").color},get dirOnly(){return f.get("forceVectorsDirectionOnly")},get count(){return z.length},x:function(e){return z[e].x},y:function(e){return z[e].y},vx:function(e){var t=z[e];return t.ax*t.mass*100},vy:function(e){var t=z[e];return t.ay*t.mass*100},m2px:e.model2canvas,m2pxInv:e.model2canvasInv}),Ft=new s(Ct.pixiContainer,{get show(){return f.get("showElectricField")},get length(){return.8*f.get("width")/f.get("electricFieldDensity")},get color(){var e=f.get("electricFieldColor");return"auto"!==e?e:p(f.get("backgroundColor"))},get count(){return W.length},x:function(e){return W[e].x},y:function(e){return W[e].y},vx:function(e){return W[e].fx},vy:function(e){return W[e].fy},alpha:function(e){var t=W[e];return Math.min(1,.3*Math.pow(t.fx*t.fx+t.fy*t.fy,.2))},m2px:e.model2canvas,m2pxInv:e.model2canvasInv}),jt=new h(e,f),Gt=[],Ut=[],zt=[],Wt=[],$t=!0,qt=r.what_browser(),Ht=Math.PI/2,Yt="MSIE"===qt.browser&&Number(qt.version)>=10;return vt={setup:function(){yt||F()},update:function(){yt&&U()},repaint:function(){yt&&G()},bindModel:j}}}),define("models/md2d/views/view",["require","common/views/svg-container","models/md2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/md2d/views/renderer");return function(e,r){return new t(e,r,n)}}),define("models/md2d/views/dna-edit-dialog",[],function(){return function(e){var t,n,r,i,o,a=function(){n=$("<div></div>"),r=$('<input type="text" id="dna-sequence-input" size="55"></input>'),r.appendTo(n),i=$('<p class="error"></p>'),i.appendTo(n),n.dialog({dialogClass:"dna-edit-dialog",appendTo:".lab-responsive-content",title:"DNA Code on Sense Strand",autoOpen:!1,width:"35em",buttons:{Apply:function(){e.set({DNA:r.val()}),$(this).dialog("close")}}}),o=$(".dna-edit-dialog button:contains('Apply')"),r.on("input",function(){try{e.getPropertyValidateFunc("DNA")(r.val()),o.button("enable"),i.text("")}catch(t){o.button("disable"),i.text(t.message)}})};return t={open:function(){i.text(""),o.removeAttr("disabled"),r.val(e.get("DNA")),n.dialog("open")}},a(),t}}),define("models/md2d/controllers/scripting-api",["require","models/md2d/views/dna-edit-dialog"],function(e){var t=e("models/md2d/views/dna-edit-dialog");return function(e){function n(t){return function(n,r){try{e.model[t].call(e.model,n)}catch(i){if(!r||!r.silent)throw i}e.api.repaintIfReady()}}var r=null,i=0,o=function(){var t,n=arguments[0],r=arguments[1];Array.isArray(r)?(t=Array.prototype.slice.call(arguments,2,arguments.length),e.api.batch(function(){for(var e=0,i=r[0];e<r.length;i=r[++e])n.apply(null,Array.prototype.concat(i,t))})):(t=Array.prototype.slice.call(arguments,1,arguments.length),n.apply(null,t)),e.api.repaintIfReady()};return{getCurrentComputerTime:function(){return Date.now()},getNumberOfAtoms:function(t){return e.model.getNumberOfAtoms(t)},getNumberOfObstacles:function(){return e.model.getNumberOfObstacles()},getNumberOfElements:function(){return e.model.getNumberOfElements()},getNumberOfRadialBonds:function(){return e.model.getNumberOfRadialBonds()},getNumberOfAngularBonds:function(){return e.model.getNumberOfAngularBonds()},addAtom:function(t){return e.model.addAtom(t)},removeAtom:function(t,n){try{e.model.removeAtom(t,n)}catch(r){if(!n||!n.silent)throw r}},removeRadialBond:function(t,n){try{e.model.removeRadialBond(t)}catch(r){if(!n||!n.silent)throw r}e.api.repaintIfReady()},removeAngularBond:function(t,n){try{e.model.removeAngularBond(t)}catch(r){if(!n||!n.silent)throw r}e.api.repaintIfReady()},addRadialBond:function(t){e.model.addRadialBond(t),e.api.repaintIfReady()},addAngularBond:function(t){e.model.addAngularBond(t),e.api.repaintIfReady()},addRandomAtom:function(){return e.model.addRandomAtom.apply(e.model,arguments)},adjustTemperature:function(t){e.model.set({targetTemperature:t*e.model.get("targetTemperature")})},setTemperatureOfAllAtoms:function(t){for(var n=[],r=0;r<e.model.getNumberOfAtoms();r++)n.push(r);e.model.setTemperatureOfAtoms(n,t)},setTemperatureOfAtoms:function(t,n){e.model.setTemperatureOfAtoms(t,n)},addKEToAtoms:function(t,n){e.model.addKEToAtoms(t,n)},getTemperatureOfAllAtoms:function(){for(var t=[],n=0;n<e.model.getNumberOfAtoms();n++)t.push(n);return e.model.getTemperatureOfAtoms(t)},getTemperatureOfAtoms:function(t){return e.model.getTemperatureOfAtoms(t)},limitHighTemperature:function(t){e.model.get("targetTemperature")>t&&e.model.set({targetTemperature:t})},randomAtoms:function(t){var n=e.model.getNumberOfAtoms();if(null===t&&(t=1+e.api.randomInteger(n-1)),!e.api.isInteger(t))throw new Error("randomAtoms: number of atoms requested, "+t+", is not an integer.");if(0>t)throw new Error("randomAtoms: number of atoms requested, "+t+", was less be greater than zero.");return t>n&&(t=n),e.api.choose(t,n)},turnOnLightSource:function(){e.model.turnOnLightSource()},turnOffLightSource:function(){e.model.turnOffLightSource()},setLightSourceAngle:function(t){e.model.setLightSourceAngle(t)},setLightSourceFrequency:function(t){e.model.setLightSourceFrequency(t)},setLightSourcePeriod:function(t){e.model.setLightSourcePeriod(t)},setLightSourceNumber:function(t){e.model.setLightSourceNumber(t)},setBondEnergy:function(t,n){e.model.setBondEnergy(t,n)},setValenceElectrons:function(t,n){e.model.setValenceElectrons(t,n),e.api.repaintIfReady()},atomsWithinCircle:function(t,n,r,i){var o,a,s,l,u=[];for(s=0,l=e.model.getNumberOfAtoms();l>s;s++)o=e.model.getAtomProperties(s),("undefined"==typeof i||o.element===i)&&(a=Math.sqrt(Math.pow(t-o.x,2)+Math.pow(n-o.y,2)),r>=a&&u.push(s));return u},atomsWithinRect:function(t,n,r,i,o){var a,s,l,u,c,d,p=[];for(c=0,d=e.model.getNumberOfAtoms();d>c;c++)a=e.model.getAtomProperties(c),("undefined"==typeof o||a.element===o)&&("undefined"==typeof i?(s=Math.sqrt(Math.pow(t-a.x,2)+Math.pow(n-a.y,2)),r>=s&&p.push(c)):(l=a.x>=t&&a.x<=t+r,u=a.y>=n&&a.y<=n+i,l&&u&&p.push(c)));return p},atomsWithinTriangle:function(t,n,r,i,o,a,s){function l(e,s){var l=[o-t,a-n],u=[r-t,i-n],c=[e-t,s-n],d=l[0]*l[0]+l[1]*l[1],p=l[0]*u[0]+l[1]*u[1],h=l[0]*c[0]+l[1]*c[1],f=u[0]*u[0]+u[1]*u[1],m=u[0]*c[0]+u[1]*c[1],g=1/(d*f-p*p),v=(f*h-p*m)*g,y=(d*m-p*h)*g;return v>=0&&y>=0&&1>v+y}var u,c,d,p=[];for(c=0,d=e.model.getNumberOfAtoms();d>c;c++)u=e.model.getAtomProperties(c),("undefined"==typeof s||u.element===s)&&l(u.x,u.y)&&p.push(c);return p},markAtoms:function(t){var n,r;if(0!==arguments.length){for(e.api.isArray(arguments[0])||(t=arguments),e.api.unmarkAllAtoms(),n=0,r=t.length;r>n;n++)e.model.setAtomProperties(t[n],{marked:1});e.api.repaintIfReady()}},unmarkAllAtoms:function(){for(var t=0,n=e.model.getNumberOfAtoms();n>t;t++)e.model.setAtomProperties(t,{marked:0});e.api.repaintIfReady()},traceAtom:function(t){null!==t&&(e.model.set({atomTraceId:t}),e.model.set({showAtomTrace:!0}))},untraceAtom:function(){e.model.set({showAtomTrace:!1})},setAtomProperties:function(t,n,r,i){o(e.model.setAtomProperties,t,n,r,i)},atomTransition:function(){return e.model.atomTransition()},getAtomProperties:function(t){return e.model.getAtomProperties(t)},getRadialBondsForAtom:function(t){return e.model.getRadialBondsForAtom(t)},getAngularBondsForAtom:function(t){return e.model.getAngularBondsForAtom(t)},getMoleculeAtoms:function(t){return e.model.getMoleculeAtoms(t)},setElementProperties:function(t,n){o(e.model.setElementProperties,t,n)},setPairwiseLJProperties:function(t,n,r){e.model.getPairwiseLJProperties().set(t,n,r)},getElementProperties:function(t){return e.model.getElementProperties(t)},addObstacle:n("addObstacle"),addShape:n("addShape"),addLine:n("addLine"),setObstacleProperties:function(t,n){o(e.model.setObstacleProperties,t,n)},getObstacleProperties:function(t){return e.model.getObstacleProperties(t)},removeObstacle:function(t,n){try{e.model.removeObstacle(t)}catch(r){if(!n||!n.silent)throw r}e.api.repaintIfReady()},setShapeProperties:function(t,n){o(e.model.setShapeProperties,t,n)},getShapeProperties:function(t){return e.model.getShapeProperties(t)},setLineProperties:function(t,n){o(e.model.setLineProperties,t,n)},getLineProperties:function(t){return e.model.getLineProperties(t)},addElectricField:function(t,n){try{e.model.addElectricField(t)}catch(r){if(!n||!n.silent)throw r}},removeElectricField:function(t,n){try{e.model.removeElectricField(t)}catch(r){if(!n||!n.silent)throw r}},setElectricFieldProperties:function(t,n){e.model.setElectricFieldProperties(t,n)},getElectricFieldProperties:function(t){return e.model.getElectricFieldProperties(t)},getAtomsWithinShape:function(t){var n=e.model.getShapeProperties(t);return this.atomsWithinRect(n.x,n.y,n.width,n.height)},removeShape:function(t,n){try{e.model.removeShape(t)}catch(r){if(!n||!n.silent)throw r}e.api.repaintIfReady()},removeLine:function(t,n){try{e.model.removeLine(t)}catch(r){if(!n||!n.silent)throw r}e.api.repaintIfReady()},setRadialBondProperties:function(t,n){e.model.setRadialBondProperties(t,n),e.api.repaintIfReady()},getRadialBondProperties:function(t){return e.model.getRadialBondProperties(t)},setAngularBondProperties:function(t,n){e.model.setAngularBondProperties(t,n),e.api.repaintIfReady()},getAngularBondProperties:function(t){return e.model.getAngularBondProperties(t)},openDNADialog:function(){null==r&&(r=new t(e.model)),r.open()
},jumpToNextDNAState:function(){e.model.geneticEngine().jumpToNextState()},jumpToPrevDNAState:function(){e.model.geneticEngine().jumpToPrevState()},DNAStateBefore:function(t){return e.model.geneticEngine().stateBefore(t)},DNAStateAfter:function(t){return e.model.geneticEngine().stateAfter(t)},animateToNextDNAState:function(){e.model.geneticEngine().transitionToNextState()},animateToDNAState:function(t){e.model.geneticEngine().transitionTo(t)},stopDNAAnimation:function(){e.model.geneticEngine().stopTransition()},transcribeDNAStep:function(t){var n=e.model.geneticEngine();n.stateBefore("dna")||n.stateAfter("transcription-end")?(e.model.set("DNAState","dna"),n.transitionTo("transcription:0"),n.transcribeStep(t)):"transcription-end"!==e.model.get("DNAState")&&n.transcribeStep(t)},translateDNAStep:function(){var t=e.model.geneticEngine();t.stateBefore("translation:0")||t.stateAfter("translation-end")?(e.model.set("DNAState","translation:0"),t.transitionTo("translation:1")):"translation-end"!==e.model.get("DNAState")&&t.transitionToNextState()},generateRandomProtein:function(t){var n=e.model.geneticEngine().generateProtein(void 0,t);if(n!==t)throw new Error("Generated protein was truncated due to limited area of the parent.model. Only"+n+" amino acids were generated.")},setSolvent:function(t){e.model.setSolvent(t)},pe:function(){return e.model.get("potentialEnergy")},ke:function(){return e.model.get("kineticEnergy")},atomsKe:function(t){var n,r=0;for(n=0;n<t.length;n++)r+=e.model.getAtomKineticEnergy(t[n]);return r},minimizeEnergy:function(){e.model.minimizeEnergy(),e.api.repaintIfReady()},addTextBox:function(t){e.model.addTextBox(t)},removeTextBox:function(t){e.model.removeTextBox(t)},setTextBoxProperties:function(t,n){e.model.setTextBoxProperties(t,n)},getTextBoxProperties:function(t){return e.model.getTextBoxProperties(t)},getNumberOfTextBoxes:function(){return e.model.getNumberOfTextBoxes()},getNumberOfLines:function(){return e.model.getNumberOfLines()},getNumberOfShapes:function(){return e.model.getNumberOfShapes()},getImageProperties:function(t){return e.model.getImageProperties(t)},setImageProperties:function(t,n){o(e.model.setImageProperties,t,n)},repaintIfReady:function(){0===i&&e.api.repaint()},batch:function(t){++i,e.model.startBatch(),t(),e.model.endBatch(),--i,e.api.repaintIfReady()}}}}),define("models/md2d/benchmarks/benchmarks",["require","common/performance"],function(e){var t=e("common/performance"),n=5e3,r=1e3;return function(e){var i;return[{name:"atoms",numeric:!0,run:function(t){t(e.model.getNumberOfAtoms())}},{name:"temperature",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.model.get("temperature"))}},{name:"engine (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(o){e.model.start(),setTimeout(function(){e.model.stop(),t.collectData(!0),i=e.model.stepCounter(),setTimeout(function(){e.model.start(),setTimeout(function(){e.model.stop(),t.collectData(!1),o(t.getAvgTime("engine"))},n)},100)},r)}},{name:"JS rendering (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("js-rendering"))}},{name:"tick (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("tick"))}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(t.getAvgTime("gap"))}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(1e3*(e.model.stepCounter()-i)/n)}}]}}),define("models/md2d/controllers/controller",["require","common/controllers/model-controller","models/md2d/models/modeler","models/md2d/views/view","models/md2d/controllers/scripting-api","models/md2d/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("models/md2d/models/modeler"),r=e("models/md2d/views/view"),i=e("models/md2d/controllers/scripting-api"),o=e("models/md2d/benchmarks/benchmarks");return function(e,a,s){return new t(e,a,s,n,r,i,o)}}),define("models/solar-system/models/engine/constants/units",["require","exports","module"],function(e,t){var n,r,i,o=86400,a=149597870700,s=5.97219e24,l=332946,u={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",POWER:"power",FORCE:"force",VELOCITY:"velocity",ACCELERATION:"acceleration",GRAVITATIONAL_CONSTANT:"Gravitational Constant",AREA:"area",VOLUME:"volume",PRESSURE:"pressure"};t.unit=n={DAY:{name:"Day",value:1,type:u.TIME},SECOND:{name:"second",value:o,type:u.TIME},AU:{name:"au",value:1,type:u.LENGTH},METER:{name:"meter",value:a,type:u.LENGTH},EARTH_MASS:{name:"Earth Mass",value:1,type:u.MASS},KILOGRAM:{name:"kilogram",value:s,type:u.MASS},SOLAR_MASS:{name:"Solar Mass",value:l,type:u.MASS},JOULE:{name:"Joule",value:1/s*(1/a)*(1/a)/(1/o*(1/o)),type:u.ENERGY},WATT:{name:"Watt",value:1/s*(1/a)*(1/a)/(1/o*(1/o)*(1/o)),type:u.POWER},NEWTON:{name:"Newton",value:1,type:u.FORCE},METERS_PER_SECOND:{name:"meters per second",value:1/a*o,type:u.VELOCITY},METERS_PER_SECOND_PER_SECOND:{name:"meters per second per second",value:1/a*o*o,type:u.ACCELERATION},METERS_CUBED_PER_KILOGRAMS_TIMES_TIME_SQUARED:{name:"meters cubed per kilograms times second squared",value:1/a*(1/a)*(1/a)/(1/s*o*o),type:u.ACCELERATION},ASTRONOMICAL_FORCE:{name:" in Astronomical units (Earth Mass, AU, Day)",value:1*s,type:u.GRAVITATIONAL_CONSTANT},SI_GC:{name:"gravitational constant of proprtionality in SI units (kg, m, s)",value:1,type:u.GRAVITATIONAL_CONSTANT},ASTRONOMICAL_GC:{name:"gravitational constant of proprtionality in Astronomical units (Earth Mass, AU, Day)",value:1*s*o*o/(a*a*a),type:u.GRAVITATIONAL_CONSTANT}},t.ratio=r=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=i=function(e,t){var n=t&&t.from,i=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!i)throw new Error('units.convert() did not receive a "to" argument');return e*r(i,{per:n})}}),define("models/solar-system/models/engine/constants/index",["require","exports","module","./units"],function(e,t){var n,r,i=e("./units"),o=i.unit,a=i.ratio,s=i.convert,l={SOLAR_LUMINOSITY:{value:3.839e26,unit:o.WATT},ASTRONOMICAL_UNIT_DISTANCE:{value:149597870691,unit:o.METER},GRAVITATIONAL_CONSTANT:{value:6.67384e-11,unit:o.SI_GC}};t.unit=o,t.ratio=a,t.convert=s;for(n in l)l.hasOwnProperty(n)&&(r=l[n],t[n]=function(e){return{as:function(t){return i.convert(e.value,{from:e.unit,to:t})}}}(r))}),define("models/solar-system/models/engine/solar-system",["require","exports","module","arrays","common/array-types","./constants/index","common/console","common/models/engines/clone-restore-wrapper"],function(e,t){var n=e("arrays"),r=e("common/array-types"),i=e("./constants/index"),o=(i.unit,e("common/console"),e("common/models/engines/clone-restore-wrapper")),a=i.GRAVITATIONAL_CONSTANT.as(i.unit.ASTRONOMICAL_GC);t.createEngine=function(){var e,t,i,s,u,c,d,p,h,f,m,g,v,y,b,x,w,_=a,T=!1,C=[50,50],A=-25,S=-25,P=25,E=25,k=0,R=0,M=function(){L(0)},N=function(e,t){var r,i;if(Array.isArray(e))for(r=0,i=e.length;i>r;r++)n.isArray(e[r])&&(e[r]=n.extend(e[r],t));else for(r in e)e.hasOwnProperty(r)&&n.isArray(e[r])&&(e[r]=n.extend(e[r],t))},O={bodies:function(){s=b.radius,u=b.x,c=b.y,d=b.vx,p=b.vy,h=b.px,f=b.py,m=b.ax,g=b.ay,v=b.mass,y=b.speed,pinned=b.pinned}},L=function(t){b=e.bodies={},b.radius=n.create(t,0,r.float),b.x=n.create(t,0,r.float),b.y=n.create(t,0,r.float),b.vx=n.create(t,0,r.float),b.vy=n.create(t,0,r.float),b.px=n.create(t,0,r.float),b.py=n.create(t,0,r.float),b.ax=n.create(t,0,r.float),b.ay=n.create(t,0,r.float),b.mass=n.create(t,0,r.floatType),b.speed=n.create(t,0,r.float),b.pinned=n.create(t,0,r.uint8),b.marked=n.create(t,0,r.uint8),b.visible=n.create(t,0,r.uint8),O.bodies()},I=function(e){var t=s[e],n=A+t,r=S+t,i=P-t,o=E-t,a=C[0],l=C[1];if(x)u[e]+s[e]<n?u[e]+=a:u[e]-s[e]>i&&(u[e]-=a);else if(u[e]<n){for(;u[e]<n-a;)u[e]+=a;u[e]=n+(n-u[e]),d[e]*=-1,h[e]*=-1}else if(u[e]>i){for(;u[e]>i+a;)u[e]-=a;u[e]=i-(u[e]-i),d[e]*=-1,h[e]*=-1}if(w)c[e]+s[e]<r?c[e]+=l:c[e]-s[e]>o&&(c[e]-=l);else if(c[e]<r){for(;c[e]<r-l;)c[e]+=l;c[e]=r+(r-c[e]),p[e]*=-1,f[e]*=-1}else if(c[e]>o){for(;c[e]>o+l;)c[e]-=l;c[e]=o-(c[e]-o),p[e]*=-1,f[e]*=-1}},D=function(){var e;if(0!==R){for(e=0;R>e;e++)m[e]=g[e]=0;B()}},B=function(){var e,t,n,r,i,o,a,s;for(e=-1;++e<R;)for(m1=v[e],t=e;++t<R;)n=u[t]-u[e],r=c[t]-c[e],i=n*n+r*r,l=Math.sqrt(i),m2=v[t],o=_*m1*m2/i,a=n/l*o,s=r/l*o,m[e]+=a/m1,g[e]+=s/m1,m[t]-=a/m2,g[t]-=s/m2},V=function(){var e,n;for(e=0;R>e;e++)n=v[e],d[e]+=.5*m[e]*t,h[e]=n*d[e],p[e]+=.5*g[e]*t,f[e]=n*p[e]},F=function(){{var e,n,r;100*C[0],100*C[1]}for(r=0;R>r;r++)e=u[r],n=c[r],u[r]+=d[r]*t,c[r]+=p[r]*t,I(r)},j=function(){var e;for(e=0;R>e;e++)pinned[e]&&(d[e]=p[e]=m[e]=g[e]=0)},G=function(){var e;for(e=0;R>e;e++)y[e]=Math.sqrt(d[e]*d[e]+p[e]*p[e])};return e={setTime:function(e){k=e},setDimensions:function(e){if(T)throw new Error("The SolarSystem model's size has already been set, and cannot be reset.");A=e[0],S=e[1],P=e[2],E=e[3],C=[P-A,E-S],T=!0},getDimensions:function(){return[A,P,S,E]},setHorizontalWrapping:function(e){x=!!e},setVerticalWrapping:function(e){w=!!e},setGravitationalConstant:function(e){_="number"==typeof e&&0!==e?e:a},setBodyProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(b[n][e]=t[n]);y[e]=Math.sqrt(d[e]*d[e]+p[e]*p[e])},addBody:function(t){R+1>b.x.length&&(N(b,R+10),O.bodies()),t.ax=t.ay=0,R++,e.setBodyProperties(R-1,t)},removeBody:function(e){var t,n;if(e>=R)throw new Error("Body "+e+" doesn't exist, so it can't be removed.");for(t=e;R>t;t++)for(n in b)b.hasOwnProperty(n)&&(b[n][t]=t===R-1?0:b[n][t+1]);R--,updateParticlesAccelerations()},setupBodiesRandomly:function(){var t,n,r,i,o,a,s,l,u=Math.floor(Math.sqrt(R)),c=Math.ceil(R/u);for(o=C[0]/(1+c),i=C[1]/(1+u),t=-1,n=1;u>=n;n++)for(r=1;c>=r&&(t++,t!==R);r++)a=math.normal(1,.25),s=2*Math.random()*Math.PI,l={x:r*o,y:n*i,mass:5*Math.random(),vx:a*Math.cos(s),vy:a*Math.sin(s)},l.radius=radiusFromMass(l.mass),e.setBodyProperties(t,l)},radiusFromMass:function(e){var t,n=1e3,r=e/n;return t=Math.pow(r/(4/3*Math.PI),1/3)},integrate:function(e,n){var r,o,a=k;for(void 0===e&&(e=100),void 0===n&&(n=.1),t=n,i=t*t,0===k&&D(),r=Math.floor(e/t),o=1;r>=o;o++)k=a+o*t,V(),j(),F(),D(),V(),G()},getNumberOfBodies:function(){return R},computeOutputState:function(e){e.time=k},getState:function(){return[new o(b),{clone:function(){return k},restore:function(t){e.setTime(t)}}]}},M(),e}}),define("models/solar-system/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"solar-system",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{defaultValue:-25,immutable:!0},maxX:{defaultValue:25,immutable:!0},minY:{defaultValue:-25,immutable:!0},maxY:{defaultValue:25,immutable:!0},width:{defaultValue:50},height:{defaultValue:50},unitsScheme:{defaultValue:"solar-system"},modelSampleRate:{defaultValue:"default"},timeStep:{defaultValue:.1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},horizontalWrapping:{defaultValue:!1},verticalWrapping:{defaultValue:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},showClock:{defaultValue:!0,storeInTickHistory:!0},showBodyTrace:{defaultValue:!1,storeInTickHistory:!0},bodyTraceId:{defaultValue:0,storeInTickHistory:!0},backgroundColor:{defaultValue:"#eeeeee"},bodyTraceColor:{defaultValue:"#ee8833"},markColor:{defaultValue:"#f8b500"},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},fitToParent:{defaultValue:!1},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},gridLines:{defaultValue:!1},planetNumbers:{defaultValue:!1},enableBodyTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},planetTraceColor:{defaultValue:"#6913c5"}},body:{x:{required:!0},y:{required:!0},vx:{defaultValue:0},vy:{defaultValue:0},ax:{defaultValue:0,serialize:!1},ay:{defaultValue:0,serialize:!1},mass:{defaultValue:1},radius:{},pinned:{defaultValue:!1},visible:{defaultValue:1},marked:{defaultValue:0},px:{readOnly:!0,serialize:!1},py:{readOnly:!0,serialize:!1},speed:{readOnly:!0,serialize:!1}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontScale:{defaultValue:1},hostType:{},hostIndex:{},textAlign:{}}}}),define("models/solar-system/models/unit-definitions/solar-system",[],function(){return{name:"solar-system",translated:!1,units:{length:{name:"Astronomical Unit",pluralName:"Astronomical Units",symbol:"AU"},mass:{name:"Earth Mass",pluralName:"Earth Masses",symbol:"M"},time:{name:"day",pluralName:"days",symbol:"D",displayValue:{unitsPerBaseUnit:1,name:"day",pluralName:"days",symbol:"D"}},velocity:{name:"Astronomical Unit per day",pluralName:"Astronomical Units per day",symbol:"AU/D"},acceleration:{name:"Astronomical Unit per day squared",pluralName:"Astronomical Units per day squared",symbol:"AU/D²"},momentum:{name:"Earth Mass Astronomical Unit per day",pluralName:"Earth Mass Astronomical Units per day",symbol:"M⋅AU/D"},force:{name:"Earth Mass Astronomical Unit per day squared",pluralName:"Earth Mass Astronomical Units per day squared",symbol:"M⋅AU/D²"},energy:{name:"joules",pluralName:"joules",symbol:"J"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("models/solar-system/models/unit-definitions/index",["require","models/solar-system/models/unit-definitions/solar-system","underscore"],function(e){var t={solarSystem:e("models/solar-system/models/unit-definitions/solar-system")},n=e("underscore");return{get:function(e){var r;return"solar-system"===e?t.solarSystem:(r=n.extend({},t[e]),r.units=n.extend({},t.solarSystem.units,t[e].units),r)}}}),define("models/solar-system/models/modeler",["require","arrays","common/console","common/serialize","common/validator","common/property-support","common/property-description","common/models/tick-history","models/solar-system/models/engine/solar-system","models/solar-system/models/metadata","models/solar-system/models/engine/constants/units","models/solar-system/models/unit-definitions/index","underscore"],function(e){var t=(e("arrays"),e("common/console")),n=e("common/serialize"),r=e("common/validator"),i=e("common/property-support"),o=e("common/property-description"),a=e("common/models/tick-history"),s=e("models/solar-system/models/engine/solar-system"),l=e("models/solar-system/models/metadata"),u=(e("models/solar-system/models/engine/constants/units"),e("models/solar-system/models/unit-definitions/index")),c=e("underscore");return function(e,d){function p(e,t,n){var i,o;if("mainProperty"===e)i=l.mainProperties;else{if("viewOption"!==e)throw new Error(e+" is not a supported built-in property type");i=l.viewOptions}o={type:e,writable:r.propertyIsWritable(i[t]),set:n,includeInHistoryState:!!i[t].storeInTickHistory,validate:function(e){return r.validateSingleProperty(i[t],t,e,!1)}},R.defineProperty(t,o)}function h(e,n){var r=E.get("timeStep");return t.time("integration"),w.integrate(E.get("timeStepsPerTick")*r,r),t.timeEnd("integration"),t.time("reading model state"),f(),t.timeEnd("reading model state"),t.time("tick history push"),x.push(),t.timeEnd("tick history push"),L=!0,n||k.tick(),N}function f(){v(),R.deleteComputedPropertyCachedValues(),B.forEach(function(e){V[e].addSample()}),R.notifyAllComputedProperties()}function m(){I||(D++,0===D&&(R.storeComputedProperties(),R.deleteComputedPropertyCachedValues(),R.enableCaching=!1),D++)}function g(){I||(D--,0===D&&(R.enableCaching=!0),w&&v(),B.forEach(function(e){V[e].addSample()}),0===D&&(R.enableCaching=!0,R.notifyChangedComputedProperties(),x&&x.invalidateFollowingState(),k.invalidation()))}function v(){var e,t,n;for(w.computeOutputState(b),y(),e=0,n=E.get_num_bodies();n>e;e++)for(t in _)_.hasOwnProperty(t)&&(T[e][t]=_[t][e])}function y(){var e,t;for(T||(T=[]),e=T.length,t=E.get_num_bodies();t>e;e++)T[e]||(T[e]={idx:e});T.length=t}this.constructor.type="solar-system";var b,x,w,_,T,C,A,S,P,E={},k=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek","addBody","removeBody","invalidation","textBoxesChanged","ready"),R=new i({types:["output","parameter","mainProperty","viewOption"]}),M=1e3,N=!0,O=!1,L=!1,I=!1,D=0,B=[],V={},F=!1,j=function(){var e=[{getNum:"getNumberOfBodies",addEvent:"addBody",removeEvent:"removeBody"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=w[r.getNum]();for(t(),n=0;n<e.length;n++)r=e[n],i=w[r.getNum](),i>r.num?k[r.addEvent]():i<r.num&&k[r.removeEvent]()}}();return R.mixInto(E),A=E.set,E.set=function(e,t){w&&m(),A(e,t),w&&g()},E.addPropertiesListener=function(e,t){"string"==typeof e?E.addObserver(e,t):e.forEach(function(e){E.addObserver(e,t)})},E.defineOutput=function(e,t,n){R.defineProperty(e,{type:"output",writable:!1,get:n,includeInHistoryState:!1,description:new o(C,t)})},E.defineFilteredOutput=function(e,t,n,r,i){var o,a;if("RunningAverage"!==r)throw new Error("FilteredOutput: unknown filter type "+r+".");if(o=new RunningAverageFilter(i),a=E.get(n),void 0===a||isNaN(Number(a)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");o.addSample(E.get("time"),a),B.push(e),V[e]={addSample:function(){o.addSample(E.get("time"),E.get(n))}},x.registerExternalObject({push:function(){},extract:function(e){o.setCurrentStep(e)},invalidate:function(e){o.invalidate(e)},setHistoryLength:function(e){o.setMaxBufferLength(e)}}),t.property=n,t.type=r,t.period=i,E.defineOutput(e,t,function(){return o.calculate()})},E.defineParameter=function(e,t,n){var r={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new o(C,t)};n&&(r.set=function(e){n.call(E,e)}),R.defineProperty(e,r)},E.stepCounter=function(){return x.get("counter")},E.stepStartCounter=function(){return x.get("startCounter")},E.steps=function(){return x.get("length")},E.isNewStep=function(){return L},E.seek=function(e){return arguments.length||(e=0),E.isStopped()||E.stop(),L=!1,j(function(){x.seekExtract(e),f(),k.seek()}),x.get("counter")},E.stepBack=function(e){return arguments.length||(e=1),E.isStopped()||E.stop(),L=!1,j(function(){var t,n;for(t=-1;++t<e;)n=x.get("index"),n>0&&(x.decrementExtract(),f(),k.stepBack())}),x.get("counter")},E.stepForward=function(e){return arguments.length||(e=1),E.isStopped()||E.stop(),j(function(){var t,n,r;for(t=-1;++t<e;)n=x.get("index"),r=x.get("length"),r-1>n?(x.incrementExtract(),f(),k.stepForward()):h()}),x.get("counter")},E.initializeDimensions=function(){E.set({width:E.get("maxX")-E.get("minX")}),E.set({height:E.get("maxY")-E.get("minY")})},E.initializeEngine=function(){w=s.createEngine(),w.setDimensions([E.get("minX"),E.get("minY"),E.get("maxX"),E.get("maxY")]),w.setHorizontalWrapping(E.get("horizontalWrapping")),w.setVerticalWrapping(E.get("verticalWrapping")),window.state=b={},_=w.bodies},E.createBodies=function(e){var t,n,r,i,o={supressCheck:!0,deserialization:!0};if(m(),"number"==typeof e?n=e:void 0!==e.num?n=e.num:e.x&&(n=e.x.length),e.x&&e.y)for(t=0;n>t;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);i.radius||(i.radius=w.radiusFromMass(e.mass[t])),E.addBody(i,o)}else{for(t=0;n>t;t++)i={x:0,y:0},E.addBody(i,o);w.setupBodiesRandomly()}return g(),k.reset(),E},E.ready=function(){if(F)throw new Error("ready() called on an already-ready model.");x.saveInitialState(),x.push(),R.invalidatingChangePreHook(),F=!0,R.invalidatingChangePostHook(),k.ready()},E.reset=function(){w.setTime(0),x.restoreInitialState(),k.reset()},E.addRandomBody=function(){var e,t,n=E.get("width"),r=E.get("height"),i=E.get("minX"),o=E.get("minY"),a={};return t=10*Math.random(),e=w.radiusFromMass(t),a={x:i+Math.random()*n-2*e,y:o+Math.random()*r-2*e,vx:(Math.random()-.5)/100,vy:(Math.random()-.5)/100,mass:t,radius:e},E.addBody(a),!1},E.addBody=function(e,t){E.get("minX"),E.get("minY"),E.get("maxX"),E.get("maxY");return t=t||{},e=r.validateCompleteness(l.body,e),t.deserialization||m(),w.addBody(e),t.deserialization||g(),t.supressEvent||k.addBody(),!0},E.removeBody=function(e,t){t=t||{},m(),w.removeBody(e),T.length=0,g(),t.supressEvent||k.removeplanet()},E.setBodyProperties=function(e,t,n){if(t=r.validate(l.body,t),n){var i="number"==typeof t.x?t.x:_.x[e],o="number"==typeof t.y?t.y:_.y[e];if(!w.canPlaceplanet(el,i,o,e))return!1}return m(),w.setBodyProperties(e,t),g(),!0},E.getBodyProperties=function(e){var t,n=l.body,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=_[t][e]);return r},E.addTextBox=function(e){e=r.validateCompleteness(l.textBox,e),E.get("textBoxes").push(e),k.textBoxesChanged()},E.removeTextBox=function(e){var t=E.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');E.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),k.textBoxesChanged()},E.setTextBoxProperties=function(e,t){var n,i=E.get("textBoxes")[e];if(!i)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=r.validate(l.textBox,t);for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);k.textBoxesChanged()},E.isStopped=function(){return N},E.get_bodies=function(){return _},E.get_results=function(){return T},E.get_num_bodies=function(){return w.getNumberOfBodies()},E.on=function(e,t){return k.on(e,t),E},E.tickInPlace=function(){return k.tick(),E},E.tick=function(e,t){arguments.length||(e=1);for(var n=t&&t.dontDispatchTickEvent||!1,r=-1;++r<e;)h(null,n);return E},E.start=function(){return E.resume()},E.restart=function(){O=!0},E.resume=function(){return t.time("gap between frames"),E.timer(function(e){return t.timeEnd("gap between frames"),N?!0:O?(setTimeout(E.resume,0),!0):(h(e,!1),t.time("gap between frames"),!1)}),O=!1,N&&(N=!1,k.play()),E},E.timer=function(e){var t,n=E.get("modelSampleRate");"default"===n?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)},E.stop=function(){return N=!0,k.stop(),E},E.getUnitDefinition=function(e){return C.units[e]},E.serialize=function(){var e={},t=function(t,n){e.bodies[t].every(function(e){return e===n})&&delete e.bodies[t]};return e=n(l.mainProperties,properties),e.viewOptions=n(l.viewOptions,properties),e.bodies=n(l.body,_,w.getNumberOfBodies()),e.viewOptions.showBodyTrace===!1&&delete e.viewOptions.bodyTraceId,t("marked",l.body.marked.defaultValue),t("visible",l.body.visible.defaultValue),e},function(){if(e.viewOptions&&e.viewOptions.textBoxes){var t,n,i=e.viewOptions.textBoxes;for(t=0,n=i.length;n>t;t++)i[t]=r.validateCompleteness(l.textBox,i[t])}}(),P=r.validateCompleteness(l.viewOptions,e.viewOptions||{}),S=r.validateCompleteness(l.mainProperties,e),C=u.get(S.unitsScheme),function(){var e={modelSampleRate:function(){N||E.restart()}};Object.keys(l.mainProperties).forEach(function(t){p("mainProperty",t,e[t])}),R.setRawValues(S)}(),Object.keys(l.viewOptions).forEach(function(e){p("viewOption",e)}),R.setRawValues(P),E.initializeDimensions(),E.initializeEngine(),e.bodies&&E.createBodies(e.bodies),x=new a({getProperties:function(){return R.historyStateRawValues},restoreProperties:R.setRawValues,state:w.getState()},E,M),L=!0,mainPropertyUnitTypes={},c.each(l.mainProperties,function(e,t){e.unitType&&(mainPropertyUnitTypes[t]={unitType:e.unitType})}),E.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){return b.time}),E.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return E.get("timeStep")*E.get("timeStepsPerTick")}),function(){var e;C.units.time.displayValue?e=C.units.time.displayValue:(e=c.extend({},C.units.time),e.unitsPerBaseUnit=1),E.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return E.get("time")*e.unitsPerBaseUnit}),E.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return E.get("timePerTick")*e.unitsPerBaseUnit})}(),E.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return x.get("counter")}),E.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return L}),E.defineOutput("isPlayable",{label:"Playable"},function(){return F}),f(),d.waitForSetup||E.ready(),E}}),define("models/solar-system/views/renderer",["require","lab.config","common/console","cs!common/layout/wrap-svg-text","common/views/gradients"],function(e){var t=e("lab.config"),n=e("common/console"),r=(e("cs!common/layout/wrap-svg-text"),e("common/views/gradients"));return function(e,i){function o(){var e,t,n,o;n=i.get("markColor"),e=d3.rgb(n),t=e.brighter(1).toString(),o=e.darker(1).toString(),r.createRadialGradient("mark-grad",t,n,o,K),r.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",K)}function a(e){return e.marked?"url(#mark-grad)":"url(#neutral-grad)"}function s(){var e,t;for(Z.length=R.length,e=0,t=R.length;t>e;e++)Z[e]=a(R[e])}function l(){K.selectAll("circle").remove(),K.selectAll("g.label").remove(),N=K.selectAll("circle").data(R),c(),O=K.selectAll("g.label").data(R),L=O.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+E(e.x)+","+k(e.y)+")"}),L.each(function(e){var t,n=d3.select(this);i.get("astromonicalBodyNumbers")&&n.append("text").text(e.idx).style("font-size",E(1.4*e.radius)+"px"),t=n.selectAll("text"),t.node()&&(t.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),t.attr({x:-t.node().getComputedTextLength()/2,y:"0.31em"})),n.select("text.shadow").style({stroke:"#fff","stroke-width":.15*E(e.radius),"stroke-opacity":.7})})}function u(){K.selectAll("path.bodyTrace").remove(),H="",z=i.get("showBodyTrace"),W=i.get("bodyTraceId"),z&&(q=K.selectAll("path.bodyTrace").data([R[W]]),m())}function c(){N.enter().append("circle").attr({r:function(e){return E(e.radius)},cx:function(e){return E(e.x)},cy:function(e){return k(e.y)},"fill-opacity":function(e){return e.visible},fill:function(e,t){return Z[t]}}).on("mousedown",h).on("mouseover",p).on("mouseout",y)}function d(){N.attr({r:function(e){return E(e.radius)},cx:function(e){return E(e.x)},cy:function(e){return k(e.y)}}),(0===M||M>0)&&v(M)}function p(e,t){i.get("enableBodyTooltips")&&v(t)}function h(t,n){e.node.focus(),i.get("enableBodyTooltips")&&(M!==!1?(I.style("opacity",1e-6),I.style("display","none"),M=!1):(M=d3.event.shiftKey?n:!1,v(n)))}function f(){q.attr({d:g})}function m(){q.enter().append("path").attr({"class":"bodyTrace",d:g,"stroke-width":Y,stroke:$,fill:"none"})}function g(e){var t,n,r=Math.floor(100*E(e.x))/100,i=Math.floor(100*k(e.y))/100;return H?(H+=r+","+i+" ",H.length>Q&&(t=H.indexOf("L"),n=H.indexOf(" "),H="M"+H.slice(t+1,n)+"L"+H.slice(n+1)),H):(H="M"+r+","+i+"L","M "+r+","+i)}function v(e){I.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",E(R[e].x)+60+"px").style("top",k(R[e].y)+30+"px").style("zIndex",100).transition().duration(250),D.text("astromonicalBody: "+e+"\ntime: "+modelTimeLabel()+"\nspeed: "+d3.format("+6.3e")(R[e].speed)+"\nvx:    "+d3.format("+6.3e")(R[e].vx)+"\nvy:    "+d3.format("+6.3e")(R[e].vy)+"\nax:    "+d3.format("+6.3e")(R[e].ax)+"\nay:    "+d3.format("+6.3e")(R[e].ay)+"\n")}function y(){M||0===M||I.style("opacity",1e-6).style(0/0)}function b(){void 0===I&&(I=d3.select("body").append("div").attr("class","tooltip").style("opacity",1e-6),D=I.append("pre"))}function x(){F=i.get("images"),j=i.get("imageMapping"),G=i.get("imagePath"),G?U=t.actualRoot+G:e.url&&(U=t.actualRoot+e.url.slice(0,e.url.lastIndexOf("/")+1)),$=i.get("bodyTraceColor")}function w(){function t(t){return function(){t(),e.updateClickHandlers()}}E=e.model2px,k=e.model2pxInv,B=e.getFontSizeInPixels(),V=.9*B,Y=B/12,R=i.get_results(),A=i.get("width"),S=i.get("height"),P=A/S,x(),modelMinX=i.get("minX"),modelMinY=i.get("minY"),modelMaxX=i.get("maxX"),modelMaxY=i.get("maxY"),b(),i.addPropertiesListener(["showBodyTrace","bodyTraceId","backgroundColor","markColor"],t(T)),i.on("addBody",t(T)),i.on("removeBody",t(T))}function _(e){i=e,w()}function T(t,n){arguments.length&&(E=t,k=n),B=e.getFontSizeInPixels(),V=.9*B,o(),u(),s(),l()}function C(){n.time("view update"),d(),z&&f(),n.timeEnd("view update")}var A,S,P,E,k,R,M,N,O,L,I,D,B,V,F,j,G,U,z,W,$,q,H,Y,X={},J=e.appendViewport(),K=(J.append("g").attr("class","image-container-below"),J.append("g").attr("class","text-container-below"),J.append("g").attr("class","main-container")),Z=(J.append("g").attr("class","image-container-top"),J.append("g").attr("class","text-container-top"),[]),Q=35500;return X={update:C,repaint:T,bindModel:_,model2px:e.model2px,model2pxInv:e.model2pxInv}}}),define("models/solar-system/views/view",["require","common/views/svg-container","models/solar-system/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/solar-system/views/renderer");return function(e,r){return new t(e,r,n)}}),define("models/solar-system/controllers/scripting-api",[],function(){return function(e){return{getNumberOfBodies:function(){return e.model.get_num_bodies()},addBody:function(t,n){return n&&n.supressRepaint&&(n.supressEvent=!0),e.model.addBody(t,n)},removeBody:function(t,n){n&&n.supressRepaint&&(n.supressEvent=!0,delete n.supressRepaint);try{e.model.removeBody(t,n)}catch(r){if(!n||!n.silent)throw r}},addRandomBody:function(){return e.model.addRandomBody.apply(e.model,arguments)},randomBodies:function(t){var n=e.model.get_num_bodies();if(null===t&&(t=1+e.api.randomInteger(n-1)),!e.api.isInteger(t))throw new Error("randomBodies: number of bodies requested, "+t+", is not an integer.");if(0>t)throw new Error("randomBodies: number of bodies requested, "+t+", was less be greater than zero.");return t>n&&(t=n),e.api.choose(t,n)},markBodies:function t(){var n,r;if(0!==arguments.length){if(e.api.isArray(arguments[0]))return t.apply(null,arguments[0]);for(e.api.unmarkAllBodies(),n=0,r=arguments.length;r>n;n++)e.model.setBodyProperties(arguments[n],{marked:1});e.api.repaint()}},unmarkAllBodies:function(){for(var t=0,n=e.model.get_num_bodies();n>t;t++)e.model.setBodyProperties(t,{marked:0});e.api.repaint()},traceBody:function(t){null!==t&&(e.model.set({bodyTraceId:t}),e.model.set({showBodyTrace:!0}))},untraceBody:function(){e.model.set({showBodyTrace:!1})},setBodyProperties:function(t,n,r,i,o){e.model.setBodyProperties(t,n,r,i),o&&o.supressRepaint||e.api.repaint()},getBodyProperties:function(t){return e.model.getBodyProperties(t)},addTextBox:function(t){e.model.addTextBox(t)},removeTextBox:function(t){e.model.removeTextBox(t)},setTextBoxProperties:function(t,n){e.model.setTextBoxProperties(t,n)}}}}),define("models/solar-system/benchmarks/benchmarks",["require","common/performance"],function(e){var t=e("common/performance");return function(e){var n=0,r=0,i=null,o=[{name:"bodies",numeric:!0,run:function(e){e(model.get_num_bodies())}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(n){var r,i,o;for(model.stop(),i=+t.now(),o=-1;o++<100;)e.modelContainer.update();r=t.now()-i,n(100/r*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;for(model.stop(),r=+t.now(),i=-1;i++<100;)model.tick(1,{dontDispatchTickEvent:!0});n=t.now()-r,e(100/n*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;for(model.stop(),n=+t.now(),i=-1;i++<100;)model.tick();r=t.now()-n,e(100/r*1e3)
}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){n=0,r=0,i=null,model.on("tickEnd",function(){i=t.now()}),model.on("tickStart",function(){i&&(n+=t.now()-i,r+=1)}),model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("timeStepsPerTick")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(n/r)}}];return o}}),define("models/solar-system/controllers/controller",["require","common/controllers/model-controller","models/solar-system/models/modeler","models/solar-system/views/view","models/solar-system/controllers/scripting-api","models/solar-system/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("models/solar-system/models/modeler"),r=e("models/solar-system/views/view"),i=e("models/solar-system/controllers/scripting-api"),o=e("models/solar-system/benchmarks/benchmarks");return function(e,a,s){return new t(e,a,s,n,r,i,o)}}),define("models/signal-generator/metadata",[],function(){return{mainProperties:{type:{defaultValue:"signal-generator",immutable:!0},frequency:{defaultValue:1,unitType:"frequency",propertyChangeInvalidates:!0},modelSampleRate:{defaultValue:60,propertyChangeInvalidates:!0},timeScale:{defaultValue:1,unitType:"time",propertyChangeInvalidates:!0},sampleBatchLength:{defaultValue:1,propertyChangeInvalidates:!1}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1}}}}),define("models/signal-generator/modeler",["require","common/lab-modeler-mixin","models/signal-generator/metadata"],function(e){var t=e("common/lab-modeler-mixin"),n=e("models/signal-generator/metadata"),r={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},frequency:{name:"Hertz",pluralName:"Hertz",symbol:"Hz"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}};return function(e){function i(e){return e-2*Math.PI*Math.floor(e/(2*Math.PI))}function o(e){return i(p+2*Math.PI*l.properties.frequency*e)}function a(e,t,n){return 0>t?n:e[t]}var s,l,u={frequency:function(e){void 0!==s&&(p=i(p+2*Math.PI*(s-e)*l.properties.time)),s=e}},c=new t({metadata:n,setters:u,unitsDefinition:r,initialProperties:e}),d=c.dispatchSupport,p=0,h=[],f=0,m=-1;return l={tick:function(){var e=1e3/l.properties.modelSampleRate,t=a(h,h.length-1,0);if(h.push(t+.001*e*l.properties.timeScale),f++,f%l.properties.sampleBatchLength===0)for(;m<h.length-1;)m++,l.updateAllOutputProperties(),d.tick()},stepCounter:function(){return f},reset:function(){d.reset()}},c.mixInto(l),d.addEventTypes("tick"),d.addEventTypes("reset"),l.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return a(h,m,0)}),l.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return a(h,m,0)}),l.defineOutput("signalValue",{label:"Signal Value",format:".2f"},function(){var e=a(h,m,0);return Math.cos(o(e))}),l.defineOutput("angle",{label:"Angle",unitType:"angle",format:".2f"},function(){var e=a(h,m,0);return o(e)}),l}}),define("common/views/null-model-view",[],function(){return function(){return{$el:$("<div id='model-container' class='container'/>"),getHeightForWidth:function(){return 0},resize:function(){},repaint:function(){},bindModel:function(){},setup:function(){},update:function(){}}}}),define("models/signal-generator/controller",["require","common/controllers/model-controller","models/signal-generator/modeler","common/views/null-model-view"],function(e){var t=e("common/controllers/model-controller"),n=e("models/signal-generator/modeler"),r=e("common/views/null-model-view"),i=function(){};return function(e,o,a){return new t(e,o,a,n,r,i)}}),define("models/iframe/metadata",[],function(){return{mainProperties:{type:{defaultValue:"iframe-model",immutable:!0},url:{immutable:!0}},viewOptions:{aspectRatio:{defaultValue:1.55},showClock:{defaultValue:!1,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"reset",propertyChangeInvalidates:!1}}}}),define("models/iframe/modeler",["require","common/lab-modeler-mixin","models/iframe/metadata"],function(e){function t(e){var t=new r({metadata:i,initialProperties:e,usePlaybackSupport:!1});t.mixInto(this),this.set=n,this._phone=null,this._stopped=!0,this._initialProperties=e,this._propertySupport=t.propertySupport,this._dispatch=t.dispatchSupport,this._dispatch.addEventTypes("tick","tickStart","tickEnd","play","stop","reset","stepForward","stepBack"),this.defineParameter("pressure",{label:"Pressure"},void 0)}function n(e,t){var n=this;if("string"!=typeof e){var r=e;return void Object.keys(r).forEach(function(e){n.set(e,r[e])})}this.hasProperty(e)||this._propertySupport.defineProperty(e,{type:"mainProperty",writable:!0,set:function(t){n._phone.post("set",{name:e,value:t})},includeInHistoryState:!1,beforeSetCallback:this._propertySupport.invalidatingChangePreHook,afterSetCallback:this._propertySupport.invalidatingChangePostHook}),this.properties[e]=t}var r=e("common/lab-modeler-mixin"),i=e("models/iframe/metadata");return t.prototype._defineModelSpecificProperties=function(){var e=this._initialProperties,t=this;Object.keys(e).forEach(function(n){i.mainProperties[n]||i.viewOptions[n]||t.set(n,e[n])})},t.prototype.start=function(){return this._phone.post({type:"play"}),this},t.prototype.stop=function(){return this._phone.post({type:"stop"}),this},t.prototype.restart=function(){return this.stop(),this.start(),this},t.prototype.isStopped=function(){return this._stopped},t.prototype.serialize=function(){return this._initialProperties},Object.defineProperty(t.prototype,"iframePhone",{set:function(e){this._phone=e,this._addListeners(),this._defineModelSpecificProperties()},get:function(){return this._phone}}),t.prototype._addListeners=function(){var e=this;this._phone.addListener("play.iframe-model",function(){e._stopped=!1,e._dispatch.play()}),this._phone.addListener("stop.iframe-model",function(){e._stopped=!0,e._dispatch.stop()}),this._phone.addListener("propertyValue",function(t){"pressureProbeFiltered"===t.name&&e.set("pressure",t.value)}),this._phone.post("observe","pressureProbeFiltered")},t}),define("models/iframe/iframe-container",["require","iframe-phone"],function(e){var t=e("iframe-phone");return function(e){function n(e){i.find("#iframe-model").remove(),i.append("<iframe id='iframe-model' style='width:100%;height:100%' src='"+e.get("url")+"'></iframe>"),e.iframePhone=new t.ParentEndpoint(i.find("#iframe-model")[0])}var r=e,i=$("<div id='model-container' class='container'></div>");return n(e),{$el:i,getHeightForWidth:function(e){return e/r.get("aspectRatio")},resize:function(){},bindModel:function(e){i.find("#iframe-model").remove(),n(e),r=e},setup:function(){},update:function(){},repaint:function(){}}}}),define("models/iframe/scripting-api",[],function(){return function(e){var t=e.bindModel;return e.bindModel=function(){t.apply(e,arguments),e.model.iframePhone.addListener("registerScriptingAPIFunc",function(t){null==e.api[t]&&(e.api[t]=function(n){e.model.iframePhone.post(t,n)})})},{post:function(t,n){e.model.iframePhone.post(t,n)}}}}),define("models/iframe/controller",["require","common/controllers/model-controller","models/iframe/modeler","models/iframe/iframe-container","models/iframe/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/iframe/modeler"),r=e("models/iframe/iframe-container"),i=e("models/iframe/scripting-api");return function(e,o,a){return new t(e,o,a,n,r,i)}}),define("models/sensor/metadata",[],function(){return{mainProperties:{type:{defaultValue:"sensor",immutable:!0},sensorType:{defaultValue:null},samplesPerSecond:{readOnly:!0},collectionTime:{defaultValue:null},tareValue:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("sensor-applet",e):"undefined"!=typeof window?window.sensorAppletInterface=e():"undefined"!=typeof global?global.sensorAppletInterface=e():"undefined"!=typeof self&&(self.sensorAppletInterface=e())}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){var n=e("./mini-class"),r=e("./sensor-applet");t.exports={GoIO:n.extendClass(r,{deviceType:"golink",deviceSpecificJars:["sensor-vernier","goio-jna"]}),LabQuest:n.extendClass(r,{deviceType:"labquest",deviceSpecificJars:["sensor-vernier","labquest-jna"]})}},{"./mini-class":4,"./sensor-applet":6}],2:[function(e,t){"use strict";function n(e){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}function r(){n.apply(this,arguments)}function i(){n.apply(this,arguments)}function o(){n.apply(this,arguments)}function a(){n.apply(this,arguments)}var s=e("util");s.inherits(r,Error),s.inherits(i,Error),s.inherits(o,Error),s.inherits(a,Error),t.exports={JavaLoadError:r,AppletInitializationError:i,AlreadyReadingError:a,SensorConnectionError:o}},{util:11}],3:[function(e,t){t.exports="20131210.035616"},{}],4:[function(e,t){"use strict";function n(e,t){var n,r={}.hasOwnProperty;for(n in t)r.call(t,n)&&(e[n]=t[n])}function r(e,t){function r(){this.constructor=e}n(e,t),r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}function i(e){function t(e){n(this,e)}return n(t.prototype,e),t}function o(e,t){function i(e){n(this,e)}return r(i,e),n(i.prototype,t),i}t.exports={defineClass:i,extendClass:o,mixin:n}},{}],5:[function(e,t){"use strict";t.exports={on:function(e,t){this._ee_listeners||(this._ee_listeners={}),this._ee_listeners[e]||(this._ee_listeners[e]=[]),this._ee_listeners[e].push(t)},emit:function(e){var t=arguments.length>1?[].slice.call(arguments,1):[];if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;r>n;n++)this._ee_listeners[e][n].apply(null,t)},removeListener:function(e,t){if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;r>n;n++)this._ee_listeners[e][n]===t&&this._ee_listeners[e].splice(n,1)},removeListeners:function(e){e?this._ee_listeners&&(this._ee_listeners[e]=[]):this._ee_listeners={}}}},{}],6:[function(e,t){"use strict";function n(){var e=null,t=null;this.handleCallback=function(){console.log("handling callback from applet"),setTimeout(function(){return null===e?void console.log("applet called callback after timer expired"):(window.clearInterval(e),e=null,void t.success())},5)},this.wait=function(n){var r=0,i=n.times;t=n,e=window.setInterval(function(){r++,r>i&&(window.clearInterval(e),e=null,n.fail())},n.interval)}}var r,i=e("./mini-class"),o=e("./mini-event-emitter"),a=e("./errors"),s=e("./jars-timestamp");r=i.defineClass({listenerPath:"",sensorDefinitions:null,codebase:"",deviceType:"",appletId:"sensor-applet",classNames:"applet sensor-applet",jars:["jna","sensor","sensor-applets"],deviceSpecificJarUrls:[],code:"org.concord.sensor.applet.SensorApplet",testAppletReadyInterval:100,getArchiveValue:function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n]+".jar";return t.join(", ")},getHTML:function(){var e=this.jars.concat(this.deviceSpecificJars);return["<applet ",'id="',this.appletId,'" ','class="',this.classNames,'" ','archive="',this.getArchiveValue(e),'" ','code="',this.code,'" ','codebase="',this.codebase,"/",s,'" ','width="1px" ','height="1px" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />','<param name="evalOnInit" value="'+this.listenerPath+'.appletIsReadyCallback()" />','<param name="permissions" value="all-permissions" />','<param name="java_arguments" value="-Djnlp.packEnabled=true"/>',"</applet>"].join("")},getTestAppletHTML:function(){return["<applet ",'id="',this.appletId,'-test-applet" ','class="applet test-sensor-applet" ','code="org.concord.sensor.applet.DetectionApplet" ','archive="',this.getArchiveValue(["sensor-applets"]),'" ','codebase="',this.codebase,"/",s,'" ','width="150px" ','height="150px" ','style="position: absolute; ',"left: "+($("body").width()/2-75)+"px; ","top: "+($("body").height()/2-75)+'px;" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />','<param name="evalOnInit" value="'+this.listenerPath+'.testAppletIsReadyCallback()" />','<param name="permissions" value="all-permissions" />','<param name="java_arguments" value="-Djnlp.packEnabled=true"/>',"</applet>"].join("")},isSensorConnected:function(e){var t,n,r=this;setTimeout(function(){t=function(i){i?(t=function(){var t=JSON.parse(r.appletInstance.getCachedAttachedSensors());if(t)if(1===r.sensorDefinitions.length){for(var n=0;n<t.length;n++)if(r.appletInstance.getTypeConstantName(t[n].type)===r.sensorDefinitions[0].typeConstantName)return void e.call(r,!0);e.call(r,!1)}else e.call(r,!0);else e.call(r,!1)},n=r.registerCallback(t),r.appletInstance.getAttachedSensors(r.deviceType,""+n)):e.call(r,!1)},n=r.registerCallback(t),r.appletInstance.isInterfaceConnected(r.deviceType,""+n)})},_state:"not appended",getState:function(){return this._state},append:function(e,t){if("not appended"!==this.getState())throw new Error("Can't call append() when sensor applet has left 'not appended' state");console.log("appending test applet"),this.$testAppletContainer=this._appendHTML(this.appletId+"-test-applet-container",this.getTestAppletHTML(),e),this._state="test applet appended",this._waitForTestApplet(),this._appendCallback=t},_appendHTML:function(e,t,n){var r=$("#"+e);return r.length||(r=$("<div id='"+e+"'/>").appendTo(n)),r.html(t),r},_testAppletWaiter:new n,testAppletIsReadyCallback:function(){this._testAppletWaiter.handleCallback()},_waitForTestApplet:function(){var e=this;this._testAppletWaiter.wait({times:30,interval:1e3,success:function(){e.$appletContainer=e._appendHTML(e.appletId+"-container",e.getHTML(),$("body")),e._state="appended",e._waitForApplet()},fail:function(){e._appendCallback(new a.JavaLoadError("Timed out waiting for test applet to initialize."))}})},_appletWaiter:new n,appletIsReadyCallback:function(){this._appletWaiter.handleCallback()},_waitForApplet:function(){var e=this;this._appletWaiter.wait({times:30,interval:1e3,success:function(){var t=[];e.$testAppletContainer.html(""),"appended"===e.getState()&&(e._state="applet ready"),e.appletInstance=$("#"+e.appletId)[0];for(var n=0;n<e.sensorDefinitions.length;n++)t[n]=e.appletInstance.getSensorRequest(e.sensorDefinitions[n].measurementType);e.appletInstance.initSensorInterface(e.listenerPath,e.deviceType,t)},fail:function(){e._appendCallback(new a.AppletInitializationError("Timed out waiting for sensor applet to initialize."))}})},readSensor:function(e){var t=this;return"reading sensor"===this.getState()?(console.log("Already reading sensor in another thread..."),void e.call(this,new a.AlreadyReadingError("Already reading sensor in another thread"),null)):"stopped"!==this.getState()?void e.call(this,new Error("Tried to read the sensor value from non-stopped state '"+this.getState()+'"'),null):(this._state="reading sensor",void this.isSensorConnected(function(n){if(n){var r=function(n){t._state="stopped",n&&0!==n.length?e.call(t,null,n):e.call(t,new Error("readSensor: no sensor values to report"),null)},i=t.registerCallback(r);t.appletInstance.getConfiguredSensorsValues(t.deviceType,""+i)}else t._state="stopped",e.call(t,new a.SensorConnectionError("readSensor: sensor is not connected"),null)}))},start:function(e){var t=this;return"reading sensor"===this.getState()?(console.log("start called while waiting for a sensor reading"),void setTimeout(function(){t.start(e)},100)):"stopped"!==this.getState()?void(e&&setTimeout(function(){e.call(this,new Error("Tried to start the applet from non-stopped state '"+this.getState()+'"'),!1)},5)):(this._state="starting",void this.isSensorConnected(function(n){n?(t.appletInstance.startCollecting(),t._state="started",e&&e.call(t,null,!0)):(t._state="stopped",e&&e.call(t,new a.SensorConnectionError("Device reported the requested sensor type was not attached."),null))}))},stop:function(){"started"===this.getState()&&(this._state="stopped",this.appletInstance.stopCollecting())},remove:function(){"not appended"!==this.getState()&&(this.$appletContainer&&this.$appletContainer.html(""),this.$testAppletContainer&&this.$testAppletContainer.html(""),this._state="not appended")},initSensorInterfaceComplete:function(e){var t=this;setTimeout(function(){e?(t._state="stopped",t._appendCallback(null),t._appendCallback=null):t._appendCallback(new a.SensorConnectionError("Device reported the requested sensor type was not attached."))},5)},dataReceived:function(e,t,n){var r=this,i=[],o=this.sensorDefinitions.length;setTimeout(function(){n=n||[];for(var e=0;t>e;e++){for(var a=0;o>a;a++)i[a]=n[e*o+a];r.emit("data",i)}},5)},deviceUnplugged:function(){var e=this;window.setTimeout(function(){e.emit("deviceUnplugged")},5)},sensorUnplugged:function(){console.log("received sensorUnplugged message; deviceType = "+this.deviceType)},callbackTable:[],registerCallback:function(e){return this.callbackTable.push(e),this.callbackTable.length-1},handleCallback:function(e,t){var n,r=this;"string"==typeof e&&this[e]?n=this[e]:this.callbackTable[e]&&(n=this.callbackTable[e],this.callbackTable[e]=null),n&&(t=t||[],setTimeout(function(){n.apply(r,t)},5))}}),i.mixin(r.prototype,o),t.exports=r},{"./errors":2,"./jars-timestamp":3,"./mini-class":4,"./mini-event-emitter":5}],7:[function(e,t){t.exports={goMotion:{appletClass:"GoIO",measurementName:"Distance",measurementType:"distance",typeConstantName:"distance",sensorName:"GoMotion",deviceName:"GoMotion",samplesPerSecond:20,tareable:!0,minReading:-2,maxReading:2,precision:2,maxSeconds:20},goTemp:{appletClass:"GoIO",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature_wand",sensorName:"GoIO Temperature Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},goLinkTemperature:{appletClass:"GoIO",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature",sensorName:"GoIO Temperature Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},goLinkLight:{appletClass:"GoIO",measurementName:"Light Intensity",measurementType:"light",typeConstantName:"light",sensorName:"GoIO Light Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:2e3,maxSeconds:20},goLinkForce:{appletClass:"GoIO",measurementName:"Force",measurementType:"force",typeConstantName:"force",sensorName:"GoIO Force Sensor",deviceName:"GoIO",samplesPerSecond:20,tareable:!0,minReading:-50,maxReading:50,precision:2,maxSeconds:10},goLinkPH:{appletClass:"GoIO",measurementName:"Acidity",measurementType:"ph",typeConstantName:"ph",sensorName:"GoIO pH Sensor",deviceName:"GoIO",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:14,maxSeconds:60},goLinkCO2:{appletClass:"GoIO",measurementName:"CO₂ Concentration",measurementType:"co2",typeConstantName:"co2_gas",sensorName:"GoIO CO₂ sensor",deviceName:"GoIO",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:5e3,maxSeconds:60},goLinkO2:{appletClass:"GoIO",measurementName:"O₂ Concentration",measurementType:"o2",typeConstantName:"oxygen_gas",sensorName:"GoIO O₂ sensor",deviceName:"GoIO",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:100,maxSeconds:60},labQuestMotion:{appletClass:"LabQuest",measurementName:"Distance",measurementType:"distance",typeConstantName:"distance",sensorName:"LabQuest Motion Sensor",deviceName:"LabQuest",samplesPerSecond:20,tareable:!0,minReading:-2,maxReading:2,precision:2,maxSeconds:20},labQuestTemperature:{appletClass:"LabQuest",measurementName:"Temperature",measurementType:"temperature",typeConstantName:"temperature",sensorName:"LabQuest Temperature Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:40,maxSeconds:20},labQuestLight:{appletClass:"LabQuest",measurementName:"Light Intensity",measurementType:"light",typeConstantName:"light",sensorName:"LabQuest Light Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:2e3,maxSeconds:20},labQuestForce:{appletClass:"LabQuest",measurementName:"Force",measurementType:"force",typeConstantName:"force",sensorName:"LabQuest Force Sensor",deviceName:"LabQuest",samplesPerSecond:20,tareable:!0,minReading:-50,maxReading:50,precision:2,maxSeconds:10},labQuestPH:{appletClass:"LabQuest",measurementName:"Acidity",measurementType:"ph",typeConstantName:"ph",sensorName:"LabQuest pH Sensor",deviceName:"LabQuest",samplesPerSecond:10,tareable:!1,minReading:0,maxReading:14,maxSeconds:60},labQuestCO2:{appletClass:"LabQuest",measurementName:"CO₂ Concentration",measurementType:"co2",typeConstantName:"co2_gas",sensorName:"LabQuest CO₂ sensor",deviceName:"LabQuest",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:5e3,maxSeconds:60},labQuestO2:{appletClass:"LabQuest",measurementName:"O₂ Concentration",measurementType:"o2",typeConstantName:"oxygen_gas",sensorName:"LabQuest O₂ sensor",deviceName:"LabQuest",samplesPerSecond:1,tareable:!1,minReading:0,maxReading:100,maxSeconds:60}}},{}],8:[function(e,t){t.exports={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"},temperature:{name:"degree Celsius",pluaralName:"degrees Celsius",symbol:"°C"},light:{name:"lux",pluralName:"lux",symbol:"lux"},force:{name:"Newton",pluralName:"Newtons",symbol:"N"},ph:{name:"pH Unit",pluralName:"pH Units",symbol:"pH"},co2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"},o2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"}}}},{}],9:[function(e,t){var n=e("./lib/applet-classes"),r=e("./lib/errors");t.exports={GoIO:n.GoIO,LabQuest:n.LabQuest,sensorDefinitions:e("./lib/sensor-definitions"),unitsDefinition:e("./lib/units-definition"),JavaLoadError:r.JavaLoadError,AppletInitializationError:r.AppletInitializationError,SensorConnectionError:r.SensorConnectionError,AlreadyReadingError:r.AlreadyReadingError}},{"./lib/applet-classes":1,"./lib/errors":2,"./lib/sensor-definitions":7,"./lib/units-definition":8}],10:[function(e,t,n){function r(e){return"[object Array]"===u.call(e)}function i(e,t){var n;if(null===e)n={__proto__:null};else{if("object"!=typeof e)throw new TypeError("typeof prototype["+typeof e+"] != 'object'");var r=function(){};r.prototype=e,n=new r,n.__proto__=e}return"undefined"!=typeof t&&Object.defineProperties&&Object.defineProperties(n,t),n}function o(e){return"object"!=typeof e&&"function"!=typeof e||null===e}function a(e){if(o(e))throw new TypeError("Object.keys called on a non-object");var t=[];for(var n in e)c.call(e,n)&&t.push(n);return t}function s(e){if(o(e))throw new TypeError("Object.getOwnPropertyNames called on a non-object");var t=a(e);return n.isArray(e)&&-1===n.indexOf(e,"length")&&t.push("length"),t}function l(e,t){return{value:e[t]}}var u=Object.prototype.toString,c=Object.prototype.hasOwnProperty;n.isArray="function"==typeof Array.isArray?Array.isArray:r,n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1},n.filter=function(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n},n.forEach=function(e,t,n){if(e.forEach)return e.forEach(t,n);for(var r=0;r<e.length;r++)t.call(n,e[r],r,e)},n.map=function(e,t){if(e.map)return e.map(t);for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r],r,e);return n},n.reduce=function(e,t,n){if(e.reduce)return e.reduce(t,n);var r,i=!1;2<arguments.length&&(r=n,i=!0);for(var o=0,a=e.length;a>o;++o)e.hasOwnProperty(o)&&(i?r=t(r,e[o],o,e):(r=e[o],i=!0));return r},n.substr="b"!=="ab".substr(-1)?function(e,t,n){return 0>t&&(t=e.length+t),e.substr(t,n)}:function(e,t,n){return e.substr(t,n)},n.trim=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},n.bind=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(t.bind)return t.bind.apply(t,e);var n=e.shift();return function(){t.apply(n,e.concat([Array.prototype.slice.call(arguments)]))}},n.create="function"==typeof Object.create?Object.create:i;var d="function"==typeof Object.keys?Object.keys:a,p="function"==typeof Object.getOwnPropertyNames?Object.getOwnPropertyNames:s;if((new Error).hasOwnProperty("description")){var h=function(e,t){return"[object Error]"===u.call(e)&&(t=n.filter(t,function(e){return"description"!==e&&"number"!==e&&"message"!==e})),t};n.keys=function(e){return h(e,d(e))},n.getOwnPropertyNames=function(e){return h(e,p(e))}}else n.keys=d,n.getOwnPropertyNames=p;if("function"==typeof Object.getOwnPropertyDescriptor)try{Object.getOwnPropertyDescriptor({a:1},"a"),n.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(f){n.getOwnPropertyDescriptor=function(e,t){try{return Object.getOwnPropertyDescriptor(e,t)}catch(n){return l(e,t)}}}else n.getOwnPropertyDescriptor=l},{}],11:[function(e,t,n){function r(e,t){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(t)?r.showHidden=t:t&&n._extend(r,t),x(r.showHidden)&&(r.showHidden=!1),x(r.depth)&&(r.depth=2),x(r.colors)&&(r.colors=!1),x(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=i),s(r,e,r.depth)}function i(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function o(e){return e}function a(e){var t={};return N.forEach(e,function(e){t[e]=!0}),t}function s(e,t,r){if(e.customInspect&&t&&A(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r);return y(i)||(i=s(e,i,r)),i}var o=l(e,t);if(o)return o;var f=N.keys(t),m=a(f);if(e.showHidden&&(f=N.getOwnPropertyNames(t)),0===f.length){if(A(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(w(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(T(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return u(t)}var v="",b=!1,x=["{","}"];if(h(t)&&(b=!0,x=["[","]"]),A(t)){var _=t.name?": "+t.name:"";v=" [Function"+_+"]"}if(w(t)&&(v=" "+RegExp.prototype.toString.call(t)),T(t)&&(v=" "+Date.prototype.toUTCString.call(t)),C(t)&&(v=" "+u(t)),0===f.length&&(!b||0==t.length))return x[0]+v+x[1];if(0>r)return w(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=b?c(e,t,r,m,f):f.map(function(n){return d(e,t,r,m,n,b)}),e.seen.pop(),p(S,v,x)}function l(e,t){if(x(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function c(e,t,n,r,i){for(var o=[],a=0,s=t.length;s>a;++a)o.push(M(t,String(a))?d(e,t,n,r,String(a),!0):"");return N.forEach(i,function(i){i.match(/^\d+$/)||o.push(d(e,t,n,r,i,!0))}),o}function d(e,t,n,r,i,o){var a,l,u;if(u=N.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?l=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(l=e.stylize("[Setter]","special")),M(r,i)||(a="["+i+"]"),l||(N.indexOf(e.seen,u.value)<0?(l=m(n)?s(e,u.value,null):s(e,u.value,n-1),l.indexOf("\n")>-1&&(l=o?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),x(a)){if(o&&i.match(/^\d+$/))return l;a=JSON.stringify(""+i),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+l}function p(e,t,n){var r=0,i=N.reduce(e,function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function h(e){return N.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return null==e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function x(e){return void 0===e}function w(e){return _(e)&&"[object RegExp]"===E(e)}function _(e){return"object"==typeof e&&e}function T(e){return _(e)&&"[object Date]"===E(e)}function C(e){return _(e)&&"[object Error]"===E(e)}function A(e){return"function"==typeof e}function S(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function P(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.binarySlice}function E(e){return Object.prototype.toString.call(e)}function k(e){return 10>e?"0"+e.toString(10):e.toString(10)}function R(){var e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":");return[e.getDate(),L[e.getMonth()],t].join(" ")}function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var N=e("_shims"),O=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,i=arguments,o=i.length,a=String(e).replace(O,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return e}}),s=i[n];o>n;s=i[++n])a+=m(s)||!_(s)?" "+s:" "+r(s);return a},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=h,n.isBoolean=f,n.isNull=m,n.isNullOrUndefined=g,n.isNumber=v,n.isString=y,n.isSymbol=b,n.isUndefined=x,n.isRegExp=w,n.isObject=_,n.isDate=T,n.isError=C,n.isFunction=A,n.isPrimitive=S,n.isBuffer=P;var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",R(),n.format.apply(n,arguments))},n.inherits=function(e,t){e.super_=t,e.prototype=N.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},n._extend=function(e,t){if(!t||!_(t))return e;for(var n=N.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}},{_shims:10}]},{},[9])(9)}),define("models/sensor/modeler",["require","common/lab-modeler-mixin","common/property-description","./metadata","sensor-applet","lab.config","common/controllers/basic-dialog","common/controllers/export-controller"],function(e){function t(e,t){var n=new u({width:"60%",buttons:t});n.setContent(e),n.open()}var n=e("common/lab-modeler-mixin"),r=e("common/property-description"),i=e("./metadata"),o=e("sensor-applet"),a=o.unitsDefinition,s=o.sensorDefinitions,l=e("lab.config"),u=e("common/controllers/basic-dialog"),c=e("common/controllers/export-controller"),d={label:"Sensor Reading",unitAbbreviation:"-",format:".2f",min:0,max:1};return function(e){function u(e,t,n){var i,o;i=V.getPropertyDescription(e).getHash(),i.min=t,i.max=n,o=new r(a,i),C.setPropertyDescription(e,o)}function p(){null!=V.properties.collectionTime&&u("displayTime",0,V.properties.collectionTime)
}function h(){E&&(E.removeListeners("data"),E.removeListeners("deviceUnplugged"),E.removeListeners("sensorUnplugged"),E.remove()),V.makeInvalidatingChange(function(){G=!1,U=!1})}function f(){V.makeInvalidatingChange(function(){U=!0}),setTimeout(function(){E.on("data",_),E.on("deviceUnplugged",function(){v("device")}),E.on("sensorUnplugged",function(){v("sensor")}),E.append($("body"),function(e){return e?(e instanceof o.JavaLoadError?g("It appears that Java applets cannot run in your browser. If you are able to fix this, reload the page to use the sensor"):e instanceof o.AppletInitializationError?g("The sensor applet appears not to be loading. If you are able to fix this, reload the page to use the sensor"):e instanceof o.SensorConnectionError?m():g("There was an unexpected error when connecting to the sensor."),void V.makeInvalidatingChange(function(){U=!1})):void V.makeInvalidatingChange(function(){G=!0,U=!1})})},10)}function m(){h(),t("The "+V.properties.sensorName+' does not appear to be attached. Try re-attaching it, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),f()},Cancel:function(){$(this).remove(),V.reload()}})}function g(e){h(),t(e,{OK:function(){$(this).remove(),V.reload()}})}function v(e){h(),V.stop(),c.logAction("User unplugged the "+e+" ("+V.properties[e+"Name"]+")."),t("The "+V.properties[e+"Name"]+' was unplugged. Try plugging it back in, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),f()},Cancel:function(){$(this).dialog("close")}})}function y(){k&&clearInterval(k);var e=function(e,t){if(e)if(e instanceof o.AlreadyReadingError);else{if(!(e instanceof o.SensorConnectionError))throw clearInterval(k),e;clearInterval(k),m()}else V.makeInvalidatingChange(function(){N=t[0],I&&(V.properties.tareValue=N,I=!1)})};k=setInterval(function(){E.readSensor(e)},1e3/z)}function b(){k&&(clearInterval(k),k=null)}function x(){O=0,M=0,N=void 0,L=!1,D=!1,I=!1}function w(e){var t,n,i,u;P!==e&&(P&&(V.properties.tareValue=0),P=e,N=void 0,E&&h(),P?(n=s[P],R=n.samplesPerSecond,u=n.measurementType,t=o[n.appletClass],D=n.tareable,E=window.Lab.sensor[P]=new t({listenerPath:"Lab.sensor."+P,sensorDefinitions:[n],appletId:P+"-sensor",codebase:l.rootUrl+"/jars/lab-sensor-applet-interface-dist"}),f(),i=new r(a,{label:n.measurementName,unitType:u,min:n.minReading,max:n.maxReading}),C.setPropertyDescription("sensorReading",i),null==V.properties.collectionTime&&(V.properties.collectionTime=n.maxSeconds)):V.properties.hasOwnProperty("sensorReading")&&(i=new r(a,d),C.setPropertyDescription("sensorReading",i)))}function _(e){O++,M+=1/R,window.__bizarreSafariFix=1,N=e[0],L||V.freeze("sensorType"),L=!0,V.updateAllOutputProperties(),A.tick()}var T,C,A,S,P,E,k,R,M,N,O,L,I,D,B,V,F=!0,j=!1,G=!1,U=!1,z=1;return V={on:function(e,t){A.on(e,t)},start:function(){V.properties.isPlayable&&E.start(function(e,t){e?e instanceof o.SensorConnectionError&&m():t&&(V.makeInvalidatingChange(function(){F=!1}),A.play())})},stop:function(){E&&E.stop(),V.makeInvalidatingChange(function(){F=!0}),A.stop()},tare:function(){if(!F)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=k&&null!=N?V.properties.tareValue=N:V.makeInvalidatingChange(function(){I=!0})},willReset:function(){A.willReset()},reset:function(){V.stop(),h(),x(),V.properties.tareValue=B,V.unfreeze("sensorType"),V.properties.sensorType=S,A.reset()},reload:function(){V.stop(),V.makeInvalidatingChange(function(){j=!0})},isStopped:function(){return F},stepCounter:function(){return O},serialize:function(){return""}},x(),void 0===window.Lab&&(window.Lab={}),window.Lab.sensor={},T=new n({metadata:i,setters:{sensorType:w},unitsDefinition:a,initialProperties:e,usePlaybackSupport:!1}),T.mixInto(V),C=T.propertySupport,A=T.dispatchSupport,A.addEventTypes("tick","play","stop","tickStart","tickEnd"),S=V.properties.sensorType,B=V.properties.tareValue,V.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return M}),V.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return M}),V.defineOutput("sensorReading",d,function(){return null==N?N:N-V.properties.tareValue}),V.defineOutput("sensorName",{label:"Sensor Name"},function(){return s[P].sensorName}),V.defineOutput("deviceName",{label:"Sensor Interface Device Name"},function(){return s[P].deviceName}),V.defineOutput("isStopped",{label:"Stopped?"},function(){return F}),V.defineOutput("isPlayable",{label:"Startable?"},function(){return G&&!L}),V.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return L}),V.defineOutput("shouldPollSensor",{label:"Polling Sensor?"},function(){return V.properties.isPlayable&&F}),V.defineOutput("isSensorInitializing",{label:"Loading Sensor?"},function(){return U}),V.defineOutput("isTaring",{label:"Waiting for a tare value?"},function(){return I}),V.defineOutput("canTare",{label:"Can set a tare value?"},function(){return F&&!L&&D&&!I}),V.defineOutput("needsReload",{label:"Needs Reload?"},function(){return j}),V.on("willReset.model",h),V.addObserver("shouldPollSensor",function(){V.properties.shouldPollSensor?y():b()}),V.addObserver("collectionTime",p),p(),w(V.properties.sensorType),V}}),define("models/sensor/view",["common/views/select-box-view","common/views/numeric-output-view","sensor-applet","common/views/view-state"],function(){var e=require("common/views/select-box-view"),t=require("common/views/numeric-output-view"),n=require("sensor-applet").sensorDefinitions,r=require("common/views/view-state");return function(i,o){function a(){d.$zeroButton.find("button").html(i.properties.isTaring?"Zeroing...":"Zero")}function s(){i.properties.canTare?r.enableView(d.$zeroButton):r.disableView(d.$zeroButton)}function l(){var e=i.getPropertyDescription("sensorType");e.getFrozen()?r.disableView(d.$selectBox):r.enableView(d.$selectBox)}function u(){i.addObserver("isTaring",a),a(),i.addObserver("canTare",s),s(),i.addPropertyDescriptionObserver("sensorType",l),l()}var c,d,p=new e({id:"sensor-type-view",options:[{value:null,text:"Select type of sensor...",selected:null==i.properties.sensorType,disabled:!0}].concat(Object.keys(n).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType,disabled:!1}})),onChange:function(e){i.properties.sensorType=e.value}}),h=d3.format(".2f");return d={$el:$("<div id='model-container' class='container sensor-model-container' />"),bindModel:function(e,t){o=t||o,i=e||i,u()},getHeightForWidth:function(){return"2.6em"},setup:function(){this.$el.empty(),c=new t({id:"sensor-value-view",label:"Reading: ",units:i.getPropertyDescription("sensorReading").getUnitAbbreviation()});var e=p.render(this.$el),n=$("<div><button>Zero</button></div>"),r=c.render();e.addClass("interactive-pulldown component component-spacing"),n.addClass("interactive-button component component-spacing"),r.addClass("numeric-output component horizontal component-spacing"),this.$el.css("zIndex",4),this.$el.append(e),this.$el.append(r),this.$el.append(n),this.$zeroButton=n,this.$selectBox=e,c.resize(),u(),n.on("click","button",function(){i.tare()})},showInitializationProgress:function(){var e;this.$progressbarContainer||(e=$("<div/>").attr("id","sensor-progressbar"),this.$progressbarContainer=$("<div/>").attr("id","sensor-progressbar-container").css("bottom",$("body").height()/2+75+$(".lab-responsive-content").offset().top).append('<div class="label">Loading sensor...</div>').append(e).appendTo(".lab-responsive-content"),e.progressbar({value:!1})),this.$progressbarContainer.show()},hideInitializationProgress:function(){this.$progressbarContainer.hide()},resize:function(){c&&c.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(e){c.updateUnits(e),null==i.properties.sensorReading&&c.hideUnits()},update:function(){null==i.properties.sensorReading?(c.update(""),c.hideUnits()):(c.update(h(i.properties.sensorReading)),c.showUnits())}}}}),define("models/sensor/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/sensor/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("isSensorInitializing",function(){var t=l.modelContainer;e.properties.isSensorInitializing?t.showInitializationProgress():t.hideInitializationProgress()}),e.addObserver("sensorReading",function(){e.isStopped()&&l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.sensor-model-controller",s),a.on("modelReset.sensor-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0)}),l}}),define("models/dual-sensor/metadata",[],function(){return{mainProperties:{type:{defaultValue:"dual-sensor",immutable:!0},sensorType:{defaultValue:null},sensorType2:{defaultValue:null},samplesPerSecond:{readOnly:!0},collectionTime:{defaultValue:null},tareValue:{defaultValue:0},tareValue2:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("models/dual-sensor/modeler",["require","common/property-support","common/property-description","cs!common/filters/running-average-filter","common/validator","./metadata","sensor-applet","lab.config","common/controllers/basic-dialog","common/controllers/export-controller"],function(e){function t(e,t){var n=new d({width:"60%",buttons:t});n.setContent(e),n.open()}var n=e("common/property-support"),r=e("common/property-description"),i=e("cs!common/filters/running-average-filter"),o=e("common/validator"),a=e("./metadata"),s=e("sensor-applet"),l=s.unitsDefinition,u=s.sensorDefinitions,c=e("lab.config"),d=e("common/controllers/basic-dialog"),p=e("common/controllers/export-controller"),h={label:"Sensor Reading",unitAbbreviation:"-",format:".2f",min:0,max:1};return function(e){function d(e,t,n){var i,s,u,c;if("mainProperty"===t)i=a.mainProperties;else{if("viewOption"!==t)throw new Error(t+" is not a supported built-in property type");i=a.viewOptions}u=o.propertyChangeInvalidates(i[e]),s={type:t,writable:o.propertyIsWritable(i[e]),set:n,includeInHistoryState:!!i[e].storeInTickHistory,validate:function(t){return o.validateSingleProperty(i[e],e,t,!1)},beforeSetCallback:u?f:void 0,afterSetCallback:u?m:void 0},c=i[e].unitType,s.description=c?new r(l,{unitType:c}):new r(null,{label:i.label||e}),Q.defineProperty(e,s)}function f(){0===st&&(Q.storeComputedProperties(),Q.deleteComputedPropertyCachedValues(),Q.enableCaching=!1),st++}function m(){st--,v(),0===st&&(Q.enableCaching=!0,Q.notifyChangedComputedProperties())}function g(e){f(),e(),m()}function v(){lt.forEach(function(e){e.addSample()})}function y(e,t,n){var i,o;i=Z.getPropertyDescription(e).getHash(),i.min=t,i.max=n,o=new r(l,i),Q.setPropertyDescription(e,o)}function b(){null!=Z.properties.collectionTime&&y("displayTime",0,Z.properties.collectionTime)}function x(){V&&(V.removeListeners("data"),V.removeListeners("deviceUnplugged"),V.removeListeners("sensorUnplugged"),V.remove()),g(function(){rt=!1,it=!1})}function w(){g(function(){it=!0}),setTimeout(function(){V.on("data",N),V.on("deviceUnplugged",function(){C("device")}),V.on("sensorUnplugged",function(){C("sensor")}),V.append($("body"),function(e){return e?(e instanceof s.JavaLoadError?T("It appears that Java applets cannot run in your browser. If you are able to fix this, reload the page to use the sensor"):e instanceof s.AppletInitializationError?T("The sensor applet appears not to be loading. If you are able to fix this, reload the page to use the sensor"):e instanceof s.SensorConnectionError?_():T("There was an unexpected error when connecting to the sensor."),void g(function(){it=!1})):void g(function(){rt=!0,it=!1})})},10)}function _(){x(),t("The "+Z.properties.sensorName+' does not appear to be attached. Try re-attaching it, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),w()},Cancel:function(){$(this).remove(),Z.reload()}})}function T(e){x(),t(e,{OK:function(){$(this).remove(),Z.reload()}})}function C(e){x(),Z.stop(),p.logAction("User unplugged the "+e+" ("+Z.properties[e+"Name"]+")."),t("The "+Z.properties[e+"Name"]+' was unplugged. Try plugging it back in, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),w()},Cancel:function(){$(this).dialog("close")}})}function A(){F&&clearInterval(F);var e=function(e,t){if(e)if(e instanceof s.AlreadyReadingError);else{if(!(e instanceof s.SensorConnectionError))throw clearInterval(F),e;clearInterval(F),_()}else g(function(){G=t[0],U=t[1],q&&(Z.properties.tareValue=G,q=!1),H&&(Z.properties.tareValue2=U,H=!1)})};F=setInterval(function(){V.readSensor(e)},1e3/ot)}function S(){F&&(clearInterval(F),F=null)}function P(){z=0,j=0,G=void 0,U=void 0,W=!1,Y=!1,X=!1,q=!1,H=!1}function E(){if(D&&B){var e=u[D],t=u[B],n=s[e.appletClass];V=window.Lab.sensor[D+B]=new n({listenerPath:"Lab.sensor."+D+B,sensorDefinitions:[e,t],appletId:D+B+"-sensor",codebase:c.rootUrl+"/jars/lab-sensor-applet-interface-dist"}),w()}}function k(){if(D&&B){var e=u[D],t=u[B];at=Math.max(e.samplesPerSecond,t.samplesPerSecond)}}function R(e){var t,n,i;D!==e&&(D&&(Z.properties.tareValue=0),D=e,G=void 0,V&&x(),D?(t=u[D],i=t.measurementType,Y=t.tareable,k(),E(),n=new r(l,{label:t.measurementName,unitType:i,min:t.minReading,max:t.maxReading}),Q.setPropertyDescription("sensorReading",n),null==Z.properties.collectionTime&&(Z.properties.collectionTime=t.maxSeconds)):Z.properties.hasOwnProperty("sensorReading")&&(n=new r(l,h),Q.setPropertyDescription("sensorReading",n)))}function M(e){var t,n,i;B!==e&&(B&&(Z.properties.tareValue2=0),B=e,U=void 0,V&&x(),B?(t=u[B],i=t.measurementType,X=t.tareable,k(),E(),n=new r(l,{label:t.measurementName,unitType:i,min:t.minReading,max:t.maxReading}),Q.setPropertyDescription("sensorReading2",n),null==Z.properties.collectionTime&&(Z.properties.collectionTime=t.maxSeconds)):Z.properties.hasOwnProperty("sensorReading2")&&(n=new r(l,h),Q.setPropertyDescription("sensorReading2",n)))}function N(e){z++,j+=1/at,window.__bizarreSafariFix=1,G=e[0],U=e[1],W||(Z.freeze("sensorType"),Z.freeze("sensorType2")),W=!0,Q.deleteComputedPropertyCachedValues(),Q.notifyAllComputedProperties(),v(),nt.tick()}var O,L,I,D,B,V,F,j,G,U,z,W,q,H,Y,X,J,K,Z,Q=new n({types:["mainProperty","viewOption","parameter","output"]}),et=!0,tt=!1,nt=d3.dispatch("play","stop","tick","tickStart","willReset","reset","stepForward","stepBack","seek","invalidation"),rt=!1,it=!1,ot=1,at=10,st=0,lt=[];return Z={on:function(e,t){nt.on(e,t)},start:function(){Z.properties.isPlayable&&V.start(function(e,t){e?e instanceof s.SensorConnectionError&&_():t&&(g(function(){et=!1}),nt.play())})},stop:function(){V&&V.stop(),g(function(){et=!0}),nt.stop()},tare:function(){if(!et)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=F&&null!=G?Z.properties.tareValue=G:g(function(){q=!0})},tare2:function(){if(!et)throw new Error("Sensor model: tare() called on a non-stopped model.");null!=F&&null!=U?Z.properties.tareValue2=U:g(function(){H=!0})},willReset:function(){nt.willReset()},reset:function(){Z.stop(),x(),P(),Z.unfreeze("sensorType"),Z.unfreeze("sensorType2"),Z.properties.sensorType=I,Z.properties.sensorType2=I,nt.reset()},reload:function(){Z.stop(),g(function(){tt=!0})},isStopped:function(){return et},stepCounter:function(){return z},addPropertiesListener:function(e,t){"string"==typeof e?Z.addObserver(e,t):e.forEach(function(e){Z.addObserver(e,t)})},defineParameter:function(e,t,n){var i={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new r(l,t),beforeSetCallback:f,afterSetCallback:m};n&&(i.set=function(e){n.call(Z,e)}),Q.defineProperty(e,i)},defineOutput:function(e,t,n){Q.defineProperty(e,{type:"output",writable:!1,get:n,includeInHistoryState:!1,description:new r(l,t)})},defineFilteredOutput:function(e,t,n,r,o){var a,s;if("RunningAverage"!==r)throw new Error("FilteredOutput: unknown filter type "+r+".");if(a=new i(o),s=Z.properties[e],void 0===s||isNaN(Number(s)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");a.addSample(Z.properties.time,s),lt.push({addSample:function(){a.addSample(Z.properties.time,Z.properties[n])}}),t.property=n,t.type=r,t.period=o,Z.defineOutput(e,t,function(){return a.calculate()})},serialize:function(){return""}},P(),void 0===window.Lab&&(window.Lab={}),window.Lab.sensor={},Q.mixInto(Z),K={sensorType:R,sensorType2:M},L=o.validateCompleteness(a.mainProperties,e),Object.keys(L).forEach(function(e){d(e,"mainProperty",K[e])}),Q.setRawValues(L),I=Z.properties.sensorType,J=Z.properties.tareValue,O=o.validateCompleteness(a.viewOptions,e.viewOptions||{}),Object.keys(O).forEach(function(e){d(e,"viewOption")}),Q.setRawValues(O),Z.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return j}),Z.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return j}),Z.defineOutput("sensorReading",h,function(){return null==G?G:G-Z.properties.tareValue}),Z.defineOutput("sensorReading2",h,function(){return null==U?U:U-Z.properties.tareValue2}),Z.defineOutput("sensorName",{label:"Sensor Name"},function(){return u[D].sensorName}),Z.defineOutput("sensorName2",{label:"Sensor Name"},function(){return u[B].sensorName}),Z.defineOutput("deviceName",{label:"Sensor Interface Device Name"},function(){return u[D].deviceName}),Z.defineOutput("deviceName2",{label:"Sensor Interface Device Name"},function(){return u[B].deviceName}),Z.defineOutput("isStopped",{label:"Stopped?"},function(){return et}),Z.defineOutput("isPlayable",{label:"Startable?"},function(){return rt&&!W}),Z.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return W}),Z.defineOutput("shouldPollSensor",{label:"Polling Sensor?"},function(){return Z.properties.isPlayable&&et}),Z.defineOutput("isSensorInitializing",{label:"Loading Sensor?"},function(){return it}),Z.defineOutput("isTaring",{label:"Waiting for a tare value?"},function(){return q}),Z.defineOutput("isTaring2",{label:"Waiting for a tare value?"},function(){return H}),Z.defineOutput("canTare",{label:"Can set a tare value?"},function(){return et&&!W&&Y&&!q}),Z.defineOutput("canTare2",{label:"Can set a tare value?"},function(){return et&&!W&&X&&!H}),Z.defineOutput("needsReload",{label:"Needs Reload?"},function(){return tt}),Z.on("willReset.model",x),Z.addObserver("shouldPollSensor",function(){Z.properties.shouldPollSensor?A():S()}),Z.addObserver("collectionTime",b),b(),R(Z.properties.sensorType),M(Z.properties.sensorType2),Z}}),define("models/dual-sensor/view",["common/views/select-box-view","common/views/numeric-output-view","sensor-applet","common/views/view-state"],function(){var e=require("common/views/select-box-view"),t=require("common/views/numeric-output-view"),n=require("sensor-applet").sensorDefinitions,r=require("common/views/view-state");return function(i,o){function a(){m.$zeroButton.find("button").html(i.properties.isTaring?"Zeroing...":"Zero")}function s(){i.properties.canTare?r.enableView(m.$zeroButton):r.disableView(m.$zeroButton)}function l(){m.$zeroButton2.find("button").html(i.properties.isTaring2?"Zeroing...":"Zero")}function u(){i.properties.canTare2?r.enableView(m.$zeroButton2):r.disableView(m.$zeroButton2)}function c(){var e=i.getPropertyDescription("sensorType");e.getFrozen()?r.disableView(m.$selectBox):r.enableView(m.$selectBox)}function d(){var e=i.getPropertyDescription("sensorType2");e.getFrozen()?r.disableView(m.$selectBox2):r.enableView(m.$selectBox2)}function p(){i.addObserver("isTaring",a),i.addObserver("isTaring2",l),a(),l(),i.addObserver("canTare",s),i.addObserver("canTare2",u),s(),u(),i.addPropertyDescriptionObserver("sensorType",c),c(),i.addPropertyDescriptionObserver("sensorType2",d),d()}var h,f,m,g=new e({id:"sensor-type-view",options:[{value:null,text:"Select type of sensor...",selected:null==i.properties.sensorType,disabled:!0}].concat(Object.keys(n).filter(function(e){return"LabQuest"===n[e].appletClass}).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType,disabled:!1}})),onChange:function(e){i.properties.sensorType=e.value}}),v=new e({id:"sensor-type2-view",options:[{value:null,text:"Select type of sensor...",selected:null==i.properties.sensorType2,disabled:!0}].concat(Object.keys(n).filter(function(e){return"LabQuest"===n[e].appletClass}).map(function(e){return{value:e,text:n[e].sensorName,selected:e===i.properties.sensorType2,disabled:!1}})),onChange:function(e){i.properties.sensorType2=e.value}}),y=d3.format(".2f");return m={$el:$("<div id='model-container' class='container sensor-model-container' />"),bindModel:function(e,t){o=t||o,i=e||i,p()},getHeightForWidth:function(){return"4.8em"},setup:function(){this.$el.empty(),h=new t({id:"sensor-value-view",label:"Reading: ",units:i.getPropertyDescription("sensorReading").getUnitAbbreviation()}),f=new t({id:"sensor-value-2-view",label:"Reading: ",units:i.getPropertyDescription("sensorReading2").getUnitAbbreviation()});var e=$("<div></div>"),n=$("<div></div>"),r=g.render(this.$el),o=v.render(this.$el),a=$("<div><button>Zero</button></div>"),s=$("<div><button>Zero</button></div>"),l=h.render(),u=f.render();r.addClass("interactive-pulldown component component-spacing"),o.addClass("interactive-pulldown component component-spacing"),a.addClass("interactive-button component component-spacing"),s.addClass("interactive-button component component-spacing"),l.addClass("numeric-output component horizontal component-spacing"),u.addClass("numeric-output component horizontal component-spacing"),this.$el.css("zIndex",4),this.$el.append(e),this.$el.append(n),e.append(r),e.append(l),e.append(a),n.append(o),n.append(u),n.append(s),this.$zeroButton=a,this.$zeroButton2=s,this.$selectBox=r,this.$selectBox2=o,h.resize(),f.resize(),p(),a.on("click","button",function(){i.tare()}),s.on("click","button",function(){i.tare2()})},showInitializationProgress:function(){var e;this.$progressbarContainer||(e=$("<div/>").attr("id","sensor-progressbar"),this.$progressbarContainer=$("<div/>").attr("id","sensor-progressbar-container").css("bottom",$("body").height()/2+75+$(".lab-responsive-content").offset().top).append('<div class="label">Loading sensor...</div>').append(e).appendTo(".lab-responsive-content"),e.progressbar({value:!1})),this.$progressbarContainer.show()},hideInitializationProgress:function(){this.$progressbarContainer.hide()},resize:function(){h&&h.resize(),f&&f.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(e){h.updateUnits(e),null==i.properties.sensorReading&&h.hideUnits()},updateUnits2:function(e){f.updateUnits(e),null==i.properties.sensorReading2&&f.hideUnits()},update:function(){null==i.properties.sensorReading?(h.update(""),h.hideUnits()):(h.update(y(i.properties.sensorReading)),h.showUnits()),null==i.properties.sensorReading2?(f.update(""),f.hideUnits()):(f.update(y(i.properties.sensorReading2)),f.showUnits())}}}}),define("models/dual-sensor/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/dual-sensor/controller",["require","common/controllers/model-controller","models/dual-sensor/modeler","models/dual-sensor/view","models/dual-sensor/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/dual-sensor/modeler"),r=e("models/dual-sensor/view"),i=e("models/dual-sensor/scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("isSensorInitializing",function(){var t=l.modelContainer;e.properties.isSensorInitializing?t.showInitializationProgress():t.hideInitializationProgress()}),e.addObserver("sensorReading",function(){e.isStopped()&&l.updateView()}),e.addObserver("sensorReading2",function(){e.isStopped()&&l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())}),e.addPropertyDescriptionObserver("sensorReading2",function(){var t=e.getPropertyDescription("sensorReading2"),n=l.modelContainer;n.updateUnits2(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.dual-sensor-model-controller",s),a.on("modelReset.dual-sensor-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0)}),l}}),define("models/sensor-server/metadata",[],function(){return{mainProperties:{type:{defaultValue:"sensor-server",immutable:!0},sensorType:{defaultValue:null},tareValue:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),define("common/state-machine",[],function(){function e(e){var t=this;this.states=e,this.currentState=null,Object.keys(e).forEach(function(n){var r=e[n];if(void 0!==r.name&&r.name!==n)throw new Error("State "+n+" already has a 'name' property. The 'name' property is reserved.");if(r.name=n,void 0!==r.gotoState)throw new Error("State "+n+" already has a 'gotoState' property. The 'gotoState' property is reserved.");r.gotoState=function(e){if(this!==t.currentState)throw new Error("gotoState was called on state "+this.name+" but the current state is ",t.getCurrentStateName());t.gotoState(e)}})}return e.prototype.getCurrentStateName=function(){return this.currentState?this.currentState.name:"<no state>"},e.prototype.gotoState=function(e){var t=this.states[e];if(!t)throw new Error("gotoState was called with state name "+e+" but no such state exists.");this.currentState&&"function"==typeof this.currentState.leaveState&&this.currentState.leaveState(),this.currentState=t,"function"==typeof this.currentState.enterState&&this.currentState.enterState()},e.prototype.handleEvent=function(e){var t=Array.prototype.slice.call(arguments,1);return"function"==typeof this.currentState[e]?(this.currentState[e].apply(this.currentState,t),!0):!1},e}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("sensor-server-interface",e):"undefined"!=typeof window?window.sensorServerInterface=e():"undefined"!=typeof global?global.sensorServerInterface=e():"undefined"!=typeof self&&(self.sensorServerInterface=e())}(function(){var e;return function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return i(n?n:t)},u,u.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){"use strict";function n(){p=[],h=Object.create(null),f=Object.create(null),m=!1}function r(e,t){var n=w+t,r=new XMLHttpRequest;if("withCredentials"in r)r.open(e,n,!0),r.responseType="json",r.setRequestHeader("Accept","application/json");else{if("undefined"==typeof XDomainRequest)return null;r=new XDomainRequest,r.open(e,n)}return r}function i(){x.emit("connectionTimedOut"),S=!1}function o(){var e=r("GET","/status");return e?(e.onerror=a,e.onload=s,void e.send()):void a()}function a(){x.emit("statusErrored")}function s(){var e=this.response||JSON.parse(this.responseText);if("string"==typeof e&&(e=JSON.parse(e)),C&&!(e.requestTimeStamp<A)){if(g){if(g!==e.sessionID)return void(m||(x.emit("sessionChanged"),m=!0))}else g=e.sessionID,n();A=e.requestTimeStamp,E.reset(),l(e.sets),u(e.columns),S=!0,x.emit("statusReceived"),P&&!e.collection.isCollecting?(P=!1,x.emit("collectionStopped")):!P&&e.collection.isCollecting&&(P=!0,x.emit("collectionStarted"))}}function l(e){Object.keys(e).forEach(function(e){h[e]||(x.emit("datasetAdded",e),h[e]={columns:[],id:e},p.unshift(h[e]))}),p.sort(function(e,t){return t.setId-e.setId})}function u(e){Object.keys(e).forEach(function(t){var n=[],r=e[t],i=h[r.setID],o=f[t];o?o!==i.columns[r.position]&&n.push("columnMoved"):(n.push("columnAdded"),o=f[t]={id:null,units:null,receivedValuesTimeStamp:0,requestedValuesTimeStamp:0,liveValue:null,data:[]}),i.columns[r.position]=o,null!==o.units&&o.units!==r.units&&n.push("columnTypeChanged"),o.units=r.units,o.id=t,o.liveValue=parseFloat(r.liveValue||0),o.requestedValuesTimeStamp<r.valuesTimeStamp&&(c(t,r.valuesTimeStamp),o.requestedValuesTimeStamp=r.valuesTimeStamp),n.forEach(function(e){x.emit(e,t)})}),Object.keys(f).forEach(function(t){e[t]||(x.emit("columnRemoved",t),delete f[t])})}function c(e,t){var n=r("GET","/columns/"+e);n.send(),n.onload=function(){if(C){var n=this.response||JSON.parse(this.responseText);"string"==typeof n&&(n=JSON.parse(n));var r=n.values,i=f[e];t>i.receivedValuesTimeStamp&&(i.data.length=0,[].push.apply(i.data,r),i.receivedValuesTimeStamp=t,x.emit("data",e))}}}function d(e){return function(){return new y.Promise(function(t,n){var i=r("GET",e);i||n(new Error("This browser does not appear to support Cross-Origin Resource Sharing")),i.send(),i.onerror=function(){n(this)},i.onload=t})}}var p,h,f,m,g,v,y=e("rsvp"),b=e("eventemitter2").EventEmitter2,x=new b({wildcard:!0}),w="",_=1e4,T=100,C=!1,A=0,S=!1,P=!1,E={start:function(){this.timerId=setTimeout(i,_)},reset:function(){this.stop(),this.start()},stop:function(){clearTimeout(this.timerId)}};t.exports={startPolling:function(e){w="http://"+e,o(),C=!0,S=!1,E.start(),v=setInterval(o,T)},stopPolling:function(){E.stop(),clearInterval(v),g=void 0,C=!1},requestStart:d("/control/start"),requestStop:d("/control/stop"),on:function(){x.on.apply(x,arguments)},off:function(){x.off.apply(x,arguments)},get datasets(){return p},get isConnected(){return C&&S},get isCollecting(){return C&&S&&P}}},{eventemitter2:3,rsvp:4}],2:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],3:[function(t,n,r){var i=t("__browserify_process");!function(t){function n(){this._events={},this._conf&&r.call(this,this._conf)}function r(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function i(e){this._events={},this.newListener=!1,r.call(this,e)}function o(e,t,n,r){if(!n)return[];var i,a,s,l,u,c,d,p=[],h=t.length,f=t[r],m=t[r+1];if(r===h&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(i=0,a=n._listeners.length;a>i;i++)e&&e.push(n._listeners[i]);return[n]}if("*"===f||"**"===f||n[f]){if("*"===f){for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&(p=p.concat(o(e,t,n[s],r+1)));
return p}if("**"===f){d=r+1===h||r+2===h&&"*"===m,d&&n._listeners&&(p=p.concat(o(e,t,n,h)));for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&("*"===s||"**"===s?(n[s]._listeners&&!d&&(p=p.concat(o(e,t,n[s],h))),p=p.concat(o(e,t,n[s],r))):p=p.concat(s===m?o(e,t,n[s],r+2):o(e,t,n[s],r)));return p}p=p.concat(o(e,t,n[f],r+1))}if(l=n["*"],l&&o(e,t,l,r+1),u=n["**"])if(h>r){u._listeners&&o(e,t,u,h);for(s in u)"_listeners"!==s&&u.hasOwnProperty(s)&&(s===m?o(e,t,u[s],r+2):s===f?o(e,t,u[s],r+1):(c={},c[s]=u[s],o(e,t,{"**":c},r+1)))}else u._listeners?o(e,t,u,h):u["*"]&&u["*"]._listeners&&o(e,t,u["*"],h);return p}function a(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,r=e.length;r>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var i=this.listenerTree,o=e.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===e.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,t];else if(s(i._listeners)&&(i._listeners.push(t),!i._listeners.warned)){var a=l;"undefined"!=typeof this._events.maxListeners&&(a=this._events.maxListeners),a>0&&i._listeners.length>a&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=t;return!0}o=e.shift()}return!0}var s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=10;i.prototype.delimiter=".",i.prototype.setMaxListeners=function(e){this._events||n.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},i.prototype.event="",i.prototype.once=function(e,t){return this.many(e,1,t),this},i.prototype.many=function(e,t,n){function r(){0===--t&&i.off(e,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(e,r),i},i.prototype.emit=function(){this._events||n.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var t=arguments.length,r=new Array(t-1),i=1;t>i;i++)r[i-1]=arguments[i];for(i=0,t=this._all.length;t>i;i++)this.event=e,this._all[i].apply(this,r)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var a;if(this.wildcard){a=[];var s="string"==typeof e?e.split(this.delimiter):e.slice();o.call(this,a,s,this.listenerTree,0)}else a=this._events[e];if("function"==typeof a){if(this.event=e,1===arguments.length)a.call(this);else if(arguments.length>1)switch(arguments.length){case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:for(var t=arguments.length,r=new Array(t-1),i=1;t>i;i++)r[i-1]=arguments[i];a.apply(this,r)}return!0}if(a){for(var t=arguments.length,r=new Array(t-1),i=1;t>i;i++)r[i-1]=arguments[i];for(var l=a.slice(),i=0,t=l.length;t>i;i++)this.event=e,l[i].apply(this,r);return l.length>0||this._all}return this._all},i.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||n.call(this),this.emit("newListener",e,t),this.wildcard)return a.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(s(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var r=l;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=t;return this},i.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();r=o.call(this,null,i,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var l=r[a];if(n=l._listeners,s(n)){for(var u=-1,c=0,d=n.length;d>c;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){u=c;break}if(0>u)continue;return this.wildcard?l._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e])}return this},i.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,r=t.length;r>n;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||n.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),r=o.call(this,null,t,this.listenerTree,0),i=0;i<r.length;i++){var a=r[i];a._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},i.prototype.listeners=function(e){if(this.wildcard){var t=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return o.call(this,t,r,this.listenerTree,0),t}return this._events||n.call(this),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},i.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof e&&e.amd?e(function(){return i}):t.EventEmitter2=i}("undefined"!=typeof i&&"undefined"!=typeof i.title&&"undefined"!=typeof r?r:window)},{__browserify_process:2}],4:[function(e,t,n){"use strict";function r(e,t){g.async(e,t)}function i(){g.on.apply(g,arguments)}function o(){g.off.apply(g,arguments)}var a=e("./rsvp/promise")["default"],s=e("./rsvp/events")["default"],l=e("./rsvp/node")["default"],u=e("./rsvp/all")["default"],c=e("./rsvp/all-settled")["default"],d=e("./rsvp/race")["default"],p=e("./rsvp/hash")["default"],h=e("./rsvp/hash-settled")["default"],f=e("./rsvp/rethrow")["default"],m=e("./rsvp/defer")["default"],g=e("./rsvp/config").config,v=e("./rsvp/config").configure,y=e("./rsvp/map")["default"],b=e("./rsvp/resolve")["default"],x=e("./rsvp/reject")["default"],w=e("./rsvp/filter")["default"],_=e("./rsvp/asap")["default"];if(g.async=_,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var T=window.__PROMISE_INSTRUMENTATION__;v("instrument",!0);for(var C in T)T.hasOwnProperty(C)&&i(C,T[C])}n.Promise=a,n.EventTarget=s,n.all=u,n.allSettled=c,n.race=d,n.hash=p,n.hashSettled=h,n.rethrow=f,n.defer=m,n.denodeify=l,n.configure=v,n.on=i,n.off=o,n.resolve=b,n.reject=x,n.async=r,n.map=y,n.filter=w},{"./rsvp/all":6,"./rsvp/all-settled":5,"./rsvp/asap":7,"./rsvp/config":8,"./rsvp/defer":9,"./rsvp/events":10,"./rsvp/filter":11,"./rsvp/hash":13,"./rsvp/hash-settled":12,"./rsvp/map":15,"./rsvp/node":16,"./rsvp/promise":17,"./rsvp/race":23,"./rsvp/reject":24,"./rsvp/resolve":25,"./rsvp/rethrow":26}],5:[function(e,t,n){"use strict";function r(e){return{state:"fulfilled",value:e}}function i(e){return{state:"rejected",reason:e}}var o=e("./promise")["default"],a=e("./utils").isArray,s=e("./utils").isNonThenable;n["default"]=function(e,t){return new o(function(t){function n(e){return function(t){u(e,r(t))}}function l(e){return function(t){u(e,i(t))}}function u(e,n){p[e]=n,0===--d&&t(p)}if(!a(e))throw new TypeError("You must pass an array to allSettled.");var c,d=e.length;if(0===d)return void t([]);for(var p=new Array(d),h=0;h<e.length;h++)c=e[h],s(c)?u(h,r(c)):o.resolve(c).then(n(h),l(h))},t)}},{"./promise":17,"./utils":27}],6:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.all(e,t)}},{"./promise":17}],7:[function(e,t,n){function r(){return function(){s.nextTick(a)}}function i(){var e=0,t=new c(a),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function o(){return function(){setTimeout(a,1)}}function a(){for(var e=0;e<d.length;e++){var t=d[e],n=t[0],r=t[1];n(r)}d.length=0}var s=e("__browserify_process");n["default"]=function(e,t){var n=d.push([e,t]);1===n&&l()};var l,u="undefined"!=typeof window?window:{},c=u.MutationObserver||u.WebKitMutationObserver,d=[];l="undefined"!=typeof s&&"[object process]"==={}.toString.call(s)?r():c?i():o()},{__browserify_process:2}],8:[function(e,t,n){"use strict";function r(e,t){return"onerror"===e?void o.on("error",t):2!==arguments.length?o[e]:void(o[e]=t)}var i=e("./events")["default"],o={instrument:!1};i.mixin(o),n.config=o,n.configure=r},{"./events":10}],9:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e){var t={};return t.promise=new r(function(e,n){t.resolve=e,t.reject=n},e),t}},{"./promise":17}],10:[function(e,t,n){"use strict";function r(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function i(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}n["default"]={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var n,o=i(this);n=o[e],n||(n=o[e]=[]),-1===r(n,t)&&n.push(t)},off:function(e,t){var n,o,a=i(this);return t?(n=a[e],o=r(n,t),void(-1!==o&&n.splice(o,1))):void(a[e]=[])},trigger:function(e,t){var n,r,o=i(this);if(n=o[e])for(var a=0;a<n.length;a++)(r=n[a])(t)}}},{}],11:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=e("./utils").isFunction;n["default"]=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as filter's second argument.");for(var o=e.length,a=new Array(o),s=0;o>s;s++)a[s]=t(e[s]);return r.all(a,n).then(function(t){for(var n=new Array(o),r=0,i=0;o>i;i++)t[i]===!0&&(n[r]=e[i],r++);return n.length=r,n})})}},{"./promise":17,"./utils":27}],12:[function(e,t,n){"use strict";function r(e){return{state:"fulfilled",value:e}}function i(e){return{state:"rejected",reason:e}}var o=e("./promise")["default"],a=e("./utils").isNonThenable,s=e("./utils").keysOf;n["default"]=function(e){return new o(function(t){function n(e){return function(t){u(e,r(t))}}function l(e){return function(t){u(e,i(t))}}function u(e,n){p[e]=n,0===--f&&t(p)}var c,d,p={},h=s(e),f=h.length;if(0===f)return void t(p);for(var m=0;m<h.length;m++)d=h[m],c=e[d],a(c)?u(d,r(c)):o.resolve(c).then(n(d),l(d))})}},{"./promise":17,"./utils":27}],13:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=e("./utils").isNonThenable,o=e("./utils").keysOf;n["default"]=function(e){return new r(function(t,n){function a(e){return function(n){c[e]=n,0===--p&&t(c)}}function s(e){p=0,n(e)}var l,u,c={},d=o(e),p=d.length;if(0===p)return void t(c);for(var h=0;h<d.length;h++)u=d[h],l=e[u],i(l)?(c[u]=l,0===--p&&t(c)):r.resolve(l).then(a(u),s)})}},{"./promise":17,"./utils":27}],14:[function(e,t,n){"use strict";var r=e("./config").config,i=e("./utils").now;n["default"]=function(e,t,n){try{r.trigger(e,{guid:t._guidKey+t._id,eventName:e,detail:t._detail,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:i(),stack:new Error(t._label).stack})}catch(o){setTimeout(function(){throw o},0)}}},{"./config":8,"./utils":27}],15:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=(e("./utils").isArray,e("./utils").isFunction);n["default"]=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as map's second argument.");for(var o=e.length,a=new Array(o),s=0;o>s;s++)a[s]=t(e[s]);return r.all(a,n)})}},{"./promise":17,"./utils":27}],16:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=e("./utils").isArray;n["default"]=function(e,t){function n(){for(var n=arguments.length,i=new Array(n),s=0;n>s;s++)i[s]=arguments[s];var l;return o||a||!t?l=this:(console.warn('Deprecation: RSVP.denodeify() doesn\'t allow setting the "this" binding anymore. Use yourFunction.bind(yourThis) instead.'),l=t),r.all(i).then(function(n){function i(r,i){function s(){for(var e=arguments.length,n=new Array(e),s=0;e>s;s++)n[s]=arguments[s];var l=n[0],u=n[1];if(l)i(l);else if(o)r(n.slice(1));else if(a){var c,d,p={},h=n.slice(1);for(d=0;d<t.length;d++)c=t[d],p[c]=h[d];r(p)}else r(u)}n.push(s),e.apply(l,n)}return new r(i)})}var o=t===!0,a=i(t);return n.__proto__=e,n}},{"./promise":17,"./utils":27}],17:[function(e,t,n){"use strict";function r(){}function i(e,t){if(!y(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._id=S++,this._label=t,this._subscribers=[],m.instrument&&g("created",this),r!==e&&o(e,this)}function o(e,t){function n(e){c(t,e)}function r(e){p(t,e)}try{e(n,r)}catch(i){r(i)}}function a(e,t,n,r){var i=e._subscribers,o=i.length;i[o]=t,i[o+k]=n,i[o+R]=r}function s(e,t){var n,r,i=e._subscribers,o=e._detail;m.instrument&&g(t===k?"fulfilled":"rejected",e);for(var a=0;a<i.length;a+=3)n=i[a],r=i[a+t],l(t,n,r,o);e._subscribers=null}function l(e,t,n,r){var i,o,a,s,l=y(n);if(l)try{i=n(r),a=!0}catch(d){s=!0,o=d}else i=r,a=!0;u(t,i)||(l&&a?c(t,i):s?p(t,o):e===k?c(t,i):e===R&&p(t,i))}function u(e,t){var n,r=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(v(t)&&(r=t.then,y(r)))return r.call(t,function(r){return n?!0:(n=!0,void(t!==r?c(e,r):d(e,r)))},function(t){return n?!0:(n=!0,void p(e,t))},"Settle: "+(e._label||" unknown promise")),!0}catch(i){return n?!0:(p(e,i),!0)}return!1}function c(e,t){e===t?d(e,t):u(e,t)||d(e,t)}function d(e,t){e._state===P&&(e._state=E,e._detail=t,m.async(h,e))}function p(e,t){e._state===P&&(e._state=E,e._detail=t,m.async(f,e))}function h(e){s(e,e._state=k)}function f(e){e._onerror&&e._onerror(e._detail),s(e,e._state=R)}var m=e("./config").config,g=(e("./events")["default"],e("./instrument")["default"]),v=e("./utils").objectOrFunction,y=e("./utils").isFunction,b=e("./utils").now,x=e("./promise/cast")["default"],w=e("./promise/all")["default"],_=e("./promise/race")["default"],T=e("./promise/resolve")["default"],C=e("./promise/reject")["default"],A="rsvp_"+b()+"-",S=0;n["default"]=i,i.cast=x,i.all=w,i.race=_,i.resolve=T,i.reject=C;var P=void 0,E=0,k=1,R=2;i.prototype={constructor:i,_id:void 0,_guidKey:A,_label:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,_onerror:function(e){m.trigger("error",e)},then:function(e,t,n){var i=this;this._onerror=null;var o=new this.constructor(r,n);if(this._state){var s=arguments;m.async(function(){l(i._state,o,s[i._state-1],i._detail)})}else a(this,o,e,t);return m.instrument&&g("chained",i,o),o},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}}},{"./config":8,"./events":10,"./instrument":14,"./promise/all":18,"./promise/cast":19,"./promise/race":20,"./promise/reject":21,"./promise/resolve":22,"./utils":27}],18:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=e("../utils").isNonThenable;n["default"]=function(e,t){var n=this;return new n(function(t,o){function a(e){return function(n){c[e]=n,0===--u&&t(c)}}function s(e){u=0,o(e)}if(!r(e))throw new TypeError("You must pass an array to all.");var l,u=e.length,c=new Array(u);if(0===u)return void t(c);for(var d=0;d<e.length;d++)l=e[d],i(l)?(c[d]=l,0===--u&&t(c)):n.resolve(l).then(a(d),s)},t)}},{"../utils":27}],19:[function(e,t,n){"use strict";n["default"]=function(e,t){var n=this;return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)},t)}},{}],20:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=(e("../utils").isFunction,e("../utils").isNonThenable);n["default"]=function(e,t){var n,o=this;return new o(function(t,a){function s(e){u&&(u=!1,t(e))}function l(e){u&&(u=!1,a(e))}if(!r(e))throw new TypeError("You must pass an array to race.");for(var u=!0,c=0;c<e.length;c++){if(n=e[c],i(n))return u=!1,void t(n);o.resolve(n).then(s,l)}},t)}},{"../utils":27}],21:[function(e,t,n){"use strict";n["default"]=function(e,t){var n=this;return new n(function(t,n){n(e)},t)}},{}],22:[function(e,t,n){"use strict";n["default"]=function(e,t){var n=this;return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)},t)}},{}],23:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.race(e,t)}},{"./promise":17}],24:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.reject(e,t)}},{"./promise":17}],25:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.resolve(e,t)}},{"./promise":17}],26:[function(e,t,n){"use strict";n["default"]=function(e){throw setTimeout(function(){throw e}),e}},{}],27:[function(e,t,n){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function o(e){return!r(e)}n.objectOrFunction=r,n.isFunction=i,n.isNonThenable=o;var a;a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var s=a;n.isArray=s;var l=Date.now||function(){return(new Date).getTime()};n.now=l;var u=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};n.keysOf=u},{}]},{},[1])(1)}),define("models/sensor-server/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"},temperature:{name:"degree Celsius",pluaralName:"degrees Celsius",symbol:"°C"},light:{name:"lux",pluralName:"lux",symbol:"lux"},force:{name:"Newton",pluralName:"Newtons",symbol:"N"},ph:{name:"pH Unit",pluralName:"pH Units",symbol:"pH"},co2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"},o2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"}}}}),define("models/sensor-server/sensor-definitions",[],function(){return{lux:{sensorName:"Light",measurementName:"Illumination",measurementType:"illumination",tareable:!0,minReading:0,maxReading:6e3},m:{sensorName:"Motion",measurementName:"Position",measurementType:"position",tareable:!0,minReading:0,maxReading:2},"m/s²":{sensorName:"Accelerometer",measurementName:"Acceleration",measurementType:"acceleration",tareable:!0,minReading:-50,maxReading:50},g:{sensorName:"Accelerometer",measurementName:"Acceleration",measurementType:"acceleration",tareable:!0,minReading:-5,maxReading:5},"N/kg":{sensorName:"Accelerometer",measurementName:"Acceleration",measurementType:"acceleration",tareable:!0,minReading:-25,maxReading:25},"mg/L":{sensorName:"Dissolved Oxygen",measurementName:"DO",measurementType:"do",tareable:!0,minReading:0,maxReading:12},kPa:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:220},"mm Hg":{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2e3},"in Hg":{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:80},mbar:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2200},psi:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:40},atm:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2.5},torr:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2e3},nC:{sensorName:"Charge Sensor",measurementName:"Charge",measurementType:"charge",tareable:!1,minReading:-20,maxReading:20},V:{sensorName:"Voltage",measurementName:"Potential",measurementType:"potential",tareable:!0,minReading:-30,maxReading:30},ppm:{sensorName:"CO2 Gas",measurementName:"CO2",measurementType:"co2",tareable:!1,minReading:0,maxReading:5e3},ppt:{sensorName:"CO2 Gas",measurementName:"CO2",measurementType:"co2",tareable:!1,minReading:0,maxReading:5},"%":{sensorName:"CO2 Gas",measurementName:"CO2",measurementType:"co2",tareable:!1,minReading:0,maxReading:.5},"%T":{sensorName:"Colorimeter",measurementName:"Transmittance",measurementType:"transmittance",tareable:!1,minReading:0,maxReading:100},"µS/cm":{sensorName:"Conductivity",measurementName:"Conductivity",measurementType:"conductivity",tareable:!0,minReading:0,maxReading:2e3},"dS/m":{sensorName:"Conductivity",measurementName:"Conductivity",measurementType:"conductivity",tareable:!0,minReading:0,maxReading:2},A:{sensorName:"Current",measurementName:"Current",measurementType:"current",tareable:!0,minReading:-1.2,maxReading:1.2},mA:{sensorName:"Current",measurementName:"Current",measurementType:"current",tareable:!0,minReading:0,maxReading:500},"°C":{sensorName:"Temperature",measurementName:"Temperature",measurementType:"temperature",tareable:!1,minReading:0,maxReading:50},"°F":{sensorName:"Temperature",measurementName:"Temperature",measurementType:"temperature",tareable:!1,minReading:30,maxReading:100},K:{sensorName:"Temperature",measurementName:"Temperature",measurementType:"temperature",tareable:!1,minReading:250,maxReading:400},N:{sensorName:"Force",measurementName:"Force",measurementType:"force",tareable:!0,minReading:-50,maxReading:50},lb:{sensorName:"Force",measurementName:"Force",measurementType:"force",tareable:!0,minReading:-12.5,maxReading:12.5},mV:{sensorName:null,measurementName:"Potential",measurementType:"potential",tareable:!0,minReading:-500,maxReading:1100},"m/s":{sensorName:"Flow Rate",measurementName:"Flow Rate",measurementType:"flow rate",tareable:!0,minReading:0,maxReading:4},"ft/s":{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:100},ft:{sensorName:"Motion",measurementName:"Position",measurementType:"position",tareable:!0,minReading:0,maxReading:6},kg:{sensorName:"Hand Dynamometer",measurementName:"Force",measurementType:"force",tareable:!0,minReading:0,maxReading:50},v:{sensorName:"Heart Rate",measurementName:"Signal",measurementType:"signal",tareable:!1,minReading:0,maxReading:3},mT:{sensorName:"Magnetic Field",measurementName:"Magnetic Field",measurementType:"magnetic field",tareable:!0,minReading:-8,maxReading:8},G:{sensorName:"Magnetic Field",measurementName:"Magnetic Field",measurementType:"magnetic field",tareable:!0,minReading:-80,maxReading:80},rad:{sensorName:"Rotary Motion",measurementName:"Angle",measurementType:"angle",tareable:!0,minReading:-15,maxReading:15},"°":{sensorName:"Rotary Motion",measurementName:"Angle",measurementType:"angle",tareable:!0,minReading:-1e3,maxReading:1e3},cm:{sensorName:"Linear Position Sensor",measurementName:"Position",measurementType:"position",tareable:!0,minReading:0,maxReading:15},dB:{sensorName:"Sound Level",measurementName:"Sound Level",measurementType:"sound level",tareable:!0,minReading:40,maxReading:110},rel:{sensorName:"Spectrophotometer",measurementName:"Intensity",measurementType:"intensity",tareable:!1,minReading:0,maxReading:1},Rel:{sensorName:"Spectrophotometer",measurementName:"Fluorescence 405 nm",measurementType:"fluorescence 405 nm",tareable:!1,minReading:0,maxReading:1},"Rel.":{sensorName:"Spectrophotometer",measurementName:"Fluorescence 500 nm",measurementType:"fluorescence 500 nm",tareable:!1,minReading:0,maxReading:1},"L/s":{sensorName:"Spirometer",measurementName:"Flow Rate",measurementType:"flow rate",tareable:!0,minReading:-4,maxReading:4},"mL/s":{sensorName:"Spirometer",measurementName:"Flow Rate",measurementType:"flow rate",tareable:!0,minReading:-4e3,maxReading:4e3},NTU:{sensorName:"Turbidity",measurementName:"Turbidity",measurementType:"turbidity",tareable:!0,minReading:0,maxReading:50},"mW/m²":{sensorName:"UV Sensor",measurementName:"UV Intensity",measurementType:"uv intensity",tareable:!0,minReading:0,maxReading:2e4},mL:{sensorName:"Drop Counter",measurementName:"Volume",measurementType:"volume",tareable:!1,minReading:0,maxReading:3},f:{sensorName:"Altitude",measurementName:"Altitude",measurementType:"altitude",tareable:!0,minReading:-300,maxReading:300},mph:{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:10},"km/h":{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:20},knots:{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:50}}}),define("models/sensor-server/modeler",["require","common/lab-modeler-mixin","common/property-description","./metadata","common/state-machine","sensor-server-interface","./units-definition","./sensor-definitions","common/controllers/basic-dialog","underscore"],function(e){function t(e,t){var n=new u({width:"60%",buttons:t});n.setContent(e),n.open()}var n=e("common/lab-modeler-mixin"),r=e("common/property-description"),i=e("./metadata"),o=e("common/state-machine"),a=e("sensor-server-interface"),s=e("./units-definition"),l=e("./sensor-definitions"),u=e("common/controllers/basic-dialog"),c=(e("underscore"),{label:"Sensor Reading",unitAbbreviation:"-",format:".2f",min:0,max:10});return function(e){function u(){var e,t;_?(e=l[_.units],e?(t={label:e.measurementName,format:".2f",min:e.minReading,max:e.maxReading},s.units[e.measurementType]?t.unitType=e.measurementType:t.unitAbbreviation=_.units,N=e.tareable,T=e.sensorName):(t={label:"Sensor Reading",unitAbbreviation:_.units,format:".2f",min:0,max:10},N=!0,T=_.units+" sensor")):(t=c,N=!1,T="(no sensor)"),console.log("resetting sensor description: ",t),y.setPropertyDescription("sensorReading",new r(s,t)),y.setPropertyDescription("liveSensorReading",new r(s,t))}function d(){C=!0,k=0,S=0,P=void 0,E=void 0,w=void 0,_=void 0}function p(){var e,t=a.datasets[0];w=t.columns[0],e=t.columns[1],_=e,u(),_||(E=void 0)}function h(){if(w&&_)for(var e=Math.min(w.data.length,_.data.length);e>k;k++)S=w.data[k],P=_.data[k],L.updateAllOutputProperties(),b.tick()}function f(e){return e.receivedValuesTimeStamp>=e.requestedValuesTimeStamp}function m(){return f(w)&&(!_||f(_))}function g(e){var t=Array.prototype.slice.call(arguments,0);"statusReceived"!==e&&console.log("handling event: "+e,t),L.makeInvalidatingChange(function(){var n=x.handleEvent.apply(x,t);n||("connectionTimedOut"===e?x.gotoState("disconnected"):"sessionChanged"===e&&(a.stopPolling(),x.gotoState("disconnected")))})}var v,y,b,x,w,_,T,C,A,S,P,E,k,R,M,N,O,L;return L={on:function(e,t){b.on(e,t)},start:function(){g("start")},stop:function(){g("stop")},tare:function(){var e=R;R=!1,g("tare"),R=e},willReset:function(){b.willReset()},reset:function(){g("reset")},reload:function(){L.stop(),L.makeInvalidatingChange(function(){A=!0})},isStopped:function(){return C},stepCounter:function(){return k},serialize:function(){return""}},x=new o({notConnected:{enterState:function(){O="Not connected.",a.startPolling("127.0.0.1:11180"),this.gotoState("connecting")}},connecting:{enterState:function(){O="Connecting...",a.isConnected&&this.gotoState("connected")},statusErrored:function(){this.gotoState("initialConnectionFailure")},connectionTimedOut:function(){this.gotoState("initialConnectionFailure")},statusReceived:function(){this.gotoState("connected")},sessionChanged:function(){a.stopPolling(),a.startPolling()}},initialConnectionFailure:{enterState:function(){a.stopPolling(),O="Connection failed.",t("Could not connect to the Sensor Server. Please make sure that the Sensor Server application is running on your machine.",{OK:function(){$(this).dialog("close"),g("dismiss")}})},dismiss:function(){this.gotoState("notConnected")}},connected:{enterState:function(){O="Connected.",M=!0,R=!0,C=!0,p(),a.isCollecting&&this.gotoState("started")},leaveState:function(){M=!1,R=!1},columnAdded:p,columnRemoved:p,columnTypeChanged:p,columnMoved:p,tare:function(){_&&(L.properties.tareValue=_.liveValue)},start:function(){a.requestStart().catch(function(){g("startRequestFailed")}),this.gotoState("starting")},sessionChanged:function(){a.stopPolling(),a.startPolling(),this.gotoState("connecting")},collectionStarted:function(){this.gotoState("started")}},starting:{enterState:function(){O="Starting data collection...",C=!1;var e=this;this._startTimerId=setTimeout(5e3,function(){e.gotoState("startRequestFailed")})},leaveState:function(){clearTimeout(this._startTimerId)},startRequestFailed:function(){this.gotoState("errorStarting")},collectionStarted:function(){this.gotoState("started")}},errorStarting:{enterState:function(){O="Error starting data collection.",C=!0,t("Could not start data collection. Make sure that (remote starting) is enabled",{OK:function(){$(this).dialog("close"),g("dismissErrorStarting")}})},collectionStarted:function(){this.gotoState("started")},dismissErrorStarting:function(){this.gotoState("connected")}},started:{enterState:function(){C=!1,p(),a.isCollecting||this.gotoState("stopped"),_||this.gotoState("startedWithNoDataColumn")},data:h,stop:function(){a.requestStop().catch(function(){g("stopRequestFailed")}),this.gotoState("stopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},startedWithNoDataColumn:{enterState:function(){O="No data is available.",a.requestStop(),t("The LabQuest does not appear to be reporting data for the plugged-in device",{OK:function(){$(this).dialog("close")}})},collectionStopped:function(){this.gotoState("stoppedWithNoDataColumn")}},stoppedWithNoDataColumn:{enterState:function(){m()&&this.gotoState("connected")},data:function(){m()&&this.gotoState("connected")}},stopping:{enterState:function(){O="Stopping data collection..."},data:h,stopRequestFailed:function(){this.gotoState("errorStopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},errorStopping:{enterState:function(){O="Error stopping data collection.",t("Could not stop data collection. Make sure that (remote starting) is enabled",{OK:function(){$(this).dialog("close"),g("dismissErrorStopping")}})},data:h,collectionStopped:function(){this.gotoState("collectionStopped")},dismissErrorStopping:function(){this.gotoState("started")}},collectionStopped:{enterState:function(){O="Data collection stopped.",m()&&this.gotoState("collectionComplete")},data:function(){h(),m()&&this.gotoState("collectionComplete")}},collectionComplete:{enterState:function(){O="Data collection complete.",C=!0},reset:function(){d(),u(),this.gotoState("connecting"),b.reset()}},disconnected:{enterState:function(){O="Disconnected."}}}),a.on("*",function(){var e=Array.prototype.slice.call(arguments,0);g.apply(null,[this.event].concat(e))}),a.on("statusReceived",function(){_&&L.makeInvalidatingChange(function(){E=_.liveValue})}),v=new n({metadata:i,setters:{},unitsDefinition:s,initialProperties:e,usePlaybackSupport:!1}),v.mixInto(L),y=v.propertySupport,b=v.dispatchSupport,b.addEventTypes("tick","play","stop","tickStart","tickEnd"),d(),L.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return S}),L.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return S}),L.defineOutput("sensorReading",c,function(){return null==P?P:P-L.properties.tareValue}),L.defineOutput("liveSensorReading",c,function(){return null==E?E:E-L.properties.tareValue}),L.defineOutput("sensorName",{label:"Sensor Name"},function(){return T}),L.defineOutput("isStopped",{label:"Stopped?"},function(){return C
}),L.defineOutput("isPlayable",{label:"Startable?"},function(){return R}),L.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return k>0}),L.defineOutput("canTare",{label:"Can set a tare value?"},function(){return M&&N}),L.defineOutput("needsReload",{label:"Needs Reload?"},function(){return A}),L.defineOutput("message",{label:"User Message"},function(){return O}),L.on("willReset.model",function(){a.stopPolling(),a.requestStop()}),L.updateAllOutputProperties(),x.gotoState("notConnected"),L}}),define("models/sensor-server/view",["common/views/numeric-output-view","common/views/view-state"],function(){var e=require("common/views/numeric-output-view"),t=require("common/views/view-state");return function(n,r){function i(){n.properties.canTare?t.enableView(u.$zeroButton):t.disableView(u.$zeroButton)}function o(){}function a(){u.$message.text(n.properties.message)}function s(){n.addObserver("canTare",i),i(),n.addObserver("canConnect",o),o(),n.addObserver("message",a),a()}var l,u,c=d3.format(".2f");return u={$el:$("<div id='model-container' class='container sensor-model-container' />"),remoteAddress:null,bindModel:function(e,t){r=t||r,n=e||n,s()},getHeightForWidth:function(){return"2.6em"},setup:function(){u.$el.empty(),l=new e({id:"sensor-value-view",label:"Reading: ",units:n.getPropertyDescription("sensorReading").getUnitAbbreviation()}),u.$zeroButton=$("<div class='interactive-button'><button>Zero</button></div>"),u.$message=$("<div class='message'></div>"),u.$sensorReading=l.render().addClass("horizontal"),u.$el.css("zIndex",4).append(u.$sensorReading).append(u.$zeroButton).append(u.$message),u.$el.find("div").addClass("component component-spacing"),l.resize(),s(),u.$zeroButton.on("click","button",n.tare)},resize:function(){l&&l.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(e){l.updateUnits(e),null==n.properties.liveSensorReading&&l.hideUnits()},update:function(){null==n.properties.liveSensorReading?(l.update(""),l.hideUnits()):(l.update(c(n.properties.liveSensorReading)),l.showUnits())}}}}),define("models/sensor-server/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/sensor-server/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("liveSensorReading",function(){l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.sensor-server-model-controller",s),a.on("modelReset.sensor-server-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0)}),l}}),define("models/labquest2/metadata",[],function(){return{mainProperties:{type:{defaultValue:"labquest2",immutable:!0},sensorType:{defaultValue:null},tareValue:{defaultValue:0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},controlButtonStyle:{defaultValue:"video",propertyChangeInvalidates:!1,serialize:!1}}}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("labquest2-interface",e):"undefined"!=typeof window?window.sensorLabquest2Interface=e():"undefined"!=typeof global?global.sensorLabquest2Interface=e():"undefined"!=typeof self&&(self.sensorLabquest2Interface=e())}(function(){var e;return function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return i(n?n:t)},u,u.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){"use strict";function n(){p=[],h=Object.create(null),f=Object.create(null),m=!1}function r(e,t){var n=w+t,r=new XMLHttpRequest;if("withCredentials"in r)r.open(e,n,!0),r.responseType="json",r.setRequestHeader("Accept","application/json");else{if("undefined"==typeof XDomainRequest)return null;r=new XDomainRequest,r.open(e,n)}return r}function i(){x.emit("connectionTimedOut"),A=!1}function o(){var e=r("GET","/status");return e?(e.onerror=a,e.onload=s,void e.send()):void a()}function a(){x.emit("statusErrored")}function s(){var e=this.response||JSON.parse(this.responseText);if("string"==typeof e&&(e=JSON.parse(e)),T&&!(e.requestTimeStamp<C)){if(g){if(g!==e.sessionID)return void(m||(x.emit("sessionChanged"),m=!0))}else g=e.sessionID,n();C=e.requestTimeStamp,E.reset(),l(e.sets),u(e.columns),A=!0,x.emit("statusReceived"),S&&!e.collection.isCollecting?(S=!1,x.emit("collectionStopped")):!S&&e.collection.isCollecting&&(S=!0,x.emit("collectionStarted")),P&&!e.collection.canControl?(P=!1,x.emit("controlDisabled")):!P&&e.collection.canControl&&(P=!0,x.emit("controlEnabled"))}}function l(e){Object.keys(e).forEach(function(e){h[e]||(x.emit("datasetAdded",e),h[e]={columns:[],id:e},p.unshift(h[e]))}),p.sort(function(e,t){return t.setId-e.setId})}function u(e){Object.keys(e).forEach(function(t){var n=[],r=e[t],i=h[r.setID],o=f[t];o?o!==i.columns[r.position]&&n.push("columnMoved"):(n.push("columnAdded"),o=f[t]={id:null,units:null,receivedValuesTimeStamp:0,requestedValuesTimeStamp:0,liveValue:null,data:[]}),i.columns[r.position]=o,o.units&&o.units!==r.units&&n.push("columnTypeChanged"),o.units=r.units,o.id=t,o.liveValue=parseFloat(r.liveValue||0),o.requestedValuesTimeStamp<r.valuesTimeStamp&&(c(t,r.valuesTimeStamp),o.requestedValuesTimeStamp=r.valuesTimeStamp),n.forEach(function(e){x.emit(e,t)})}),Object.keys(f).forEach(function(t){e[t]||(x.emit("columnRemoved",t),delete f[t])})}function c(e,t){var n=r("GET","/columns/"+e);n.send(),n.onload=function(){if(T){var n=this.response||JSON.parse(this.responseText);"string"==typeof n&&(n=JSON.parse(n));var r=n.values,i=f[e];t>i.receivedValuesTimeStamp&&(i.data.length=0,[].push.apply(i.data,r),i.receivedValuesTimeStamp=t,x.emit("data",e))}}}function d(e){return function(){return new y.Promise(function(t,n){var i=r("GET",e);i||n(new Error("This browser does not appear to support Cross-Origin Resource Sharing")),i.send(),i.onerror=function(){n(this)},i.onload=t})}}var p,h,f,m,g,v,y=e("rsvp"),b=e("eventemitter2").EventEmitter2,x=new b({wildcard:!0}),w="",_=1e4,T=!1,C=0,A=!1,S=!1,P=!0,E={start:function(){this.timerId=setTimeout(i,_)},reset:function(){this.stop(),this.start()},stop:function(){clearTimeout(this.timerId)}};t.exports={startPolling:function(e){w="http://"+e,o(),T=!0,A=!1,E.start(),v=setInterval(o,500)},stopPolling:function(){E.stop(),clearInterval(v),g=void 0,T=!1},requestStart:d("/control/start"),requestStop:d("/control/stop"),on:function(){x.on.apply(x,arguments)},off:function(){x.off.apply(x,arguments)},get datasets(){return p},get isConnected(){return T&&A},get isCollecting(){return T&&A&&S},get canControl(){return P}}},{eventemitter2:3,rsvp:4}],2:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],3:[function(t,n,r){var i=t("__browserify_process");!function(t){function n(){this._events={},this._conf&&r.call(this,this._conf)}function r(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function i(e){this._events={},this.newListener=!1,r.call(this,e)}function o(e,t,n,r){if(!n)return[];var i,a,s,l,u,c,d,p=[],h=t.length,f=t[r],m=t[r+1];if(r===h&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(i=0,a=n._listeners.length;a>i;i++)e&&e.push(n._listeners[i]);return[n]}if("*"===f||"**"===f||n[f]){if("*"===f){for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&(p=p.concat(o(e,t,n[s],r+1)));return p}if("**"===f){d=r+1===h||r+2===h&&"*"===m,d&&n._listeners&&(p=p.concat(o(e,t,n,h)));for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&("*"===s||"**"===s?(n[s]._listeners&&!d&&(p=p.concat(o(e,t,n[s],h))),p=p.concat(o(e,t,n[s],r))):p=p.concat(s===m?o(e,t,n[s],r+2):o(e,t,n[s],r)));return p}p=p.concat(o(e,t,n[f],r+1))}if(l=n["*"],l&&o(e,t,l,r+1),u=n["**"])if(h>r){u._listeners&&o(e,t,u,h);for(s in u)"_listeners"!==s&&u.hasOwnProperty(s)&&(s===m?o(e,t,u[s],r+2):s===f?o(e,t,u[s],r+1):(c={},c[s]=u[s],o(e,t,{"**":c},r+1)))}else u._listeners?o(e,t,u,h):u["*"]&&u["*"]._listeners&&o(e,t,u["*"],h);return p}function a(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,r=e.length;r>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var i=this.listenerTree,o=e.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===e.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,t];else if(s(i._listeners)&&(i._listeners.push(t),!i._listeners.warned)){var a=l;"undefined"!=typeof this._events.maxListeners&&(a=this._events.maxListeners),a>0&&i._listeners.length>a&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=t;return!0}o=e.shift()}return!0}var s=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=10;i.prototype.delimiter=".",i.prototype.setMaxListeners=function(e){this._events||n.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},i.prototype.event="",i.prototype.once=function(e,t){return this.many(e,1,t),this},i.prototype.many=function(e,t,n){function r(){0===--t&&i.off(e,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(e,r),i},i.prototype.emit=function(){this._events||n.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var t=arguments.length,r=new Array(t-1),i=1;t>i;i++)r[i-1]=arguments[i];for(i=0,t=this._all.length;t>i;i++)this.event=e,this._all[i].apply(this,r)}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var a;if(this.wildcard){a=[];var s="string"==typeof e?e.split(this.delimiter):e.slice();o.call(this,a,s,this.listenerTree,0)}else a=this._events[e];if("function"==typeof a){if(this.event=e,1===arguments.length)a.call(this);else if(arguments.length>1)switch(arguments.length){case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:for(var t=arguments.length,r=new Array(t-1),i=1;t>i;i++)r[i-1]=arguments[i];a.apply(this,r)}return!0}if(a){for(var t=arguments.length,r=new Array(t-1),i=1;t>i;i++)r[i-1]=arguments[i];for(var l=a.slice(),i=0,t=l.length;t>i;i++)this.event=e,l[i].apply(this,r);return l.length>0||this._all}return this._all},i.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||n.call(this),this.emit("newListener",e,t),this.wildcard)return a.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(s(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var r=l;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=t;return this},i.prototype.onAny=function(e){if(this._all||(this._all=[]),"function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof e?e.split(this.delimiter):e.slice();r=o.call(this,null,i,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var l=r[a];if(n=l._listeners,s(n)){for(var u=-1,c=0,d=n.length;d>c;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){u=c;break}if(0>u)continue;return this.wildcard?l._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e])}return this},i.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,r=t.length;r>n;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||n.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),r=o.call(this,null,t,this.listenerTree,0),i=0;i<r.length;i++){var a=r[i];a._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},i.prototype.listeners=function(e){if(this.wildcard){var t=[],r="string"==typeof e?e.split(this.delimiter):e.slice();return o.call(this,t,r,this.listenerTree,0),t}return this._events||n.call(this),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},i.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof e&&e.amd?e(function(){return i}):t.EventEmitter2=i}("undefined"!=typeof i&&"undefined"!=typeof i.title&&"undefined"!=typeof r?r:window)},{__browserify_process:2}],4:[function(e,t,n){"use strict";function r(e,t){g.async(e,t)}function i(){g.on.apply(g,arguments)}function o(){g.off.apply(g,arguments)}var a=e("./rsvp/promise")["default"],s=e("./rsvp/events")["default"],l=e("./rsvp/node")["default"],u=e("./rsvp/all")["default"],c=e("./rsvp/all-settled")["default"],d=e("./rsvp/race")["default"],p=e("./rsvp/hash")["default"],h=e("./rsvp/hash-settled")["default"],f=e("./rsvp/rethrow")["default"],m=e("./rsvp/defer")["default"],g=e("./rsvp/config").config,v=e("./rsvp/config").configure,y=e("./rsvp/map")["default"],b=e("./rsvp/resolve")["default"],x=e("./rsvp/reject")["default"],w=e("./rsvp/filter")["default"],_=e("./rsvp/asap")["default"];if(g.async=_,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var T=window.__PROMISE_INSTRUMENTATION__;v("instrument",!0);for(var C in T)T.hasOwnProperty(C)&&i(C,T[C])}n.Promise=a,n.EventTarget=s,n.all=u,n.allSettled=c,n.race=d,n.hash=p,n.hashSettled=h,n.rethrow=f,n.defer=m,n.denodeify=l,n.configure=v,n.on=i,n.off=o,n.resolve=b,n.reject=x,n.async=r,n.map=y,n.filter=w},{"./rsvp/all":6,"./rsvp/all-settled":5,"./rsvp/asap":7,"./rsvp/config":8,"./rsvp/defer":9,"./rsvp/events":10,"./rsvp/filter":11,"./rsvp/hash":13,"./rsvp/hash-settled":12,"./rsvp/map":15,"./rsvp/node":16,"./rsvp/promise":17,"./rsvp/race":23,"./rsvp/reject":24,"./rsvp/resolve":25,"./rsvp/rethrow":26}],5:[function(e,t,n){"use strict";function r(e){return{state:"fulfilled",value:e}}function i(e){return{state:"rejected",reason:e}}var o=e("./promise")["default"],a=e("./utils").isArray,s=e("./utils").isNonThenable;n["default"]=function(e,t){return new o(function(t){function n(e){return function(t){u(e,r(t))}}function l(e){return function(t){u(e,i(t))}}function u(e,n){p[e]=n,0===--d&&t(p)}if(!a(e))throw new TypeError("You must pass an array to allSettled.");var c,d=e.length;if(0===d)return void t([]);for(var p=new Array(d),h=0;h<e.length;h++)c=e[h],s(c)?u(h,r(c)):o.resolve(c).then(n(h),l(h))},t)}},{"./promise":17,"./utils":27}],6:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.all(e,t)}},{"./promise":17}],7:[function(e,t,n){function r(){return function(){s.nextTick(a)}}function i(){var e=0,t=new c(a),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function o(){return function(){setTimeout(a,1)}}function a(){for(var e=0;e<d.length;e++){var t=d[e],n=t[0],r=t[1];n(r)}d.length=0}var s=e("__browserify_process");n["default"]=function(e,t){var n=d.push([e,t]);1===n&&l()};var l,u="undefined"!=typeof window?window:{},c=u.MutationObserver||u.WebKitMutationObserver,d=[];l="undefined"!=typeof s&&"[object process]"==={}.toString.call(s)?r():c?i():o()},{__browserify_process:2}],8:[function(e,t,n){"use strict";function r(e,t){return"onerror"===e?void o.on("error",t):2!==arguments.length?o[e]:void(o[e]=t)}var i=e("./events")["default"],o={instrument:!1};i.mixin(o),n.config=o,n.configure=r},{"./events":10}],9:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e){var t={};return t.promise=new r(function(e,n){t.resolve=e,t.reject=n},e),t}},{"./promise":17}],10:[function(e,t,n){"use strict";function r(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function i(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}n["default"]={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var n,o=i(this);n=o[e],n||(n=o[e]=[]),-1===r(n,t)&&n.push(t)},off:function(e,t){var n,o,a=i(this);return t?(n=a[e],o=r(n,t),void(-1!==o&&n.splice(o,1))):void(a[e]=[])},trigger:function(e,t){var n,r,o=i(this);if(n=o[e])for(var a=0;a<n.length;a++)(r=n[a])(t)}}},{}],11:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=e("./utils").isFunction;n["default"]=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as filter's second argument.");for(var o=e.length,a=new Array(o),s=0;o>s;s++)a[s]=t(e[s]);return r.all(a,n).then(function(t){for(var n=new Array(o),r=0,i=0;o>i;i++)t[i]===!0&&(n[r]=e[i],r++);return n.length=r,n})})}},{"./promise":17,"./utils":27}],12:[function(e,t,n){"use strict";function r(e){return{state:"fulfilled",value:e}}function i(e){return{state:"rejected",reason:e}}var o=e("./promise")["default"],a=e("./utils").isNonThenable,s=e("./utils").keysOf;n["default"]=function(e){return new o(function(t){function n(e){return function(t){u(e,r(t))}}function l(e){return function(t){u(e,i(t))}}function u(e,n){p[e]=n,0===--f&&t(p)}var c,d,p={},h=s(e),f=h.length;if(0===f)return void t(p);for(var m=0;m<h.length;m++)d=h[m],c=e[d],a(c)?u(d,r(c)):o.resolve(c).then(n(d),l(d))})}},{"./promise":17,"./utils":27}],13:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=e("./utils").isNonThenable,o=e("./utils").keysOf;n["default"]=function(e){return new r(function(t,n){function a(e){return function(n){c[e]=n,0===--p&&t(c)}}function s(e){p=0,n(e)}var l,u,c={},d=o(e),p=d.length;if(0===p)return void t(c);for(var h=0;h<d.length;h++)u=d[h],l=e[u],i(l)?(c[u]=l,0===--p&&t(c)):r.resolve(l).then(a(u),s)})}},{"./promise":17,"./utils":27}],14:[function(e,t,n){"use strict";var r=e("./config").config,i=e("./utils").now;n["default"]=function(e,t,n){try{r.trigger(e,{guid:t._guidKey+t._id,eventName:e,detail:t._detail,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:i(),stack:new Error(t._label).stack})}catch(o){setTimeout(function(){throw o},0)}}},{"./config":8,"./utils":27}],15:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=(e("./utils").isArray,e("./utils").isFunction);n["default"]=function(e,t,n){return r.all(e,n).then(function(e){if(!i(t))throw new TypeError("You must pass a function as map's second argument.");for(var o=e.length,a=new Array(o),s=0;o>s;s++)a[s]=t(e[s]);return r.all(a,n)})}},{"./promise":17,"./utils":27}],16:[function(e,t,n){"use strict";var r=e("./promise")["default"],i=e("./utils").isArray;n["default"]=function(e,t){function n(){for(var n=arguments.length,i=new Array(n),s=0;n>s;s++)i[s]=arguments[s];var l;return o||a||!t?l=this:(console.warn('Deprecation: RSVP.denodeify() doesn\'t allow setting the "this" binding anymore. Use yourFunction.bind(yourThis) instead.'),l=t),r.all(i).then(function(n){function i(r,i){function s(){for(var e=arguments.length,n=new Array(e),s=0;e>s;s++)n[s]=arguments[s];var l=n[0],u=n[1];if(l)i(l);else if(o)r(n.slice(1));else if(a){var c,d,p={},h=n.slice(1);for(d=0;d<t.length;d++)c=t[d],p[c]=h[d];r(p)}else r(u)}n.push(s),e.apply(l,n)}return new r(i)})}var o=t===!0,a=i(t);return n.__proto__=e,n}},{"./promise":17,"./utils":27}],17:[function(e,t,n){"use strict";function r(){}function i(e,t){if(!y(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._id=S++,this._label=t,this._subscribers=[],m.instrument&&g("created",this),r!==e&&o(e,this)}function o(e,t){function n(e){c(t,e)}function r(e){p(t,e)}try{e(n,r)}catch(i){r(i)}}function a(e,t,n,r){var i=e._subscribers,o=i.length;i[o]=t,i[o+k]=n,i[o+R]=r}function s(e,t){var n,r,i=e._subscribers,o=e._detail;m.instrument&&g(t===k?"fulfilled":"rejected",e);for(var a=0;a<i.length;a+=3)n=i[a],r=i[a+t],l(t,n,r,o);e._subscribers=null}function l(e,t,n,r){var i,o,a,s,l=y(n);if(l)try{i=n(r),a=!0}catch(d){s=!0,o=d}else i=r,a=!0;u(t,i)||(l&&a?c(t,i):s?p(t,o):e===k?c(t,i):e===R&&p(t,i))}function u(e,t){var n,r=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(v(t)&&(r=t.then,y(r)))return r.call(t,function(r){return n?!0:(n=!0,void(t!==r?c(e,r):d(e,r)))},function(t){return n?!0:(n=!0,void p(e,t))},"Settle: "+(e._label||" unknown promise")),!0}catch(i){return n?!0:(p(e,i),!0)}return!1}function c(e,t){e===t?d(e,t):u(e,t)||d(e,t)}function d(e,t){e._state===P&&(e._state=E,e._detail=t,m.async(h,e))}function p(e,t){e._state===P&&(e._state=E,e._detail=t,m.async(f,e))}function h(e){s(e,e._state=k)}function f(e){e._onerror&&e._onerror(e._detail),s(e,e._state=R)}var m=e("./config").config,g=(e("./events")["default"],e("./instrument")["default"]),v=e("./utils").objectOrFunction,y=e("./utils").isFunction,b=e("./utils").now,x=e("./promise/cast")["default"],w=e("./promise/all")["default"],_=e("./promise/race")["default"],T=e("./promise/resolve")["default"],C=e("./promise/reject")["default"],A="rsvp_"+b()+"-",S=0;n["default"]=i,i.cast=x,i.all=w,i.race=_,i.resolve=T,i.reject=C;var P=void 0,E=0,k=1,R=2;i.prototype={constructor:i,_id:void 0,_guidKey:A,_label:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,_onerror:function(e){m.trigger("error",e)},then:function(e,t,n){var i=this;this._onerror=null;var o=new this.constructor(r,n);if(this._state){var s=arguments;m.async(function(){l(i._state,o,s[i._state-1],i._detail)})}else a(this,o,e,t);return m.instrument&&g("chained",i,o),o},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}}},{"./config":8,"./events":10,"./instrument":14,"./promise/all":18,"./promise/cast":19,"./promise/race":20,"./promise/reject":21,"./promise/resolve":22,"./utils":27}],18:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=e("../utils").isNonThenable;n["default"]=function(e,t){var n=this;return new n(function(t,o){function a(e){return function(n){c[e]=n,0===--u&&t(c)}}function s(e){u=0,o(e)}if(!r(e))throw new TypeError("You must pass an array to all.");var l,u=e.length,c=new Array(u);if(0===u)return void t(c);for(var d=0;d<e.length;d++)l=e[d],i(l)?(c[d]=l,0===--u&&t(c)):n.resolve(l).then(a(d),s)},t)}},{"../utils":27}],19:[function(e,t,n){"use strict";n["default"]=function(e,t){var n=this;return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)},t)}},{}],20:[function(e,t,n){"use strict";var r=e("../utils").isArray,i=(e("../utils").isFunction,e("../utils").isNonThenable);n["default"]=function(e,t){var n,o=this;return new o(function(t,a){function s(e){u&&(u=!1,t(e))}function l(e){u&&(u=!1,a(e))}if(!r(e))throw new TypeError("You must pass an array to race.");for(var u=!0,c=0;c<e.length;c++){if(n=e[c],i(n))return u=!1,void t(n);o.resolve(n).then(s,l)}},t)}},{"../utils":27}],21:[function(e,t,n){"use strict";n["default"]=function(e,t){var n=this;return new n(function(t,n){n(e)},t)}},{}],22:[function(e,t,n){"use strict";n["default"]=function(e,t){var n=this;return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)},t)}},{}],23:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.race(e,t)}},{"./promise":17}],24:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.reject(e,t)}},{"./promise":17}],25:[function(e,t,n){"use strict";var r=e("./promise")["default"];n["default"]=function(e,t){return r.resolve(e,t)}},{"./promise":17}],26:[function(e,t,n){"use strict";n["default"]=function(e){throw setTimeout(function(){throw e}),e}},{}],27:[function(e,t,n){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function o(e){return!r(e)}n.objectOrFunction=r,n.isFunction=i,n.isNonThenable=o;var a;a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var s=a;n.isArray=s;var l=Date.now||function(){return(new Date).getTime()};n.now=l;var u=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};n.keysOf=u},{}]},{},[1])(1)}),define("models/labquest2/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"},temperature:{name:"degree Celsius",pluaralName:"degrees Celsius",symbol:"°C"},light:{name:"lux",pluralName:"lux",symbol:"lux"},force:{name:"Newton",pluralName:"Newtons",symbol:"N"},ph:{name:"pH Unit",pluralName:"pH Units",symbol:"pH"},co2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"},o2:{name:"part per million",pluralName:"parts per million",symbol:"ppm"}}}}),define("models/labquest2/sensor-definitions",[],function(){return{lux:{sensorName:"Light",measurementName:"Illumination",measurementType:"illumination",tareable:!0,minReading:0,maxReading:6e3},m:{sensorName:"Motion",measurementName:"Position",measurementType:"position",tareable:!0,minReading:0,maxReading:2},"m/s²":{sensorName:"Accelerometer",measurementName:"Acceleration",measurementType:"acceleration",tareable:!0,minReading:-50,maxReading:50},g:{sensorName:"Accelerometer",measurementName:"Acceleration",measurementType:"acceleration",tareable:!0,minReading:-5,maxReading:5},"N/kg":{sensorName:"Accelerometer",measurementName:"Acceleration",measurementType:"acceleration",tareable:!0,minReading:-25,maxReading:25},"mg/L":{sensorName:"Dissolved Oxygen",measurementName:"DO",measurementType:"do",tareable:!0,minReading:0,maxReading:12},kPa:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:220},"mm Hg":{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2e3},"in Hg":{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:80},mbar:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2200},psi:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:40},atm:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2.5},torr:{sensorName:"Pressure",measurementName:"Pressure",measurementType:"pressure",tareable:!0,minReading:0,maxReading:2e3},nC:{sensorName:"Charge Sensor",measurementName:"Charge",measurementType:"charge",tareable:!1,minReading:-20,maxReading:20},V:{sensorName:"Voltage",measurementName:"Potential",measurementType:"potential",tareable:!0,minReading:-30,maxReading:30},ppm:{sensorName:"CO2 Gas",measurementName:"CO2",measurementType:"co2",tareable:!1,minReading:0,maxReading:5e3},ppt:{sensorName:"CO2 Gas",measurementName:"CO2",measurementType:"co2",tareable:!1,minReading:0,maxReading:5},"%":{sensorName:"CO2 Gas",measurementName:"CO2",measurementType:"co2",tareable:!1,minReading:0,maxReading:.5},"%T":{sensorName:"Colorimeter",measurementName:"Transmittance",measurementType:"transmittance",tareable:!1,minReading:0,maxReading:100},"µS/cm":{sensorName:"Conductivity",measurementName:"Conductivity",measurementType:"conductivity",tareable:!0,minReading:0,maxReading:2e3},"dS/m":{sensorName:"Conductivity",measurementName:"Conductivity",measurementType:"conductivity",tareable:!0,minReading:0,maxReading:2},A:{sensorName:"Current",measurementName:"Current",measurementType:"current",tareable:!0,minReading:-1.2,maxReading:1.2},mA:{sensorName:"Current",measurementName:"Current",measurementType:"current",tareable:!0,minReading:0,maxReading:500},"°C":{sensorName:"Temperature",measurementName:"Temperature",measurementType:"temperature",tareable:!1,minReading:0,maxReading:50},"°F":{sensorName:"Temperature",measurementName:"Temperature",measurementType:"temperature",tareable:!1,minReading:30,maxReading:100},K:{sensorName:"Temperature",measurementName:"Temperature",measurementType:"temperature",tareable:!1,minReading:250,maxReading:400},N:{sensorName:"Force",measurementName:"Force",measurementType:"force",tareable:!0,minReading:-50,maxReading:50},lb:{sensorName:"Force",measurementName:"Force",measurementType:"force",tareable:!0,minReading:-12.5,maxReading:12.5},mV:{sensorName:null,measurementName:"Potential",measurementType:"potential",tareable:!0,minReading:-500,maxReading:1100},"m/s":{sensorName:"Flow Rate",measurementName:"Flow Rate",measurementType:"flow rate",tareable:!0,minReading:0,maxReading:4},"ft/s":{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:100},ft:{sensorName:"Motion",measurementName:"Position",measurementType:"position",tareable:!0,minReading:0,maxReading:6},kg:{sensorName:"Hand Dynamometer",measurementName:"Force",measurementType:"force",tareable:!0,minReading:0,maxReading:50},v:{sensorName:"Heart Rate",measurementName:"Signal",measurementType:"signal",tareable:!1,minReading:0,maxReading:3},mT:{sensorName:"Magnetic Field",measurementName:"Magnetic Field",measurementType:"magnetic field",tareable:!0,minReading:-8,maxReading:8},G:{sensorName:"Magnetic Field",measurementName:"Magnetic Field",measurementType:"magnetic field",tareable:!0,minReading:-80,maxReading:80},rad:{sensorName:"Rotary Motion",measurementName:"Angle",measurementType:"angle",tareable:!0,minReading:-15,maxReading:15},"°":{sensorName:"Rotary Motion",measurementName:"Angle",measurementType:"angle",tareable:!0,minReading:-1e3,maxReading:1e3},cm:{sensorName:"Linear Position Sensor",measurementName:"Position",measurementType:"position",tareable:!0,minReading:0,maxReading:15},dB:{sensorName:"Sound Level",measurementName:"Sound Level",measurementType:"sound level",tareable:!0,minReading:40,maxReading:110},rel:{sensorName:"Spectrophotometer",measurementName:"Intensity",measurementType:"intensity",tareable:!1,minReading:0,maxReading:1},Rel:{sensorName:"Spectrophotometer",measurementName:"Fluorescence 405 nm",measurementType:"fluorescence 405 nm",tareable:!1,minReading:0,maxReading:1},"Rel.":{sensorName:"Spectrophotometer",measurementName:"Fluorescence 500 nm",measurementType:"fluorescence 500 nm",tareable:!1,minReading:0,maxReading:1},"L/s":{sensorName:"Spirometer",measurementName:"Flow Rate",measurementType:"flow rate",tareable:!0,minReading:-4,maxReading:4},"mL/s":{sensorName:"Spirometer",measurementName:"Flow Rate",measurementType:"flow rate",tareable:!0,minReading:-4e3,maxReading:4e3},NTU:{sensorName:"Turbidity",measurementName:"Turbidity",measurementType:"turbidity",tareable:!0,minReading:0,maxReading:50},"mW/m²":{sensorName:"UV Sensor",measurementName:"UV Intensity",measurementType:"uv intensity",tareable:!0,minReading:0,maxReading:2e4},mL:{sensorName:"Drop Counter",measurementName:"Volume",measurementType:"volume",tareable:!1,minReading:0,maxReading:3},f:{sensorName:"Altitude",measurementName:"Altitude",measurementType:"altitude",tareable:!0,minReading:-300,maxReading:300},mph:{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:10},"km/h":{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:20},knots:{sensorName:"Anemometer",measurementName:"Speed",measurementType:"speed",tareable:!0,minReading:0,maxReading:50}}
}),define("models/labquest2/modeler",["require","common/lab-modeler-mixin","common/property-description","./metadata","common/state-machine","labquest2-interface","./units-definition","./sensor-definitions","common/controllers/basic-dialog","underscore"],function(e){function t(e,t){var n=new u({width:"60%",buttons:t});n.setContent(e),n.open()}var n=e("common/lab-modeler-mixin"),r=e("common/property-description"),i=e("./metadata"),o=e("common/state-machine"),a=e("labquest2-interface"),s=e("./units-definition"),l=e("./sensor-definitions"),u=e("common/controllers/basic-dialog"),c=e("underscore"),d={label:"Sensor Reading",unitAbbreviation:"-",format:".2f",min:0,max:10};return function(e){function u(){var e,t;T?(e=l[T.units],e?(t={label:e.measurementName,format:".2f",min:e.minReading,max:e.maxReading},s.units[e.measurementType]?t.unitType=e.measurementType:t.unitAbbreviation=T.units,I=e.tareable,C=e.sensorName):(t={label:"Sensor Reading",unitAbbreviation:T.units,format:".2f",min:0,max:10},I=!0,C=T.units+" sensor")):(t=d,I=!1,C="(no sensor)"),b.setPropertyDescription("sensorReading",new r(s,t)),b.setPropertyDescription("liveSensorReading",new r(s,t))}function p(){A=!0,N=!1,L=a.canControl,R=0,P=0,E=void 0,k=void 0,_=void 0,T=void 0}function h(){var e,t=a.datasets[0];_=c.find(t.columns,function(e){return"s"===e.units}),e=c.find(t.columns,function(e){return"s"!==e.units}),T!==e&&(T=e,u()),T||(k=void 0)}function f(){if(_&&T)for(var e=Math.min(_.data.length,T.data.length);e>R;R++)P=_.data[R],E=T.data[R],B.updateAllOutputProperties(),x.tick()}function m(e){return e.receivedValuesTimeStamp>=e.requestedValuesTimeStamp}function g(){return m(_)&&(!T||m(T))}function v(e){var t=Array.prototype.slice.call(arguments,0);B.makeInvalidatingChange(function(){var n=w.handleEvent.apply(w,t);n||("connectionTimedOut"===e||"sessionChanged"===e)&&w.gotoState("disconnected")})}var y,b,x,w,_,T,C,A,S,P,E,k,R,M,N,O,L,I,D,B;return B={on:function(e,t){x.on(e,t)},connect:function(e){v("connect",e)},start:function(){v("start")},stop:function(){v("stop")},tare:function(){var e=M;M=!1,v("tare"),M=e},willReset:function(){x.willReset()},reset:function(){v("reset")},reload:function(){B.stop(),B.makeInvalidatingChange(function(){S=!0})},isStopped:function(){return A},stepCounter:function(){return R},serialize:function(){return""}},w=new o({notConnected:{enterState:function(){D="Not connected.",N=!0},leaveState:function(){N=!1},connect:function(e){a.startPolling(e),this.gotoState("connecting")}},connecting:{enterState:function(){D="Connecting...",a.isConnected&&this.gotoState("connected")},statusErrored:function(){this.gotoState("initialConnectionFailure")},connectionTimedOut:function(){this.gotoState("initialConnectionFailure")},statusReceived:function(){this.gotoState("connected")},sessionChanged:function(){a.stopPolling(),a.startPolling()}},initialConnectionFailure:{enterState:function(){a.stopPolling(),D="Connection failed.",t("Could not connect to the LabQuest2. Please make sure the address is correct and that the LabQuest2 can be reached from this computer",{OK:function(){$(this).dialog("close"),v("dismiss")}})},dismiss:function(){this.gotoState("notConnected")}},connected:{enterState:function(){D="Connected.",O=!0,M=!0,A=!0,h(),L?this.controlEnabled():this.controlDisabled(),a.isCollecting&&this.gotoState("started")},leaveState:function(){O=!1,M=!1},columnAdded:h,columnRemoved:h,columnTypeChanged:h,columnMoved:h,tare:function(){T&&(B.properties.tareValue=T.liveValue)},start:function(){a.requestStart().catch(function(){v("startRequestFailed")}),this.gotoState("starting")},controlEnabled:function(){D="Connected."},controlDisabled:function(){D="Connected. Press start on your LabQuest2 to begin."},sessionChanged:function(){a.stopPolling(),a.startPolling(),this.gotoState("connecting")},collectionStarted:function(){this.gotoState("started")}},starting:{enterState:function(){D="Starting data collection...",A=!1;var e=this;this._startTimerId=setTimeout(3e3,function(){e.gotoState("startRequestFailed")})},leaveState:function(){clearTimeout(this._startTimerId)},startRequestFailed:function(){this.gotoState("errorStarting")},collectionStarted:function(){this.gotoState("started")}},errorStarting:{enterState:function(){D="Error starting data collection.",A=!0,t("Could not start data collection. Make sure that (remote starting) is enabled",{OK:function(){$(this).dialog("close"),v("dismissErrorStarting")}})},collectionStarted:function(){this.gotoState("started")},dismissErrorStarting:function(){this.gotoState("connected")}},started:{enterState:function(){D=L?"Collecting data.":"Collecting data. Press stop on your LabQuest2 to end.",A=!1,h(),a.isCollecting||this.gotoState("stopped"),T||this.gotoState("startedWithNoDataColumn")},data:f,controlEnabled:function(){D="Collecting data."},controlDisabled:function(){D="Collecting data. Press stop on your LabQuest2 to end."},stop:function(){a.requestStop().catch(function(){v("stopRequestFailed")}),this.gotoState("stopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},startedWithNoDataColumn:{enterState:function(){D="No data is available.",a.requestStop(),t("The LabQuest does not appear to be reporting data for the plugged-in device",{OK:function(){$(this).dialog("close")}})},collectionStopped:function(){this.gotoState("stoppedWithNoDataColumn")}},stoppedWithNoDataColumn:{enterState:function(){g()&&this.gotoState("connected")},data:function(){g()&&this.gotoState("connected")}},stopping:{enterState:function(){D="Stopping data collection..."},data:f,stopRequestFailed:function(){this.gotoState("errorStopping")},collectionStopped:function(){this.gotoState("collectionStopped")}},errorStopping:{enterState:function(){D="Error stopping data collection.",t("Could not stop data collection. Make sure that (remote starting) is enabled",{OK:function(){$(this).dialog("close"),v("dismissErrorStopping")}})},data:f,collectionStopped:function(){this.gotoState("collectionStopped")},dismissErrorStopping:function(){this.gotoState("started")}},collectionStopped:{enterState:function(){D="Data collection stopped.",g()&&this.gotoState("collectionComplete")},data:function(){f(),g()&&this.gotoState("collectionComplete")}},collectionComplete:{enterState:function(){D="Data collection complete.",A=!0},reset:function(){p(),u(),this.gotoState("connecting"),x.reset()}},disconnected:{enterState:function(){D="Disconnected.",N=!0,a.stopPolling()},leaveState:function(){N=!1},connect:function(e){a.startPolling(e),this.gotoState("connecting")}}}),a.on("*",function(){var e=Array.prototype.slice.call(arguments,0);v.apply(null,[this.event].concat(e))}),a.on("statusReceived",function(){T&&B.makeInvalidatingChange(function(){k=T.liveValue})}),a.on("controlEnabled",function(){L=!0}),a.on("controlDisabled",function(){L=!1}),y=new n({metadata:i,setters:{},unitsDefinition:s,initialProperties:e,usePlaybackSupport:!1}),y.mixInto(B),b=y.propertySupport,x=y.dispatchSupport,x.addEventTypes("tick","play","stop","tickStart","tickEnd"),p(),B.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return P}),B.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return P}),B.defineOutput("sensorReading",d,function(){return null==E?E:E-B.properties.tareValue}),B.defineOutput("liveSensorReading",d,function(){return null==k?k:k-B.properties.tareValue}),B.defineOutput("sensorName",{label:"Sensor Name"},function(){return C}),B.defineOutput("isStopped",{label:"Stopped?"},function(){return A}),B.defineOutput("isPlayable",{label:"Startable?"},function(){return M}),B.defineOutput("hasPlayed",{label:"Has successfully collected data?"},function(){return R>0}),B.defineOutput("canTare",{label:"Can set a tare value?"},function(){return O&&I}),B.defineOutput("canConnect",{label:"Can begin connecting to the LabQuest2?"},function(){return N}),B.defineOutput("canControl",{label:"Can remotely start/stop the LabQuest2?"},function(){return L}),B.defineOutput("needsReload",{label:"Needs Reload?"},function(){return S}),B.defineOutput("message",{label:"User Message"},function(){return D}),B.on("willReset.model",function(){a.stopPolling(),a.requestStop()}),B.updateAllOutputProperties(),w.gotoState("notConnected"),B}}),define("models/labquest2/view",["common/views/numeric-output-view","common/views/view-state"],function(){var e=require("common/views/numeric-output-view"),t=require("common/views/view-state");return function(n,r){function i(){n.properties.canTare?t.enableView(u.$zeroButton):t.disableView(u.$zeroButton)}function o(){n.properties.canConnect?t.enableView(u.$connectButton):t.disableView(u.$connectButton)}function a(){u.$message.text(n.properties.message)}function s(){n.addObserver("canTare",i),i(),n.addObserver("canConnect",o),o(),n.addObserver("message",a),a()}var l,u,c=d3.format(".2f");return u={$el:$("<div id='model-container' class='container sensor-model-container' />"),remoteAddress:null,bindModel:function(e,t){r=t||r,n=e||n,s()},getHeightForWidth:function(){return"2.6em"},setup:function(){u.$el.empty(),u.$addressInput=$("<div class='address-input'><input type='text' name='address-input' placeholder='address of LabQuest2'></input></div>"),l=new e({id:"sensor-value-view",label:"Reading: ",units:n.getPropertyDescription("sensorReading").getUnitAbbreviation()}),u.$connectButton=$("<div class='interactive-button'><button>Connect</button></div>"),u.$zeroButton=$("<div class='interactive-button'><button>Zero</button></div>"),u.$message=$("<div class='message'></div>"),u.$sensorReading=l.render().addClass("horizontal"),u.$el.css("zIndex",4).append(u.$addressInput).append(u.$connectButton).append(u.$sensorReading).append(u.$zeroButton).append(u.$message),u.$el.find("div").addClass("component component-spacing"),l.resize(),s(),"string"==typeof u.remoteAddress&&u.$addressInput.find("input").val(u.remoteAddress),u.$addressInput.find("input").on("change",function(){u.remoteAddress=$(this).val()}),u.$connectButton.on("click","button",function(){n.connect(u.$addressInput.find("input").val())}),u.$zeroButton.on("click","button",n.tare)},resize:function(){l&&l.resize()},repaint:function(){},setFocus:function(){},updateUnits:function(e){l.updateUnits(e),null==n.properties.liveSensorReading&&l.hideUnits()},update:function(){null==n.properties.liveSensorReading?(l.update(""),l.hideUnits()):(l.update(c(n.properties.liveSensorReading)),l.showUnits())}}}}),define("models/labquest2/scripting-api",[],function(){return function(e){return{resetModel:function(t){e.intController.resetModel(t)}}}}),define("models/labquest2/controller",["require","common/controllers/model-controller","./modeler","./view","./scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("./modeler"),r=e("./view"),i=e("./scripting-api");return function(e,o,a){function s(){var e=l.model;e.addObserver("liveSensorReading",function(){l.updateView()}),e.addObserver("needsReload",function(){e.properties.needsReload&&a.reloadModel()}),e.addPropertyDescriptionObserver("sensorReading",function(){var t=e.getPropertyDescription("sensorReading"),n=l.modelContainer;n.updateUnits(t.getUnitAbbreviation())})}var l=new t(e,o,a,n,r,i);return a.on("modelLoaded.labquest2-model-controller",s),a.on("modelReset.labquest2-model-controller",function(){l.model.set("isNewRunInProgress",!1)}),a.on("willResetModel",function(){l.model.set("isNewRunInProgress",!0)}),l}}),define("models/energy2d/models/constants",["require","exports","module"],function(e,t){"use strict";t.AIR_THERMAL_CONDUCTIVITY=.025,t.AIR_SPECIFIC_HEAT=1012,t.AIR_DENSITY=1.204,t.AIR_VISCOSITY=1568e-8,t.STEFAN_CONSTANT=5.67e-8}),define("models/energy2d/metadata",["require","models/energy2d/models/constants"],function(e){var t=e("models/energy2d/models/constants");return{mainProperties:{type:{defaultValue:"energy2d",immutable:!0},use_WebGL:{defaultValue:!1},grid_width:{defaultValue:100,immutable:!0},grid_height:{defaultValue:100,immutable:!0},model_width:{defaultValue:10,immutable:!0},model_height:{defaultValue:10,immutable:!0},timeStep:{defaultValue:1},timeStepsPerTick:{defaultValue:4},ticksPerGPUSync:{defaultValue:30},convective:{defaultValue:!0},background_temperature:{defaultValue:0},background_conductivity:{defaultValue:t.AIR_THERMAL_CONDUCTIVITY},background_specific_heat:{defaultValue:t.AIR_SPECIFIC_HEAT},background_density:{defaultValue:t.AIR_DENSITY},background_viscosity:{defaultValue:t.AIR_VISCOSITY},thermal_buoyancy:{defaultValue:25e-5},buoyancy_approximation:{defaultValue:1},boundary:{defaultValue:{type:"temperature",upper:0,lower:0,left:0,right:0}},sunny:{defaultValue:!1},sun_angle:{defaultValue:1.5707964},solar_power_density:{defaultValue:2e3},solar_ray_count:{defaultValue:24},solar_ray_speed:{defaultValue:.1},photon_emission_interval:{defaultValue:20}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},color_palette_type:{defaultValue:0},velocity:{defaultValue:!1},minimum_temperature:{defaultValue:0},maximum_temperature:{defaultValue:40},enableKeyboardHandlers:{defaultValue:!0}},part:{shapeType:{required:!0,immutable:!0},x:{defaultValue:0},y:{defaultValue:0},width:{},height:{},a:{},b:{},inner:{},outer:{},vertices:{},raw_x_coords:{serialize:!1},raw_y_coords:{serialize:!1},thermal_conductivity:{defaultValue:1},specific_heat:{defaultValue:1300},density:{defaultValue:25},transmission:{defaultValue:0},reflection:{defaultValue:0},absorption:{defaultValue:1},emissivity:{defaultValue:0},temperature:{defaultValue:0},constant_temperature:{defaultValue:!1},power:{defaultValue:0},wind_speed:{defaultValue:0},wind_angle:{defaultValue:0},visible:{defaultValue:!0},filled:{defaultValue:!0},color:{defaultValue:"auto"},label:{defaultValue:""},texture:{defaultValue:!1},draggable:{defaultValue:!0}},sensor:{type:{required:!0,immutable:!0},x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},angle:{immutable:!0},label:{defaultValue:""},value:{readOnly:!0,serialize:!1}}}}),define("models/energy2d/models/physics-solvers/heat-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5;t.makeHeatSolver=function(e){var t=e.getModelOptions(),i=t.grid_width,o=t.grid_height,a=r,s=e.getConductivityArray(),l=e.getCapacityArray(),u=e.getDensityArray(),c=e.getUVelocityArray(),d=e.getVVelocityArray(),p=e.getBoundaryTemperatureArray(),h=e.getFluidityArray(),f=n.create(i*o,0,e.getArrayType()),m=i-1,g=o-1,v=i-2,y=o-2,b=t.model_width/t.grid_width,x=t.model_height/t.grid_height,w=function(e){var n,r,a,l,u=t.boundary,c=u.upper,d=u.lower,p=u.left,h=u.right;if("temperature"===u.type){for(n=0;i>n;n+=1)a=n*i,e[a]=c,e[a+g]=d;for(r=0;o>r;r+=1)e[r]=p,e[m*i+r]=h}else if("flux"===u.type){for(n=0;i>n;n+=1)a=n*i,l=a+g,e[a]=e[a+1]+c*x/s[a],e[l]=e[a+y]-d*x/s[l];for(r=0;o>r;r+=1)e[r]=e[i+r]-p*b/s[r],e[m*i+r]=e[v*i+r]+h*b/s[m*i+r]}},_=function(e){var n,r,o,a,s,l,u,p,v=t.timeStep,y=.5*v/b,_=.5*v/x;for(n=1;m>n;n+=1)for(o=n*i,r=1;g>r;r+=1)a=o+r,l=a-i,s=a+i,p=a-1,u=a+1,h[a]&&(f[a]=e[a]-y*(c[s]*e[s]-c[l]*e[l])-_*(d[u]*e[u]-d[p]*e[p]));for(w(f),n=1;m>n;n+=1)for(o=n*i,r=1;g>r;r+=1)a=o+r,h[a]&&(l=a-i,s=a+i,p=a-1,u=a+1,e[a]=.5*(e[a]+f[a])-.5*y*c[a]*(f[s]-f[l])-.5*_*d[a]*(f[u]-f[p]));w(e)};return{solve:function(e,r,o){var c,d,h,v,y,T,C,A,S,P,E,k,R,M,N,O=t.timeStep,L=.5/(b*b),I=.5/(x*x),D=1/O;for(n.copy(r,f),C=0;a>C;C+=1){for(A=1;m>A;A+=1)for(P=A*i,S=1;g>S;S+=1)E=P+S,isNaN(p[E])?(R=E-i,k=E+i,N=E-1,M=E+1,d=l[E]*u[E]*D,c=s[E],h=L*(c+s[R]),v=L*(c+s[k]),y=I*(c+s[N]),T=I*(c+s[M]),r[E]=(f[E]*d+o[E]+h*r[R]+v*r[k]+y*r[N]+T*r[M])/(d+h+v+y+T)):r[E]=p[E];w(r)}e&&_(r)}}}}),define("models/energy2d/gpu/context",[],function(){"use strict";var e;return{getWebGLContext:function(){if(!e){var t=document.createElement("canvas");try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(n){}if(!e)throw new Error("GL: WebGL not supported.")}return e},get error(){if(!e)return"WebGL unavailable";var t=e.getError();return t===e.NO_ERROR?void 0:t}}}),define("models/energy2d/gpu/shader",["require","common/console","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r=e("common/console"),i=e("models/energy2d/gpu/context"),o=function(e,t,n){for(var r;null!==(r=e.exec(t));)n(r)},a=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t||"[object Float32Array]"===t},s=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t||"[object Boolean]"===t};return n=function(e,n){function r(e,n){var r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Shader: compile error.\n"+t.getShaderInfoLog(r)+"\nSource:\n"+n);return r}var a="      attribute vec4 gl_Vertex;      attribute vec4 gl_TexCoord;      attribute vec3 gl_Normal;      attribute vec4 gl_Color;      ",s="      precision highp float;      ",l=function(e,t){var n,r={};return n=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t),t=n?n[1]+e+t.substr(n[1].length):e+t,o(/\bgl_\w+\b/g,e,function(e){void 0===r[e]&&(t=t.replace(new RegExp("\\b"+e+"\\b","g"),"_"+e),r[e]=!0)}),t},u={};if(t=i.getWebGLContext(),e=l(a,e),n=l(s,n),this.program=t.createProgram(),t.attachShader(this.program,r(t.VERTEX_SHADER,e)),t.attachShader(this.program,r(t.FRAGMENT_SHADER,n)),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw new Error("Shader: link error.\n"+t.getProgramInfoLog(this.program)+"\nSource:\n"+e+"\n\n"+n);this.attributes={},this.uniformLocations={},o(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+n,function(e){u[e[2]]=1}),this.isSampler=u},n.prototype.uniforms=function(e){var n,i,o;t.useProgram(this.program);for(n in e)if(e.hasOwnProperty(n)){if(void 0===this.uniformLocations[n]&&(this.uniformLocations[n]=t.getUniformLocation(this.program,n)),i=this.uniformLocations[n],null===i){r.warn("Shader: name "+n+" does not correspond to an active uniform variable.");continue}if(o=e[n],a(o))switch(o.length){case 1:t.uniform1fv(i,new Float32Array(o));break;case 2:t.uniform2fv(i,new Float32Array(o));break;case 3:t.uniform3fv(i,new Float32Array(o));break;case 4:t.uniform4fv(i,new Float32Array(o));break;case 9:t.uniformMatrix3fv(i,!1,new Float32Array([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]]));break;case 16:t.uniformMatrix4fv(i,!1,new Float32Array([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]]));break;default:throw new Error("Shader: don't know how to load uniform \""+n+'" of length '+o.length)}else{if(!s(o))throw new Error('Shader: attempted to set uniform "'+n+'" to invalid value '+o);(this.isSampler[n]?t.uniform1i:t.uniform1f).call(t,i,o)}}return this},n.prototype.draw=function(e,n){t.useProgram(this.program),this.drawBuffers(e.vertexBuffers,e.indexBuffers[n===t.LINES?"lines":"triangles"],arguments.length<2?t.TRIANGLES:n)},n.prototype.drawBuffers=function(e,n,r){var i,o,a,s=0;for(i in e)if(e.hasOwnProperty(i)){if(o=e[i],void 0===this.attributes[i]&&(this.attributes[i]=t.getAttribLocation(this.program,i.replace(/^gl_/,"_gl_"))),a=this.attributes[i],-1===a||!o.buffer)continue;t.bindBuffer(t.ARRAY_BUFFER,o.buffer),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.buffer.spacing,t.FLOAT,!1,0,0),s=o.buffer.length/o.buffer.spacing}for(i in this.attributes)this.attributes.hasOwnProperty(i)&&void 0===e[i]&&t.disableVertexAttribArray(this.attributes[i]);!s||n&&!n.buffer||(n?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.buffer),t.drawElements(r,n.buffer.length,t.UNSIGNED_SHORT,0)):t.drawArrays(r,0,s))},n}),define("models/energy2d/gpu/texture",["require","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r=e("models/energy2d/gpu/context");return n=function(e,n,i){t=r.getWebGLContext(),i=i||{},this.id=t.createTexture(),this.width=e,this.height=n,this.format=i.format||t.RGBA,this.type=i.type||t.UNSIGNED_BYTE,this.tex_unit=null,this.fbo=null,t.bindTexture(t.TEXTURE_2D,this.id),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i.mag_filter||i.filter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i.min_filter||i.filter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i.wrap||i.wrap_s||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,i.wrap||i.wrap_t||t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,this.format,e,n,0,this.format,this.type,null)},n.prototype.setAsRenderTarget=function(){null===this.fbo?(this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.id,0),t.viewport(0,0,this.width,this.height)):(t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.viewport(0,0,this.width,this.height))},n.prototype.bind=function(e){this.tex_unit=e||0,t.activeTexture(t.TEXTURE0+this.tex_unit),t.bindTexture(t.TEXTURE_2D,this.id)},n.prototype.unbind=function(){null!==this.tex_unit&&(t.activeTexture(t.TEXTURE0+this.tex_unit),t.bindTexture(t.TEXTURE_2D,null),this.tex_unit=null)},n.prototype.drawTo=function(e){if(null===this.fbo)throw new Error("Texture: call setupAsRenderTarget() method first.");t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.viewport(0,0,this.width,this.height),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)},n.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.tex_unit,e.tex_unit=this.tex_unit,this.tex_unit=t,t=e.fbo,e.fbo=this.fbo,this.fbo=t},n}),define("models/energy2d/gpu/mesh",["require","models/energy2d/gpu/context"],function(e){"use strict";var t,n,r,i=e("models/energy2d/gpu/context");return n=function(e,n){t=i.getWebGLContext(),this.buffer=null,this.target=e,this.type=n,this.data=[]},n.prototype.compile=function(e){var n,r,i,o=[];for(n=0,r=1e4;n<this.data.length;n+=r)o=Array.prototype.concat.apply(o,this.data.slice(n,n+r));if(i=this.data.length?o.length/this.data.length:0,i!==Math.round(i))throw new Error("Mesh: buffer elements not of consistent size, average size is "+i);this.buffer=this.buffer||t.createBuffer(),this.buffer.length=o.length,this.buffer.spacing=i,t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(o),e||t.STATIC_DRAW)},r=function(e){t=i.getWebGLContext(),e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),(void 0===e.lines||e.triangles)&&this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")},r.prototype.addVertexBuffer=function(e,r){var i=this.vertexBuffers[r]=new n(t.ARRAY_BUFFER,Float32Array);i.name=e,this[e]=[]},r.prototype.addIndexBuffer=function(e){this.indexBuffers[e]=new n(t.ELEMENT_ARRAY_BUFFER,Uint16Array);this[e]=[]},r.prototype.compile=function(){var e,t,n;for(e in this.vertexBuffers)this.vertexBuffers.hasOwnProperty(e)&&(n=this.vertexBuffers[e],n.data=this[n.name],n.compile());for(t in this.indexBuffers)this.indexBuffers.hasOwnProperty(t)&&(n=this.indexBuffers[t],n.data=this[t],n.compile())},r.plane=function(e){var t,n,i,o,a,s,l,u;for(e=e||{},t=new r(e),n=e.detailX||e.detail||1,i=e.detailY||e.detail||1,a=0;i>=a;a+=1)for(s=a/i,o=0;n>=o;o+=1)l=o/n,t.vertices.push([2*l-1,2*s-1,0]),t.coords&&t.coords.push([l,s]),t.normals&&t.normals.push([0,0,1]),n>o&&i>a&&(u=o+a*(n+1),t.triangles.push([u,u+1,u+n+1]),t.triangles.push([u+n+1,u+1,u+n+2]));return t.compile(),t},r}),define("models/energy2d/gpu/gpgpu",["require","models/energy2d/gpu/context","models/energy2d/gpu/texture","models/energy2d/gpu/shader","models/energy2d/gpu/mesh"],function(e){"use strict";var t,n,r,i,o,a,s,l,u,c=e("models/energy2d/gpu/context"),d=e("models/energy2d/gpu/texture"),p=e("models/energy2d/gpu/shader"),h=e("models/energy2d/gpu/mesh"),f=!1,m=!1,g="    varying vec2 coord;    void main() {      coord = gl_Vertex.xy * 0.5 + 0.5;      gl_Position = vec4(gl_Vertex.xyz, 1.0);    }",v="    uniform sampler2D texture;    uniform float channel;    varying vec2 coord;    float shift_right(float v, float amt) {      v = floor(v) + 0.5;      return floor(v / exp2(amt));    }    float shift_left(float v, float amt) {      return floor(v * exp2(amt) + 0.5);    }        float mask_last(float v, float bits) {      return mod(v, shift_left(1.0, bits));    }    float extract_bits(float num, float from, float to) {      from = floor(from + 0.5);      to = floor(to + 0.5);      return mask_last(shift_right(num, from), to - from);    }    vec4 encode_float(float val) {      if (val == 0.0)        return vec4(0, 0, 0, 0);      float sign = val > 0.0 ? 0.0 : 1.0;      val = abs(val);      float exponent = floor(log2(val));      float biased_exponent = exponent + 127.0;      float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;            float t = biased_exponent / 2.0;      float last_bit_of_biased_exponent = fract(t) * 2.0;      float remaining_bits_of_biased_exponent = floor(t);            float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;      float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;      float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;      float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;      return vec4(byte4, byte3, byte2, byte1);    }    void main() {      vec4 data = texture2D(texture, coord);      if (channel == 0.0)        gl_FragColor = encode_float(data.r);      else if (channel == 1.0)        gl_FragColor = encode_float(data.g);      else if (channel == 2.0)        gl_FragColor = encode_float(data.b);      else        gl_FragColor = encode_float(data.a);    }",y="    uniform sampler2D texture;    varying vec2 coord;    void main() {      gl_FragColor = texture2D(texture, coord);    }",b="GPGPU: call init(grid_width, grid_height) with proper dimensions first!",x={WebGLContext:{required:!0,available:!1},OES_texture_float:{required:!0,available:!1},"FLOAT texture as render target":{required:!0,available:!1},OES_texture_float_linear:{required:!1,available:!1}},w=function(){if(t=c.getWebGLContext(),!t)throw x.WebGLContext.available=!1,new Error("GPGPU: WebGL is not supported!");if(x.WebGLContext.available=!0,!t.getExtension("OES_texture_float"))throw x.OES_texture_float.available=!1,new Error("GPGPU: OES_texture_float is not supported!");if(x.OES_texture_float.available=!0,t.getExtension("OES_texture_float_linear")?x.OES_texture_float_linear.available=!0:(x.OES_texture_float_linear.available=!1,console.warn("GPGPU: OES_texture_float_linear is not supported. Renering quality will be affected.")),i=new d(1,1,{type:t.FLOAT,format:t.RGBA,filter:x.OES_texture_float_linear.available?t.LINEAR:t.NEAREST}),i.setAsRenderTarget(),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw t.bindFramebuffer(t.FRAMEBUFFER,null),x["FLOAT texture as render target"].available=!1,new Error("GPGPU: FLOAT texture as render target is not supported!");x["FLOAT texture as render target"].available=!0,t.bindFramebuffer(t.FRAMEBUFFER,null),t.disable(t.DEPTH_TEST),s=h.plane(),l=new p(g,v),u=new p(g,y),m=!0},_=function(e,t,n,r,i){var o,a,s;if(e.length!==t.length||e.length!==n.length||e.length!==r.length||i.length!==4*e.length)throw new Error("GPGPU: Invalid input data length.");for(o=0,s=e.length;s>o;o+=1)a=4*o,i[a]=e[o],i[a+1]=t[o],i[a+2]=n[o],i[a+3]=r[o]};return{init:function(e,s){var l;m||w(),n=e,r=s,l=x.OES_texture_float_linear.available?t.LINEAR:t.NEAREST,i=new d(n,r,{type:t.FLOAT,format:t.RGBA,filter:l}),o=new d(n,r,{type:t.UNSIGNED_BYTE,format:t.RGBA,filter:l}),a=new Float32Array(n*r*4)},get featuresInfo(){if(!m)try{w()}catch(e){}return x},getWebGLContext:function(){return void 0===t&&w(),t},createTexture:function(){return n&&r?new d(n,r,{type:t.FLOAT,format:t.RGBA,filter:x.OES_texture_float_linear.available?t.LINEAR:t.NEAREST}):new Error(b)},convertToRGBA:function(e,t,i){var o,a,s,l;if(e.length!==n*r)throw new Error("GPGPU: Invalid input data length.");for(o=void 0===i?new Float32Array(4*e.length):i,void 0===t&&(t=0),a=0,s=e.length;s>a;a+=1)l=4*a,o[l]=o[l+1]=o[l+2]=o[l+3]=0,o[l+t]=e[a];return o},writeTexture:function(e,n){var r=this.convertToRGBA(n,0,a);t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,r)},writeRGBATexture:function(e,n,r,i,o){_(n,r,i,o,a),t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,a)},readTexture:function(e,i,a){var u;return t&&e.width===n&&e.height===r?(void 0===a&&(a=0),u=new Uint8Array(i.buffer),e.bind(),o.setAsRenderTarget(),l.uniforms({channel:a}),l.draw(s),void t.readPixels(0,0,o.width,o.height,o.format,o.type,u)):new Error(b)},copyTexture:function(e,t){e.bind(),t.setAsRenderTarget(),u.draw(s)},executeProgram:function(e,t,n){var r,o;for(r=0,o=t.length;o>r;r+=1)t[r].bind(r);for(i.setAsRenderTarget(),e.draw(s),r=0,o=t.length;o>r;r+=1)t[r].unbind(r);n.swapWith(i)},setSynchronizationAllowed:function(e){f=e},tryFinish:function(){f&&t.finish()}}}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl",[],function(){return'// texture 0:\n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1:\n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float inv_timeStep;\n\n// Boundary conditions uniforms\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    float tb = data0.b;\n    // Check if tb is NaN. isnan() function is not available\n    // in OpenGL ES GLSL, so use some tricks. IEEE 754 spec defines\n    // that NaN != NaN, however this seems to not work on Windows.\n    // So, also check if the value is outside [-3.4e38, 3.4e38] (3.4e38\n    // is close to 32Float max value), as such values are not expected.\n    if (tb != tb || tb < -3.4e38 || tb > 3.4e38) {\n      vec4 data1 = texture2D(data1_tex, coord);\n      vec4 data0_m_dy = texture2D(data0_tex, coord - dy);\n      vec4 data0_p_dy = texture2D(data0_tex, coord + dy);\n      vec4 data0_m_dx = texture2D(data0_tex, coord - dx);\n      vec4 data0_p_dx = texture2D(data0_tex, coord + dx);\n      float sij = data1.g * data1.b * inv_timeStep;\n      float rij = data0.a;\n      float axij = hx * (rij + data0_m_dy.a);\n      float bxij = hx * (rij + data0_p_dy.a);\n      float ayij = hy * (rij + data0_m_dx.a);\n      float byij = hy * (rij + data0_p_dx.a);\n      data0.r = (data0.g * sij + data1.r\n                 + axij * data0_m_dy.r\n                 + bxij * data0_p_dy.r\n                 + ayij * data0_m_dx.r\n                 + byij * data0_p_dx.r)\n                 / (sij + axij + bxij + ayij + byij);\n    } else {\n      data0.r = tb;\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nuniform vec2 grid;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\nuniform float delta_x;\nuniform float delta_y;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  if (coord.x < grid.x) {\n    data0.r = texture2D(data0_tex, coord + dx).r\n            + vN * delta_y / data0.a;\n  } else if (coord.x > 1.0 - grid.x) {\n    data0.r = texture2D(data0_tex, coord - dx).r\n            - vS * delta_y / data0.a;\n  } else if (coord.y < grid.y) {\n    data0.r = texture2D(data0_tex, coord + dy).r\n            - vW * delta_x / data0.a;\n  } else if (coord.y > 1.0 - grid.y) {\n    data0.r = texture2D(data0_tex, coord - dy).r\n            + vE * delta_x / data0.a;\n  }\n  gl_FragColor = data0;\n}\n"
}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data0 = texture2D(data0_tex, coord);\n	data0.g = data0.r;\n	gl_FragColor = data0;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature.\n      float t_m_dy = texture2D(data0_tex, coord - dy).r;\n      float t_p_dy = texture2D(data0_tex, coord + dy).r;\n      float t_m_dx = texture2D(data0_tex, coord - dx).r;\n      float t_p_dx = texture2D(data0_tex, coord + dx).r;\n      // Velocity.\n      float u_m_dy = texture2D(data2_tex, coord - dy).r;\n      float u_p_dy = texture2D(data2_tex, coord + dy).r;\n      float v_m_dx = texture2D(data2_tex, coord - dx).g;\n      float v_p_dx = texture2D(data2_tex, coord + dx).g;\n      // Update T0.\n      data0.g = data0.r - tx * (u_p_dy * t_p_dy - u_m_dy * t_m_dy)\n                        - ty * (v_p_dx * t_p_dx - v_m_dx * t_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.g = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.g = vS;\n    } else if (coord.y < grid.y) {\n      data0.g = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.g = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature t0.\n      float t0_m_dy = texture2D(data0_tex, coord - dy).g;\n      float t0_p_dy = texture2D(data0_tex, coord + dy).g;\n      float t0_m_dx = texture2D(data0_tex, coord - dx).g;\n      float t0_p_dx = texture2D(data0_tex, coord + dx).g;\n      // Velocity.\n      float u = texture2D(data2_tex, coord).r;\n      float v = texture2D(data2_tex, coord).g;\n      // Update T.\n      data0.r = 0.5 * (data0.r + data0.g)\n              - 0.5 * tx * u * (t0_p_dy - t0_m_dy)\n              - 0.5 * ty * v * (t0_p_dx - t0_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("models/energy2d/models/physics-solvers-gpu/heat-solver-gpu",["require","exports","module","models/energy2d/gpu/shader","models/energy2d/gpu/gpgpu","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"],function(e,t){"use strict";var n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/gpgpu"),i=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl"),o=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl"),a=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),s=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),l=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl"),u=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl"),c=e("text!models/energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"),d=10;t.makeHeatSolverGPU=function(e){var t=new n(i,o),p=new n(i,a),h=new n(i,s),f=new n(i,l),m=new n(i,u),g=new n(i,c),v=e.getModelOptions(),y=v.grid_width,b=v.grid_height,x=v.timeStep,w=v.boundary,_=v.model_width/v.grid_width,T=v.model_height/v.grid_height,C=d,A=e.getSimulationTexture(0),S=e.getSimulationTexture(1),P=e.getSimulationTexture(2),E=[A,S,P],k=[A,S],R=[A],M=[1/b,1/y],N=function(){var e;e={data0_tex:0,data1_tex:1,grid:M,enforce_temp:0,hx:.5/(_*_),hy:.5/(T*T),inv_timeStep:1/x},t.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:M,enforce_temp:0,tx:.5*x/_,ty:.5*x/T},m.uniforms(e),g.uniforms(e),"temperature"===w.type?(e={enforce_temp:1,vN:w.upper,vS:w.lower,vW:w.left,vE:w.right},t.uniforms(e),m.uniforms(e),g.uniforms(e)):"flux"===w.type&&(e={data0_tex:0,grid:M,vN:w.upper,vS:w.lower,vW:w.left,vE:w.right,delta_x:_,delta_y:T},p.uniforms(e),h.uniforms(e))},O=function(){r.executeProgram(m,E,A),"flux"===w.type&&r.executeProgram(h,R,A),r.executeProgram(g,E,A),"flux"===w.type&&r.executeProgram(p,R,A)},L={solve:function(e){var n;for(r.executeProgram(f,R,A),n=0;C>n;n+=1)r.executeProgram(t,k,A),"flux"===w.type&&r.executeProgram(p,R,A);e&&O()}};return N(),L}}),define("models/energy2d/models/physics-solvers/fluid-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5,i=0,o=0,a=1;t.makeFluidSolver=function(e){var t=e.getModelOptions(),s=t.grid_width,l=t.grid_height,u=r,c=i,d=e.getTemperatureArray(),p=e.getFluidityArray(),h=e.getUWindArray(),f=e.getVWindArray(),m=e.getArrayType(),g=n.create(s*l,0,m),v=n.create(s*l,0,m),y=s-1,b=l-1,x=s-2,w=l-2,_=t.model_width/t.grid_width,T=t.model_height/t.grid_height,C=.5/_,A=.5/T,S=1/(_*_),P=1/(T*T),E=function(e,t){var n,r,i,o,a,l,u,c=1===e,d=2===e,p=y*s,h=x*s;for(n=1;y>n;n+=1)i=n*s,o=i+1,a=i+b,l=i+w,t[i]=d?-t[o]:t[o],t[a]=d?-t[l]:t[l];for(r=1;b>r;r+=1)u=s+r,t[r]=c?-t[u]:t[u],t[p+r]=c?-t[h+r]:t[h+r];t[0]=.5*(t[s]+t[1]),t[p]=.5*(t[h]+t[p+1]),t[b]=.5*(t[s+b]+t[w]),t[p+b]=.5*(t[h+b]+t[p+w])},k=function(e,t){var n,r,i,o,a,l,u,c,d,m,g=0;for(i=1;y>i;i+=1)for(a=i*s,o=1;b>o;o+=1)l=a+o,c=l-s,u=l+s,m=l-1,d=l+1,p[l]||(n=h[l],r=f[l],g=0,p[c]?(g+=1,e[l]=n-e[c],t[l]=r+t[c]):p[u]&&(g+=1,e[l]=n-e[u],t[l]=r+t[u]),p[m]?(g+=1,e[l]=n+e[m],t[l]=r-t[m]):p[d]&&(g+=1,e[l]=n+e[d],t[l]=r-t[d]),0===g&&(e[l]=n,t[l]=r))},R=function(e){var t,n,r,i,o,a,l,u;for(t=1;y>t;t+=1)for(r=t*s,n=1;b>n;n+=1)i=r+n,p[i]||(a=i-s,o=i+s,u=i-1,l=i+1,p[a]?e[i]=e[a]:p[o]&&(e[i]=e[o]),p[u]?e[i]=e[u]:p[l]&&(e[i]=e[l]))},M=function(e,t){var n,r,i=0,o=l,a=0;for(n=t-1;n>0;n-=1)if(r=e*s+n,!p[r]){i=n;break}for(n=t+1;l>n;n+=1)if(r=e*s+n,!p[r]){o=n;break}for(n=i;o>n;n+=1)r=e*s+n,a+=d[r];return a/(o-i)},N=function(e){var n,r,i,l,u,h=c*t.timeStep,f=t.thermal_buoyancy*t.timeStep;switch(t.buoyancy_approximation){case o:for(n=function(e){var t,n=0,r=e.length;for(t=0;r>t;t+=1)n+=e[t];return n/r}(d),r=1;y>r;r+=1)for(l=r*s,i=1;b>i;i+=1)u=l+i,p[u]&&(e[u]+=(h-f)*d[u]+f*n);break;case a:for(r=1;y>r;r+=1)for(l=r*s,i=1;b>i;i+=1)u=l+i,p[u]&&(n=M(r,i),e[u]+=(h-f)*d[u]+f*n)}},O=function(e,t,n,r){var i,o,a,l,c,d,h,f,m,g=.5/(S+P);for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)c=l+a,p[c]&&(h=c-s,d=c+s,m=c-1,f=c+1,r[c]=(e[d]-e[h])*C+(t[f]-t[m])*A,n[c]=0);for(E(0,r),E(0,n),R(r),R(n),i=0;u>i;i+=1)for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)c=l+a,p[c]&&(h=c-s,d=c+s,m=c-1,f=c+1,n[c]=g*((n[h]+n[d])*S+(n[m]+n[f])*P-r[c]));for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)c=l+a,p[c]&&(h=c-s,d=c+s,m=c-1,f=c+1,e[c]-=(n[d]-n[h])*C,t[c]-=(n[f]-n[m])*A);E(1,e),E(2,t)},L=function(e,r,i){var o,a,l,c,d,h,f,m,g,v=t.timeStep,x=t.background_viscosity,w=v*x*S,_=v*x*P,T=1/(1+2*(w+_));for(n.copy(i,r),o=0;u>o;o+=1){for(a=1;y>a;a+=1)for(c=a*s,l=1;b>l;l+=1)d=c+l,p[d]&&(f=d-s,h=d+s,g=d-1,m=d+1,i[d]=(r[d]+w*(i[f]+i[h])+_*(i[g]+i[m]))*T);E(e,i)}},I=function(e,r,i){var o,a,l,u,c,d,h,f,m=t.timeStep,x=.5*m/_,w=.5*m/T;for(o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)u=l+a,p[u]&&(d=u-s,c=u+s,f=u-1,h=u+1,i[u]=r[u]-x*(g[c]*r[c]-g[d]*r[d])-w*(v[h]*r[h]-v[f]*r[f]));for(E(e,i),o=1;y>o;o+=1)for(l=o*s,a=1;b>a;a+=1)u=l+a,p[u]&&(d=u-s,c=u+s,f=u-1,h=u+1,r[u]=.5*(r[u]+i[u])-.5*x*g[u]*(i[c]-i[d])-.5*w*v[u]*(i[h]-i[f]));n.copy(r,i),E(e,i)},D=function(e,t,n){I(e,t,n)};return{solve:function(e,r){0!==t.thermal_buoyancy&&N(r),k(e,r),t.background_viscosity>0&&(L(1,g,e),L(2,v,r),O(e,r,g,v),k(e,r)),n.copy(e,g),n.copy(r,v),D(1,g,e),D(2,v,r),O(e,r,g,v),k(e,r)}}}}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = data2.ba - tx * (data2_p_dy.bb * data2_p_dy.ba - data2_m_dy.bb * data2_m_dy.ba)\n              - ty * (data2_p_dx.aa * data2_p_dx.ba - data2_m_dx.aa * data2_m_dx.ba);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = 0.5 * (data2.ba + data2.rg) \n            - 0.5 * tx * data2.bb * (data2_p_dy.rg - data2_m_dy.rg)\n            - 0.5 * ty * data2.aa * (data2_p_dx.rg - data2_m_dx.rg);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_p_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_p_dx.rg);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = vec2(data2_p_dx.r, -data2_p_dx.g);\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = vec2(data2_m_dx.r, -data2_m_dx.g);\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    data2.rg = vec2(-data2_p_dy.r, data2_p_dy.g);\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    data2.rg = vec2(-data2_m_dy.r, data2_m_dy.g);\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_p_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_p_dx.ba);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    data2.ba = texture2D(data2_tex, coord + dx).ba;\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    data2.ba = texture2D(data2_tex, coord - dx).ba;\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    data2.ba = texture2D(data2_tex, coord + dy).ba;\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    data2.ba = texture2D(data2_tex, coord - dy).ba;\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dy).ba;\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dy).ba;\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dx).ba;\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dx).ba;\n    } \n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n// texture 3: \n// - R: uWind\n// - G: vWind\n// - B: undefined\n// - A: undefined\nuniform sampler2D data3_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    int count = 0;\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dy = texture2D(data2_tex, coord - dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_m_dy.r, data2_m_dy.g);\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dy = texture2D(data2_tex, coord + dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_p_dy.r, data2_p_dy.g);\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dx = texture2D(data2_tex, coord - dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_m_dx.r, -data2_m_dx.g);\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dx = texture2D(data2_tex, coord + dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_p_dx.r, -data2_p_dx.g);\n    } \n\n    if (count == 0) {\n      data2.rg = texture2D(data3_tex, coord).rg;\n    }\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data2 = texture2D(data2_tex, coord);\n	data2.ba = data2.rg;\n	gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = 0.0;\n    // Div.\n    data2.a = (data2_p_dy.r - data2_m_dy.r) * i2dx + (data2_p_dx.g - data2_m_dx.g) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float s;\nuniform float idxsq;\nuniform float idysq;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = s * ((data2_m_dy.b + data2_p_dy.b) * idxsq + (data2_m_dx.b + data2_p_dx.b) * idysq - data2.a);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // U.\n    data2.r -= (data2_p_dy.b - data2_m_dy.b) * i2dx;\n    // V.\n    data2.g -= (data2_p_dx.b - data2_m_dx.b) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float dn;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = (data2.ba + hx * (data2_m_dy.rg + data2_p_dy.rg)\n                         + hy * (data2_m_dx.rg + data2_p_dx.rg)) * dn;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float g;\nuniform float b;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    float t = texture2D(data0_tex, coord).r;\n    // Get average column temperature.\n\n    float avg_t = t;\n    float count = 1.0;\n    vec2 n_coord = coord - dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x > 0.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord -= dx;\n      } else {\n        break;\n      }\n    }\n    n_coord = coord + dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x < 1.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord += dx;\n      } else {\n        break;\n      }\n    }\n    avg_t /= count;\n\n    // Update velocity V component.\n    data2.g += (g - b) * t + b * avg_t;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu",["require","exports","module","models/energy2d/gpu/shader","models/energy2d/gpu/gpgpu","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl","text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"],function(e,t){"use strict";var n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/gpgpu"),i=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl"),o=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl"),a=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl"),s=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl"),l=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl"),u=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl"),c=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl"),d=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl"),p=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl"),h=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl"),f=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl"),m=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl"),g=e("text!models/energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"),v=10,y=0;t.makeFluidSolverGPU=function(e){var t=new n(i,o),b=new n(i,a),x=new n(i,s),w=new n(i,l),_=new n(i,u),T=new n(i,c),C=new n(i,d),A=new n(i,p),S=new n(i,h),P=new n(i,f),E=new n(i,m),k=new n(i,g),R=e.getSimulationTexture(0),M=e.getSimulationTexture(1),N=e.getSimulationTexture(2),O=e.getSimulationTexture(3),L=e.getModelOptions(),I=L.grid_width,D=L.grid_height,B=L.timeStep,V=L.thermal_buoyancy,F=L.background_viscosity,j=L.model_width/L.grid_width,G=L.model_height/L.grid_height,U=v,z=y,W=.5/j,$=.5/G,q=1/(j*j),H=1/(G*G),Y=.5/(q+H),X=B*F*q,J=B*F*H,K=1/(1+2*(X+J)),Z=z*B,Q=V*B,et=[1/D,1/I],tt=[N],nt=[M,N],rt=[R,M,N],it=[M,N,O],ot=function(){var e;e={data1_tex:0,data2_tex:1,grid:et,tx:.5*B/j,ty:.5*B/G},t.uniforms(e),b.uniforms(e),e={data2_tex:0,grid:et},x.uniforms(e),w.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et},_.uniforms(e),e={data1_tex:0,data2_tex:1,data3_tex:2,grid:et},T.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,i2dx:W,i2dy:$},A.uniforms(e),P.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,s:Y,idxsq:q,idysq:H},S.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,hx:X,hy:J,dn:K},E.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:et,g:Z,b:Q},k.uniforms(e)},at=function(){r.executeProgram(k,rt,N)},st=function(){r.executeProgram(t,nt,N),r.executeProgram(x,tt,N),r.executeProgram(b,nt,N),r.executeProgram(x,tt,N)},lt=function(){var e;for(r.executeProgram(A,nt,N),r.executeProgram(w,tt,N),r.executeProgram(_,nt,N),e=0;U>e;e+=1)r.executeProgram(S,nt,N);r.executeProgram(P,nt,N),r.executeProgram(x,tt,N)},ut=function(){var e;for(r.executeProgram(C,tt,N),e=0;U>e;e+=1)r.executeProgram(E,nt,N),r.executeProgram(x,tt,N)},ct=function(){r.executeProgram(T,it,N)},dt=function(){r.executeProgram(C,tt,N)},pt={solve:function(){0!==V&&at(),ct(),F>0&&(ut(),lt(),ct()),dt(),st(),lt(),ct()}};return ot(),pt}}),define("models/energy2d/models/helpers",["require","exports","module"],function(e,t){"use strict";t.hypot=function(e,t){var n;return e=Math.abs(e),t=Math.abs(t),n=Math.min(e,t),e=Math.max(e,t),0===e?0:(n/=e,e*Math.sqrt(1+n*n))}}),define("models/energy2d/models/shape",["require","exports","module"],function(e,t){"use strict";t.pointInsidePolygon=function(e,t,n,r,i){var o,a,s=0;for(o=0,a=e-1;e>o;a=o,o+=1)n[o]>i!=n[a]>i&&r<(t[a]-t[o])*(i-n[o])/(n[a]-n[o])+t[o]&&(s=!s);return!!s};var n=t.Line=function(e,t,n,r){this.x1=e,this.y1=t,this.x2=n,this.y2=r};n.prototype.intersectsLine=function(e){var t,n,r,i={x:this.x1,y:this.y1},o={x:this.x2,y:this.y2},a={x:e.x1,y:e.y1},s={x:e.x2,y:e.y2},l=(s.x-a.x)*(i.y-a.y)-(s.y-a.y)*(i.x-a.x),u=(o.x-i.x)*(i.y-a.y)-(o.y-i.y)*(i.x-a.x),c=(s.y-a.y)*(o.x-i.x)-(s.x-a.x)*(o.y-i.y);
return 0!==c?(n=l/c,r=u/c,t=n>=0&&1>=n&&r>=0&&1>=r?!0:!1):t=0===l||0===u?!0:!1,t};var r=t.Polygon=function(e,t,n,r,i){this.count=e,this.raw_x_coords=t,this.raw_y_coords=n,this.x_coords=new Array(e),this.y_coords=new Array(e),this.x=r||0,this.y=i||0};Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){var t,n;for(t=0,n=this.count;n>t;t++)this.x_coords[t]=this.raw_x_coords[t]+e;this._x=e}}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){var t,n;for(t=0,n=this.count;n>t;t++)this.y_coords[t]=this.raw_y_coords[t]+e;this._y=e}}),r.prototype.polygonize=function(){return this},r.prototype.contains=function(e,t){var n,r,i=this.x_coords,o=this.y_coords,a=this.count,s=0;for(n=0,r=a-1;a>n;r=n,n+=1)o[n]>t!=o[r]>t&&e<(i[r]-i[n])*(t-o[n])/(o[r]-o[n])+i[n]&&(s=!s);return!!s};var i=t.Rectangle=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.polygon_cache=void 0};i.prototype.polygonize=function(){var e,t,n,i;return this.polygon_cache||(e=this.x,t=this.y,n=this.width,i=this.height,this.polygon_cache=new r(4,[e,e+n,e+n,e],[t,t,t+i,t+i])),this.polygon_cache},i.prototype.contains=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};var o=function(e,t,n,i,o){var a,s,l=new Array(o),u=new Array(o),c=2*Math.PI/o;for(s=0;o>s;s+=1)a=c*s,l[s]=e+n*Math.cos(a),u[s]=t+i*Math.sin(a);return new r(o,l,u)},a=t.Ellipse=function(e,t,n,r){this.x=e,this.y=t,this.a=n,this.b=r,this.polygon_cache=void 0};a.prototype.POLYGON_SEGMENTS=50,a.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=o(this.x,this.y,.5*this.a,.5*this.b,this.POLYGON_SEGMENTS)),this.polygon_cache},a.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=.5*this.a,o=.5*this.b;return 1>=n*n/(i*i)+r*r/(o*o)};var s=t.Ring=function(e,t,n,r){this.x=e,this.y=t,this.inner=n,this.outer=r,this.polygon_cache=void 0};s.prototype.POLYGON_SEGMENTS=50,s.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=o(this.x,this.y,.5*this.outer,.5*this.outer,this.POLYGON_SEGMENTS)),this.polygon_cache},s.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=.5*this.outer,o=.5*this.outer,a=.5*this.inner,s=.5*this.inner;return 1>=n*n/(i*i)+r*r/(o*o)&&n*n/(a*a)+r*r/(s*s)>=1}}),define("models/energy2d/models/photon",["require","exports","module","models/energy2d/models/helpers","models/energy2d/models/shape","models/energy2d/models/shape"],function(e,t){"use strict";var n=e("models/energy2d/models/helpers").hypot,r=e("models/energy2d/models/shape").Line,i=e("models/energy2d/models/shape").Rectangle,o=t.Photon=function(e,t,n,r,i){this.x=e,this.y=t,this.energy=n,this.c=r,void 0!==i&&(this.vx=Math.cos(i)*r,this.vy=Math.sin(i)*r)};o.prototype.isContained=function(e,t,n,r){return this.x>=e&&this.x<=t&&this.y>=n&&this.y<=r},o.prototype.move=function(e){this.x+=this.vx*e,this.y+=this.vy*e},o.prototype.reflectFromLine=function(e,t){var i,o,a,s,l,u=this.x,c=this.y,d=this.x-this.vx*t,p=this.y-this.vy*t,h=new r(u,c,d,p),f=this.vx,m=this.vy;return h.intersectsLine(e)?(u=e.x1,c=e.y1,d=e.x2,p=e.y2,i=1/n(u-d,c-p),o=(p-c)*i,a=(d-u)*i,s=f*a+m*o,l=m*a-f*o,this.vx=s*a+l*o,this.vy=s*o-l*a,!0):!1},o.prototype.reflectFromRectangle=function(e,t){var n,r,i=e.x,o=e.y,a=e.x+e.width,s=e.y+e.height;n=this.vx*t,this.x-n<i?this.vx=-Math.abs(this.vx):this.x-n>a&&(this.vx=Math.abs(this.vx)),r=this.vy*t,this.y-r<o?this.vy=-Math.abs(this.vy):this.y-r>s&&(this.vy=Math.abs(this.vy))},o.prototype.reflectFromPolygon=function(e,t){var n,i,o=new r;for(n=0,i=e.count-1;i>n;n+=1)if(o.x1=e.x_coords[n],o.y1=e.y_coords[n],o.x2=e.x_coords[n+1],o.y2=e.y_coords[n+1],this.reflectFromLine(o,t))return;o.x1=e.x_coords[e.count-1],o.y1=e.y_coords[e.count-1],o.x2=e.x_coords[0],o.y2=e.y_coords[0],this.reflectFromLine(o,t)},o.prototype.reflect=function(e,t){return e.contains(this.x,this.y)?(e instanceof i?this.reflectFromRectangle(e,t):this.reflectFromPolygon(e.polygonize(),t),!0):!1}}),define("models/energy2d/models/physics-solvers/ray-solver",["require","exports","module","models/energy2d/models/photon"],function(e,t){"use strict";var n=e("models/energy2d/models/photon").Photon;t.makeRaySolver=function(e){var t=e.getModelOptions(),r=e.getPowerArray(),i=e.getPartsArray(),o=e.getPhotonsArray(),a=t.model_width,s=t.model_height,l=t.grid_width,u=t.grid_height,c=l-1,d=u-1,p=t.model_width/t.grid_width,h=t.model_height/t.grid_height,f=function(){return Math.PI-t.sun_angle},m=function(){for(var e=0;e<o.length;)void 0===o[e]?o.splice(e,1):e+=1},g=function(){var e,t;for(e=0,t=o.length;t>e;e+=1)o[e].isContained(0,a,0,s)||(o[e]=void 0);m()},v=function(e,t){var n,r;for(n=0,r=i.length;r>n;n+=1)if(i[n].contains(e,t))return!0;return!1},y=function(e,r){var i,l,u,c=f(),d=t.solar_power_density,p=t.solar_ray_speed,h=Math.floor(a/e),m=Math.floor(s/r);if(c>=0&&c<.5*Math.PI){for(l=0,u=1;h>=u;u+=1)i=e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=0,u=0;m>=u;u+=1)l=r*u,v(i,l)||o.push(new n(i,l,d,p,c))}else if(0>c&&c>=-.5*Math.PI){for(l=s,u=1;h>=u;u+=1)i=e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=0,u=0;m>=u;u+=1)l=s-r*u,v(i,l)||o.push(new n(i,l,d,p,c))}else if(c<Math.PI+.001&&c>=.5*Math.PI){for(l=0,u=0;h>=u;u+=1)i=a-e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=a,u=1;m>=u;u+=1)l=r*u,v(i,l)||o.push(new n(i,l,d,p,c))}else if(c>=-Math.PI&&c<-.5*Math.PI){for(l=s,u=0;h>=u;u+=1)i=a-e*u,v(i,l)||o.push(new n(i,l,d,p,c));for(i=a,u=1;m>=u;u+=1)l=s-r*u,v(i,l)||o.push(new n(i,l,d,p,c))}};return{solve:function(){var e,n,a,s,l,f,v,y,b=t.timeStep,x=t.photon_emission_interval,w=1/(b*x),_=1/p,T=1/h;for(l=0,v=o.length;v>l;l+=1)for(e=o[l],e.move(b),f=0,y=i.length;y>f&&(n=i[f],!n.reflect(e,b));f+=1)if(n.absorb(e)){a=Math.max(Math.min(Math.round(e.x*_),c),0),s=Math.max(Math.min(Math.round(e.y*T),d),0),r[a*u+s]=e.energy*w,o[l]=void 0;break}m(),g()},radiate:function(){var t,n,r;for(n=0,r=i.length;r>n;n+=1)t=i[n],t.emissivity>0&&t.radiate(e)},sunShine:function(){var e,n,r,i=f();0>i||(e=Math.abs(Math.sin(i)),n=Math.abs(Math.cos(i)),r=n*a>e*s?s/n:a/e,r/=t.solar_ray_count,y(r/e,r/n))}}}}),define("models/energy2d/models/part",["require","exports","module","models/energy2d/models/constants","models/energy2d/models/helpers","models/energy2d/models/photon","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape","models/energy2d/models/shape"],function(e,t){"use strict";var n=e("models/energy2d/models/constants"),r=e("models/energy2d/models/helpers").hypot,i=e("models/energy2d/models/photon").Photon,o=e("models/energy2d/models/shape"),a=e("models/energy2d/models/shape").Line,s=e("models/energy2d/models/shape").Polygon,l=e("models/energy2d/models/shape").Rectangle,u=e("models/energy2d/models/shape").Ellipse,c=e("models/energy2d/models/shape").Ring,d=.5,p=20,h=100,f=Math.sin(Math.PI/6),m=Math.cos(Math.PI/6),g=Math.sin(Math.PI/3),v=Math.cos(Math.PI/3),y=t.Part=function(e){var t,n,r;if(this._options=e,"rectangle"===e.shapeType)this.shape=new l(e.x,e.y,e.width,e.height);else if("ellipse"===e.shapeType)this.shape=new u(e.x,e.y,e.a,e.b);else if("ring"===e.shapeType)this.shape=new c(e.x,e.y,e.inner,e.outer);else{if("polygon"!==e.shapeType)throw new Error("Part: shape not defined or not supported.");for(t=e.vertices.split(", "),this.x_coords=[],this.y_coords=[],r=0,n=.5*t.length;n>r;r+=1)this.x_coords[r]=Number(t[2*r]),this.y_coords[r]=Number(t[2*r+1]);this.shape=new s(n,this.x_coords,this.y_coords,e.x,e.y)}};Object.defineProperty(y.prototype,"shapeType",{get:function(){return this._options.shapeType}}),["x","y","width","height","inner","outer","a","b","raw_x_coords","raw_y_coords"].forEach(function(e){Object.defineProperty(y.prototype,e,{get:function(){return this.shape[e]},set:function(t){this.shape[e]=t,this.polygon_cache=void 0}})}),Object.defineProperty(y.prototype,"vertices",{get:function(){if("polygon"!==this.shapeType)return void 0;var e,t,n=this.shape.raw_x_coords,r=this.shape.raw_y_coords,i=[];for(e=0,t=n.length;t>e;e++)i.push(n[e]),i.push(r[e]);return i.join(", ")}}),["thermal_conductivity","specific_heat","density","temperature","constant_temperature","power","wind_speed","wind_angle","transmission","reflection","absorption","emissivity","visible","filled","color","texture","label","draggable"].forEach(function(e){Object.defineProperty(y.prototype,e,{get:function(){return this._options[e]},set:function(t){this._options[e]=t}})}),y.prototype.getLabel=function(){function e(e,t){var n;return n=e>=100?e.toFixed():e.toFixed(e>=10?1:2),n+t}var t,n=this.label;return"%temperature"===n?t=e(this.temperature," °C"):"%density"===n?t=e(this.density," kg/m³"):"%specific_heat"===n?t=e(this.specific_heat," J/(kg×°C)"):"%thermal_conductivity"===n?t=e(this.thermal_conductivity," W/(m×°C)"):"%power_density"===n?t=e(this.power," W/m³"):"%area"===n?"rectangle"===this.shapeType?t=e(this.width*this.height," m²"):"ellipse"===this.shapeType&&(t=e(this.a*this.b*.25*Math.PI," m²")):"%width"===n?"rectangle"===this.shapeType?t=e(this.width," m"):"ellipse"===this.shapeType&&(t=e(this.a," m")):"%height"===n?"rectangle"===this.shapeType?t=e(this.height," m"):"ellipse"===this.shapeType&&(t=e(this.b," m")):t=n,t},y.prototype.getGridCells=function(e,t,n,r){var i=e-1,a=t-1,s=i/n,l=a/r,u=function(e){var n,r,o,u,c,d,p,h=[];for(o=Math.min(Math.max(Math.ceil(e.x*s),0),i),u=Math.min(Math.max(Math.ceil(e.y*l),0),a),c=Math.min(Math.max(Math.floor((e.x+e.width)*s),0),i),d=Math.min(Math.max(Math.floor((e.y+e.height)*l),0),a),h=new Array((c-o+1)*(d-u+1)),p=0,n=o;c>=n;n+=1)for(r=u;d>=r;r+=1)h[p+=1]=n*t+r;return h},c=function(e){var n,r,o,u,c,d,p,h,f=e.x*s,m=e.y*l,g=.5*e.a*s,v=.5*e.b*l,y=[];for(o=Math.min(Math.max(Math.ceil(f-g),0),i),u=Math.min(Math.max(Math.floor(f+g),0),i),y=[],h=0,r=o;u>=r;r+=1)for(n=Math.sqrt(1-(r-f)*(r-f)/(g*g)),d=Math.min(Math.max(Math.ceil(m-v*n),0),a),p=Math.min(Math.max(Math.floor(m+v*n),0),a),c=d;p>=c;c+=1)y[h+=1]=r*t+c;return y},d=function(e){var n,r,o,u,c,d,p,h,f,m,g=e.x*s,v=e.y*l,y=.5*e.outer*s,b=.5*e.outer*l,x=.5*e.inner*s,w=.5*e.inner*l,_=[];for(r=Math.min(Math.max(Math.ceil(g-y),0),i),o=Math.min(Math.max(Math.floor(g+y),0),i),n=r;o>=n;n+=1)if(f=Math.sqrt(1-(n-g)*(n-g)/(y*y)),c=Math.min(Math.max(Math.ceil(v-b*f),0),a),h=Math.min(Math.max(Math.floor(v+b*f),0),a),Math.abs(n-g)<x){for(f=Math.sqrt(1-(n-g)*(n-g)/(x*x)),d=Math.min(Math.max(Math.ceil(v-w*f),0),a),p=Math.min(Math.max(Math.floor(v+w*f),0),a),u=c;d>=u;u+=1)_[m+=1]=n*t+u;for(u=p;h>=u;u+=1)_[m+=1]=n*t+u}else for(u=c;h>=u;u+=1)_[m+=1]=n*t+u;return _},p=function(e){var n,r,u,c,d,p,h,f=e.x_coords.length,m=new Array(f),g=new Array(f),v=Number.MAX_VALUE,y=Number.MIN_VALUE,b=Number.MAX_VALUE,x=Number.MIN_VALUE,w=[];for(n=0;f>n;n+=1)m[n]=e.x_coords[n]*s,g[n]=e.y_coords[n]*l,m[n]<v&&(v=m[n]),m[n]>y&&(y=m[n]),g[n]<b&&(b=g[n]),g[n]>x&&(x=g[n]);for(r=Math.min(Math.max(Math.round(v),0),i),d=Math.min(Math.max(Math.round(b),0),a),u=Math.min(Math.max(Math.round(y),0),i),p=Math.min(Math.max(Math.round(x),0),a),w=[],h=0,n=r;u>=n;n+=1)for(c=d;p>=c;c+=1)o.pointInsidePolygon(f,m,g,n,c)&&(w[h+=1]=n*t+c);return w};if("rectangle"===this.shapeType)return u(this.shape);if("ellipse"===this.shapeType)return c(this.shape);if("ring"===this.shapeType)return d(this.shape);if("polygon"===this.shapeType)return p(this.shape);throw new Error("Part: unknown shape.")},y.prototype.contains=function(e,t){return this.shape.contains(e,t)},y.prototype.reflect=function(e,t){return Math.abs(this.reflection-1)<.001?e.reflect(this.shape,t):!1},y.prototype.absorb=function(e){return Math.abs(this.absorption-1)<.001?this.shape.contains(e.x,e.y):!1},y.prototype.getIrradiance=function(e){var t;return 0===this.emissivity?0:(t=273+e,t*=t,this.emissivity*n.STEFAN_CONSTANT*h*t*t)},y.prototype.radiate=function(e){var t,n,r=this.shape.polygonize(),i=new a;if(0!==this.emissivity){for(t=0,n=r.count-1;n>t;t+=1)i.x1=r.x_coords[t],i.y1=r.y_coords[t],i.x2=r.x_coords[t+1],i.y2=r.y_coords[t+1],this.radiateFromLine(e,i);i.x1=r.x_coords[r.count-1],i.y1=r.y_coords[r.count-1],i.x2=r.x_coords[0],i.y2=r.y_coords[0],this.radiateFromLine(e,i)}},y.prototype.radiateFromLine=function(e,t){var n,o,a,s,l,u,c,h,y,b,x,w,_,T,C,A,S;if(0!==this.emissivity)if(n=e.getModelOptions(),o=r(t.x1-t.x2,t.y1-t.y2),a=(t.x2-t.x1)/o,s=(t.y2-t.y1)/o,l=Math.max(1,Math.round(o/d)),b=n.solar_ray_speed*s,x=-n.solar_ray_speed*a,1===l)y=.5*o,u=t.x1+y*a,c=t.y1+y*s,y=e.getAverageTemperatureAt(u,c),y>p&&(y=e.getTemperatureAt(u,c),h=new i(u,c,this.getIrradiance(y),n.solar_ray_speed),h.vx=b,h.vy=x,e.addPhoton(h),this.constant_temperature||e.setTemperatureAt(u,c,y-h.energy/this.specific_heat));else for(w=new Array(4),_=new Array(4),w[0]=b*m-x*f,_[0]=b*f+x*m,w[1]=x*f+b*m,_[1]=x*m-b*f,w[2]=b*v-x*g,_[2]=b*g+x*v,w[3]=x*g+b*v,_[3]=x*v-b*g,T=1+w.length,A=0;l>A;A+=1)if(y=(A+.5)*d,u=t.x1+y*a,c=t.y1+y*s,y=e.getAverageTemperatureAt(u,c),C=this.getIrradiance(y)/T,y>p){for(h=new i(u,c,C,n.solar_ray_speed),h.vx=b,h.vy=x,e.addPhoton(h),S=0;T-1>S;S+=1)h=new i(u,c,C,n.solar_ray_speed),h.vx=w[S],h.vy=_[S],e.addPhoton(h);this.constant_temperature||e.changeAverageTemperatureAt(u,c,-C*T/this.specific_heat)}}}),define("models/energy2d/models/core-model",["require","exports","module","arrays","models/energy2d/models/physics-solvers/heat-solver","models/energy2d/models/physics-solvers-gpu/heat-solver-gpu","models/energy2d/models/physics-solvers/fluid-solver","models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu","models/energy2d/models/physics-solvers/ray-solver","models/energy2d/models/part","models/energy2d/gpu/gpgpu","models/energy2d/models/helpers"],function(e,t){"use strict";var n=e("arrays"),r=e("models/energy2d/models/physics-solvers/heat-solver"),i=e("models/energy2d/models/physics-solvers-gpu/heat-solver-gpu"),o=e("models/energy2d/models/physics-solvers/fluid-solver"),a=e("models/energy2d/models/physics-solvers-gpu/fluid-solver-gpu"),s=e("models/energy2d/models/physics-solvers/ray-solver"),l=e("models/energy2d/models/part").Part,u=e("models/energy2d/gpu/gpgpu"),c=e("models/energy2d/models/helpers").hypot,d=function(){try{new Float32Array}catch(e){return"regular"}return"Float32Array"}();t.makeCoreModel=function(e,t){var p,h,f,m,g,v,y,b,x=e.grid_width,w=e.grid_height,_=x*w,T=e.model_width/x,C=e.model_height/w,A=0,S=!1,P={start:function(){},stop:function(){},startFPS:function(){},updateFPS:function(){},stopFPS:function(){}},E=n.create(_,e.background_temperature,d),k=n.create(_,0/0,d),R=n.create(_,0,d),M=n.create(_,0,d),N=n.create(_,0,d),O=n.create(_,0,d),L=n.create(_,0,d),I=n.create(_,e.background_conductivity,d),D=n.create(_,e.background_specific_heat,d),B=n.create(_,e.background_density,d),V=n.create(_,!0,d),F=[],j=[],G=function(){var e,r,i=[];if(t)for(n.isArray(t)||(t=[t]),i=new Array(t.length),e=0,r=t.length;r>e;e+=1)i[e]=new l(t[e]);return i}(),U=function(){if(S=!1,"undefined"==typeof window)throw new Error("Core model: WebGL GPGPU unavailable in the node.js environment.");u.init(w,x),j[0]=u.createTexture(),j[1]=u.createTexture(),j[2]=u.createTexture(),j[3]=u.createTexture(),z(),m=i.makeHeatSolverGPU(J),g=a.makeFluidSolverGPU(J),S=!0},z=function(){u.writeRGBATexture(j[0],E,E,k,I),u.writeRGBATexture(j[1],N,D,B,V),u.writeRGBATexture(j[2],R,M,R,M),u.writeRGBATexture(j[3],O,L,O,L)},W=function(){v=function(){var t,n;if(e.sunny)return!0;for(t=0,n=G.length;n>t;t+=1)if(G[t].emissivity>0)return!0;return!1}(),y=function(){var e,t;for(e=0,t=G.length;t>e;e+=1)if(G[e].power>0)return!0;return!1}()},$=function(t,n){var r,i,o,a,s=e.model_width,l=e.model_height;for(r=t.getGridCells(x,w,s,l),o=0,a=r.length;a>o;o+=1)i=r[o],n||(E[i]=t.temperature),V[i]=!1,I[i]=t.thermal_conductivity,D[i]=t.specific_heat,B[i]=t.density,0!==t.wind_speed&&(O[i]=t.wind_speed*Math.cos(t.wind_angle),L[i]=t.wind_speed*Math.sin(t.wind_angle)),t.constant_temperature&&(k[i]=t.temperature)},q=function(t){t||(n.fill(E,e.background_temperature),n.fill(R,0),n.fill(M,0)),n.fill(k,0/0),n.fill(N,0),n.fill(O,0),n.fill(L,0),n.fill(I,e.background_conductivity),n.fill(D,e.background_specific_heat),n.fill(B,e.background_density),n.fill(V,!0)},H=function(e){if(G&&0!==G.length){var t;for(t=G.length-1;t>=0;t-=1)$(G[t],e)}},Y=function(){var e,t,n,r,i,o,a,s,l;for(r=0;x>r;r+=1)for(t=r*T,i=r*w,o=0;w>o;o+=1)if(n=o*C,N[i+o]=0,l=0,y){for(a=0,s=G.length;s>a;a+=1)e=G[a],e.shape.contains(t,n)&&(N[i+o]+=e.power,l++);l>0&&(N[i+o]/=l)}},X=function(e,t){var n=(R[e*w+t+1]-R[e*w+t-1])/T,r=(M[(e+1)*w+t]-M[(e-1)*w+t])/C;return.5*(n-r)},J={nextStep:function(){P.start("Core model step"),S?(e.convective&&(P.start("Fluid solver GPU"),g.solve(),P.stop("Fluid solver GPU")),P.start("Heat solver GPU"),m.solve(e.convective),P.stop("Heat solver GPU")):(v&&(P.start("Ray solver CPU"),A%e.photon_emission_interval===0&&(Y(),e.sunny&&f.sunShine(),f.radiate()),f.solve(),P.stop("Ray solver CPU")),e.convective&&(P.start("Fluid solver CPU"),h.solve(R,M),P.stop("Fluid solver CPU")),P.start("Heat solver CPU"),p.solve(e.convective,E,N),P.stop("Heat solver CPU")),A+=1,P.stop("Core model step")},setPerformanceTools:function(e){P=e},reset:function(){A=0,q(),W(),H(),Y(),S&&z()},partsChanged:function(e,t){q(!0),W(),H(!0),Y(),"temperature"===t&&$(e)},addPart:function(e){var t=new l(e);G.push(t),$(t)},removePart:function(e){G.splice(e,1),J.partsChanged()},useWebGL:function(e){return S!==e?J.isWebGLCompatible()?void(e?U():(J.syncTemperature(),J.syncVelocity(),S=!1)):void(S=!1):void 0},isWebGLActive:function(){return S},isWebGLCompatible:function(){return!v},getWebGLError:function(){return b},syncTemperature:function(){S&&u.readTexture(j[0],E)},syncVelocity:function(){S&&(u.readTexture(j[2],R,0),u.readTexture(j[2],M,1))},getIndexOfStep:function(){return A},getModelOptions:function(){return e},getTemperatureAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/C)),0);return E[n*w+r]},setTemperatureAt:function(e,t,n){var r=Math.max(Math.min(x-1,Math.round(e/T)),0),i=Math.max(Math.min(w-1,Math.round(t/C)),0);E[r*w+i]=n},getAverageTemperatureAt:function(e,t){var n,r,i=0,o=x-1,a=w-1,s=Math.round(e/T),l=Math.round(t/C);return n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l),0),i+=E[n*w+r],n=Math.max(Math.min(o,s+1),0),r=Math.max(Math.min(a,l),0),i+=E[n*w+r],n=Math.max(Math.min(o,s-1),0),r=Math.max(Math.min(a,l),0),i+=E[n*w+r],n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l+1),0),i+=E[n*w+r],n=Math.max(Math.min(o,s),0),r=Math.max(Math.min(a,l-1),0),i+=E[n*w+r],.2*i},changeAverageTemperatureAt:function(e,t,n){var r,i,o=x-1,a=w-1,s=Math.round(e/T),l=Math.round(t/C);n*=.2,r=Math.min(o,s),i=Math.min(a,l),r>=0&&i>=0&&(E[r*w+i]+=n),r=Math.min(o,s+1),i=Math.min(a,l),r>=0&&i>=0&&(E[r*w+i]+=n),r=Math.min(o,s-1),i=Math.min(a,l),r>=0&&i>=0&&(E[r*w+i]+=n),r=Math.min(o,s),i=Math.min(a,l+1),r>=0&&i>=0&&(E[r*w+i]+=n),r=Math.min(o,s),i=Math.min(a,l-1),r>=0&&i>=0&&(E[r*w+i]+=n)},getVorticityAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/C)),0);return X(n,r)},getAverageVorticityAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/C)),0),i=X(n,r);return i+=X(n-1,r),i+=X(n+1,r),i+=X(n,r-1),i+=X(n,r+1),i+=X(n-1,r-1),i+=X(n-1,r+1),i+=X(n+1,r-1),i+=X(n+1,r+1),i/9},getSpeedAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/C)),0);return c(R[n*w+r],M[n*w+r])},getHeatFluxAt:function(e,t){var n=Math.max(Math.min(x-1,Math.round(e/T)),0),r=Math.max(Math.min(w-1,Math.round(t/C)),0),i=I[n*w+r]*(E[(n-1)*w+r]-E[(n+1)*w+r])/(2*T),o=I[n*w+r]*(E[n*w+r-1]-E[n*w+r+1])/(2*C);return[i,o]},addPhoton:function(e){F.push(e)},removePhoton:function(e){var t=F.indexOf(e);-1!==t&&F.splice(t,1)},getArrayType:function(){return d},getPerformanceModel:function(){return P},getTemperatureArray:function(){return E},getUVelocityArray:function(){return R},getVVelocityArray:function(){return M},getUWindArray:function(){return O},getVWindArray:function(){return L},getBoundaryTemperatureArray:function(){return k},getPowerArray:function(){return N},getConductivityArray:function(){return I},getCapacityArray:function(){return D},getDensityArray:function(){return B},getFluidityArray:function(){return V},getPhotonsArray:function(){return F},getPartsArray:function(){return G},getTemperatureTexture:function(){return j[0]},getVelocityTexture:function(){return j[2]},getSimulationTexture:function(e){return j[e]}};return W(),H(),Y(),p=r.makeHeatSolver(J),h=o.makeFluidSolver(J),f=s.makeRaySolver(J),J}}),define("models/energy2d/modeler",["require","common/alert","common/console","common/validator","common/serialize","common/performance","common/lab-modeler-mixin","models/energy2d/metadata","models/energy2d/models/core-model"],function(e){"use strict";var t=e("common/alert"),n=e("common/console"),r=e("common/validator"),i=e("common/serialize"),o=e("common/performance"),a=e("common/lab-modeler-mixin"),s=e("models/energy2d/metadata"),l=e("models/energy2d/models/core-model"),u={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},temperature:{name:"degree Celsius",pluralName:"degrees Celsius",symbol:"°C"},length:{name:"meter",pluralName:"meters",symbol:"m"},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s"}}},c=0;return function(e){function d(e){try{y.useWebGL(e)}catch(t){n.warn("WebGL initialization failed. CPU solvers and rendering will be used."),n.warn(t.message)}}function p(){y.syncTemperature(),y.syncVelocity()}function h(){var e,t,n=v.getTemperatureArray();for(e=0,t=n.length;t>e;e++)if(isNaN(n[e])||Math.abs(n[e])>1e10)return v.stop(),y.reset(),!0;return!1}function f(e){var t=[];return e.forEach(function(e){t.push(r.validateCompleteness(s.part,e))}),t}function m(e){var t={thermometer:function(){return v.getTemperatureAt(this.x,this.y)},anemometer:function(){return this._rot},heatFlux:function(){var e=v.getHeatFluxAt(this.x,this.y);return e[0]*this._sin+e[1]*this._cos}},n={thermometer:{label:"Temperature",unitType:"temperature",format:".1f"},anemometer:{},heatFlux:{label:"Heat Flux",unitName:"Watt Per Square Meter",unitPluralName:"Watts Per Square Meter",unitAbbreviation:"W/m²",format:".1f"}};C=[],e.forEach(function(e,i){e=r.validateCompleteness(s.sensor,e),"anemometer"===e.type&&(e._rot=0,A.push(e)),"heatFlux"===e.type&&(e.angle=e.angle||0,e._sin=Math.sin(-e.angle*Math.PI/180),e._cos=Math.cos(e.angle*Math.PI/180)),Object.defineProperty(e,"value",{enumerable:!0,get:t[e.type]}),C.push(e),v.defineOutput("sensor-"+i,n[e.type],function(){return e.value})})}function g(){var e,t,n;for(t=0,n=A.length;n>t;t++)e=A[t],e._rot+=v.getSpeedAt(e.x,e.y)*(v.getVorticityAt(e.x,e.y)<0?-1:1)*v.properties.timeStep*700,e._rot=e._rot%360}var v,y,b="energy2dModel"+ ++c,x=new a({metadata:s,unitsDefinition:u,initialProperties:e,setters:{use_WebGL:function(e){y&&d(e),T=v.properties.ticksPerGPUSync},ticksPerGPUSync:function(e){y&&p(),T=Number(e)}}}),w=x.propertySupport,_=x.dispatchSupport,T=0,C=[],A=[],S={parts:[],sensors:[]},P=function(){function e(e){Object.defineProperty(this,"_rawPart",{enumerable:!1,get:function(){return e}})}return Object.keys(s.part).forEach(function(t){Object.defineProperty(e.prototype,t,{enumerable:!0,get:function(){return this._rawPart[t]},set:function(e){var n=v.properties.use_WebGL;v.properties.use_WebGL=!1,w.invalidatingChangePreHook(),this._rawPart[t]=r.validateSingleProperty(s.part[t],t,e),v.isStopped()?y.reset():y.partsChanged(this._rawPart,t),w.invalidatingChangePostHook(),v.properties.use_WebGL=n,_.partsChanged()}})}),e.prototype.computeLabel=function(){return this._rawPart.getLabel()},function(){var t,n,r=y.getPartsArray(),i=S.parts;for(i.length=0,t=0,n=r.length;n>t;t++)i.push(new e(r[t]))}}(),E=function(){function e(e){Object.defineProperty(this,"_rawObj",{enumerable:!1,get:function(){return e}})}var t={x:function(e){return Math.max(0,Math.min(v.properties.model_width,e))},y:function(e){return Math.max(0,Math.min(v.properties.model_height,e))}};return Object.keys(s.sensor).forEach(function(n){Object.defineProperty(e.prototype,n,{enumerable:!0,get:function(){return this._rawObj[n]},set:function(e){w.invalidatingChangePreHook(),e=t[n]?t[n](e):e,this._rawObj[n]=r.validateSingleProperty(s.sensor[n],n,e),w.invalidatingChangePostHook(),_.sensorsChanged()}})}),function(){var t,n,r=S.sensors;for(r.length=0,t=0,n=C.length;n>t;t++)r.push(new e(C[t]))}}();return v={namespace:b,tick:function(){var e,n,r;for(o.enterScope("engine"),e=0,n=v.properties.timeStepsPerTick;n>e;e++)y.nextStep();o.leaveScope("engine"),y.isWebGLActive()?T>0?T--:(p(),T=Number(v.properties.ticksPerGPUSync),r=h()):r=h(),g(),v.updateAllOutputProperties(),_.tick(),r&&t("The model has diverged and has been reset!\n\nTry changing its parameters (e.g. 'timeStep', positions of parts etc.) or reload it to restore the initial configuration.")},syncTemperature:function(){w.invalidatingChangePreHook(),y.syncTemperature(),w.invalidatingChangePostHook()},syncVelocity:function(){w.invalidatingChangePreHook(),y.syncVelocity(),w.invalidatingChangePostHook()},addPart:function(e){var t=v.properties.use_WebGL;v.properties.use_WebGL=!1,e=r.validateCompleteness(s.part,e),w.invalidatingChangePreHook(),y.addPart(e),P(),w.invalidatingChangePostHook(),v.properties.use_WebGL=t,_.partsChanged()},removePart:function(e){var t=v.properties.use_WebGL;v.properties.use_WebGL=!1,w.invalidatingChangePreHook(),y.removePart(e),P(),w.invalidatingChangePostHook(),v.properties.use_WebGL=t,_.partsChanged()},reset:function(){_.willReset(),w.invalidatingChangePreHook(),v.stop(),y.reset();var t;e.structure&&e.structure.part&&(t=f(e.structure.part)),y=l.makeCoreModel(v.properties,t),d(v.properties.use_WebGL),e.sensors&&m(e.sensors),P(),E(),w.invalidatingChangePostHook(),v.resetAllOutputProperties(),_.reset(),_.invalidation()},stepCounter:function(){return y.getIndexOfStep()},isNewStep:function(){return!0},stepBack:function(){return y.getIndexOfStep()},stepForward:function(e){arguments.length||(e=1),this.isStopped()||this.stop();for(var t=-1;++t<e;)v.tick();return y.getIndexOfStep()},getTime:function(){return v.properties.timeStep*y.getIndexOfStep()},isWebGLActive:function(){return y.isWebGLActive()},isWebGLCompatible:function(){return y.isWebGLCompatible()},getWebGLError:function(){return y.getWebGLError()},getIndexOfStep:function(){return y.getIndexOfStep()},getTemperatureAt:function(e,t){return y.getTemperatureAt(e,t)},getAverageTemperatureAt:function(e,t){return y.getAverageTemperatureAt(e,t)},getVorticityAt:function(e,t){return y.getVorticityAt(e,t)},getHeatFluxAt:function(e,t){return y.getHeatFluxAt(e,t)},getAverageVorticityAt:function(e,t){return y.getAverageVorticityAt(e,t)},getSpeedAt:function(e,t){return y.getSpeedAt(e,t)},getTemperatureArray:function(){return y.getTemperatureArray()},getTemperatureTexture:function(){return y.getTemperatureTexture()},getUVelocityArray:function(){return y.getUVelocityArray()},getVVelocityArray:function(){return y.getVVelocityArray()},getVelocityTexture:function(){return y.getVelocityTexture()},getPhotonsArray:function(){return y.getPhotonsArray()},getPartsArray:function(){return S.parts},getSensorsArray:function(){return S.sensors},serialize:function(){var e={},t=w.rawValues;return e=i(s.mainProperties,t),e.viewOptions=i(s.viewOptions,t),e.structure={part:[]},S.parts.forEach(function(t){e.structure.part.push(i(s.part,t))}),e.sensors=[],S.sensors.forEach(function(t){e.sensors.push(i(s.sensor,t))}),e}},function(){function t(){w.invalidatingChangePreHook(),w.invalidatingChangePostHook()}var n;x.mixInto(v),_.addEventTypes("tick","partsChanged","sensorsChanged"),e.structure&&e.structure.part&&(n=f(e.structure.part)),y=l.makeCoreModel(v.properties,n),d(v.properties.use_WebGL),e.sensors&&m(e.sensors),P(),E(),v.on("play.model",t),v.on("stop.model",t),v.defineOutput("minX",{},function(){return 0}),v.defineOutput("minY",{},function(){return 0}),v.defineOutput("maxX",{},function(){return v.properties.model_width}),v.defineOutput("maxY",{},function(){return v.properties.model_height}),v.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return v.getTime()}),v.defineOutput("displayTime",{label:"Time"},function(){var e=d3.format("02d");return function(){var t,n,r,i,o=v.getTime();return o=Math.floor(o),t=o%60,o=Math.floor(o/60),n=o%60,o=Math.floor(o/60),r=o%24,o=Math.floor(o/24),i=o,i+":"+e(r)+":"+e(n)+":"+e(t)}}())}(),v}}),define("models/energy2d/views/helpers",[],function(){"use strict";return{HSVToRGB:function(e,t,n){var r,i,o,a,s,l,u,c;if(e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100,0===t)return r=i=o=n,[Math.round(255*r),Math.round(255*i),Math.round(255*o)];switch(e/=60,a=Math.floor(e),s=e-a,l=n*(1-t),u=n*(1-t*s),c=n*(1-t*(1-s)),a){case 0:r=n,i=c,o=l;break;case 1:r=u,i=n,o=l;break;case 2:r=l,i=n,o=c;break;case 3:r=l,i=u,o=n;break;case 4:r=c,i=l,o=n;break;default:r=n,i=l,o=u}return[Math.round(255*r),Math.round(255*i),Math.round(255*o)]}}}),define("models/energy2d/views/color-palette",["require","models/energy2d/views/helpers"],function(e){"use strict";var t,n,r=e("models/energy2d/views/helpers");return t={},t[0]=t.RAINBOW=[[0,0,128],[20,50,120],[20,100,200],[10,150,150],[120,180,50],[220,200,10],[240,160,36],[225,50,50],[230,85,110],[250,250,250],[255,255,255]],t[1]=t.IRON=[[40,20,100],[80,20,150],[150,20,150],[200,50,120],[220,80,80],[230,120,30],[240,200,20],[240,220,80],[255,255,125],[250,250,250],[255,255,255]],t[2]=t.GRAY=[[50,50,50],[75,75,75],[100,100,100],[125,125,125],[150,150,150],[175,175,175],[200,200,200],[225,225,225],[250,250,250],[255,255,255]],t[3]=t.RAINBOW2=function(){var e,t=(r.HSVToRGB,256),n=new Array(t);for(e=0;t>e;e+=1)n[e]=r.HSVToRGB(t-1-e,100,90);return n}(),n=function(e){(void 0===e||"DEFAULT"===e)&&(e="RAINBOW"),this.color_palette_id=e},n.prototype.getRGBArray=function(){return void 0!==t[this.color_palette_id]?t[this.color_palette_id]:void 0},n}),define("models/energy2d/views/heatmap",["require","models/energy2d/views/color-palette"],function(e){"use strict";var t=e("models/energy2d/views/color-palette");return function(e){var n,r,i,o,a,s,l,u="energy2d-heatmap-view",c=0,d=50,p=function(){n=$("<canvas />"),n.attr("id",e||u),r=n[0].getContext("2d")},h={renderHeatmap:function(){var e,t,n,u,p,h,f,m,g,v,y,b;if(!a)throw new Error("Heatmap: bind heatmap before rendering.");for(r.clearRect(0,0,s,l),r.fillStyle="rgb(0,0,0)",e=o/Math.max(1,d-c),h=r.getImageData(0,0,s,l),f=h.data,y=0,b=4*s,m=0;s>m;m+=1)for(v=m*l,y=4*m,g=0;l>g;g+=1)n=e*(a[v+g]-c),t=Math.floor(n),n-=t,0>t?(t=0,n=0):t>o-1&&(t=o-1,n=1),u=i[t],p=i[t+1],f[y]=u[0]*(1-n)+p[0]*n,f[y+1]=u[1]*(1-n)+p[1]*n,f[y+2]=u[2]*(1-n)+p[2]*n,f[y+3]=255,y+=b;r.putImageData(h,0,0)},bindHeatmap:function(e,t,n){if(t*n!==e.length)throw new Error("Heatmap: provided heatmap has wrong dimensions.");a=e,s=t,l=n,this.setCanvasSize(s,l)},getHTMLElement:function(){return n},resize:function(){},setCanvasSize:function(e,t){n.attr("width",e),n.attr("height",t)},setMinTemperature:function(e){c=e},setMaxTemperature:function(e){d=e},setColorPalette:function(e){i=new t(e).getRGBArray(),o=i.length-1}};return h.setColorPalette("DEFAULT"),p(),h}}),define("text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_TexCoord.xy;\n  gl_Position = vec4(gl_Vertex.xyz, 1.0);\n}\n"}),define("text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl",[],function(){return"// Provided textur contains temperature data in R channel.\nuniform sampler2D heatmap_tex;\nuniform sampler2D palette_tex;\n\nuniform float max_temp;\nuniform float min_temp;\n\nvarying vec2 coord;\n\nvoid main() {\n  float temp = texture2D(heatmap_tex, coord).r;\n  float scaled_temp = (temp - min_temp) / max(1.0, max_temp - min_temp);\n  gl_FragColor = texture2D(palette_tex, vec2(scaled_temp, 0.5));\n}\n"}),define("models/energy2d/views/heatmap-webgl",["require","models/energy2d/gpu/context","models/energy2d/gpu/texture","models/energy2d/gpu/shader","models/energy2d/gpu/mesh","models/energy2d/views/color-palette","text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl","text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl"],function(e){"use strict";
var t=e("models/energy2d/gpu/context"),n=e("models/energy2d/gpu/texture"),r=e("models/energy2d/gpu/shader"),i=e("models/energy2d/gpu/mesh"),o=e("models/energy2d/views/color-palette"),a=e("text!models/energy2d/views/heatmap-webgl-glsl/basic.vs.glsl"),s=e("text!models/energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl");return function(e){var l,u,c,d,p,h=t.getWebGLContext(),f=new r(a,s),m=i.plane({coords:!0}),g="energy2d-heatmap-webgl-view",v=0,y=50,b=function(){u=$(h.canvas),u.attr("id",e||g)},x=function(){h.bindFramebuffer(h.FRAMEBUFFER,null),h.viewport(0,0,c,d)},w={renderHeatmap:function(){if(!p)throw new Error("Heatmap: bind heatmap texture before rendering.");x(),h.clear(h.COLOR_BUFFER_BIT),p.bind(0),l.bind(1),f.draw(m),l.unbind(1),p.unbind(0)},resize:function(){c=u.width(),d=u.height(),u.attr("width",c),u.attr("height",d)},bindHeatmapTexture:function(e){p=e},getHTMLElement:function(){return u},setMinTemperature:function(e){v=e,f.uniforms({min_temp:v})},setMaxTemperature:function(e){y=e,f.uniforms({max_temp:y})},setColorPalette:function(e){var t,r,i,a,s;for(t=new o(e).getRGBArray(),r=t.length,i=new Uint8Array(4*r),a=0;r>a;a+=1)s=4*a,i[s]=t[a][0],i[s+1]=t[a][1],i[s+2]=t[a][2],i[s+3]=255;l=new n(r,1,{type:h.UNSIGNED_BYTE,format:h.RGBA,filter:h.LINEAR}),h.bindTexture(h.TEXTURE_2D,l.id),h.texImage2D(h.TEXTURE_2D,0,l.format,r,1,0,l.format,l.type,i)}};return w.setColorPalette("DEFAULT"),f.uniforms({heatmap_tex:0,palette_tex:1,min_temp:v,max_temp:y}),m.coords=[[1,0],[1,1],[0,0],[0,1]],m.compile(),b(),w}}),define("models/energy2d/views/webgl-status",["require","common/controllers/checkbox-controller","models/energy2d/gpu/gpgpu"],function(e){"use strict";var t=e("common/controllers/checkbox-controller"),n=e("models/energy2d/gpu/gpgpu"),r='<p><a href="http://get.webgl.org" target="_blank">Click to learn more about WebGL.</a></p>';return function(e,i){function o(){var t;u=$("<div />"),u.attr("id",e||v),d=$('<div id="status-wrapper"/>'),d.appendTo(u),p=$("<div />"),p.appendTo(d),t=$('<a id="hide-webgl-status" class="button"><i class="icon-remove"></i></a>'),t.on("click",s),t.appendTo(d),f.appendTo(d),c=$('<a id="show-webgl-status" class="button"><i class="icon-bolt"></i></a>'),c.on("click",a),c.appendTo(u),d.hide()}function a(){c.hide(),d.fadeIn()}function s(){c.fadeIn(),d.fadeOut()}function l(){h=new t({type:"checkbox",id:"webgl-status-checkbox",text:"WebGL-accelerated physics engine",property:"use_WebGL"},y),f=h.getViewContainer(),o()}var u,c,d,p,h,f,m,g,v="e2d-webgl-status",y={getModel:function(){return i},getScriptingAPI:function(){return function(){}},getNextTabIndex:function(){return function(){}}};return g={bindModel:function(e){m=e,y.getModel=function(){return e},h.modelLoadedCallback(y)},render:function(){var e,t=m.isWebGLCompatible(),i=n.featuresInfo,o=!0,s=!0,l=m.properties.use_WebGL&&!m.isWebGLActive();p.empty(),Object.keys(i).forEach(function(e){var t=i[e];t.required&&!t.available&&(o=!1),t.required||t.available||(s=!1)}),o&&s?p.append('<p>Your browser <span class="happy">supports</span> WebGL as well as all required and optional extensions!</p>'):o?(p.append('<p>Your browser <span class="happy">supports</span> WebGL and all required extensions! However some optional extensions are unavailable:</p>'),Object.keys(i).forEach(function(e){var t,n=i[e];n.required||(t=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',p.append('<p class="extension">'+t+" "+e+"</p>"))}),p.append("<p>WebGL rendering quality can be affected.</p>")):i.WebGL?(p.append('<p>Your browser <span class="happy">supports</span> WebGL, however not all required extensions are available:</p>'),Object.keys(i).forEach(function(e){var t,n=i[e];n.required&&(t=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',p.append('<p class="extension">'+t+" "+e+"</p>"))}),p.append(r)):(p.append('<p>Sorry, your browser <span class="sad">does not support</span> WebGL.'),p.append(r)),t?(e='This model is <span class="happy">compatible</span> with WebGL-accelerated physics engine',m.isWebGLActive()?e+=' and it is <span class="happy">active</span>.':(e+=', but it is <span class="sad">inactive</span>.',l?e+=' Unfortunately, its initialization <span class="sad">failed</span>. Check the browser console for details.':o&&(e+=" Enable it to speed up simulation:")),p.append("<p>"+e+"</p>")):p.append('<p>Unfortunately, some features used in this model are <span class="sad">incompatible</span> with WebGL-accelerated physics engine.</p>'),o&&t&&!l?f.show():f.hide(),l?(e="WebGL initialization failed.",c.removeClass("happy"),c.addClass("sad")):o&&t?m.isWebGLActive()?(e="WebGL available and active.",c.removeClass("sad"),c.addClass("happy")):(e="WebGL available, but inactive.",c.removeClass("happy"),c.removeClass("sad")):(e="WebGL unavailable.",c.removeClass("happy"),c.addClass("sad")),e+=" Click for detailed information.",c.attr("title",e),l&&a()},getHTMLElement:function(){return u}},l(),g}}),define("models/energy2d/views/vectormap",[],function(){"use strict";return function(e){var t,n,r,i,o,a,s,l,u,c="energy2d-vectormap-view",d=100,p=8,h=Math.cos(.523598776),f=Math.sin(.523598776),m=4,g="rgb(175,175,175)",v=!0,y=function(){t=$("<canvas />"),t.attr("id",e||c),n=t[0].getContext("2d")},b=function(e,t,r,i){var o=1/Math.sqrt(r*r+i*i),a=r*o,s=i*o,l=e+a*p+r*d,u=t+s*p+i*d,c=m*(a*h+s*f),g=m*(s*h-a*f);n.beginPath(),n.moveTo(e,t),n.lineTo(l,u),n.lineTo(l-c,u-g),n.moveTo(l,u),c=m*(a*h-s*f),g=m*(s*h+a*f),n.lineTo(l-c,u-g),n.stroke()},x={renderVectormap:function(){if(v){var e,t,c,d,p,h,f,m,y,x;if(!o||!a)throw new Error("Vectormap: bind vectormap before rendering.");for(e=r/s,t=i/l,n.clearRect(0,0,r,i),n.strokeStyle=g,n.lineWidth=1,f=1;s-1>f;f+=u)for(y=f*l,c=(f+.5)*e,m=1;l-1>m;m+=u)x=y+m,d=(m+.5)*t,p=o[x],h=a[x],p*p+h*h>1e-15&&b(c,d,p,h)}},clear:function(){n.clearRect(0,0,r,i)},get enabled(){return v},set enabled(e){v=e,v||x.clear()},bindVectormap:function(e,t,n,r,i){if(n*r!==e.length)throw new Error("Heatmap: provided U component of vectormap has wrong dimensions.");if(n*r!==t.length)throw new Error("Heatmap: provided V component of vectormap has wrong dimensions.");o=e,a=t,s=n,l=r,u=Math.round(n/i)},getHTMLElement:function(){return t},resize:function(){r=t.width(),i=t.height(),t.attr("width",r),t.attr("height",i)}};return y(),x}}),define("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl",[],function(){return"// Provided texture contains vector data in RG channels.\nattribute vec2 origin;\n\nuniform sampler2D vectormap_tex;\nuniform float base_length;\nuniform float vector_scale;\nuniform vec2 scale;\n\nvoid main() {\n  // Read vector which should be visualized.\n  vec2 vec = texture2D(vectormap_tex, gl_TexCoord.xy).xy;\n  vec.y = -vec.y;\n\n  if (length(vec) < 1e-15) {\n    // Do not draw to small vectors.\n    // Set position outside [-1, 1] region, which is rendered.\n    gl_Position = vec4(2.0);\n    return;\n  }\n\n  // Test which part of the vector arrow is being processed. \n  if (gl_Vertex.x == 0.0 && gl_Vertex.y == 0.0) {\n    // Origin of the arrow is being processed.\n    // Just transform its coordinates.\n    gl_Position = vec4(origin, 0.0, 1.0);\n  } else {\n    // Other parts of arrow are being processed.\n    // Set proper length of the arrow, rotate it, scale\n    // and finally transform.\n\n    // Calculate arrow length.\n    vec2 new_pos = gl_Vertex.xy;\n    new_pos.x += base_length + vector_scale * length(vec);\n\n    // Calculate angle between reference arrow (horizontal).\n    vec = normalize(vec);\n    float angle = acos(dot(vec, vec2(1.0, 0.0)));\n    if (vec.y < 0.0) {\n      angle = -angle;\n    }\n    // Prepare rotation matrix.\n    // See: http://en.wikipedia.org/wiki/Rotation_matrix\n    mat2 rot_m = mat2(\n      cos(angle), sin(angle),\n     -sin(angle), cos(angle)\n    );\n    // Rotate.\n    new_pos = rot_m * new_pos;\n    // Scale.\n    new_pos = new_pos * scale;\n    // Transform.\n    gl_Position = vec4(new_pos + origin, 0.0, 1.0);\n  }\n}\n"}),define("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl",[],function(){return"uniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n"}),define("models/energy2d/views/vectormap-webgl",["require","models/energy2d/gpu/context","models/energy2d/gpu/shader","models/energy2d/gpu/mesh","text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl","text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl"],function(e){"use strict";var t=e("models/energy2d/gpu/context"),n=e("models/energy2d/gpu/shader"),r=e("models/energy2d/gpu/mesh"),i=e("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl"),o=e("text!models/energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl");return function(e){var a,s,l,u,c,d,p,h=t.getWebGLContext(),f=new n(i,o),m=new r({coords:!0,lines:!0}),g="energy2d-vectormap-webgl-view",v=100,y=8,b=[.7,.7,.7,1],x=!0,w=function(){var e,t,n,r,i,o=2/c,a=2/d,s=1/c,l=1/d;for(m.addVertexBuffer("origins","origin"),m.vertices=[],m.origins=[],m.coords=[],m.lines=[],n=0,e=1;c-1>e;e+=p)for(t=1;d-1>t;t+=p)m.vertices.push([0,0,0],[.01,0,0],[-3,2,0],[-3,-2,0]),r=[-1+(e+.5)*o,1-(t+.5)*a,0],m.origins.push(r,r,r,r),i=[(t+.5)*l,(e+.5)*s],m.coords.push(i,i,i,i),m.lines.push([n,n+1],[n+1,n+2],[n+1,n+3]),n+=4;m.compile()},_=function(){a=$(h.canvas),a.attr("id",e||g)},T=function(){h.bindFramebuffer(h.FRAMEBUFFER,null),h.viewport(0,0,s,l)},C={renderVectormap:function(){if(x){if(!u)throw new Error("Vectormap: bind heatmap texture before rendering.");T(),u.bind(0),f.draw(m,h.LINES),u.unbind(0)}},get enabled(){return x},set enabled(e){x=e},resize:function(){s=a.width(),l=a.height(),a.attr("width",s),a.attr("height",l),f.uniforms({scale:[2/s,2/l]})},bindVectormapTexture:function(e,t,n,r){u=e,c=t,d=n,p=Math.round(c/r),w()},getHTMLElement:function(){return a}};return f.uniforms({vectormap_tex:0,base_length:y,vector_scale:v,color:b}),_(),C}}),define("models/energy2d/views/photons",[],function(){"use strict";return function(e){var t,n,r,i,o,a,s,l,u,c="energy2d-photons-view",d="energy2d-photons-view",p=10,h=function(){t=$("<canvas />"),t.attr("id",e||c),t.addClass(d),n=t[0].getContext("2d")},f=function(){n.strokeStyle="rgba(255,255,255,128)",n.lineWidth=.5},m={renderPhotons:function(){var e,t,l,u,c,d;if(!o)throw new Error("Photons view: bind parts array before rendering.");for(n.clearRect(0,0,r,i),c=0,d=o.length;d>c;c+=1)e=o[c],t=e.x*a,l=e.y*s,u=1/Math.sqrt(e.vx*e.vx+e.vy*e.vy),n.beginPath(),n.moveTo(t,l),n.lineTo(t+p*e.vx*u,l+p*e.vy*u),n.stroke()},bindPhotonsArray:function(e,t,n){o=e,l=t,u=n,a=r/l,s=i/u},getHTMLElement:function(){return t},resize:function(){r=t.width(),i=t.height(),a=r/l,s=i/u,t.attr("width",r),t.attr("height",i),f()}};return h(),f(),m}}),define("models/energy2d/views/parts",[],function(){var e=-1,t=2;return function(n,r){function i(e){return"translate("+T(e.x||0)+","+C(e.y||0)+")"}function o(e){return T(e.width)+t}function a(e){return T(e.height)+t}function s(e){return T(.5*e.a)}function l(e){return T(.5*e.b)}function u(e){return e.visible?"visible":"hidden"}function c(e){return e.texture?"url(#texture-1)":"none"}function d(e){return e.computeLabel()}function p(){return-this.getBBox().width/2}function h(e){if(!e.filled)return"rgba(0, 0, 0, 0)";var t;if("auto"===e.color)t=e.power>0?"#FFFF00":e.power<0?"#B0C4DE":e.constant_temperature?"rgba(0, 0, 0, 0)":"#999";else if(t=e.color,!isNaN(parseInt(t,16))){for(;t.length<6;)t="0"+t;t="#"+t}return t}function f(e){var t,n,r=[],i=e.raw_x_coords,o=e.raw_y_coords;for(t=0,n=i.length;n>t;t++)r.push(T(i[t])),r.push(C(o[t]));return"M"+r.join(",")+"Z"}function m(e){switch(e.shapeType){case"polygon":return f(e);case"ring":return S(e)}}function g(e){var t=e.shapeType;return"rectangle"===t||"polygon"===t?this.parentNode.firstElementChild.getBBox().width/2:0}function v(e){var t=e.shapeType;return"rectangle"===t||"polygon"===t?this.parentNode.firstElementChild.getBBox().height/2:0}function y(){var e=r.append("defs").append("pattern").attr("id","texture-1").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","0.7em").attr("height","0.7em").attr("viewBox","0 0 16 16");e.append("path").attr("class","e2d-texture-path-shadow").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1"),e.append("path").attr("class","e2d-texture-path").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1")}function b(t,n,r){switch(n=n.select(A[t]),n.append(t).attr("class","e2d-part-shape"),n.append(t).attr("class","e2d-part-shape-outline").attr("fill",c),r.select(".e2d-part-shape"),r.select(".e2d-part-shape-outline"),t){case"rect":r.selectAll("rect").attr("x",e).attr("y",e).attr("width",o).attr("height",a);break;case"ellipse":r.selectAll("ellipse").attr("rx",s).attr("ry",l);break;case"path":r.selectAll("path").attr("d",m)}}function x(e,t){e.append("text").attr("class","e2d-part-label-shadow").attr("dy",".35em"),e.append("text").attr("class","e2d-part-label").attr("dy",".35em"),t.select(".e2d-part-label"),t.select(".e2d-part-label-shadow"),t.selectAll(".e2d-part-label, .e2d-part-label-shadow").text(d).attr("dx",p).attr("x",g).attr("y",v)}var w,_,T=n.model2px,C=n.model2pxInv,A={rect:function(e){return"rectangle"===e.shapeType?this:null},ellipse:function(e){return"ellipse"===e.shapeType?this:null},path:function(e){return"polygon"===e.shapeType||"ring"===e.shapeType?this:null}},S=d3.svg.arc().innerRadius(function(e){return T(.5*e.inner)}).outerRadius(function(e){return T(.5*e.outer)}).startAngle(0).endAngle(2*Math.PI),P=function(){var e,t,n,r,i,o,a;return d3.behavior.drag().origin(function(e){return{x:T(e.x),y:C(e.y)}}).on("dragstart",function(s){var l,u;s.draggable&&(e=t=null,l=T.range(),u=C.range(),n=Math.min(l[0],l[1]),r=Math.max(l[0],l[1]),i=Math.min(u[0],u[1]),o=Math.max(u[0],u[1]),a=this.getBBox(),a.x0=a.x+10,a.y0=a.y+10,a.x1=a.x+a.width-10,a.y1=a.y+a.height-10,d3.select(this).style("opacity",.7))}).on("drag",function(s){s.draggable&&(e=d3.event.x,t=d3.event.y,e-=Math.max(0,a.x0+e-r)+Math.min(0,a.x1+e-n),t-=Math.max(0,a.y0+t-o)+Math.min(0,a.y1+t-i),d3.select(this).attr("transform","translate("+e+","+t+")"))}).on("dragend",function(n){n.draggable&&(d3.select(this).style("opacity",1),null!==e&&(n.x=T.invert(e),n.y=C.invert(t)))})}();return w={renderParts:function(){if(_){var e,t;e=r.selectAll(".e2d-part").data(_),t=e.enter().append("g").attr("class","e2d-part part"),b("rect",t,e),b("ellipse",t,e),b("path",t,e),x(t,e),t.call(P),e.attr("transform",i),e.select(".e2d-part-shape").attr("fill",h).style("visibility",u),e.exit().remove()}},bindPartsArray:function(e){_=e}},function(){y()}(),w}}),define("models/energy2d/views/sensors",[],function(){var e=2,t=4;return function(n,r){function i(e){return e+"%"}function o(e){return"translate("+C(e.x)+","+A(e.y)+")"}function a(){return-this.getBBox().width/2}function s(e){return e.label}function l(e){return e.value.toFixed(1)+" °C"}function u(e){return i(S(e.value))}function c(e){return"rotate("+e.value+")"}function d(e){return e.value.toFixed(1)+" W/m²"}function p(e){return"rotate("+e.angle+")"}function h(e){e=e.append("g").attr("class","e2d-measuring-point"),e.append("line").attr("x1",0).attr("y1","-0.8%").attr("x2",0).attr("y2","0.8%"),e.append("line").attr("x1","-0.8%").attr("y1",0).attr("x2","0.8%").attr("y2",0),e.append("circle").attr("r","0.8%")}function f(e,t){e.append("text").attr("class","e2d-sensor-reading-shadow"),e.append("text").attr("class","e2d-sensor-reading"),e.append("text").attr("class","e2d-sensor-label-shadow"),e.append("text").attr("class","e2d-sensor-label"),t.select(".e2d-sensor-label"),t.select(".e2d-sensor-label-shadow"),t.select(".e2d-sensor-reading"),t.select(".e2d-sensor-reading-shadow")}function m(n){var c=r.selectAll(".e2d-sensor.thermometer").data(n.filter(function(e){return"thermometer"===e.type})),d=c.enter().append("g").attr("class","e2d-sensor sensor thermometer").call(P);f(d,c),d.append("rect").attr("class","e2d-thermometer-fill"),d.append("rect").attr("class","e2d-thermometer-background"),d.call(h),c.attr("transform",o),c.select(".e2d-thermometer-fill").attr("x",i(-.5*e)).attr("y",i(-.5*t)).attr("width",i(e)).attr("height",i(t)),x=c.select(".e2d-thermometer-background").attr("x",i(-.5*e)).attr("y",i(-.5*t)).attr("width",i(e)).attr("height",u),w=c.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(l).attr("y",i(-.5*t)).attr("dy","-.2em").attr("dx","-.7em"),c.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","1em").attr("y",i(.5*t)),c.exit().remove()}function g(e){var t=r.selectAll(".e2d-sensor.anemometer").data(e.filter(function(e){return"anemometer"===e.type})),n=t.enter().append("g").attr("class","e2d-sensor sensor anemometer").call(P);f(n,t),n=n.append("svg").attr("class","e2d-anemometer-shape").attr("viewBox","-50 -50 100 100").attr("x","-3%").attr("y","-3%").attr("width","6%").attr("height","6%").append("g").attr("class","e2d-anemometer-rot"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(0)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(120)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(240)"),n.append("circle").attr("r",12),t.attr("transform",o),_=t.select(".e2d-anemometer-rot").attr("transform",c),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","0.7em").attr("y","3%"),t.exit().remove()}function v(e){var t=r.selectAll(".e2d-sensor.heatFlux").data(e.filter(function(e){return"heatFlux"===e.type})),n=t.enter().append("g").attr("class","e2d-sensor sensor heatFlux").call(P);n=n.append("g").attr("transform",p),n.append("rect").attr("class","e2d-heatflux-shape").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%"),n.append("svg").attr("viewBox","0 0 6 1").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%").append("path").attr("class","e2d-heatflux-pattern").attr("d","M0,0L1,1L2,0L3,1L4,0L5,1L6,0"),n.call(h),f(n,t),t.attr("transform",o),T=t.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(d).attr("y","-1%").attr("dy","-.2em").attr("dx","-1.8em"),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(s).attr("dx",a).attr("dy","0.9em").attr("y","1%"),t.exit().remove()}var y,b,x,w,_,T,C=n.model2px,A=n.model2pxInv,S=d3.scale.linear().clamp(!0).domain([0,50]).range([t,0]),P=d3.behavior.drag().origin(function(e){return{x:C(e.x),y:A(e.y)}}).on("drag",function(e){e.x=C.invert(d3.event.x),e.y=A.invert(d3.event.y)});return y={update:function(){x.attr("height",u),w.text(l),_.attr("transform",c),T.text(d)},renderSensors:function(){b&&(m(b),g(b),v(b))},bindSensorsArray:function(e){b=e},setMinMaxTemp:function(e,t){S.domain([e,t])}}}}),define("models/energy2d/views/renderer",["require","models/energy2d/views/heatmap","models/energy2d/views/heatmap-webgl","models/energy2d/views/webgl-status","models/energy2d/views/vectormap","models/energy2d/views/vectormap-webgl","models/energy2d/views/photons","models/energy2d/views/parts","models/energy2d/views/sensors"],function(e){var t=e("models/energy2d/views/heatmap"),n=e("models/energy2d/views/heatmap-webgl"),r=e("models/energy2d/views/webgl-status"),i=e("models/energy2d/views/vectormap"),o=e("models/energy2d/views/vectormap-webgl"),a=e("models/energy2d/views/photons"),s=e("models/energy2d/views/parts"),l=e("models/energy2d/views/sensors");return function(e,u){function c(e){var t=e.getHTMLElement();t.css("width","100%"),t.css("height","100%"),t.css("position","absolute"),t.css("top",0),t.css("left",0),t.css("z-index",_),_+=1,w.append(t)}function d(){var e=u.properties;w.empty(),_=0,u.isWebGLActive()?(f=new n,m=new o,c(m)):(f=new t,c(f),m=new i,c(m)),g=new a,c(g),f.resize(),m.resize(),g.resize(),u.isWebGLActive()?(f.bindHeatmapTexture(u.getTemperatureTexture()),m.bindVectormapTexture(u.getVelocityTexture(),e.grid_width,e.grid_height,25)):(f.bindHeatmap(u.getTemperatureArray(),e.grid_width,e.grid_height),m.bindVectormap(u.getUVelocityArray(),u.getVVelocityArray(),e.grid_width,e.grid_height,25)),g.bindPhotonsArray(u.getPhotonsArray(),e.model_width,e.model_height)}function p(){var e=u.properties;m.enabled=e.velocity,f.setMinTemperature(e.minimum_temperature),f.setMaxTemperature(e.maximum_temperature),f.setColorPalette(e.color_palette_type),y.setMinMaxTemp(e.minimum_temperature,e.maximum_temperature)}var h,f,m,g,v,y,b=new r(null,u),x=b.getHTMLElement(),w=$("<div id='e2d-canvas-views'>"),_=0,T=!1;return h={getHeightForWidth:function(e){return e*u.properties.grid_height/u.properties.grid_width},setup:function(e){T=!0,d(),v.bindPartsArray(e.getPartsArray()),y.bindSensorsArray(e.getSensorsArray()),b.bindModel(e),p(),v.renderParts(),y.renderSensors(),b.render(),h.update(),e.addPropertiesListener("use_WebGL",function(){d(),p(),b.render(),h.update()}),e.addPropertiesListener(["color_palette_type","velocity","minimum_temperature","maximum_temperature"],function(){p(),h.update()}),e.on("tick.view-update",h.update),e.on("partsChanged.view-update",function(){v.renderParts()}),e.on("sensorsChanged.view-update",function(){y.renderSensors()})},update:function(){T&&(f.renderHeatmap(),m.renderVectormap(),g.renderPhotons(),y.update())},resize:function(){T&&(f.resize(),m.resize(),g.resize(),v.renderParts(),y.renderSensors(),h.update())},reset:function(){},setFocus:function(){u.get("enableKeyboardHandlers")&&this.$el.focus()},bindModel:function(e){u=e}},function(){var t=e.appendViewport();v=new s(e,t.append("g")),y=new l(e,t.append("g")),e.$el.append(w),e.$el.append(x)}(),h}}),define("models/energy2d/views/view",["require","common/views/svg-container","models/energy2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("models/energy2d/views/renderer");return function(e,r){return new t(e,r,n,{origin:"top-left"})}}),define("models/energy2d/benchmarks/benchmarks",["common/performance"],function(){var e=require("common/performance"),t=5e3,n=1e3;return function(r){var i,o=[{name:"engine (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(o){r.model.start(),setTimeout(function(){r.model.stop(),r.model.properties.use_WebGL=!1,e.collectData(!0),i=r.model.get("time"),setTimeout(function(){r.model.start(),setTimeout(function(){r.model.stop(),e.collectData(!1),o(e.getAvgTime("engine"))},t)},100)},n)}},{name:"JS rendering (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("js-rendering"))}},{name:"tick (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("tick"))}},{name:"gap b/w frames (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("gap"))}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n=r.model.get("time")-i;e(n/(r.model.get("timeStepsPerTick")*r.model.get("timeStep"))*1e3/t)}},{name:"engine WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(o){r.model.start(),setTimeout(function(){r.model.stop(),r.model.properties.use_WebGL=!0,e.collectData(!0),i=r.model.get("time"),setTimeout(function(){r.model.start(),setTimeout(function(){r.model.stop(),e.collectData(!1),o(e.getAvgTime("engine"))},t)},100)},n)}},{name:"JS rendering WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("js-rendering"))}},{name:"tick WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("tick"))}},{name:"gap b/w frames WebGL (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(t){t(e.getAvgTime("gap"))}},{name:"fps WebGL",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n=r.model.get("time")-i;e(n/(r.model.get("timeStepsPerTick")*r.model.get("timeStep"))*1e3/t)}}];return o}}),define("models/energy2d/controllers/scripting-api",[],function(){return function(e){return{getTemperatureAt:function(t,n){return e.model.getTemperatureAt(t,n)},getAverageTemperatureAt:function(t,n){return e.model.getAverageTemperatureAt(t,n)},getSensor:function(t){return e.model.getSensorsArray()[t]},getPart:function(t){return e.model.getPartsArray()[t]},addPart:function(t){e.model.addPart(t)},removePart:function(t){e.model.removePart(t)},getNumberOfParts:function(){return e.model.getPartsArray().length},syncTemperature:function(){e.model.syncTemperature()}}}}),define("models/energy2d/controllers/controller",["require","common/controllers/model-controller","models/energy2d/modeler","models/energy2d/views/view","models/energy2d/benchmarks/benchmarks","models/energy2d/controllers/scripting-api"],function(e){var t=e("common/controllers/model-controller"),n=e("models/energy2d/modeler"),r=e("models/energy2d/views/view"),i=e("models/energy2d/benchmarks/benchmarks"),o=e("models/energy2d/controllers/scripting-api");return function(e,a,s){return new t(e,a,s,n,r,o,i)}}),define("common/models/dataset",[],function(){var e=0;return function(t,n){function r(){s=0,l=[],o(),u=t.timeSeries.xProperty,c=t.timeSeries.properties,i()}function i(){var e,t=[];for(s++,t.push(n.get(u)),e=0;e<c.length;e++)t.push(n.get(c[e]));l.push(t)}function o(){n.on("tick."+d,function(){i()})}var a,s,l,u,c,d="dataset"+ ++e;return a={getData:function(e){function n(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var r,i,o,a,s,u=[];if(void 0===e)return n(l);for(r=0;r<l.length;r++){for(i=l[r],s=[],a=0;a<e.length;a++)o=t.properties.indexOf(e[a]),s.push(i[o]);u.push(s)}return[u]},reset:function(){l=$.extend(!0,[],t.tableData),s=0},appendPropertyRow:i,serialize:function(){var e=$.extend(!0,{},t);return e.tableData=l,e}},r(),a}}),define("common/controllers/experiment-controller",["require","common/controllers/interactive-metadata","common/validator","common/models/dataset"],function(e){var t=e("common/controllers/interactive-metadata"),n=e("common/validator"),r=e("common/models/dataset");return function(e,i){function o(){e=n.validateCompleteness(t.experiment,e),b=e.timeSeries,x=e.parameters.inputs,w=e.parameters.outputs,_=e.destinations,T=e.stateButtons,v=[],i.on("modelLoaded.experimentController",function(){g=i.getScriptingAPI(),m=i.getModel(),a()}),s()}function a(){m.defineParameter("experimentCleared",{initialValue:!1},function(){m.get("experimentCleared")&&(h(),m.set("experimentCleared",!1))}),m.defineParameter("experimentRunning",{initialValue:!1},function(){m.get("experimentRunning")?d():p()})}function s(){function e(){A=i.getComponent(T.startRun),S=i.getComponent(T.stopRun),P=i.getComponent(T.saveRun),E=i.getComponent(T.nextRun),k=i.getComponent(T.clearAll)}function t(){var e,t,n,r;for(R=[],M=[],e=0;e<_.length;e++){for(n=_[e],n.components=[],t=0;t<n.componentIds.length;t++)n.components.push(i.getComponent(n.componentIds[t]));switch(n.type){case"timeSeries":R.push(n);break;case"parameterSeries":M.push(n);break;default:throw new Error("Experiment destination: invalid destination type: "+n.type)}}for(N=void 0,e=0;e<R.length;e++)for(n=R[e],t=0;t<n.components.length;t++)if(r=n.components[t],void 0!==r.type&&"graph"===r.type)return void(N=r)}function n(){A.setAction("set('experimentRunning', true);"),S.setAction("set('experimentRunning', false);"),P.setAction(function(){var e,t,n;for(v.push(y),e=0;e<M.length;e++)for(n=M[e],t=0;t<n.components.length;t++)n.components[t].appendDataPropertiesToComponent();P.setDisabled(!0)}),E.setAction("set('experimentCleared', true);"),k.setAction(function(){i.reloadInteractive()})}e(),t(),n()}function l(){var e;if(N){for(e=0;e<v.length;e++)N.addDataSet(v[e].getData());N.update()}}function u(){for(var e=0;e<x.length;e++)m.unfreeze(x[e])}function c(){for(var e=0;e<x.length;e++)m.freeze(x[e])}function d(){A.setDisabled(!0),S.setDisabled(!1),P.setDisabled(!0),E.setDisabled(!0),k.setDisabled(!1),c(),y=new r({timeSeries:b},m),g.api.start()}function p(){A.setDisabled(!0),S.setDisabled(!0),P.setDisabled(!1),E.setDisabled(!1),g.api.stop()}function h(){A.setDisabled(!1),S.setDisabled(!0),P.setDisabled(!0),E.setDisabled(!0),m.set("experimentCleared",!1),i.reloadModel({propertiesToRetain:x,cause:"new-run"}),u(),l()}var f,m,g,v,y,b,x,w,_,T,C,A,S,P,E,k,R,M,N;return f={setOnLoadScript:function(e){C=e},serialize:function(){var t=$.extend(!0,{},e);return t}},o(),f}}),define("common/controllers/interactives-controller",["require","seedrandom","lab.config","arrays","fastclick","common/alert","common/controllers/interactive-metadata","common/validator","common/controllers/data-set","common/controllers/bar-graph-controller","common/controllers/graph-controller","common/controllers/export-controller","common/controllers/scripting-api","common/controllers/button-controller","common/controllers/checkbox-controller","common/controllers/text-controller","common/controllers/image-controller","common/controllers/radio-controller","common/controllers/slider-controller","common/controllers/pulldown-controller","common/controllers/numeric-output-controller","common/controllers/table-controller","common/controllers/parent-message-api","common/controllers/thermometer-controller","common/controllers/playback-controller","common/controllers/div-controller","common/dispatch-support","common/controllers/help-system","common/views/tooltip","common/cookies","common/controllers/setup-banner","common/controllers/about-dialog","common/controllers/share-dialog","common/controllers/credits-dialog","common/layout/semantic-layout","common/layout/templates","models/md2d/controllers/controller","models/solar-system/controllers/controller","models/signal-generator/controller","models/iframe/controller","models/sensor/controller","models/dual-sensor/controller","models/sensor-server/controller","models/labquest2/controller","models/energy2d/controllers/controller","common/controllers/experiment-controller"],function(e){function t(e){var n;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var r=0,i=e.length;i>r;r++)n[r]=t(e[r]);return n}if(e instanceof Object){n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")}e("seedrandom");var n=e("lab.config"),r=e("arrays"),i=e("fastclick"),o=e("common/alert"),a=e("common/controllers/interactive-metadata"),s=e("common/validator"),l=e("common/controllers/data-set"),u=e("common/controllers/bar-graph-controller"),c=e("common/controllers/graph-controller"),d=e("common/controllers/export-controller"),p=e("common/controllers/scripting-api"),h=e("common/controllers/button-controller"),f=e("common/controllers/checkbox-controller"),m=e("common/controllers/text-controller"),g=e("common/controllers/image-controller"),v=e("common/controllers/radio-controller"),y=e("common/controllers/slider-controller"),b=e("common/controllers/pulldown-controller"),x=e("common/controllers/numeric-output-controller"),w=e("common/controllers/table-controller"),_=e("common/controllers/parent-message-api"),T=e("common/controllers/thermometer-controller"),C=e("common/controllers/playback-controller"),A=e("common/controllers/div-controller"),S=e("common/dispatch-support"),P=e("common/controllers/help-system"),E=e("common/views/tooltip"),k=e("common/cookies"),R=e("common/controllers/setup-banner"),M=e("common/controllers/about-dialog"),N=e("common/controllers/share-dialog"),O=e("common/controllers/credits-dialog"),L=e("common/layout/semantic-layout"),I=e("common/layout/templates"),D={md2d:e("models/md2d/controllers/controller"),"solar-system":e("models/solar-system/controllers/controller"),"signal-generator":e("models/signal-generator/controller"),"iframe-model":e("models/iframe/controller"),sensor:e("models/sensor/controller"),"dual-sensor":e("models/dual-sensor/controller"),"sensor-server":e("models/sensor-server/controller"),labquest2:e("models/labquest2/controller"),energy2d:e("models/energy2d/controllers/controller")},B=e("common/controllers/experiment-controller"),V={text:m,image:g,button:h,checkbox:f,pulldown:b,radio:v,thermometer:T,barGraph:u,graph:c,slider:y,numericOutput:x,table:w,div:A,playback:C};
return function(e,u){function c(){gt=vt.randomSeed,void 0===gt&&(Math.seedrandom(),gt=Math.random().toString()),Math.seedrandom(gt)}function h(e){if(xt[e])return xt[e];throw new Error("No model found with id "+e)}function f(){ft.isReady()&&ft.layoutInteractive()}function m(){tt.off("keydown.interactiveController"),Z&&Z.enableKeyboardHandlers()&&tt.on("keydown.interactiveController",function(e){var t=e.keycode||e.which;switch(t){case 13:e.preventDefault(),lt.api.start();break;case 32:e.preventDefault(),lt.api.isStopped()?lt.api.start():lt.api.stop();break;case 37:e.preventDefault(),lt.api.isStopped()?lt.api.stepBack():lt.api.stop();break;case 39:e.preventDefault(),lt.api.isStopped()?lt.api.stepForward():lt.api.stop()}})}function g(){var e,t,n,r,i,o;e="string"==typeof vt.template?I[vt.template]:vt.template,t=vt.layout,i=R(yt,vt,ht,dt,pt),r=i.components;for(n in r)r.hasOwnProperty(n)&&(n=r[n],n.modelLoadedCallback&&it.push($.proxy(n.modelLoadedCallback,n)));e=i.template.concat(e),e.forEach(function(t,n){e[n]=$.extend({},t)}),t=$.extend({},t,i.layout),r=$.extend({},Tt,i.components),ft.initialize(tt,nt,e,t,r,vt.aspectRatio,vt.fontScale),x()&&($(window).off("resize.lab-resize-handler"),$(window).on("resize.lab-resize-handler",function(){yt.resize()})),o=function(){yt.resize(),setTimeout(yt.resize,50)},$(document).off(".lab-fullscreen-change"),$(document).on("fullscreenchange.lab-fullscreen-change",o).on("mozfullscreenchange.lab-fullscreen-change",o).on("webkitfullscreenchange.lab-fullscreen-change",o)}function v(e){var t,n=e.type,r=e.id;if(t=new V[n](e,yt),!t.getViewContainer().hasClass("component"))throw new Error("Invalid Interactive Component implementation. Each component has to have 'component' class.");Tt[r]=t,Ct.push(t),e.retainProperty&&null!=e.property&&At.push(e.property),t.modelLoadedCallback&&it.push($.proxy(t.modelLoadedCallback,t))}function y(e){return"string"==typeof e?e:e.join("\n")}function b(e){function t(e,t){var n,r,i;if(t)try{for(n=0,r=t.length;r>n;n++)t[n]=s.validateCompleteness(a[e],t[n])}catch(l){throw i="Incorrect "+e+" definition:\n"+l.message,o(i),new Error(i)}}var n,r,i,l,u,c;try{e=s.validateCompleteness(a.interactive,e)}catch(d){throw c="Incorrect interactive definition:\n"+d.message,o(c),new Error(c)}for(t("model",e.models),t("parameter",e.parameters),t("output",e.outputs),t("dataSet",e.dataSets),t("filteredOutput",e.filteredOutputs),t("helpTip",e.helpTips),i=e.models,n=0,r=i.length;r>n;n++)l=i[n],t("parameter",l.parameters),t("output",l.outputs),t("filteredOutput",l.filteredOutputs);e.experiment&&(K=e.experiment,s.validateCompleteness(a.experimentTimeSeries,K.timeSeries),t("experimentParameter",K.parameters),t("experimentDestination",K.destinations),t("experimentSavedRun",K.savedRuns)),u=e.components;try{for(n=0,r=u.length;r>n;n++)u[n]=s.validateCompleteness(a[u[n].type],u[n])}catch(d){throw c="Incorrect "+u[n].type+" component definition:\n"+d.message,o(c),new Error(c)}if(e.exports)try{e.exports=s.validateCompleteness(a.exports,e.exports)}catch(d){throw c="Incorrect exports definition:\n"+d.message,o(c),new Error(c)}return e}function x(){return"BODY"===tt.parent().prop("nodeName")}function w(e){tt.empty(),nt=$('<div class="lab-fastclick-container">'),nt.appendTo(tt),i.attach(nt[0]),nt.append('<div class="lab-dialog-container">'),ht=new O(".lab-dialog-container"),dt=new M(".lab-dialog-container"),pt=new N(".lab-dialog-container"),at=!0,yt.interactive=e,Y=$.extend(!0,{},yt.interactive),yt.interactive=b(yt.interactive),vt=yt.interactive,c(),bt=vt.models;for(var t=0,n=bt.length;n>t;t++)xt[bt[t].id]=bt[t];var r=bt[0];r&&r.url?(F(r.id),C()):r&&r.model&&(C(),F(r.id,r.model))}function T(){Ct=[],Tt={},ot=[],it=[],At=[]}function C(){T();var e=yt.interactive.models[0];Z=A(e.type,e.modelUrl,null),Z.on("modelReset",G),lt=new p(yt,null),Z.ScriptingAPI&&lt.extend(Z.ScriptingAPI),lt.exposeScriptingAPI(),st={},vt.dataSets.forEach(function(e){new l(e,yt)}),vt.exports&&(ut=new d(vt.exports,yt),d.canExportData()&&!vt.hideExportDataControl&&v({type:"button",text:"Analyze Data",id:"-lab-analyze-data",action:"exportData();"})),vt.helpTips.length>0&&(rt=new P(vt.helpTips,nt),yt.on("interactiveRendered.helpSystem",function(){function e(e){var t,n,r=0,i=e.length;if(0===i)return r;for(t=0;i>t;t++)n=e.charCodeAt(t),r=(r<<5)-r+n,r&=r;return r}yt.on("interactiveRendered.helpSystem",null);var t=e(JSON.stringify(vt));vt.helpOnLoad&&!k.hasItem("lab-help-"+t)&&(rt.start(),k.setItem("lab-help-"+t,!0))})),E(tt);for(var t=yt.interactive.components||[],n=0,r=t.length;r>n;n++)v(t[n]);vt.experiment&&(J=new B(vt.experiment,yt)),g()}function A(e,t,n){var r,i=e||"md2d";if(null===D[i])throw new Error("Couldn't understand modelType '"+i+"'!");return r=new D[i](t,n,yt)}function F(e,t,i,o){function a(e,t,n){function i(e,t){var n;for(n in e)void 0===t[n]?t[n]=r.isArray(e[n])?$.extend(!0,[],e[n]):"object"==typeof e[n]?$.extend(!0,{},e[n]):e[n]:"object"!=typeof t[n]||t[n]instanceof Array?t[n]instanceof Array&&e[n]instanceof Array&&(t[n]=$.extend(!0,e[n],t[n])):t[n]=i(e[n],t[n]);return t}var o,a;return a=$.extend(!0,{},n),a=i(e.viewOptions||{},a),o=$.extend(!0,{},t),o=i(e||{},o),o.viewOptions=a,o}function s(e,t,n,r){X=$.extend(!0,{},t);var i=a(t,u,l);if(!Z)throw new Error("REF something went wrong");Z.reload(e,i,!0),Q=Z.model,m(),lt.bindModel(Q),lt.exposeScriptingAPI(),ct.bindModel(Q),j(),n&&Q.set(n);for(var o=0;o<ot.length;o++)ot[o]();for(o=0;o<it.length;o++)it[o](Q,lt);var s=null;yt.currentModel.onLoad&&(s=lt.makeFunctionInScriptContext(y(yt.currentModel.onLoad)))(),J&&J.setOnLoadScript(s),St.modelLoaded(r||"initialLoad"),Q.ready&&Q.ready(),ft.setupModel(Z),f(),Z.initializeView(),St.interactiveRendered(),at=!1}var l,u,d,p=h(e);c(),at||(d=H(i)),et=e,yt.currentModel=p,l=p.viewOptions?$.extend(!0,{},p.viewOptions):{controlButtons:"play"},p.modelOptions&&(u=$.extend(!0,{},p.modelOptions)),t?s(p.url,t,d,o):p.model?s(p.url,p.model,d,o):p.url&&$.get(n.actualRoot+p.url).done(function(e){e="string"==typeof e?JSON.parse(e):e,s(p.url,e,d,o)}).fail(function(){t={type:"md2d",width:2.5,height:1.5,viewOptions:{backgroundColor:"rgba(245,200,200,255)",showClock:!1,textBoxes:[{text:"Model could not be loaded:",x:0,y:1,width:2.5,height:.25,fontScale:1.4,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"},{text:p.url,x:0,y:.8,width:2.5,height:.25,fontScale:.9,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"}]}},s(p.url,t,d,o)})}function j(){W("basic",yt.currentModel.outputs,vt.outputs),q(yt.currentModel.parameters,vt.parameters),W("filtered",yt.currentModel.filteredOutputs,vt.filteredOutputs)}function G(e){_t||U(e)}function U(e){St.modelReset(e)}function z(e){function t(){o||i!==r||e()}function n(){var e=!1;return{proceed:function(){e||(e=!0,i++,t())},cancel:function(){e||(e=!0,o=!0)}}}0===wt.length&&e();var r=wt.length,i=0,o=!1;wt.forEach(function(e){var t=n();e(Q,t)||t.proceed()})}function W(e,t,n){function r(e){if(e)for(var t=0;t<e.length;t++)a[e[t].name]=e[t]}if(t||n){var i,o,a={};r(n),r(t);for(i in a)if(a.hasOwnProperty(i))switch(o=a[i],e){case"basic":Q.defineOutput(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},lt.makeFunctionInScriptContext(y(o.value)));break;case"filtered":Q.defineFilteredOutput(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},o.property,o.type,o.period)}}}function q(e,n){if(e||n){var r,i,o,a,s={};for(r=(n||[]).concat(e||[]),i=0;i<r.length;i++)o=r[i],a=void 0,o.onChange&&(a=lt.makeFunctionInScriptContext("value",y(o.onChange))),Q.defineParameter(o.name,{label:o.label,unitType:o.unitType,unitName:o.unitName,unitPluralName:o.unitPluralName,unitAbbreviation:o.unitAbbreviation},a),void 0!==o.initialValue&&(s[o.name]=t(o.initialValue));Q.set(s)}}function H(e){function t(){for(var e,t={},n=0,r=arguments.length;r>n;n++){e=arguments[n];for(var i=0,o=e.length;o>i;i++)t[e[i]]=!0}return Object.keys(t)}var n=t(vt.propertiesToRetain,At,e||[]),r={};return n.forEach(function(e){Q.isPropertyWritable(e)&&(r[e]=Q.properties[e])}),r}var Y,X,J,K,Z,Q,et,tt,nt,rt,it,ot,at,st,lt,ut,ct,dt,pt,ht,ft,mt,gt,vt={},yt={},bt=[],xt={},wt=[],_t=!1,Tt={},Ct=[],At=[],St=new S("modelLoaded","interactiveRendered","modelReset","resize");return mt=function(){var e=-1;return function(){return e++}},yt={get interactiveContainer(){return nt},get scriptingAPI(){return lt},get helpSystem(){return rt},get modelController(){return Z},get randomSeed(){return gt},getDGExportController:function(){return ut},getModel:function(){return Q},getDataSet:function(e){return st[e]},addDataSet:function(e,t){ot.push($.proxy(e.modelLoadedCallback,e)),t||(st[e.name]=e)},getScriptingAPI:function(){return lt},getModelController:function(){return Z},getComponent:function(e){return Tt[e]},getNextTabIndex:mt,loadInteractive:w,reloadInteractive:function(){Q.stop(),z(function(){yt.loadInteractive(Y)})},loadModel:F,reloadModel:function(e){e||(e={}),e.cause||(e.cause="reload"),Q.stop(),z(function(){c(),yt.loadModel(et,X,e.propertiesToRetain,e.cause)})},resetModel:function(e){Q.stop(),z(function(){e=e||{};var t=H(e.propertiesToRetain);_t=!0,Z.reset(e.cause),Q.set(t),U(e.cause),_t=!1})},updateModelView:function(){Z.updateView()},repaintModelView:function(){Z.repaint()},resize:function(){f(),St.resize()},on:function(e,t){"willResetModel"===e?wt.push(t):St.on(e,t)},get:function(e){return vt[e]},serialize:function(){var e,n,i;if(e={title:vt.title,publicationStatus:vt.publicationStatus,labEnvironment:vt.labEnvironment,subtitle:vt.subtitle,category:vt.category,subCategory:vt.subCategory,screenshot:vt.screenshot,aspectRatio:vt.aspectRatio,fontScale:vt.fontScale,helpOnLoad:vt.helpOnLoad,about:r.isArray(vt.about)?$.extend(!0,[],vt.about):vt.about,models:$.extend(!0,[],vt.models),propertiesToRetain:$.extend(!0,[],vt.propertiesToRetain),parameters:$.extend(!0,[],vt.parameters),outputs:$.extend(!0,[],vt.outputs),filteredOutputs:$.extend(!0,[],vt.filteredOutputs),helpTips:$.extend(!0,[],vt.helpTips)},void 0!==Q&&void 0!==Q.get){var o=function(){for(var t=0,n=e.models.length;n>t;t++)if(e.models[t].id===et)return e.models[t].parameters||[];return[]}(),a=e.parameters,s={};o.forEach(function(e){s[e.name]=!0;var n=Q.get(e.name);void 0!==n&&(e.initialValue=t(n))}),a.forEach(function(e){if(!s[e.name]){var n=Q.get(e.name);void 0!==n&&(e.initialValue=t(n))}})}void 0!==vt.importedFrom&&(e.importedFrom=vt.importedFrom),void 0!==vt.hideExportDataControl&&(e.hideExportDataControl=vt.hideExportDataControl),void 0!==vt.exports&&(e.exports=$.extend(!0,{},vt.exports)),void 0!==vt.experiment&&(e.experiment=$.extend(!0,{},vt.experiment)),void 0!==vt.randomSeed&&(e.randomSeed=vt.randomSeed),e.dataSets=[];for(var l in st)e.dataSets.push(st[l].serialize());for(e.components=[],n=0,i=Ct.length;i>n;n++)Ct[n].serialize&&e.components.push(Ct[n].serialize());return e.layout=$.extend(!0,{},vt.layout),e.template="string"==typeof vt.template?vt.template:$.extend(!0,[],vt.template),e},benchmarks:[{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}},{name:"layout (iterations)",numeric:!0,formatter:d3.format("g"),run:function(e){e(ft.layoutInteractive())}},{name:"layout (ms)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t=+Date.now();ft.layoutInteractive(),e(Date.now()-t)}}],getLoadedModelId:function(){return et},validateInteractive:b},tt=$(u),tt.addClass("lab-interactive-container"),ft=new L,yt.on("resize.share-dialog",function(){pt.updateIframeSize()}),ct=new _(yt),null!=e&&w(e),yt}}),define("grapher/public-api",["require","../lab.config","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","lab-grapher"],function(e){"use strict";var t=e("../lab.config"),n=e("grapher/bar-graph/bar-graph-model"),r=e("grapher/bar-graph/bar-graph-view"),i=e("lab-grapher");return window.Lab=window.Lab||{},window.Lab.grapher=window.Lab.grapher||{},window.Lab.grapher.BarGraphModel=n,window.Lab.grapher.BarGraphView=r,window.Lab.grapher.Graph=i,window.Lab.config=t,window.Lab.grapher}),define("import-export/netlogo-importer",["require","underscore"],function(e){function t(e){return e.units?e.label+" ("+e.units+")":e.label}var n=e("underscore"),r=["computationalInputs","computationalOutputs","studentInputs"];return{importRun:function(e,i){return"string"==typeof e&&(e=JSON.parse(e)),{perRunLabels:n.flatten(r.map(function(t){return e.description[t]})).map(t),perRunValues:n.flatten(r.map(function(t){return e.runs[i][t]})),perTickLabels:e.description.timeSeriesData.map(t),perTickValues:e.runs[i].timeSeriesData.map(function(e){return e.map(n.identity)})}},numberOfRuns:function(e){return"string"==typeof e&&(e=JSON.parse(e)),e.runs.length},timeStamps:function(e){return"string"==typeof e&&(e=JSON.parse(e)),n.pluck(e.runs,"timeStamp")},runHavingTimeStamp:function(e,t){"string"==typeof e&&(e=JSON.parse(e));for(var n=0;n<e.runs.length;n++)if(e.runs[n].timeStamp===t)return n;return null}}}),define("import-export/public-api",["require","import-export/dg-exporter","import-export/netlogo-importer"],function(e){"use strict";return window.Lab=window.Lab||{},window.Lab.importExport={version:"0.0.1",dgExporter:e("import-export/dg-exporter"),netlogoImporter:e("import-export/netlogo-importer")}}),define("public-api",["require","lab.version","lab.config","common/controllers/interactives-controller","common/benchmark/benchmark","grapher/public-api","import-export/public-api"],function(e){var t=e("lab.version"),n=e("lab.config"),r=e("common/controllers/interactives-controller"),i=e("common/benchmark/benchmark");e("grapher/public-api"),e("import-export/public-api"),window.Lab=window.Lab||{},window.Lab.version=t,window.Lab.config=n,window.Lab.InteractivesController=r,window.Lab.benchmark=i}),require(["public-api"],void 0,void 0,!0)}();